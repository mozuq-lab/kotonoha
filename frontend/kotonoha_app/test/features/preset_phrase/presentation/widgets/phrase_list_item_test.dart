/// PhraseListItem ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
///
/// TASK-0040: å®šå‹æ–‡ä¸€è¦§UIå®Ÿè£…
/// ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹: TC-040-011ã€œTC-040-016, TC-040-033ã€œTC-040-035
///
/// ãƒ†ã‚¹ãƒˆå¯¾è±¡: lib/features/preset_phrase/presentation/widgets/phrase_list_item.dart
///
/// ã€TDD Redãƒ•ã‚§ãƒ¼ã‚ºã€‘: ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆãŒæœªå®Ÿè£…ã®ãŸã‚ã€ã“ã®ãƒ†ã‚¹ãƒˆã¯å¤±æ•—ã™ã‚‹
library;

import 'package:flutter/material.dart';
import 'package:flutter_test/flutter_test.dart';
import 'package:kotonoha_app/core/constants/app_sizes.dart';
import 'package:kotonoha_app/features/preset_phrase/presentation/widgets/phrase_list_item.dart';
import 'package:kotonoha_app/shared/models/preset_phrase.dart';

void main() {
  // ==========================================================================
  // ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™
  // ==========================================================================

  /// ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: ãƒ†ã‚¹ãƒˆç”¨ã®å®šå‹æ–‡ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
  PresetPhrase createTestPhrase({
    required String id,
    required String content,
    String category = 'daily',
    bool isFavorite = false,
    int displayOrder = 0,
  }) {
    final now = DateTime.now();
    return PresetPhrase(
      id: id,
      content: content,
      category: category,
      isFavorite: isFavorite,
      displayOrder: displayOrder,
      createdAt: now,
      updatedAt: now,
    );
  }

  group('PhraseListItem - æ­£å¸¸ç³»ãƒ†ã‚¹ãƒˆ', () {
    // =========================================================================
    // TC-040-011: å®šå‹æ–‡ã‚¢ã‚¤ãƒ†ãƒ ãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹
    // =========================================================================
    /// TC-040-011: PhraseListItemãŒå®šå‹æ–‡å†…å®¹ã‚’æ­£ã—ãè¡¨ç¤ºã™ã‚‹ã“ã¨ã‚’ç¢ºèª
    ///
    /// ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: ã‚¢ã‚¤ãƒ†ãƒ è¡¨ç¤ºã®ç¢ºèª
    /// ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: å€‹åˆ¥ã‚¢ã‚¤ãƒ†ãƒ ã®è¡¨ç¤º
    /// ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: contentãŒè¡¨ç¤ºã•ã‚Œã‚‹
    ///
    /// ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ğŸ”µ é’ä¿¡å·
    /// é–¢é€£è¦ä»¶: REQ-101
    /// å„ªå…ˆåº¦: P0 å¿…é ˆ
    testWidgets('TC-040-011: PhraseListItemãŒå®šå‹æ–‡å†…å®¹ã‚’æ­£ã—ãè¡¨ç¤ºã™ã‚‹', (tester) async {
      final phrase = createTestPhrase(id: '1', content: 'ã“ã‚“ã«ã¡ã¯');

      await tester.pumpWidget(
        MaterialApp(
          home: Scaffold(
            body: PhraseListItem(
              phrase: phrase,
            ),
          ),
        ),
      );

      // ã€çµæœæ¤œè¨¼ã€‘: å®šå‹æ–‡å†…å®¹ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      expect(find.text('ã“ã‚“ã«ã¡ã¯'), findsOneWidget); // ã€ç¢ºèªå†…å®¹ã€‘: ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤º ğŸ”µ
    });

    // =========================================================================
    // TC-040-012: ãŠæ°—ã«å…¥ã‚Šã‚¢ã‚¤ã‚³ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹
    // =========================================================================
    /// TC-040-012: ãŠæ°—ã«å…¥ã‚Šå®šå‹æ–‡ã«ãŠæ°—ã«å…¥ã‚Šã‚¢ã‚¤ã‚³ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
    ///
    /// ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: ãŠæ°—ã«å…¥ã‚Šè¡¨ç¤ºã®ç¢ºèª
    /// ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: ãŠæ°—ã«å…¥ã‚Šãƒ•ãƒ©ã‚°ã®è¦–è¦šçš„è¡¨ç¤º
    /// ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: isFavorite=trueã®å ´åˆã€ãŠæ°—ã«å…¥ã‚Šã‚¢ã‚¤ã‚³ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹
    ///
    /// ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ğŸŸ¡ é»„ä¿¡å·
    /// é–¢é€£è¦ä»¶: REQ-105
    /// å„ªå…ˆåº¦: P1 é‡è¦
    testWidgets('TC-040-012: ãŠæ°—ã«å…¥ã‚Šå®šå‹æ–‡ã«ãŠæ°—ã«å…¥ã‚Šã‚¢ã‚¤ã‚³ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹', (tester) async {
      final phrase = createTestPhrase(id: '1', content: 'ãŠæ°—ã«å…¥ã‚Š', isFavorite: true);

      await tester.pumpWidget(
        MaterialApp(
          home: Scaffold(
            body: PhraseListItem(
              phrase: phrase,
            ),
          ),
        ),
      );

      // ã€çµæœæ¤œè¨¼ã€‘: ãŠæ°—ã«å…¥ã‚Šã‚¢ã‚¤ã‚³ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      expect(find.byIcon(Icons.star), findsOneWidget); // ã€ç¢ºèªå†…å®¹ã€‘: æ˜Ÿã‚¢ã‚¤ã‚³ãƒ³è¡¨ç¤º ğŸŸ¡
    });

    // =========================================================================
    // TC-040-013: ã‚¿ãƒƒãƒ—æ™‚ã«ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒç™ºç«ã™ã‚‹
    // =========================================================================
    /// TC-040-013: PhraseListItemã‚¿ãƒƒãƒ—ã§onTapã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒç™ºç«ã™ã‚‹ã“ã¨ã‚’ç¢ºèª
    ///
    /// ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: ã‚¿ãƒƒãƒ—ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ç¢ºèª
    /// ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: ã‚¿ãƒƒãƒ—ã‚¤ãƒ™ãƒ³ãƒˆã®ä¼æ’­
    /// ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: ã‚¿ãƒƒãƒ—ã§onTapãŒå‘¼ã³å‡ºã•ã‚Œã‚‹
    ///
    /// ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ğŸ”µ é’ä¿¡å·
    /// é–¢é€£è¦ä»¶: AC-004
    /// å„ªå…ˆåº¦: P0 å¿…é ˆ
    testWidgets('TC-040-013: PhraseListItemã‚¿ãƒƒãƒ—ã§onTapã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒç™ºç«ã™ã‚‹', (tester) async {
      bool tapped = false;
      final phrase = createTestPhrase(id: '1', content: 'ã‚¿ãƒƒãƒ—ãƒ†ã‚¹ãƒˆ');

      await tester.pumpWidget(
        MaterialApp(
          home: Scaffold(
            body: PhraseListItem(
              phrase: phrase,
              onTap: () => tapped = true,
            ),
          ),
        ),
      );

      // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: ã‚¢ã‚¤ãƒ†ãƒ ã‚’ã‚¿ãƒƒãƒ—
      await tester.tap(find.text('ã‚¿ãƒƒãƒ—ãƒ†ã‚¹ãƒˆ'));
      await tester.pumpAndSettle();

      // ã€çµæœæ¤œè¨¼ã€‘: ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒå‘¼ã³å‡ºã•ã‚ŒãŸã“ã¨ã‚’ç¢ºèª
      expect(tapped, isTrue); // ã€ç¢ºèªå†…å®¹ã€‘: ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ç™ºç« ğŸ”µ
    });

    // =========================================================================
    // TC-040-014: é•·ã„ãƒ†ã‚­ã‚¹ãƒˆãŒçœç•¥è¡¨ç¤ºã•ã‚Œã‚‹
    // =========================================================================
    /// TC-040-014: é•·ã„å®šå‹æ–‡ãƒ†ã‚­ã‚¹ãƒˆãŒçœç•¥è¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
    ///
    /// ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: ãƒ†ã‚­ã‚¹ãƒˆã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼å‡¦ç†ç¢ºèª
    /// ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: ãƒ†ã‚­ã‚¹ãƒˆã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼å‡¦ç†
    /// ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: é•·ã„ãƒ†ã‚­ã‚¹ãƒˆãŒ...ã§çœç•¥ã•ã‚Œã‚‹
    ///
    /// ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ğŸŸ¡ é»„ä¿¡å·
    /// é–¢é€£è¦ä»¶: UIå“è³ª
    /// å„ªå…ˆåº¦: P2 ä½
    testWidgets('TC-040-014: é•·ã„å®šå‹æ–‡ãƒ†ã‚­ã‚¹ãƒˆãŒçœç•¥è¡¨ç¤ºã•ã‚Œã‚‹', (tester) async {
      // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: 100æ–‡å­—ã®é•·ã„ãƒ†ã‚­ã‚¹ãƒˆ
      final longContent = 'ã‚' * 100;
      final phrase = createTestPhrase(id: '1', content: longContent);

      await tester.pumpWidget(
        MaterialApp(
          home: Scaffold(
            body: SizedBox(
              width: 200, // å¹…ã‚’åˆ¶é™
              child: PhraseListItem(
                phrase: phrase,
              ),
            ),
          ),
        ),
      );

      // ã€çµæœæ¤œè¨¼ã€‘: Textã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆãŒoverflowè¨­å®šã‚’æŒã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
      final textWidget = tester.widget<Text>(find.byType(Text).first);
      expect(textWidget.overflow, equals(TextOverflow.ellipsis)); // ã€ç¢ºèªå†…å®¹ã€‘: çœç•¥è¨­å®š ğŸŸ¡
    });
  });

  group('PhraseListItem - ã‚µã‚¤ã‚ºãƒ»ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ', () {
    // =========================================================================
    // TC-040-015: ã‚¢ã‚¤ãƒ†ãƒ ã®æœ€å°é«˜ã•ãŒ44pxä»¥ä¸Š
    // =========================================================================
    /// TC-040-015: PhraseListItemã®æœ€å°é«˜ã•ãŒ44pxä»¥ä¸Šã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
    ///
    /// ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: ã‚µã‚¤ã‚ºè¦ä»¶ç¢ºèª
    /// ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£è¦ä»¶
    /// ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: ã‚¢ã‚¤ãƒ†ãƒ é«˜ã•ãŒ44pxä»¥ä¸Š
    ///
    /// ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ğŸ”µ é’ä¿¡å·
    /// é–¢é€£è¦ä»¶: REQ-5001, AC-008
    /// å„ªå…ˆåº¦: P0 å¿…é ˆ
    testWidgets('TC-040-015: PhraseListItemã®æœ€å°é«˜ã•ãŒ44pxä»¥ä¸Š', (tester) async {
      final phrase = createTestPhrase(id: '1', content: 'ã‚');

      await tester.pumpWidget(
        MaterialApp(
          home: Scaffold(
            body: PhraseListItem(
              phrase: phrase,
            ),
          ),
        ),
      );

      // ã€çµæœæ¤œè¨¼ã€‘: æœ€å°é«˜ã•ã‚’ç¢ºèª
      final itemSize = tester.getSize(find.byType(PhraseListItem));
      expect(itemSize.height, greaterThanOrEqualTo(AppSizes.minTapTarget)); // ã€ç¢ºèªå†…å®¹ã€‘: 44pxä»¥ä¸Š ğŸ”µ
    });

    // =========================================================================
    // TC-040-016: ã‚¢ã‚¤ãƒ†ãƒ ã®æ¨å¥¨é«˜ã•60px
    // =========================================================================
    /// TC-040-016: PhraseListItemã®æ¨å¥¨é«˜ã•ãŒ60pxã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
    ///
    /// ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: æ¨å¥¨ã‚µã‚¤ã‚ºç¢ºèª
    /// ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: æ¨å¥¨ã‚µã‚¤ã‚º
    /// ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: ã‚¢ã‚¤ãƒ†ãƒ é«˜ã•ãŒ60pxç¨‹åº¦
    ///
    /// ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ğŸŸ¡ é»„ä¿¡å·
    /// é–¢é€£è¦ä»¶: NFR-202
    /// å„ªå…ˆåº¦: P2 ä½
    testWidgets('TC-040-016: PhraseListItemã®æ¨å¥¨é«˜ã•ãŒ60px', (tester) async {
      final phrase = createTestPhrase(id: '1', content: 'æ¨å¥¨ã‚µã‚¤ã‚ºãƒ†ã‚¹ãƒˆ');

      await tester.pumpWidget(
        MaterialApp(
          home: Scaffold(
            body: PhraseListItem(
              phrase: phrase,
            ),
          ),
        ),
      );

      // ã€çµæœæ¤œè¨¼ã€‘: æ¨å¥¨é«˜ã•ã‚’ç¢ºèª
      final itemSize = tester.getSize(find.byType(PhraseListItem));
      expect(itemSize.height, greaterThanOrEqualTo(AppSizes.recommendedTapTarget)); // ã€ç¢ºèªå†…å®¹ã€‘: 60pxä»¥ä¸Š ğŸŸ¡
    });
  });

  group('PhraseListItem - å¢ƒç•Œå€¤ãƒ†ã‚¹ãƒˆ', () {
    // =========================================================================
    // TC-040-033: å®šå‹æ–‡ãƒ†ã‚­ã‚¹ãƒˆãŒ1æ–‡å­—ã®å ´åˆ
    // =========================================================================
    /// TC-040-033: å®šå‹æ–‡ãƒ†ã‚­ã‚¹ãƒˆãŒæœ€çŸ­ï¼ˆ1æ–‡å­—ï¼‰ã®å ´åˆã‚’ç¢ºèª
    ///
    /// ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: æœ€çŸ­ãƒ†ã‚­ã‚¹ãƒˆã®ç¢ºèª
    /// ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: 1æ–‡å­—ã§ã‚‚æ­£ã—ãè¡¨ç¤º
    /// ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: ã€Œã‚ã€ãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹
    ///
    /// ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ğŸŸ¡ é»„ä¿¡å·
    /// é–¢é€£è¦ä»¶: UIå“è³ª
    /// å„ªå…ˆåº¦: P2 ä½
    testWidgets('TC-040-033: å®šå‹æ–‡ãƒ†ã‚­ã‚¹ãƒˆãŒæœ€çŸ­ï¼ˆ1æ–‡å­—ï¼‰ã®å ´åˆ', (tester) async {
      final phrase = createTestPhrase(id: '1', content: 'ã‚');

      await tester.pumpWidget(
        MaterialApp(
          home: Scaffold(
            body: PhraseListItem(
              phrase: phrase,
            ),
          ),
        ),
      );

      // ã€çµæœæ¤œè¨¼ã€‘: 1æ–‡å­—ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      expect(find.text('ã‚'), findsOneWidget); // ã€ç¢ºèªå†…å®¹ã€‘: 1æ–‡å­—è¡¨ç¤º ğŸŸ¡
    });

    // =========================================================================
    // TC-040-034: å®šå‹æ–‡ãƒ†ã‚­ã‚¹ãƒˆãŒ500æ–‡å­—ï¼ˆä¸Šé™å€¤ï¼‰ã®å ´åˆ
    // =========================================================================
    /// TC-040-034: å®šå‹æ–‡ãƒ†ã‚­ã‚¹ãƒˆãŒ500æ–‡å­—ï¼ˆä¸Šé™å€¤ï¼‰ã®å ´åˆã‚’ç¢ºèª
    ///
    /// ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: ä¸Šé™ãƒ†ã‚­ã‚¹ãƒˆã®ç¢ºèª
    /// ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: ä¸Šé™ãƒ†ã‚­ã‚¹ãƒˆã§ã‚‚æ­£ã—ãçœç•¥è¡¨ç¤º
    /// ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: ãƒ†ã‚­ã‚¹ãƒˆãŒçœç•¥è¡¨ç¤ºã•ã‚Œã‚‹
    ///
    /// ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ğŸŸ¡ é»„ä¿¡å·
    /// é–¢é€£è¦ä»¶: EDGE-102
    /// å„ªå…ˆåº¦: P2 ä½
    testWidgets('TC-040-034: å®šå‹æ–‡ãƒ†ã‚­ã‚¹ãƒˆãŒ500æ–‡å­—ï¼ˆä¸Šé™å€¤ï¼‰ã®å ´åˆ', (tester) async {
      // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: 500æ–‡å­—ã®ãƒ†ã‚­ã‚¹ãƒˆ
      final longContent = 'ã‚' * 500;
      final phrase = createTestPhrase(id: '1', content: longContent);

      await tester.pumpWidget(
        MaterialApp(
          home: Scaffold(
            body: SizedBox(
              width: 300,
              child: PhraseListItem(
                phrase: phrase,
              ),
            ),
          ),
        ),
      );

      // ã€çµæœæ¤œè¨¼ã€‘: ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆãŒã‚¨ãƒ©ãƒ¼ãªãè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      expect(find.byType(PhraseListItem), findsOneWidget); // ã€ç¢ºèªå†…å®¹ã€‘: 500æ–‡å­—ã§ã‚‚è¡¨ç¤º ğŸŸ¡
    });
  });

  group('PhraseListItem - ãŠæ°—ã«å…¥ã‚Šåˆ‡ã‚Šæ›¿ãˆãƒ†ã‚¹ãƒˆ', () {
    // =========================================================================
    // TC-040-035: ãŠæ°—ã«å…¥ã‚Šåˆ‡ã‚Šæ›¿ãˆã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒç™ºç«ã™ã‚‹
    // =========================================================================
    /// TC-040-035: ãŠæ°—ã«å…¥ã‚Šã‚¢ã‚¤ã‚³ãƒ³ã‚¿ãƒƒãƒ—ã§onFavoriteToggleãŒç™ºç«ã™ã‚‹ã“ã¨ã‚’ç¢ºèª
    ///
    /// ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: ãŠæ°—ã«å…¥ã‚Šåˆ‡ã‚Šæ›¿ãˆç¢ºèª
    /// ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: ãŠæ°—ã«å…¥ã‚Šåˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½
    /// ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: ãŠæ°—ã«å…¥ã‚Šã‚¢ã‚¤ã‚³ãƒ³ã‚¿ãƒƒãƒ—ã§ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ç™ºç«
    ///
    /// ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ğŸŸ¡ é»„ä¿¡å·
    /// é–¢é€£è¦ä»¶: REQ-105
    /// å„ªå…ˆåº¦: P1 é‡è¦
    testWidgets('TC-040-035: ãŠæ°—ã«å…¥ã‚Šã‚¢ã‚¤ã‚³ãƒ³ã‚¿ãƒƒãƒ—ã§onFavoriteToggleãŒç™ºç«ã™ã‚‹', (tester) async {
      bool favoriteToggled = false;
      final phrase = createTestPhrase(id: '1', content: 'ãŠæ°—ã«å…¥ã‚Šãƒ†ã‚¹ãƒˆ', isFavorite: false);

      await tester.pumpWidget(
        MaterialApp(
          home: Scaffold(
            body: PhraseListItem(
              phrase: phrase,
              onFavoriteToggle: () => favoriteToggled = true,
            ),
          ),
        ),
      );

      // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: ãŠæ°—ã«å…¥ã‚Šã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¿ãƒƒãƒ—
      // ãŠæ°—ã«å…¥ã‚Šã§ãªã„å ´åˆã¯star_borderã‚¢ã‚¤ã‚³ãƒ³
      await tester.tap(find.byIcon(Icons.star_border));
      await tester.pumpAndSettle();

      // ã€çµæœæ¤œè¨¼ã€‘: ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒå‘¼ã³å‡ºã•ã‚ŒãŸã“ã¨ã‚’ç¢ºèª
      expect(favoriteToggled, isTrue); // ã€ç¢ºèªå†…å®¹ã€‘: ãŠæ°—ã«å…¥ã‚Šåˆ‡ã‚Šæ›¿ãˆã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ ğŸŸ¡
    });
  });
}
