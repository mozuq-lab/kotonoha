/// PhraseListWidget ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
///
/// TASK-0040: å®šå‹æ–‡ä¸€è¦§UIå®Ÿè£…
/// ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹: TC-040-001ã€œTC-040-010, TC-040-024ã€œTC-040-032
///
/// ãƒ†ã‚¹ãƒˆå¯¾è±¡: lib/features/preset_phrase/presentation/widgets/phrase_list_widget.dart
///
/// ã€TDD Redãƒ•ã‚§ãƒ¼ã‚ºã€‘: ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆãŒæœªå®Ÿè£…ã®ãŸã‚ã€ã“ã®ãƒ†ã‚¹ãƒˆã¯å¤±æ•—ã™ã‚‹
library;

import 'package:flutter/material.dart';
import 'package:flutter_test/flutter_test.dart';
import 'package:kotonoha_app/core/themes/dark_theme.dart';
import 'package:kotonoha_app/core/themes/high_contrast_theme.dart';
import 'package:kotonoha_app/core/themes/light_theme.dart';
import 'package:kotonoha_app/features/preset_phrase/presentation/widgets/phrase_list_item.dart';
import 'package:kotonoha_app/features/preset_phrase/presentation/widgets/phrase_list_widget.dart';
import 'package:kotonoha_app/shared/models/preset_phrase.dart';

void main() {
  // ==========================================================================
  // ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™
  // ==========================================================================

  /// ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: ãƒ†ã‚¹ãƒˆç”¨ã®å®šå‹æ–‡ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
  /// ã€åˆæœŸæ¡ä»¶è¨­å®šã€‘: å„ãƒ†ã‚¹ãƒˆã§ä¸€è²«ã—ãŸãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚
  PresetPhrase createTestPhrase({
    required String id,
    required String content,
    String category = 'daily',
    bool isFavorite = false,
    int displayOrder = 0,
  }) {
    final now = DateTime.now();
    return PresetPhrase(
      id: id,
      content: content,
      category: category,
      isFavorite: isFavorite,
      displayOrder: displayOrder,
      createdAt: now,
      updatedAt: now,
    );
  }

  /// ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: è¤‡æ•°ä»¶ã®å®šå‹æ–‡ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ
  List<PresetPhrase> createTestPhrases(int count, {String? category}) {
    return List.generate(
      count,
      (i) => createTestPhrase(
        id: 'test_$i',
        content: 'ãƒ†ã‚¹ãƒˆå®šå‹æ–‡$i',
        category: category ??
            (i % 3 == 0 ? 'daily' : (i % 3 == 1 ? 'health' : 'other')),
      ),
    );
  }

  group('PhraseListWidget - æ­£å¸¸ç³»ãƒ†ã‚¹ãƒˆ', () {
    // =========================================================================
    // TC-040-001: å®šå‹æ–‡ä¸€è¦§ãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹
    // =========================================================================
    /// TC-040-001: PhraseListWidgetãŒå®šå‹æ–‡ãƒªã‚¹ãƒˆã‚’æ­£ã—ãè¡¨ç¤ºã™ã‚‹ã“ã¨ã‚’ç¢ºèª
    ///
    /// ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: åŸºæœ¬çš„ãªä¸€è¦§è¡¨ç¤ºæ©Ÿèƒ½ã®ç¢ºèª
    /// ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: è¤‡æ•°ã®å®šå‹æ–‡ãŒæ¸¡ã•ã‚ŒãŸå ´åˆã«ã€ã™ã¹ã¦è¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨
    /// ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: 3ä»¶ã®å®šå‹æ–‡ãŒã™ã¹ã¦ç”»é¢ä¸Šã«è¡¨ç¤ºã•ã‚Œã‚‹
    ///
    /// ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ğŸ”µ é’ä¿¡å·
    /// é–¢é€£è¦ä»¶: REQ-101
    /// å„ªå…ˆåº¦: P0 å¿…é ˆ
    testWidgets('TC-040-001: å®šå‹æ–‡ä¸€è¦§ãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹', (tester) async {
      // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: 3ã‚«ãƒ†ã‚´ãƒªã®å®šå‹æ–‡ãƒ‡ãƒ¼ã‚¿ã‚’ç”¨æ„
      final phrases = [
        createTestPhrase(id: '1', content: 'ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™', category: 'daily'),
        createTestPhrase(id: '2', content: 'ä½“èª¿ãŒæ‚ªã„ã§ã™', category: 'health'),
        createTestPhrase(id: '3', content: 'ãŠé¡˜ã„ã—ã¾ã™', category: 'other'),
      ];

      // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: PhraseListWidgetã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
      await tester.pumpWidget(
        MaterialApp(
          home: Scaffold(
            body: PhraseListWidget(
              phrases: phrases,
              onPhraseSelected: (_) {},
            ),
          ),
        ),
      );

      // ã€çµæœæ¤œè¨¼ã€‘: ã™ã¹ã¦ã®å®šå‹æ–‡ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      expect(
          find.text('ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™'), findsOneWidget); // ã€ç¢ºèªå†…å®¹ã€‘: æ—¥å¸¸ã‚«ãƒ†ã‚´ãƒªã®å®šå‹æ–‡ãŒè¡¨ç¤º ğŸ”µ
      expect(find.text('ä½“èª¿ãŒæ‚ªã„ã§ã™'), findsOneWidget); // ã€ç¢ºèªå†…å®¹ã€‘: ä½“èª¿ã‚«ãƒ†ã‚´ãƒªã®å®šå‹æ–‡ãŒè¡¨ç¤º ğŸ”µ
      expect(find.text('ãŠé¡˜ã„ã—ã¾ã™'), findsOneWidget); // ã€ç¢ºèªå†…å®¹ã€‘: ãã®ä»–ã‚«ãƒ†ã‚´ãƒªã®å®šå‹æ–‡ãŒè¡¨ç¤º ğŸ”µ
    });

    // =========================================================================
    // TC-040-002: ãŠæ°—ã«å…¥ã‚Šå®šå‹æ–‡ãŒãƒªã‚¹ãƒˆä¸Šéƒ¨ã«è¡¨ç¤ºã•ã‚Œã‚‹
    // =========================================================================
    /// TC-040-002: ãŠæ°—ã«å…¥ã‚Šãƒ•ãƒ©ã‚°ä»˜ãã®å®šå‹æ–‡ãŒé€šå¸¸ã®å®šå‹æ–‡ã‚ˆã‚Šä¸Šã«è¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
    ///
    /// ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: ãŠæ°—ã«å…¥ã‚Šå„ªå…ˆè¡¨ç¤ºã®ç¢ºèª
    /// ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: ãŠæ°—ã«å…¥ã‚Šã¨é€šå¸¸ã®å®šå‹æ–‡ãŒæ··åœ¨ã—ãŸå ´åˆã®è¡¨ç¤ºé †åº
    /// ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: ãŠæ°—ã«å…¥ã‚Šã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒã‚«ãƒ†ã‚´ãƒªã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚ˆã‚Šå…ˆã«è¡¨ç¤ºã•ã‚Œã‚‹
    ///
    /// ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ğŸ”µ é’ä¿¡å·
    /// é–¢é€£è¦ä»¶: REQ-105
    /// å„ªå…ˆåº¦: P0 å¿…é ˆ
    testWidgets('TC-040-002: ãŠæ°—ã«å…¥ã‚Šå®šå‹æ–‡ãŒãƒªã‚¹ãƒˆä¸Šéƒ¨ã«å„ªå…ˆè¡¨ç¤ºã•ã‚Œã‚‹', (tester) async {
      // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: ãŠæ°—ã«å…¥ã‚Š2ä»¶ + é€šå¸¸1ä»¶
      final phrases = [
        createTestPhrase(
            id: '1', content: 'é€šå¸¸å®šå‹æ–‡', category: 'daily', isFavorite: false),
        createTestPhrase(
            id: '2', content: 'ãŠæ°—ã«å…¥ã‚Šå®šå‹æ–‡1', category: 'daily', isFavorite: true),
        createTestPhrase(
            id: '3',
            content: 'ãŠæ°—ã«å…¥ã‚Šå®šå‹æ–‡2',
            category: 'health',
            isFavorite: true),
      ];

      await tester.pumpWidget(
        MaterialApp(
          home: Scaffold(
            body: PhraseListWidget(
              phrases: phrases,
              onPhraseSelected: (_) {},
            ),
          ),
        ),
      );

      // ã€çµæœæ¤œè¨¼ã€‘: ãŠæ°—ã«å…¥ã‚Šã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      expect(
          find.text('ãŠæ°—ã«å…¥ã‚Š'), findsOneWidget); // ã€ç¢ºèªå†…å®¹ã€‘: ãŠæ°—ã«å…¥ã‚Šã‚»ã‚¯ã‚·ãƒ§ãƒ³ãƒ˜ãƒƒãƒ€ãƒ¼ãŒè¡¨ç¤º ğŸ”µ

      // ã€çµæœæ¤œè¨¼ã€‘: ãŠæ°—ã«å…¥ã‚Šå®šå‹æ–‡ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      expect(find.text('ãŠæ°—ã«å…¥ã‚Šå®šå‹æ–‡1'), findsOneWidget); // ã€ç¢ºèªå†…å®¹ã€‘: ãŠæ°—ã«å…¥ã‚Š1ãŒè¡¨ç¤º ğŸ”µ
      expect(find.text('ãŠæ°—ã«å…¥ã‚Šå®šå‹æ–‡2'), findsOneWidget); // ã€ç¢ºèªå†…å®¹ã€‘: ãŠæ°—ã«å…¥ã‚Š2ãŒè¡¨ç¤º ğŸ”µ
    });

    // =========================================================================
    // TC-040-003: ã‚«ãƒ†ã‚´ãƒªåˆ¥ã«å®šå‹æ–‡ãŒåˆ†é¡è¡¨ç¤ºã•ã‚Œã‚‹
    // =========================================================================
    /// TC-040-003: ã€Œæ—¥å¸¸ã€ã€Œä½“èª¿ã€ã€Œãã®ä»–ã€ã®ã‚«ãƒ†ã‚´ãƒªã”ã¨ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–è¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
    ///
    /// ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: ã‚«ãƒ†ã‚´ãƒªåˆ†é¡æ©Ÿèƒ½ã®ç¢ºèª
    /// ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: å„ã‚«ãƒ†ã‚´ãƒªã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãƒ˜ãƒƒãƒ€ãƒ¼ã¨å®šå‹æ–‡ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨
    /// ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: 3ã¤ã®ã‚«ãƒ†ã‚´ãƒªã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒæ­£ã—ã„é †åºã§è¡¨ç¤ºã•ã‚Œã‚‹
    ///
    /// ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ğŸ”µ é’ä¿¡å·
    /// é–¢é€£è¦ä»¶: REQ-106
    /// å„ªå…ˆåº¦: P0 å¿…é ˆ
    testWidgets('TC-040-003: å®šå‹æ–‡ãŒã‚«ãƒ†ã‚´ãƒªåˆ¥ã«åˆ†é¡è¡¨ç¤ºã•ã‚Œã‚‹', (tester) async {
      // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: å„ã‚«ãƒ†ã‚´ãƒªã«1ä»¶ãšã¤
      final phrases = [
        createTestPhrase(id: '1', content: 'æ—¥å¸¸ã®æŒ¨æ‹¶', category: 'daily'),
        createTestPhrase(id: '2', content: 'ä½“èª¿ã®å ±å‘Š', category: 'health'),
        createTestPhrase(id: '3', content: 'ãã®ä»–ã®é€£çµ¡', category: 'other'),
      ];

      await tester.pumpWidget(
        MaterialApp(
          home: Scaffold(
            body: PhraseListWidget(
              phrases: phrases,
              onPhraseSelected: (_) {},
            ),
          ),
        ),
      );

      // ã€çµæœæ¤œè¨¼ã€‘: ã‚«ãƒ†ã‚´ãƒªãƒ˜ãƒƒãƒ€ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      expect(find.text('æ—¥å¸¸'), findsOneWidget); // ã€ç¢ºèªå†…å®¹ã€‘: æ—¥å¸¸ã‚«ãƒ†ã‚´ãƒªãƒ˜ãƒƒãƒ€ãƒ¼ ğŸ”µ
      expect(find.text('ä½“èª¿'), findsOneWidget); // ã€ç¢ºèªå†…å®¹ã€‘: ä½“èª¿ã‚«ãƒ†ã‚´ãƒªãƒ˜ãƒƒãƒ€ãƒ¼ ğŸ”µ
      expect(find.text('ãã®ä»–'), findsOneWidget); // ã€ç¢ºèªå†…å®¹ã€‘: ãã®ä»–ã‚«ãƒ†ã‚´ãƒªãƒ˜ãƒƒãƒ€ãƒ¼ ğŸ”µ
    });

    // =========================================================================
    // TC-040-004: å®šå‹æ–‡ã‚¿ãƒƒãƒ—ã§ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒç™ºç«ã™ã‚‹
    // =========================================================================
    /// TC-040-004: å®šå‹æ–‡ã‚¢ã‚¤ãƒ†ãƒ ã®ã‚¿ãƒƒãƒ—ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’ç¢ºèª
    ///
    /// ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: ã‚¿ãƒƒãƒ—ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ã®ç¢ºèª
    /// ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: å®šå‹æ–‡ã‚¿ãƒƒãƒ—æ™‚ã«onPhraseSelectedãŒå‘¼ã³å‡ºã•ã‚Œã‚‹ã“ã¨
    /// ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒ1å›å‘¼ã³å‡ºã•ã‚Œã€æ­£ã—ã„å®šå‹æ–‡ãŒæ¸¡ã•ã‚Œã‚‹
    ///
    /// ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ğŸ”µ é’ä¿¡å·
    /// é–¢é€£è¦ä»¶: AC-004
    /// å„ªå…ˆåº¦: P0 å¿…é ˆ
    testWidgets('TC-040-004: å®šå‹æ–‡ã‚¿ãƒƒãƒ—ã§onPhraseSelectedã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒç™ºç«ã™ã‚‹',
        (tester) async {
      // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯æ¤œè¨¼ç”¨å¤‰æ•°
      PresetPhrase? selectedPhrase;
      int callCount = 0;

      final testPhrase = createTestPhrase(id: '1', content: 'ã‚¿ãƒƒãƒ—ãƒ†ã‚¹ãƒˆ');

      await tester.pumpWidget(
        MaterialApp(
          home: Scaffold(
            body: PhraseListWidget(
              phrases: [testPhrase],
              onPhraseSelected: (p) {
                selectedPhrase = p;
                callCount++;
              },
            ),
          ),
        ),
      );

      // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: å®šå‹æ–‡ã‚’ã‚¿ãƒƒãƒ—
      await tester.tap(find.text('ã‚¿ãƒƒãƒ—ãƒ†ã‚¹ãƒˆ'));
      await tester.pumpAndSettle();

      // ã€çµæœæ¤œè¨¼ã€‘: ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒæ­£ã—ãå‘¼ã³å‡ºã•ã‚ŒãŸã“ã¨ã‚’ç¢ºèª
      expect(callCount, equals(1)); // ã€ç¢ºèªå†…å®¹ã€‘: ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒ1å›å‘¼ã³å‡ºã•ã‚ŒãŸ ğŸ”µ
      expect(selectedPhrase?.id, equals('1')); // ã€ç¢ºèªå†…å®¹ã€‘: æ­£ã—ã„å®šå‹æ–‡ãŒæ¸¡ã•ã‚ŒãŸ ğŸ”µ
      expect(
          selectedPhrase?.content, equals('ã‚¿ãƒƒãƒ—ãƒ†ã‚¹ãƒˆ')); // ã€ç¢ºèªå†…å®¹ã€‘: contentãŒä¸€è‡´ ğŸ”µ
    });

    // =========================================================================
    // TC-040-005: ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ãªãƒªã‚¹ãƒˆè¡¨ç¤º
    // =========================================================================
    /// TC-040-005: ListView.builderã«ã‚ˆã‚‹ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ãªãƒªã‚¹ãƒˆå®Ÿè£…ã‚’ç¢ºèª
    ///
    /// ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æ©Ÿèƒ½ã®ç¢ºèª
    /// ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: å®šå‹æ–‡ãŒå¤šæ•°ã‚ã‚‹å ´åˆã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ã§ã‚ã‚‹ã“ã¨
    /// ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¾Œã«ä¸‹éƒ¨ã®å®šå‹æ–‡ãŒè¡¨ç¤ºã•ã‚Œã‚‹
    ///
    /// ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ğŸŸ¡ é»„ä¿¡å·
    /// é–¢é€£è¦ä»¶: NFR-004
    /// å„ªå…ˆåº¦: P1 é‡è¦
    testWidgets('TC-040-005: å®šå‹æ–‡ãƒªã‚¹ãƒˆãŒã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ã§ã‚ã‚‹ã“ã¨', (tester) async {
      // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãŒå¿…è¦ãªä»¶æ•°
      final phrases = createTestPhrases(20);

      await tester.pumpWidget(
        MaterialApp(
          home: Scaffold(
            body: PhraseListWidget(
              phrases: phrases,
              onPhraseSelected: (_) {},
            ),
          ),
        ),
      );

      // ã€çµæœæ¤œè¨¼ã€‘: ListViewãŒä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
      expect(
          find.byType(ListView), findsOneWidget); // ã€ç¢ºèªå†…å®¹ã€‘: ListViewãŒä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ ğŸŸ¡
    });
  });

  group('PhraseListWidget - ç©ºçŠ¶æ…‹ãƒ»ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆ', () {
    // =========================================================================
    // TC-040-006: å®šå‹æ–‡0ä»¶ã§ç©ºçŠ¶æ…‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
    // =========================================================================
    /// TC-040-006: ç©ºãƒªã‚¹ãƒˆæ™‚ã®è¡¨ç¤ºã‚’ç¢ºèª
    ///
    /// ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: ç©ºçŠ¶æ…‹ã®é©åˆ‡ãªè¡¨ç¤ºç¢ºèª
    /// ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: å®šå‹æ–‡ãŒ0ä»¶ã®å ´åˆã«PhraseEmptyStateãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨
    /// ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: ã€Œå®šå‹æ–‡ãŒã‚ã‚Šã¾ã›ã‚“ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹
    ///
    /// ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ğŸ”µ é’ä¿¡å·
    /// é–¢é€£è¦ä»¶: AC-005, EDGE-104
    /// å„ªå…ˆåº¦: P0 å¿…é ˆ
    testWidgets('TC-040-006: å®šå‹æ–‡ãŒ0ä»¶ã®å ´åˆã€Œå®šå‹æ–‡ãŒã‚ã‚Šã¾ã›ã‚“ã€ã¨è¡¨ç¤ºã•ã‚Œã‚‹', (tester) async {
      // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: ç©ºãƒªã‚¹ãƒˆ
      final phrases = <PresetPhrase>[];

      await tester.pumpWidget(
        MaterialApp(
          home: Scaffold(
            body: PhraseListWidget(
              phrases: phrases,
              onPhraseSelected: (_) {},
            ),
          ),
        ),
      );

      // ã€çµæœæ¤œè¨¼ã€‘: ç©ºçŠ¶æ…‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      expect(find.text('å®šå‹æ–‡ãŒã‚ã‚Šã¾ã›ã‚“'), findsOneWidget); // ã€ç¢ºèªå†…å®¹ã€‘: ç©ºçŠ¶æ…‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ ğŸ”µ
    });

    // =========================================================================
    // TC-040-007: ç©ºã‚«ãƒ†ã‚´ãƒªã¯éè¡¨ç¤ºã«ãªã‚‹
    // =========================================================================
    /// TC-040-007: ç©ºã‚«ãƒ†ã‚´ãƒªã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³éè¡¨ç¤ºã‚’ç¢ºèª
    ///
    /// ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: ç©ºã‚«ãƒ†ã‚´ãƒªã®éè¡¨ç¤ºç¢ºèª
    /// ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: å®šå‹æ–‡ãŒ0ä»¶ã®ã‚«ãƒ†ã‚´ãƒªã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¯è¡¨ç¤ºã•ã‚Œãªã„ã“ã¨
    /// ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: ã€Œæ—¥å¸¸ã€ã®ã¿è¡¨ç¤ºã€ã€Œä½“èª¿ã€ã€Œãã®ä»–ã€ã¯éè¡¨ç¤º
    ///
    /// ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ğŸ”µ é’ä¿¡å·
    /// é–¢é€£è¦ä»¶: AC-006, EDGE-204
    /// å„ªå…ˆåº¦: P1 é‡è¦
    testWidgets('TC-040-007: å®šå‹æ–‡ãŒãªã„ã‚«ãƒ†ã‚´ãƒªã¯éè¡¨ç¤ºã«ãªã‚‹', (tester) async {
      // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: æ—¥å¸¸ã‚«ãƒ†ã‚´ãƒªã®ã¿
      final phrases = [
        createTestPhrase(id: '1', content: 'æ—¥å¸¸1', category: 'daily'),
        createTestPhrase(id: '2', content: 'æ—¥å¸¸2', category: 'daily'),
      ];

      await tester.pumpWidget(
        MaterialApp(
          home: Scaffold(
            body: PhraseListWidget(
              phrases: phrases,
              onPhraseSelected: (_) {},
            ),
          ),
        ),
      );

      // ã€çµæœæ¤œè¨¼ã€‘: æ—¥å¸¸ã‚«ãƒ†ã‚´ãƒªã®ã¿è¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      expect(find.text('æ—¥å¸¸'), findsOneWidget); // ã€ç¢ºèªå†…å®¹ã€‘: æ—¥å¸¸ã‚«ãƒ†ã‚´ãƒªã¯è¡¨ç¤º ğŸ”µ
      expect(find.text('ä½“èª¿'), findsNothing); // ã€ç¢ºèªå†…å®¹ã€‘: ä½“èª¿ã‚«ãƒ†ã‚´ãƒªã¯éè¡¨ç¤º ğŸ”µ
      expect(find.text('ãã®ä»–'), findsNothing); // ã€ç¢ºèªå†…å®¹ã€‘: ãã®ä»–ã‚«ãƒ†ã‚´ãƒªã¯éè¡¨ç¤º ğŸ”µ
    });

    // =========================================================================
    // TC-040-008: ãŠæ°—ã«å…¥ã‚Šã®ã¿å­˜åœ¨ã™ã‚‹å ´åˆã®è¡¨ç¤º
    // =========================================================================
    /// TC-040-008: ãŠæ°—ã«å…¥ã‚Šã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ã¿ã®è¡¨ç¤ºã‚’ç¢ºèª
    ///
    /// ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: ãŠæ°—ã«å…¥ã‚Šã®ã¿è¡¨ç¤ºã®ç¢ºèª
    /// ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: ãŠæ°—ã«å…¥ã‚Šã®ã¿ã§ã‚«ãƒ†ã‚´ãƒªã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒç©ºã®å ´åˆ
    /// ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: ãŠæ°—ã«å…¥ã‚Šã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ã¿è¡¨ç¤ºã•ã‚Œã‚‹
    ///
    /// ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ğŸŸ¡ é»„ä¿¡å·
    /// é–¢é€£è¦ä»¶: REQ-105
    /// å„ªå…ˆåº¦: P2 ä½
    testWidgets('TC-040-008: ãŠæ°—ã«å…¥ã‚Šã®ã¿å­˜åœ¨ã™ã‚‹å ´åˆã®æ­£å¸¸è¡¨ç¤º', (tester) async {
      // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: ãŠæ°—ã«å…¥ã‚Šã®ã¿ï¼ˆé€šå¸¸ã‚«ãƒ†ã‚´ãƒªãªã—çŠ¶æ…‹ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆï¼‰
      final phrases = [
        createTestPhrase(id: '1', content: 'ãŠæ°—ã«å…¥ã‚Š1', isFavorite: true),
        createTestPhrase(id: '2', content: 'ãŠæ°—ã«å…¥ã‚Š2', isFavorite: true),
      ];

      await tester.pumpWidget(
        MaterialApp(
          home: Scaffold(
            body: PhraseListWidget(
              phrases: phrases,
              onPhraseSelected: (_) {},
            ),
          ),
        ),
      );

      // ã€çµæœæ¤œè¨¼ã€‘: ãŠæ°—ã«å…¥ã‚Šã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      expect(find.text('ãŠæ°—ã«å…¥ã‚Š'), findsOneWidget); // ã€ç¢ºèªå†…å®¹ã€‘: ãŠæ°—ã«å…¥ã‚Šã‚»ã‚¯ã‚·ãƒ§ãƒ³ ğŸŸ¡
      expect(find.text('ãŠæ°—ã«å…¥ã‚Š1'), findsOneWidget); // ã€ç¢ºèªå†…å®¹ã€‘: ãŠæ°—ã«å…¥ã‚Š1è¡¨ç¤º ğŸŸ¡
      expect(find.text('ãŠæ°—ã«å…¥ã‚Š2'), findsOneWidget); // ã€ç¢ºèªå†…å®¹ã€‘: ãŠæ°—ã«å…¥ã‚Š2è¡¨ç¤º ğŸŸ¡
    });
  });

  group('PhraseListWidget - ã‚µã‚¤ã‚ºãƒ»ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ', () {
    // =========================================================================
    // TC-040-009: ãƒªã‚¹ãƒˆã‚¢ã‚¤ãƒ†ãƒ ã®ã‚¿ãƒƒãƒ—ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãŒ44pxä»¥ä¸Š
    // =========================================================================
    /// TC-040-009: ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£è¦ä»¶ã®ã‚¿ãƒƒãƒ—ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚µã‚¤ã‚ºã‚’ç¢ºèª
    ///
    /// ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£è¦ä»¶ã®ç¢ºèª
    /// ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: å„ã‚¢ã‚¤ãƒ†ãƒ ã®é«˜ã•ãŒ44pxä»¥ä¸Šã§ã‚ã‚‹ã“ã¨
    /// ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: ã‚¿ãƒƒãƒ—ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãŒ44pxä»¥ä¸Š
    ///
    /// ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ğŸ”µ é’ä¿¡å·
    /// é–¢é€£è¦ä»¶: REQ-5001, AC-008
    /// å„ªå…ˆåº¦: P0 å¿…é ˆ
    testWidgets('TC-040-009: ãƒªã‚¹ãƒˆã‚¢ã‚¤ãƒ†ãƒ ã®ã‚¿ãƒƒãƒ—ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚µã‚¤ã‚ºãŒ44pxä»¥ä¸Š', (tester) async {
      final phrase = createTestPhrase(id: '1', content: 'ã‚µã‚¤ã‚ºãƒ†ã‚¹ãƒˆ');

      await tester.pumpWidget(
        MaterialApp(
          home: Scaffold(
            body: PhraseListWidget(
              phrases: [phrase],
              onPhraseSelected: (_) {},
            ),
          ),
        ),
      );

      // ã€çµæœæ¤œè¨¼ã€‘: PhraseListItemã®é«˜ã•ã‚’ç¢ºèª
      final itemFinder = find.byType(PhraseListItem);
      expect(itemFinder, findsOneWidget);

      final itemBox = tester.getSize(itemFinder);
      expect(itemBox.height, greaterThanOrEqualTo(44.0)); // ã€ç¢ºèªå†…å®¹ã€‘: é«˜ã•44pxä»¥ä¸Š ğŸ”µ
    });

    // =========================================================================
    // TC-040-010: Semanticsãƒ©ãƒ™ãƒ«ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹
    // =========================================================================
    /// TC-040-010: ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒªãƒ¼ãƒ€ãƒ¼å¯¾å¿œã‚’ç¢ºèª
    ///
    /// ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒªãƒ¼ãƒ€ãƒ¼å¯¾å¿œç¢ºèª
    /// ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: å„ã‚¢ã‚¤ãƒ†ãƒ ã«Semanticsãƒ©ãƒ™ãƒ«ãŒä»˜ä¸ã•ã‚Œã‚‹ã“ã¨
    /// ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: Semanticsãƒ©ãƒ™ãƒ«ã«å®šå‹æ–‡ã®å†…å®¹ãŒå«ã¾ã‚Œã‚‹
    ///
    /// ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ğŸŸ¡ é»„ä¿¡å·
    /// é–¢é€£è¦ä»¶: ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£
    /// å„ªå…ˆåº¦: P1 é‡è¦
    testWidgets('TC-040-010: å®šå‹æ–‡ã‚¢ã‚¤ãƒ†ãƒ ã«Semanticsãƒ©ãƒ™ãƒ«ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹', (tester) async {
      final phrase = createTestPhrase(id: '1', content: 'ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™');

      await tester.pumpWidget(
        MaterialApp(
          home: Scaffold(
            body: PhraseListWidget(
              phrases: [phrase],
              onPhraseSelected: (_) {},
            ),
          ),
        ),
      );

      // ã€çµæœæ¤œè¨¼ã€‘: Semanticsã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
      final semanticsFinder = find.byWidgetPredicate(
        (widget) =>
            widget is Semantics && widget.properties.label == 'ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™',
      );
      expect(semanticsFinder, findsOneWidget); // ã€ç¢ºèªå†…å®¹ã€‘: Semanticsãƒ©ãƒ™ãƒ« ğŸŸ¡
    });
  });

  group('PhraseListWidget - ãƒ†ãƒ¼ãƒå¯¾å¿œãƒ†ã‚¹ãƒˆ', () {
    // =========================================================================
    // TC-040-024: ãƒ©ã‚¤ãƒˆãƒ†ãƒ¼ãƒã§æ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹
    // =========================================================================
    /// TC-040-024: ãƒ©ã‚¤ãƒˆãƒ†ãƒ¼ãƒã§ã®è¡¨ç¤ºã‚’ç¢ºèª
    ///
    /// ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: ãƒ†ãƒ¼ãƒé©ç”¨ç¢ºèª
    /// ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: ãƒ©ã‚¤ãƒˆãƒ†ãƒ¼ãƒã®é…è‰²ã§è¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨
    /// ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: ãƒ©ã‚¤ãƒˆãƒ†ãƒ¼ãƒã®é…è‰²ãŒé©ç”¨ã•ã‚Œã‚‹
    ///
    /// ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ğŸ”µ é’ä¿¡å·
    /// é–¢é€£è¦ä»¶: REQ-803, AC-009
    /// å„ªå…ˆåº¦: P1 é‡è¦
    testWidgets('TC-040-024: ãƒ©ã‚¤ãƒˆãƒ†ãƒ¼ãƒã§æ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹', (tester) async {
      final phrase = createTestPhrase(id: '1', content: 'ãƒ©ã‚¤ãƒˆãƒ†ãƒ¼ãƒãƒ†ã‚¹ãƒˆ');

      await tester.pumpWidget(
        MaterialApp(
          theme: lightTheme,
          home: Scaffold(
            body: PhraseListWidget(
              phrases: [phrase],
              onPhraseSelected: (_) {},
            ),
          ),
        ),
      );

      // ã€çµæœæ¤œè¨¼ã€‘: ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆãŒã‚¨ãƒ©ãƒ¼ãªãæç”»ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      expect(find.byType(PhraseListWidget),
          findsOneWidget); // ã€ç¢ºèªå†…å®¹ã€‘: ãƒ©ã‚¤ãƒˆãƒ†ãƒ¼ãƒã§æç”» ğŸ”µ
      expect(find.text('ãƒ©ã‚¤ãƒˆãƒ†ãƒ¼ãƒãƒ†ã‚¹ãƒˆ'), findsOneWidget); // ã€ç¢ºèªå†…å®¹ã€‘: ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤º ğŸ”µ
    });

    // =========================================================================
    // TC-040-025: ãƒ€ãƒ¼ã‚¯ãƒ†ãƒ¼ãƒã§æ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹
    // =========================================================================
    /// TC-040-025: ãƒ€ãƒ¼ã‚¯ãƒ†ãƒ¼ãƒã§ã®è¡¨ç¤ºã‚’ç¢ºèª
    ///
    /// ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: ãƒ†ãƒ¼ãƒé©ç”¨ç¢ºèª
    /// ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: ãƒ€ãƒ¼ã‚¯ãƒ†ãƒ¼ãƒã®é…è‰²ã§è¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨
    /// ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: ãƒ€ãƒ¼ã‚¯ãƒ†ãƒ¼ãƒã®é…è‰²ãŒé©ç”¨ã•ã‚Œã‚‹
    ///
    /// ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ğŸ”µ é’ä¿¡å·
    /// é–¢é€£è¦ä»¶: REQ-803, AC-009
    /// å„ªå…ˆåº¦: P1 é‡è¦
    testWidgets('TC-040-025: ãƒ€ãƒ¼ã‚¯ãƒ†ãƒ¼ãƒã§æ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹', (tester) async {
      final phrase = createTestPhrase(id: '1', content: 'ãƒ€ãƒ¼ã‚¯ãƒ†ãƒ¼ãƒãƒ†ã‚¹ãƒˆ');

      await tester.pumpWidget(
        MaterialApp(
          theme: darkTheme,
          home: Scaffold(
            body: PhraseListWidget(
              phrases: [phrase],
              onPhraseSelected: (_) {},
            ),
          ),
        ),
      );

      // ã€çµæœæ¤œè¨¼ã€‘: ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆãŒã‚¨ãƒ©ãƒ¼ãªãæç”»ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      expect(find.byType(PhraseListWidget),
          findsOneWidget); // ã€ç¢ºèªå†…å®¹ã€‘: ãƒ€ãƒ¼ã‚¯ãƒ†ãƒ¼ãƒã§æç”» ğŸ”µ
      expect(find.text('ãƒ€ãƒ¼ã‚¯ãƒ†ãƒ¼ãƒãƒ†ã‚¹ãƒˆ'), findsOneWidget); // ã€ç¢ºèªå†…å®¹ã€‘: ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤º ğŸ”µ
    });

    // =========================================================================
    // TC-040-026: é«˜ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆãƒ†ãƒ¼ãƒã§æ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹
    // =========================================================================
    /// TC-040-026: é«˜ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆãƒ†ãƒ¼ãƒã§ã®è¡¨ç¤ºã‚’ç¢ºèª
    ///
    /// ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: ãƒ†ãƒ¼ãƒé©ç”¨ç¢ºèª
    /// ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: é«˜ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆã®é…è‰²ã§è¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨
    /// ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: é«˜ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆã®é…è‰²ãŒé©ç”¨ã•ã‚Œã‚‹
    ///
    /// ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ğŸ”µ é’ä¿¡å·
    /// é–¢é€£è¦ä»¶: REQ-803, AC-009
    /// å„ªå…ˆåº¦: P1 é‡è¦
    testWidgets('TC-040-026: é«˜ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆãƒ†ãƒ¼ãƒã§æ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹', (tester) async {
      final phrase = createTestPhrase(id: '1', content: 'é«˜ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆãƒ†ã‚¹ãƒˆ');

      await tester.pumpWidget(
        MaterialApp(
          theme: highContrastTheme,
          home: Scaffold(
            body: PhraseListWidget(
              phrases: [phrase],
              onPhraseSelected: (_) {},
            ),
          ),
        ),
      );

      // ã€çµæœæ¤œè¨¼ã€‘: ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆãŒã‚¨ãƒ©ãƒ¼ãªãæç”»ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      expect(find.byType(PhraseListWidget),
          findsOneWidget); // ã€ç¢ºèªå†…å®¹ã€‘: é«˜ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆã§æç”» ğŸ”µ
      expect(find.text('é«˜ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆãƒ†ã‚¹ãƒˆ'), findsOneWidget); // ã€ç¢ºèªå†…å®¹ã€‘: ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤º ğŸ”µ
    });
  });

  group('PhraseListWidget - çµ±åˆãƒ»å¢ƒç•Œå€¤ãƒ†ã‚¹ãƒˆ', () {
    // =========================================================================
    // TC-040-029: ãŠæ°—ã«å…¥ã‚Šã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¨ã‚«ãƒ†ã‚´ãƒªã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ä¸¡æ–¹ãŒè¡¨ç¤ºã•ã‚Œã‚‹
    // =========================================================================
    /// TC-040-029: è¤‡åˆè¡¨ç¤ºã®çµ±åˆã‚’ç¢ºèª
    ///
    /// ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: çµ±åˆå‹•ä½œç¢ºèª
    /// ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: ãŠæ°—ã«å…¥ã‚Šâ†’æ—¥å¸¸â†’ä½“èª¿â†’ãã®ä»–ã®é †ã§è¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨
    /// ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: æ­£ã—ã„é †åºã§å…¨ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹
    ///
    /// ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ğŸ”µ é’ä¿¡å·
    /// é–¢é€£è¦ä»¶: REQ-105, REQ-106
    /// å„ªå…ˆåº¦: P0 å¿…é ˆ
    testWidgets('TC-040-029: ãŠæ°—ã«å…¥ã‚Šã¨ã‚«ãƒ†ã‚´ãƒªã®ä¸¡æ–¹ãŒæ­£ã—ã„é †åºã§è¡¨ç¤ºã•ã‚Œã‚‹', (tester) async {
      final phrases = [
        createTestPhrase(
            id: '1', content: 'ãŠæ°—ã«å…¥ã‚Š1', category: 'daily', isFavorite: true),
        createTestPhrase(
            id: '2', content: 'ãŠæ°—ã«å…¥ã‚Š2', category: 'health', isFavorite: true),
        createTestPhrase(id: '3', content: 'æ—¥å¸¸1', category: 'daily'),
        createTestPhrase(id: '4', content: 'ä½“èª¿1', category: 'health'),
        createTestPhrase(id: '5', content: 'ãã®ä»–1', category: 'other'),
      ];

      await tester.pumpWidget(
        MaterialApp(
          home: Scaffold(
            body: PhraseListWidget(
              phrases: phrases,
              onPhraseSelected: (_) {},
            ),
          ),
        ),
      );

      // ã€çµæœæ¤œè¨¼ã€‘: å…¨ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      expect(find.text('ãŠæ°—ã«å…¥ã‚Š'), findsOneWidget); // ã€ç¢ºèªå†…å®¹ã€‘: ãŠæ°—ã«å…¥ã‚Šã‚»ã‚¯ã‚·ãƒ§ãƒ³ ğŸ”µ
      expect(find.text('æ—¥å¸¸'), findsOneWidget); // ã€ç¢ºèªå†…å®¹ã€‘: æ—¥å¸¸ã‚»ã‚¯ã‚·ãƒ§ãƒ³ ğŸ”µ
      expect(find.text('ä½“èª¿'), findsOneWidget); // ã€ç¢ºèªå†…å®¹ã€‘: ä½“èª¿ã‚»ã‚¯ã‚·ãƒ§ãƒ³ ğŸ”µ
      expect(find.text('ãã®ä»–'), findsOneWidget); // ã€ç¢ºèªå†…å®¹ã€‘: ãã®ä»–ã‚»ã‚¯ã‚·ãƒ§ãƒ³ ğŸ”µ
    });

    // =========================================================================
    // TC-040-031: å®šå‹æ–‡1ä»¶ã®ã¿ã®è¡¨ç¤º
    // =========================================================================
    /// TC-040-031: æœ€å°æœ‰åŠ¹ãƒ‡ãƒ¼ã‚¿ã®ç¢ºèª
    ///
    /// ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: æœ€å°ãƒ‡ãƒ¼ã‚¿ã®ç¢ºèª
    /// ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: 1ä»¶ã§ã‚‚æ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨
    /// ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: 1ä»¶ã®å®šå‹æ–‡ãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹
    ///
    /// ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ğŸŸ¡ é»„ä¿¡å·
    /// é–¢é€£è¦ä»¶: REQ-101
    /// å„ªå…ˆåº¦: P1 é‡è¦
    testWidgets('TC-040-031: å®šå‹æ–‡ãŒ1ä»¶ã®ã¿ã®å ´åˆã®è¡¨ç¤º', (tester) async {
      final phrases = [
        createTestPhrase(id: '1', content: 'å”¯ä¸€ã®å®šå‹æ–‡', category: 'daily'),
      ];

      await tester.pumpWidget(
        MaterialApp(
          home: Scaffold(
            body: PhraseListWidget(
              phrases: phrases,
              onPhraseSelected: (_) {},
            ),
          ),
        ),
      );

      // ã€çµæœæ¤œè¨¼ã€‘: 1ä»¶ã®å®šå‹æ–‡ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      expect(find.text('å”¯ä¸€ã®å®šå‹æ–‡'), findsOneWidget); // ã€ç¢ºèªå†…å®¹ã€‘: 1ä»¶è¡¨ç¤º ğŸŸ¡
      expect(find.text('æ—¥å¸¸'), findsOneWidget); // ã€ç¢ºèªå†…å®¹ã€‘: ã‚«ãƒ†ã‚´ãƒªã‚‚è¡¨ç¤º ğŸŸ¡
    });
  });
}
