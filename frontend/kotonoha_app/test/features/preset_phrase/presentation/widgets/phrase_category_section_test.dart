/// PhraseCategorySection ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
///
/// TASK-0040: å®šå‹æ–‡ä¸€è¦§UIå®Ÿè£…
/// ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹: TC-040-017ã€œTC-040-021
///
/// ãƒ†ã‚¹ãƒˆå¯¾è±¡: lib/features/preset_phrase/presentation/widgets/phrase_category_section.dart
///
/// ã€TDD Redãƒ•ã‚§ãƒ¼ã‚ºã€‘: ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆãŒæœªå®Ÿè£…ã®ãŸã‚ã€ã“ã®ãƒ†ã‚¹ãƒˆã¯å¤±æ•—ã™ã‚‹
library;

import 'package:flutter/material.dart';
import 'package:flutter_test/flutter_test.dart';
import 'package:kotonoha_app/features/preset_phrase/presentation/widgets/phrase_category_section.dart';
import 'package:kotonoha_app/shared/models/preset_phrase.dart';

void main() {
  // ==========================================================================
  // ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™
  // ==========================================================================

  /// ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: ãƒ†ã‚¹ãƒˆç”¨ã®å®šå‹æ–‡ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
  PresetPhrase createTestPhrase({
    required String id,
    required String content,
    String category = 'daily',
    bool isFavorite = false,
  }) {
    final now = DateTime.now();
    return PresetPhrase(
      id: id,
      content: content,
      category: category,
      isFavorite: isFavorite,
      displayOrder: 0,
      createdAt: now,
      updatedAt: now,
    );
  }

  group('PhraseCategorySection - æ­£å¸¸ç³»ãƒ†ã‚¹ãƒˆ', () {
    // =========================================================================
    // TC-040-017: ã‚«ãƒ†ã‚´ãƒªã‚»ã‚¯ã‚·ãƒ§ãƒ³ãƒ˜ãƒƒãƒ€ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹
    // =========================================================================
    /// TC-040-017: PhraseCategorySectionãŒã‚«ãƒ†ã‚´ãƒªåã‚’è¡¨ç¤ºã™ã‚‹ã“ã¨ã‚’ç¢ºèª
    ///
    /// ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: ãƒ˜ãƒƒãƒ€ãƒ¼è¡¨ç¤ºç¢ºèª
    /// ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: ã‚«ãƒ†ã‚´ãƒªãƒ˜ãƒƒãƒ€ãƒ¼è¡¨ç¤º
    /// ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: ã‚«ãƒ†ã‚´ãƒªåï¼ˆã€Œæ—¥å¸¸ã€ç­‰ï¼‰ãŒè¡¨ç¤ºã•ã‚Œã‚‹
    ///
    /// ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ğŸ”µ é’ä¿¡å·
    /// é–¢é€£è¦ä»¶: REQ-106
    /// å„ªå…ˆåº¦: P0 å¿…é ˆ
    testWidgets('TC-040-017: PhraseCategorySectionãŒã‚«ãƒ†ã‚´ãƒªåã‚’è¡¨ç¤ºã™ã‚‹', (tester) async {
      final phrases = [
        createTestPhrase(id: '1', content: 'ãƒ†ã‚¹ãƒˆ', category: 'daily'),
      ];

      await tester.pumpWidget(
        MaterialApp(
          home: Scaffold(
            body: PhraseCategorySection(
              category: 'daily',
              phrases: phrases,
            ),
          ),
        ),
      );

      // ã€çµæœæ¤œè¨¼ã€‘: ã‚«ãƒ†ã‚´ãƒªãƒ˜ãƒƒãƒ€ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      expect(find.text('æ—¥å¸¸'), findsOneWidget); // ã€ç¢ºèªå†…å®¹ã€‘: æ—¥å¸¸ãƒ˜ãƒƒãƒ€ãƒ¼è¡¨ç¤º ğŸ”µ
    });

    // =========================================================================
    // TC-040-018: æ—¥å¸¸ã‚«ãƒ†ã‚´ãƒªã®è¡¨ç¤ºåãŒæ­£ã—ã„
    // =========================================================================
    /// TC-040-018: æ—¥å¸¸ã‚«ãƒ†ã‚´ãƒªã®è¡¨ç¤ºåãŒã€Œæ—¥å¸¸ã€ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
    ///
    /// ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: è¡¨ç¤ºåãƒãƒƒãƒ”ãƒ³ã‚°ç¢ºèª
    /// ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: ã‚«ãƒ†ã‚´ãƒªè¡¨ç¤ºå
    /// ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: "daily" â†’ "æ—¥å¸¸"
    ///
    /// ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ğŸ”µ é’ä¿¡å·
    /// é–¢é€£è¦ä»¶: REQ-106
    /// å„ªå…ˆåº¦: P0 å¿…é ˆ
    testWidgets('TC-040-018: æ—¥å¸¸ã‚«ãƒ†ã‚´ãƒªã®è¡¨ç¤ºåãŒã€Œæ—¥å¸¸ã€ã§ã‚ã‚‹', (tester) async {
      // ã€çµæœæ¤œè¨¼ã€‘: é™çš„ãƒ¡ã‚½ãƒƒãƒ‰ã§è¡¨ç¤ºåã‚’ç¢ºèª
      expect(
        PhraseCategorySection.getCategoryDisplayName('daily'),
        equals('æ—¥å¸¸'),
      ); // ã€ç¢ºèªå†…å®¹ã€‘: daily â†’ æ—¥å¸¸ ğŸ”µ
    });

    // =========================================================================
    // TC-040-019: ä½“èª¿ã‚«ãƒ†ã‚´ãƒªã®è¡¨ç¤ºåãŒæ­£ã—ã„
    // =========================================================================
    /// TC-040-019: ä½“èª¿ã‚«ãƒ†ã‚´ãƒªã®è¡¨ç¤ºåãŒã€Œä½“èª¿ã€ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
    ///
    /// ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: è¡¨ç¤ºåãƒãƒƒãƒ”ãƒ³ã‚°ç¢ºèª
    /// ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: ã‚«ãƒ†ã‚´ãƒªè¡¨ç¤ºå
    /// ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: "health" â†’ "ä½“èª¿"
    ///
    /// ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ğŸ”µ é’ä¿¡å·
    /// é–¢é€£è¦ä»¶: REQ-106
    /// å„ªå…ˆåº¦: P0 å¿…é ˆ
    testWidgets('TC-040-019: ä½“èª¿ã‚«ãƒ†ã‚´ãƒªã®è¡¨ç¤ºåãŒã€Œä½“èª¿ã€ã§ã‚ã‚‹', (tester) async {
      // ã€çµæœæ¤œè¨¼ã€‘: é™çš„ãƒ¡ã‚½ãƒƒãƒ‰ã§è¡¨ç¤ºåã‚’ç¢ºèª
      expect(
        PhraseCategorySection.getCategoryDisplayName('health'),
        equals('ä½“èª¿'),
      ); // ã€ç¢ºèªå†…å®¹ã€‘: health â†’ ä½“èª¿ ğŸ”µ
    });

    // =========================================================================
    // TC-040-020: ãã®ä»–ã‚«ãƒ†ã‚´ãƒªã®è¡¨ç¤ºåãŒæ­£ã—ã„
    // =========================================================================
    /// TC-040-020: ãã®ä»–ã‚«ãƒ†ã‚´ãƒªã®è¡¨ç¤ºåãŒã€Œãã®ä»–ã€ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
    ///
    /// ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: è¡¨ç¤ºåãƒãƒƒãƒ”ãƒ³ã‚°ç¢ºèª
    /// ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: ã‚«ãƒ†ã‚´ãƒªè¡¨ç¤ºå
    /// ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: "other" â†’ "ãã®ä»–"
    ///
    /// ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ğŸ”µ é’ä¿¡å·
    /// é–¢é€£è¦ä»¶: REQ-106
    /// å„ªå…ˆåº¦: P0 å¿…é ˆ
    testWidgets('TC-040-020: ãã®ä»–ã‚«ãƒ†ã‚´ãƒªã®è¡¨ç¤ºåãŒã€Œãã®ä»–ã€ã§ã‚ã‚‹', (tester) async {
      // ã€çµæœæ¤œè¨¼ã€‘: é™çš„ãƒ¡ã‚½ãƒƒãƒ‰ã§è¡¨ç¤ºåã‚’ç¢ºèª
      expect(
        PhraseCategorySection.getCategoryDisplayName('other'),
        equals('ãã®ä»–'),
      ); // ã€ç¢ºèªå†…å®¹ã€‘: other â†’ ãã®ä»– ğŸ”µ
    });

    // =========================================================================
    // TC-040-021: ã‚»ã‚¯ã‚·ãƒ§ãƒ³å†…ã®å®šå‹æ–‡ãŒè¡¨ç¤ºã•ã‚Œã‚‹
    // =========================================================================
    /// TC-040-021: ã‚«ãƒ†ã‚´ãƒªã‚»ã‚¯ã‚·ãƒ§ãƒ³å†…ã«å®šå‹æ–‡ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
    ///
    /// ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: ã‚»ã‚¯ã‚·ãƒ§ãƒ³æ§‹æˆç¢ºèª
    /// ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: ã‚»ã‚¯ã‚·ãƒ§ãƒ³å†…ã‚¢ã‚¤ãƒ†ãƒ è¡¨ç¤º
    /// ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãƒ˜ãƒƒãƒ€ãƒ¼ã®ä¸‹ã«å®šå‹æ–‡ãŒè¡¨ç¤ºã•ã‚Œã‚‹
    ///
    /// ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ğŸ”µ é’ä¿¡å·
    /// é–¢é€£è¦ä»¶: REQ-101, REQ-106
    /// å„ªå…ˆåº¦: P0 å¿…é ˆ
    testWidgets('TC-040-021: ã‚«ãƒ†ã‚´ãƒªã‚»ã‚¯ã‚·ãƒ§ãƒ³å†…ã«å®šå‹æ–‡ãŒè¡¨ç¤ºã•ã‚Œã‚‹', (tester) async {
      final phrases = [
        createTestPhrase(id: '1', content: 'å®šå‹æ–‡1', category: 'daily'),
        createTestPhrase(id: '2', content: 'å®šå‹æ–‡2', category: 'daily'),
        createTestPhrase(id: '3', content: 'å®šå‹æ–‡3', category: 'daily'),
      ];

      await tester.pumpWidget(
        MaterialApp(
          home: Scaffold(
            body: PhraseCategorySection(
              category: 'daily',
              phrases: phrases,
            ),
          ),
        ),
      );

      // ã€çµæœæ¤œè¨¼ã€‘: 3ä»¶ã®å®šå‹æ–‡ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      expect(find.text('å®šå‹æ–‡1'), findsOneWidget); // ã€ç¢ºèªå†…å®¹ã€‘: å®šå‹æ–‡1 ğŸ”µ
      expect(find.text('å®šå‹æ–‡2'), findsOneWidget); // ã€ç¢ºèªå†…å®¹ã€‘: å®šå‹æ–‡2 ğŸ”µ
      expect(find.text('å®šå‹æ–‡3'), findsOneWidget); // ã€ç¢ºèªå†…å®¹ã€‘: å®šå‹æ–‡3 ğŸ”µ
    });
  });

  group('PhraseCategorySection - ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆ', () {
    // =========================================================================
    // ã‚»ã‚¯ã‚·ãƒ§ãƒ³å†…å®šå‹æ–‡ã‚¿ãƒƒãƒ—ã§ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ç™ºç«
    // =========================================================================
    /// ã‚»ã‚¯ã‚·ãƒ§ãƒ³å†…ã®å®šå‹æ–‡ã‚¿ãƒƒãƒ—ã§onPhraseSelectedãŒç™ºç«ã™ã‚‹ã“ã¨ã‚’ç¢ºèª
    ///
    /// ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ç¢ºèª
    /// ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: ã‚»ã‚¯ã‚·ãƒ§ãƒ³å†…ã‚¢ã‚¤ãƒ†ãƒ ã®ã‚¿ãƒƒãƒ—ã‚¤ãƒ™ãƒ³ãƒˆ
    /// ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: ã‚¿ãƒƒãƒ—ã§ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒå‘¼ã³å‡ºã•ã‚Œã‚‹
    ///
    /// ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ğŸ”µ é’ä¿¡å·
    /// é–¢é€£è¦ä»¶: AC-004
    /// å„ªå…ˆåº¦: P0 å¿…é ˆ
    testWidgets('ã‚»ã‚¯ã‚·ãƒ§ãƒ³å†…å®šå‹æ–‡ã‚¿ãƒƒãƒ—ã§onPhraseSelectedãŒç™ºç«ã™ã‚‹', (tester) async {
      PresetPhrase? selectedPhrase;
      final phrase =
          createTestPhrase(id: '1', content: 'ã‚¿ãƒƒãƒ—ãƒ†ã‚¹ãƒˆ', category: 'daily');

      await tester.pumpWidget(
        MaterialApp(
          home: Scaffold(
            body: PhraseCategorySection(
              category: 'daily',
              phrases: [phrase],
              onPhraseSelected: (p) => selectedPhrase = p,
            ),
          ),
        ),
      );

      // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: å®šå‹æ–‡ã‚’ã‚¿ãƒƒãƒ—
      await tester.tap(find.text('ã‚¿ãƒƒãƒ—ãƒ†ã‚¹ãƒˆ'));
      await tester.pumpAndSettle();

      // ã€çµæœæ¤œè¨¼ã€‘: ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒå‘¼ã³å‡ºã•ã‚ŒãŸã“ã¨ã‚’ç¢ºèª
      expect(selectedPhrase?.id, equals('1')); // ã€ç¢ºèªå†…å®¹ã€‘: æ­£ã—ã„å®šå‹æ–‡ãŒæ¸¡ã•ã‚ŒãŸ ğŸ”µ
    });
  });
}
