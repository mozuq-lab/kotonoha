# 文字盤コミュニケーション支援アプリ（kotonoha） 要件定義書

## 概要

発話が困難な方が「できるだけ少ない操作で、自分の言いたいことを、適切な丁寧さで、安全に伝えられる」ことを目的としたタブレット向けコミュニケーション支援アプリ。

**対象ユーザー**: 脳梗塞・ALS・筋疾患などで発話が難しいが、タブレットのタップ操作がある程度可能な方

**主な利用シーン**: 自宅での家族との会話、介護施設でのスタッフとのやり取り、病院・診察時の医師・看護師とのコミュニケーション

## 関連文書

- **ユーザストーリー**: [📖 kotonoha-user-stories.md](kotonoha-user-stories.md)
- **受け入れ基準**: [✅ kotonoha-acceptance-criteria.md](kotonoha-acceptance-criteria.md)
- **技術スタック**: [🔧 ../tech-stack.md](../tech-stack.md)

## 機能要件（EARS記法）

**【信頼性レベル凡例】**:
- 🔵 **青信号**: EARS要件定義書・設計文書・ユーザヒアリングを参考にした確実な要件
- 🟡 **黄信号**: EARS要件定義書・設計文書・ユーザヒアリングから妥当な推測による要件
- 🔴 **赤信号**: EARS要件定義書・設計文書・ユーザヒアリングにない推測による要件

### 通常要件（SHALL）

#### 文字入力機能
- **REQ-001**: システムは五十音配列の文字盤UIを表示しなければならない 🔵 *mvp-requirements-original.md 5-1-1、ユーザヒアリング*
- **REQ-002**: システムは文字盤の文字をタップすると入力欄に文字を追加しなければならない 🔵 *mvp-requirements-original.md 5-1-1*
- **REQ-003**: システムは削除ボタンで最後の1文字を削除する機能を提供しなければならない 🔵 *mvp-requirements-original.md 5-1-1*
- **REQ-004**: システムは全消去ボタンで入力欄のすべての文字を削除する機能を提供しなければならない 🔵 *mvp-requirements-original.md 5-1-1*

#### 定型文管理機能
- **REQ-101**: システムは定型文を一覧表示しなければならない 🔵 *mvp-requirements-original.md 5-1-2*
- **REQ-102**: システムは定型文をタップすると入力欄に反映する機能を提供しなければならない 🔵 *mvp-requirements-original.md 5-1-2*
- **REQ-103**: システムは定型文を直接タップで即座に読み上げる機能を提供しなければならない 🔵 *mvp-requirements-original.md 5-1-2*
- **REQ-104**: システムは定型文の追加・編集・削除機能を提供しなければならない 🔵 *mvp-requirements-original.md 5-1-2*
- **REQ-105**: システムはお気に入り定型文を一覧上部に優先表示しなければならない 🔵 *mvp-requirements-original.md 5-1-2*
- **REQ-106**: システムは定型文を2-3種類のシンプルなカテゴリ（「日常」「体調」「その他」など）で分類しなければならない 🔵 *ユーザヒアリング*
- **REQ-107**: システムは50-100個程度の汎用的な定型文サンプルを初期データとして提供しなければならない 🔵 *ユーザヒアリング*

#### 大ボタン機能
- **REQ-201**: システムは「はい」「いいえ」「わからない」の3つの大ボタンを画面上部に常時表示しなければならない 🔵 *mvp-requirements-original.md 5-1-3、ユーザヒアリング*
- **REQ-202**: システムは状態を表すボタン（「痛い」「トイレ」「暑い」「寒い」など）を画面上部に表示しなければならない 🔵 *mvp-requirements-original.md 5-1-3*
- **REQ-203**: システムは状態ボタンを8-12個の固定文言として提供しなければならない 🔵 *mvp-requirements-original.md 5-1-3、ユーザヒアリング*
- **REQ-204**: システムは大ボタンおよび状態ボタンのタップ時に即座に読み上げを実行しなければならない 🟡 *mvp-requirements-original.md 5-1-3から推測*

#### 緊急ボタン機能
- **REQ-301**: システムは緊急呼び鈴ボタンをすべての画面で表示しなければならない 🔵 *mvp-requirements-original.md 5-1-4*
- **REQ-302**: システムは緊急ボタンを2段階確認（1回目タップ→確認ダイアログ→2回目確認タップ）で動作させなければならない 🔵 *mvp-requirements-original.md 5-1-4、ユーザヒアリング*
- **REQ-303**: システムは緊急ボタン押下時に周囲の人が気づきやすい音を発生させなければならない 🔵 *mvp-requirements-original.md 5-1-4*
- **REQ-304**: システムは緊急ボタン押下時に画面全体を目立つ色（赤など）で表示しなければならない 🟡 *mvp-requirements-original.md 5-1-4から推測*

#### 音声読み上げ機能（TTS）
- **REQ-401**: システムは入力欄のテキストをOS標準TTSで読み上げる機能を提供しなければならない 🔵 *mvp-requirements-original.md 5-2-1、ユーザヒアリング*
- **REQ-402**: システムは読み上げボタンを明確に表示しなければならない 🔵 *mvp-requirements-original.md 5-2-1*
- **REQ-403**: システムは読み上げ中の停止・中断機能を提供しなければならない 🔵 *mvp-requirements-original.md 5-2-1*
- **REQ-404**: システムは読み上げ速度を「遅い」「普通」「速い」の3段階から選択できなければならない 🔵 *mvp-requirements-original.md 5-2-2*

#### 対面表示機能
- **REQ-501**: システムは読み上げテキストを画面中央に大きく表示する拡大表示モードを提供しなければならない 🔵 *mvp-requirements-original.md 5-2-3*
- **REQ-502**: システムは画面を180度回転させて対面の相手から読みやすい表示に切り替える機能を提供しなければならない 🔵 *mvp-requirements-original.md 5-2-3、ユーザヒアリング*
- **REQ-503**: システムは通常モードと対面表示モードをシンプルな操作で切り替えられなければならない 🔵 *mvp-requirements-original.md 5-2-3*

#### 履歴機能
- **REQ-601**: システムは読み上げまたは表示した文章を自動的に履歴として保存しなければならない 🔵 *mvp-requirements-original.md 5-3-1*
- **REQ-602**: システムは履歴を最大50件まで保持し、古いものから自動削除しなければならない 🔵 *mvp-requirements-original.md 5-3-1、ユーザヒアリング*
- **REQ-603**: システムは履歴一覧からワンタップで再読み上げ・再表示できる機能を提供しなければならない 🔵 *mvp-requirements-original.md 5-3-1*
- **REQ-604**: システムは履歴の個別削除および全削除機能を提供しなければならない 🔵 *mvp-requirements-original.md 5-3-1*
- **REQ-605**: システムは履歴をローカル端末内のみに保存しなければならない 🔵 *mvp-requirements-original.md 5-3-1*

#### お気に入り機能
- **REQ-701**: システムは定型文または履歴をお気に入りとして登録する機能を提供しなければならない 🔵 *mvp-requirements-original.md 5-3-2*
- **REQ-702**: システムはお気に入りをリスト上部に優先表示しなければならない 🔵 *mvp-requirements-original.md 5-3-2*
- **REQ-703**: システムはお気に入りの並び順を変更できる機能を提供しなければならない 🔵 *mvp-requirements-original.md 5-3-2*
- **REQ-704**: システムはお気に入り削除時に確認ダイアログを表示しなければならない 🔵 *mvp-requirements-original.md 5-3-2*

#### アクセシビリティ機能
- **REQ-801**: システムはフォントサイズを「小」「中」「大」の3段階から選択できなければならない 🔵 *mvp-requirements-original.md 5-4-1*
- **REQ-802**: システムは文字盤・定型文一覧・ボタンラベルのフォントサイズをフォントサイズ設定に追従させなければならない 🔵 *mvp-requirements-original.md 5-4-1*
- **REQ-803**: システムは「ライトモード」「ダークモード」「高コントラストモード」の3つのテーマを提供しなければならない 🔵 *mvp-requirements-original.md 5-4-2*
- **REQ-804**: システムは標準フォントサイズを高齢者にも見やすいサイズに設定しなければならない 🟡 *mvp-requirements-original.md 5-4-1から推測*

#### AI変換機能
- **REQ-901**: システムは短い入力（キーワードまたは短文）をより丁寧で自然な文章に変換する候補を生成しなければならない 🔵 *mvp-requirements-original.md 5-6-1*
- **REQ-902**: システムはAI変換結果を自動的に表示し、ユーザーが採用・却下を選択できなければならない 🔵 *mvp-requirements-original.md 5-6-1、ユーザヒアリング*
- **REQ-903**: システムはAI変換の丁寧さレベルを「カジュアル」「普通」「丁寧」の3段階から選択できなければならない 🔵 *ユーザヒアリング*
- **REQ-904**: システムはAI変換結果が気に入らない場合、再生成または元の文のまま使用できる機能を提供しなければならない 🔵 *mvp-requirements-original.md 5-6-1*

#### オフライン対応
- **REQ-1001**: システムは文字盤入力・定型文・履歴・TTSをオフライン環境で利用可能にしなければならない 🔵 *mvp-requirements-original.md 5-5-1*
- **REQ-1002**: システムはオフライン時にAI変換が利用不可であることを明示しなければならない 🔵 *mvp-requirements-original.md 5-5-1*
- **REQ-1003**: システムはオフライン時のAI変換ボタン押下時に、元の文をそのまま利用できるフォールバック動作を提供しなければならない 🔵 *mvp-requirements-original.md 5-5-1*

### 条件付き要件（WHEN/IF-THEN）

- **REQ-2001**: ユーザーが全消去ボタンをタップした場合、システムは確認ダイアログを表示しなければならない 🟡 *mvp-requirements-original.md 6-1から推測*
- **REQ-2002**: ユーザーがお気に入り削除を実行した場合、システムは確認ダイアログを表示しなければならない 🔵 *mvp-requirements-original.md 5-3-2*
- **REQ-2003**: AI変換がオンライン接続を必要とする場合で、オフライン状態の場合、システムは変換を実行せず、代わりに元の文を使用するオプションを提示しなければならない 🔵 *mvp-requirements-original.md 5-6-1*
- **REQ-2004**: ユーザーが緊急ボタンを1回タップした場合、システムは「緊急呼び出しを実行しますか?」という確認ダイアログを表示しなければならない 🔵 *mvp-requirements-original.md 5-1-4、ユーザヒアリング*
- **REQ-2005**: 緊急呼び出しの確認ダイアログで「はい」をタップした場合、システムは緊急音を発生させ、画面を緊急表示に切り替えなければならない 🔵 *mvp-requirements-original.md 5-1-4、ユーザヒアリング*
- **REQ-2006**: AI変換の応答時間が3秒を超える場合、システムはローディング表示（進行状況インジケーター）を表示しなければならない 🟡 *mvp-requirements-original.md 6-2から推測*
- **REQ-2007**: ユーザーがフォントサイズを変更した場合、システムは即座にすべてのテキスト要素のサイズを変更しなければならない 🟡 *mvp-requirements-original.md 5-4-1から推測*
- **REQ-2008**: ユーザーがテーマを変更した場合、システムは即座にすべての画面の配色を変更しなければならない 🟡 *mvp-requirements-original.md 5-4-2から推測*

### 状態要件（WHERE）

- **REQ-3001**: アプリが初回起動時の状態にある場合、システムは簡易チュートリアルまたはヘルプ画面を表示しなければならない 🟡 *mvp-requirements-original.md 5-5-2から推測*
- **REQ-3002**: 履歴が50件に達した状態にある場合、システムは新しい履歴を追加する際に最も古い履歴を自動削除しなければならない 🔵 *mvp-requirements-original.md 5-3-1、ユーザヒアリング*
- **REQ-3003**: 読み上げが実行中の状態にある場合、システムは読み上げボタンを「停止」ボタンとして表示しなければならない 🟡 *mvp-requirements-original.md 5-2-1から推測*
- **REQ-3004**: ネットワーク接続がない状態にある場合、システムはAI変換ボタンを無効化またはグレーアウト表示しなければならない 🟡 *mvp-requirements-original.md 5-5-1から推測*

### オプション要件（MAY）

- **REQ-4001**: システムは定型文のカテゴリ順序をユーザーがカスタマイズできてもよい 🟡 *mvp-requirements-original.md 5-1-2から拡張推測*
- **REQ-4002**: システムは履歴からお気に入りへのワンタップ移動機能を提供してもよい 🟡 *mvp-requirements-original.md 5-3-1、5-3-2の組み合わせから推測*
- **REQ-4003**: システムは音量調整へのクイックアクセスを提供してもよい 🟡 *mvp-requirements-original.md 5-2-2から拡張推測*
- **REQ-4004**: システムは定型文・お気に入りのエクスポート/インポート機能を提供してもよい 🔴 *追加機能として推測*

### 制約要件（MUST）

- **REQ-5001**: システムはタップターゲット（ボタン・キー）のサイズを44px × 44px以上としなければならない 🟡 *mvp-requirements-original.md 6-1、アクセシビリティ標準から推測*
- **REQ-5002**: システムは重要な操作（緊急ボタン、全消去など）に誤操作防止の仕組みを設けなければならない 🔵 *mvp-requirements-original.md 6-1*
- **REQ-5003**: システムはアプリが強制終了しても定型文・設定・履歴を失わない永続化機構を実装しなければならない 🔵 *mvp-requirements-original.md 6-4*
- **REQ-5004**: システムは単一のタブレット端末で完結する利用体験を提供しなければならない 🔵 *mvp-requirements-original.md 3*
- **REQ-5005**: システムはタップ主体の操作で完結し、スワイプ等のジェスチャーへの依存を避けなければならない 🔵 *mvp-requirements-original.md 6-1*
- **REQ-5006**: システムは高コントラストモードでWCAG 2.1 AAレベルのコントラスト比（4.5:1以上）を確保しなければならない 🟡 *mvp-requirements-original.md 5-4-2、アクセシビリティ標準から推測*

## 非機能要件

### パフォーマンス

- **NFR-001**: システムはTTS読み上げ開始までの時間を1秒以内としなければならない 🟡 *mvp-requirements-original.md 6-2から具体化*
- **NFR-002**: システムはAI変換の応答時間を平均3秒以内とすることを目標としなければならない 🟡 *mvp-requirements-original.md 6-2、tech-stack.mdから推測*
- **NFR-003**: システムは文字盤タップから入力欄への文字反映までの遅延を100ms以内としなければならない 🟡 *mvp-requirements-original.md 6-2から推測*
- **NFR-004**: システムは定型文一覧の表示（100件程度）を1秒以内に完了しなければならない 🟡 *mvp-requirements-original.md 6-2から推測*
- **NFR-005**: システムは同時に10人以下の利用者数を想定した軽負荷環境で安定動作しなければならない 🔵 *tech-stack.md*

### セキュリティ・プライバシー

- **NFR-101**: システムは利用者の会話内容（定型文・履歴）を原則として端末内にのみ保存しなければならない 🔵 *mvp-requirements-original.md 6-3*
- **NFR-102**: システムはAI変換機能で会話内容を外部に送信する場合、その旨をアプリ内で分かりやすく説明しなければならない 🔵 *mvp-requirements-original.md 6-3*
- **NFR-103**: システムは履歴・お気に入りを利用者・支援者が任意に削除できる機能を提供しなければならない 🔵 *mvp-requirements-original.md 6-3*
- **NFR-104**: システムはHTTPS通信を使用し、API通信を暗号化しなければならない 🔵 *tech-stack.md*
- **NFR-105**: システムは環境変数をアプリ内にハードコードせず、安全に管理しなければならない 🔵 *tech-stack.md*

### ユーザビリティ

- **NFR-201**: システムは主要な操作（文字入力、定型文選択、読み上げ）を3タップ以内で完了できなければならない 🟡 *mvp-requirements-original.md 3から具体化*
- **NFR-202**: システムはボタン・タップ領域を視認性が高く押しやすいサイズ（推奨60px × 60px以上）で設計しなければならない 🟡 *mvp-requirements-original.md 6-1から具体化*
- **NFR-203**: システムは画面遷移を必要最小限に留め、主要機能を1画面でアクセス可能にしなければならない 🟡 *mvp-requirements-original.md 3、5-5-2から推測*
- **NFR-204**: システムはエラーメッセージを分かりやすい日本語で表示し、復旧方法を示さなければならない 🟡 *mvp-requirements-original.md 6-2から推測*
- **NFR-205**: システムは「ガイド付きアクセス」(iOS)や「画面ピン留め」(Android)の設定方法をアプリ内ヘルプで説明しなければならない 🔵 *mvp-requirements-original.md 5-5-2*

### 信頼性

- **NFR-301**: システムは重大なエラーが発生しても、基本機能（文字盤+読み上げ）を継続して利用可能に保たなければならない 🔵 *mvp-requirements-original.md 6-4*
- **NFR-302**: システムはアプリクラッシュからの復旧時に、最後の入力状態を復元しなければならない 🟡 *mvp-requirements-original.md 6-4から推測*
- **NFR-303**: システムはネットワークエラー時にも基本機能（オフライン機能）が正常動作することを保証しなければならない 🔵 *mvp-requirements-original.md 5-5-1*
- **NFR-304**: システムはデータベースエラー発生時に適切なエラーハンドリングを行い、データ損失を防がなければならない 🟡 *mvp-requirements-original.md 6-4から推測*

### 互換性・対応環境

- **NFR-401**: システムはiOS 14.0以上、Android 10以上、主要モダンブラウザ（Chrome、Safari、Edge）で動作しなければならない 🟡 *tech-stack.md、Flutter対応範囲から推測*
- **NFR-402**: システムは9.7インチ以上のタブレット端末を主要対象とし、スマートフォンでも基本動作を保証しなければならない 🟡 *mvp-requirements-original.md 3から推測*
- **NFR-403**: システムは縦向き・横向き両方の画面方向で正常に表示されなければならない 🟡 *mvp-requirements-original.md 5-2-3から推測*

### 保守性・拡張性

- **NFR-501**: システムはコードカバレッジ80%以上のテストを維持しなければならない 🔵 *tech-stack.md*
- **NFR-502**: システムは重要なビジネスロジック・APIエンドポイントで90%以上のテストカバレッジを維持しなければならない 🔵 *tech-stack.md*
- **NFR-503**: システムはFlutter lints、Ruff + Black準拠のコード品質を維持しなければならない 🔵 *tech-stack.md*
- **NFR-504**: システムはAPI仕様をOpenAPI (Swagger)形式で自動生成・文書化しなければならない 🔵 *tech-stack.md*

## Edgeケース・境界値

### エラー処理

- **EDGE-001**: ネットワークタイムアウト時、システムはユーザーに分かりやすいエラーメッセージを表示し、再試行オプションを提供しなければならない 🟡 *mvp-requirements-original.md 6-2から推測*
- **EDGE-002**: AI変換APIエラー時、システムは元の入力文をそのまま使用可能にするフォールバック処理を実行しなければならない 🔵 *mvp-requirements-original.md 5-6-1*
- **EDGE-003**: ストレージ容量不足時、システムはユーザーに警告を表示し、古い履歴を優先的に削除する提案を行わなければならない 🟡 *mvp-requirements-original.md 6-4から推測*
- **EDGE-004**: TTS音声再生エラー時、システムはテキスト表示のみで継続し、エラー通知を表示しなければならない 🟡 *mvp-requirements-original.md 6-4から推測*

### 境界値

- **EDGE-101**: 入力欄の文字数が1000文字を超えた場合、システムは警告を表示し、1000文字で入力を制限しなければならない 🟡 *推測*
- **EDGE-102**: 定型文の文字数が500文字を超えた場合、システムは警告を表示し、500文字で入力を制限しなければならない 🟡 *推測*
- **EDGE-103**: 履歴が0件の状態で履歴画面にアクセスした場合、システムは「履歴がありません」というメッセージを表示しなければならない 🟡 *推測*
- **EDGE-104**: お気に入りが0件の状態でお気に入り画面にアクセスした場合、システムは「お気に入りがありません」というメッセージを表示しなければならない 🟡 *推測*
- **EDGE-105**: AI変換の入力が2文字未満の場合、システムは変換を実行せず、「もう少し長く入力してください」というメッセージを表示してもよい 🔴 *推測*

### 異常系・特殊ケース

- **EDGE-201**: アプリがバックグラウンドから復帰した場合、システムは前回の画面状態・入力内容を復元しなければならない 🟡 *mvp-requirements-original.md 6-4から推測*
- **EDGE-202**: OSの音量が0（ミュート）の状態で読み上げを実行した場合、システムは「音量が0です」という視覚的警告を表示しなければならない 🟡 *mvp-requirements-original.md 5-2-2から推測*
- **EDGE-203**: マナーモード有効時に緊急ボタンが押された場合、システムはマナーモードを一時的に解除して緊急音を鳴らす、または明確な警告を表示しなければならない 🟡 *mvp-requirements-original.md 5-1-4から推測*
- **EDGE-204**: 定型文のカテゴリが空の場合、システムはそのカテゴリを非表示にする、または「このカテゴリには定型文がありません」と表示しなければならない 🟡 *推測*

## MVP範囲外（非スコープ）

以下の機能はMVPでは実装しない:

- クラウド同期・アカウント管理・複数端末間のデータ共有
- 視線入力・外部スイッチ・スキャン入力など、特殊インターフェースとの連携
- 長い会話履歴を用いた文脈理解・自動応答候補の提示
- 医療向けの高度な症状構造化・人体図UI・医療文書生成
- 詳細な統計・利用ログ・管理画面
- 多言語対応（翻訳・多言語TTS）
- 音声認識（音声入力）機能
- 画像・絵文字・スタンプ機能
- ビデオ通話連携機能
- 複数ユーザープロファイル管理
