# TASK-0051: OS音量0の警告表示 - テストケース一覧

## 作成日: 2025-11-26
## 作成者: Claude Code
## 関連要件定義: volume-warning-requirements.md

---

## 開発言語・フレームワーク

- **プログラミング言語**: Dart 3.10+ 🔵
  - **言語選択の理由**: Flutter公式言語、既存TTSテストとの一貫性
  - **テストに適した機能**: 強力な型システム、async/await、null safety
- **テストフレームワーク**: flutter_test + mocktail 🔵
  - **フレームワーク選択の理由**: Flutter公式テストフレームワーク、既存テストとの一貫性
  - **テスト実行環境**: `flutter test` コマンドで実行

---

## テストファイル構成

```
test/
├── features/
│   └── tts/
│       ├── domain/
│       │   └── services/
│       │       └── volume_service_test.dart     # 音量サービステスト（新規）
│       ├── providers/
│       │   └── volume_warning_provider_test.dart # 音量警告プロバイダーテスト（新規）
│       └── presentation/
│           └── widgets/
│               └── volume_warning_widget_test.dart # 音量警告ウィジェットテスト（新規）
├── mocks/
│   └── mock_volume_controller.dart              # volume_controllerモック（新規）
└── integration/
    └── volume_warning_integration_test.dart     # 統合テスト（新規）
```

---

## 1. 正常系テストケース（基本的な動作）

### TC-051-001: VolumeServiceが正常に初期化される 🔵

- **テスト名**: VolumeServiceが正常に初期化される
  - **何をテストするか**: VolumeService.initialize()が成功することを確認
  - **期待される動作**: 初期化が成功し、音量取得が可能な状態になる
- **入力値**: なし（システム初期化）
  - **入力データの意味**: 初期化時はユーザー入力なし
- **期待される結果**: `true`が返され、`isInitialized`が`true`になる
  - **期待結果の理由**: volume_controllerパッケージが正常に初期化される
- **テストの目的**: 音量サービスの初期化処理が正常に動作することを確認
  - **確認ポイント**: 初期化成功、エラーなし
- **参照要件**: EDGE-202
- 🔵 青信号: requirements.mdのVolumeService仕様に基づく

### TC-051-002: 現在のOS音量を取得できる 🔵

- **テスト名**: 現在のOS音量を取得できる
  - **何をテストするか**: VolumeService.getCurrentVolume()が正しい値を返すことを確認
  - **期待される動作**: OS音量（0.0〜1.0）が取得される
- **入力値**: なし（OS音量は自動取得）
  - **入力データの意味**: モックで音量0.5を返す設定
- **期待される結果**: `0.5`が返される
  - **期待結果の理由**: モックで設定した音量値が取得される
- **テストの目的**: 音量取得機能が正常に動作することを確認
  - **確認ポイント**: 音量値の正確性、型の正しさ（double）
- **参照要件**: EDGE-202
- 🔵 青信号: requirements.mdのVolumeService出力仕様に基づく

### TC-051-003: 音量が0の場合にisVolumeZeroがtrueを返す 🔵

- **テスト名**: 音量が0の場合にisVolumeZeroがtrueを返す
  - **何をテストするか**: 音量0の判定ロジックが正しく動作することを確認
  - **期待される動作**: 音量が0の場合、`isVolumeZero`が`true`を返す
- **入力値**: OS音量 = 0.0
  - **入力データの意味**: ミュート状態をシミュレート
- **期待される結果**: `isVolumeZero == true`
  - **期待結果の理由**: EDGE-202で定義された音量0検出
- **テストの目的**: 音量0の正確な検出を確認
  - **確認ポイント**: ゼロ判定の正確性
- **参照要件**: EDGE-202
- 🔵 青信号: requirements.md EDGE-202に基づく

### TC-051-004: 音量が0より大きい場合にisVolumeZeroがfalseを返す 🔵

- **テスト名**: 音量が0より大きい場合にisVolumeZeroがfalseを返す
  - **何をテストするか**: 音量が正常な場合の判定ロジックを確認
  - **期待される動作**: 音量が0より大きい場合、`isVolumeZero`が`false`を返す
- **入力値**: OS音量 = 0.5
  - **入力データの意味**: 通常の音量状態をシミュレート
- **期待される結果**: `isVolumeZero == false`
  - **期待結果の理由**: 音量が出力可能な状態
- **テストの目的**: 正常音量時に警告が表示されないことを確認
  - **確認ポイント**: 正常時に警告が出ない
- **参照要件**: EDGE-202
- 🔵 青信号: requirements.md「ケース2: 音量正常での読み上げ」に基づく

### TC-051-005: VolumeWarningWidgetが警告メッセージを表示する 🔵

- **テスト名**: VolumeWarningWidgetが警告メッセージを表示する
  - **何をテストするか**: 警告ウィジェットのUI表示を確認
  - **期待される動作**: 「音量が0です」というメッセージが表示される
- **入力値**: `isVisible = true`
  - **入力データの意味**: 警告を表示する状態
- **期待される結果**: 「音量が0です」テキストが画面に表示される
  - **期待結果の理由**: EDGE-202で定義された視覚的警告
- **テストの目的**: 警告UIの表示を確認
  - **確認ポイント**: メッセージテキスト、視認性
- **参照要件**: EDGE-202, NFR-204
- 🔵 青信号: requirements.md EDGE-202「視覚的警告を表示」に基づく

### TC-051-006: VolumeWarningWidgetの閉じるボタンが機能する 🔵

- **テスト名**: VolumeWarningWidgetの閉じるボタンが機能する
  - **何をテストするか**: 閉じるボタンのコールバック実行を確認
  - **期待される動作**: 閉じるボタンタップで`onDismiss`コールバックが呼ばれる
- **入力値**: 閉じるボタンをタップ
  - **入力データの意味**: ユーザーが警告を確認して閉じる操作
- **期待される結果**: `onDismiss`コールバックが1回呼ばれる
  - **期待結果の理由**: ユーザーによる警告の消去
- **テストの目的**: 警告の閉じる操作が正常に機能することを確認
  - **確認ポイント**: コールバック呼び出し、1回のみ
- **参照要件**: EDGE-202
- 🔵 青信号: requirements.mdのVolumeWarningWidget仕様に基づく

### TC-051-007: VolumeWarningProviderが音量0で警告状態になる 🔵

- **テスト名**: VolumeWarningProviderが音量0で警告状態になる
  - **何をテストするか**: プロバイダーの状態管理が正しく動作することを確認
  - **期待される動作**: 音量チェック後、`showWarning`が`true`になる
- **入力値**: OS音量 = 0.0
  - **入力データの意味**: ミュート状態での読み上げ試行
- **期待される結果**: `state.showWarning == true`
  - **期待結果の理由**: 警告表示が必要な状態
- **テストの目的**: 状態管理の正確性を確認
  - **確認ポイント**: 状態遷移、警告フラグ
- **参照要件**: EDGE-202
- 🔵 青信号: requirements.mdのデータフローに基づく

### TC-051-008: 音量設定へのクイックアクセスボタンが表示される 🟡

- **テスト名**: 音量設定へのクイックアクセスボタンが表示される
  - **何をテストするか**: 音量設定へのリンクUIが表示されることを確認
  - **期待される動作**: 「音量設定を開く」ボタンが表示される
- **入力値**: `isVisible = true`, `onOpenSettings != null`
  - **入力データの意味**: 警告表示時に設定ボタンも表示
- **期待される結果**: 設定ボタンが表示される
  - **期待結果の理由**: REQ-4003（MAY要件）に対応
- **テストの目的**: ユーザビリティ向上機能の確認
  - **確認ポイント**: ボタン表示、タップ可能
- **参照要件**: REQ-4003
- 🟡 黄信号: REQ-4003（MAY要件）から妥当な推測

---

## 2. 異常系テストケース（エラーハンドリング）

### TC-051-009: volume_controller初期化失敗時もTTS読み上げは継続 🔵

- **テスト名**: volume_controller初期化失敗時もTTS読み上げは継続
  - **エラーケースの概要**: volume_controllerパッケージの初期化が失敗した場合
  - **エラー処理の重要性**: NFR-301（基本機能は継続動作）の遵守
- **入力値**: volume_controller初期化で例外発生
  - **不正な理由**: プラットフォーム制限、権限不足など
  - **実際の発生シナリオ**: Web環境、特殊なデバイス
- **期待される結果**: 音量警告機能は無効化、TTS読み上げは正常動作
  - **エラーメッセージの内容**: なし（サイレントに無効化）
  - **システムの安全性**: 基本機能は継続動作
- **テストの目的**: エラー耐性の確認
  - **品質保証の観点**: 単一障害点を作らない
- **参照要件**: NFR-301, ERROR-1
- 🔵 青信号: requirements.md NFR-301「重大なエラーでも基本機能は継続動作」に基づく

### TC-051-010: 音量取得失敗時は警告を表示せずに読み上げを継続 🔵

- **テスト名**: 音量取得失敗時は警告を表示せずに読み上げを継続
  - **エラーケースの概要**: 音量取得APIが失敗した場合
  - **エラー処理の重要性**: ユーザー操作の中断を最小化
- **入力値**: getCurrentVolume()で例外発生
  - **不正な理由**: デバイス制限、一時的なエラー
  - **実際の発生シナリオ**: デバイス固有の問題
- **期待される結果**: 警告なし、読み上げ継続
  - **エラーメッセージの内容**: ログに記録のみ
  - **システムの安全性**: ユーザー体験を優先
- **テストの目的**: フォールバック処理の確認
  - **品質保証の観点**: ユーザビリティ維持
- **参照要件**: EDGE-2, NFR-301
- 🔵 青信号: requirements.md EDGE-2「音量取得に失敗した場合」に基づく

### TC-051-011: OS権限拒否時も正常に動作する 🟡

- **テスト名**: OS権限拒否時も正常に動作する
  - **エラーケースの概要**: OS音量取得権限が拒否された場合
  - **エラー処理の重要性**: 権限なしでも基本機能は動作
- **入力値**: 権限拒否エラー
  - **不正な理由**: ユーザーがOS設定で権限を拒否
  - **実際の発生シナリオ**: プライバシー意識の高いユーザー
- **期待される結果**: 警告機能は無効化、読み上げは正常動作
  - **エラーメッセージの内容**: なし
  - **システムの安全性**: 基本機能は継続
- **テストの目的**: 権限エラー時の動作確認
  - **品質保証の観点**: セキュリティとユーザビリティのバランス
- **参照要件**: ERROR-2
- 🟡 黄信号: requirements.md ERROR-2から妥当な推測

---

## 3. 境界値テストケース（最小値、最大値、null等）

### TC-051-012: 音量0.0（最小値）で警告が表示される 🔵

- **テスト名**: 音量0.0（最小値）で警告が表示される
  - **境界値の意味**: 音量の最小値（完全ミュート）
  - **境界値での動作保証**: 最小値で正しく警告が表示される
- **入力値**: OS音量 = 0.0
  - **境界値選択の根拠**: 音量の下限値
  - **実際の使用場面**: ユーザーが完全にミュートにした場合
- **期待される結果**: `isVolumeZero == true`、警告表示
  - **境界での正確性**: 正確に0.0を検出
  - **一貫した動作**: 常に警告表示
- **テストの目的**: 最小値での動作確認
  - **堅牢性の確認**: 境界値で正確に動作
- **参照要件**: EDGE-202
- 🔵 青信号: requirements.md EDGE-202に基づく

### TC-051-013: 音量0.01（0に近い正の値）で警告が表示されない 🟡

- **テスト名**: 音量0.01（0に近い正の値）で警告が表示されない
  - **境界値の意味**: 0より大きい最小の実用的な音量
  - **境界値での動作保証**: わずかでも音量があれば警告しない
- **入力値**: OS音量 = 0.01
  - **境界値選択の根拠**: 0との境界付近
  - **実際の使用場面**: 非常に小さな音量設定
- **期待される結果**: `isVolumeZero == false`、警告なし
  - **境界での正確性**: 正確に判定
  - **一貫した動作**: 0より大きければ警告なし
- **テストの目的**: 境界付近での正確な判定
  - **堅牢性の確認**: 境界を正しく区別
- **参照要件**: EDGE-202
- 🟡 黄信号: 要件定義から妥当な推測

### TC-051-014: 音量1.0（最大値）で警告が表示されない 🔵

- **テスト名**: 音量1.0（最大値）で警告が表示されない
  - **境界値の意味**: 音量の最大値
  - **境界値での動作保証**: 最大音量で正常動作
- **入力値**: OS音量 = 1.0
  - **境界値選択の根拠**: 音量の上限値
  - **実際の使用場面**: 最大音量設定
- **期待される結果**: `isVolumeZero == false`、警告なし
  - **境界での正確性**: 最大値で正常動作
  - **一貫した動作**: 警告なし、正常読み上げ
- **テストの目的**: 最大値での動作確認
  - **堅牢性の確認**: 境界値で正常動作
- **参照要件**: EDGE-202
- 🔵 青信号: requirements.md「ケース2: 音量正常での読み上げ」に基づく

### TC-051-015: VolumeWarningWidget非表示時は何も表示されない 🔵

- **テスト名**: VolumeWarningWidget非表示時は何も表示されない
  - **境界値の意味**: 表示/非表示の境界
  - **境界値での動作保証**: 非表示時にUIが存在しない
- **入力値**: `isVisible = false`
  - **境界値選択の根拠**: ブール値の境界
  - **実際の使用場面**: 音量が正常な場合
- **期待される結果**: ウィジェットが空（SizedBox.shrink等）
  - **境界での正確性**: 完全に非表示
  - **一貫した動作**: UIリソースを消費しない
- **テストの目的**: 非表示状態の確認
  - **堅牢性の確認**: 状態遷移が正確
- **参照要件**: EDGE-202
- 🔵 青信号: Flutterのウィジェット設計パターンに基づく

---

## 4. 統合テストケース

### TC-051-016: 読み上げボタンタップ時に音量チェックが実行される 🔵

- **テスト名**: 読み上げボタンタップ時に音量チェックが実行される
  - **何をテストするか**: TTS読み上げフローに音量チェックが統合されていることを確認
  - **期待される動作**: speak()呼び出し前にVolumeServiceで音量チェック
- **入力値**: 読み上げボタンタップ
  - **入力データの意味**: ユーザーによる読み上げ操作
- **期待される結果**: VolumeService.getCurrentVolume()が呼ばれる
  - **期待結果の理由**: データフロー通りの動作
- **テストの目的**: 統合の正確性確認
  - **確認ポイント**: 呼び出し順序、タイミング
- **参照要件**: EDGE-202, データフロー
- 🔵 青信号: requirements.mdのデータフローに基づく

### TC-051-017: 音量0で読み上げ後も再度読み上げ可能 🔵

- **テスト名**: 音量0で読み上げ後も再度読み上げ可能
  - **何をテストするか**: 警告表示後も操作が継続可能なことを確認
  - **期待される動作**: 警告を閉じた後、再度読み上げボタンが有効
- **入力値**: 音量0で読み上げ → 警告閉じる → 再度読み上げ
  - **入力データの意味**: ユーザーの連続操作
- **期待される結果**: 2回目の読み上げが実行可能
  - **期待結果の理由**: 受け入れ基準「警告表示後も読み上げ操作が可能」
- **テストの目的**: 操作継続性の確認
  - **確認ポイント**: 状態リセット、操作可能性
- **参照要件**: 受け入れ基準
- 🔵 青信号: requirements.md受け入れ基準に基づく

### TC-051-018: 定型文タップ時にも音量チェックが実行される 🟡

- **テスト名**: 定型文タップ時にも音量チェックが実行される
  - **何をテストするか**: 即座読み上げでも音量チェックが実行されることを確認
  - **期待される動作**: 定型文タップ → 音量チェック → 警告または読み上げ
- **入力値**: 定型文をタップ、OS音量 = 0.0
  - **入力データの意味**: 即座読み上げシナリオ
- **期待される結果**: 警告表示、読み上げ開始
  - **期待結果の理由**: EDGE-4「定型文・大ボタンの即座読み上げでの警告」
- **テストの目的**: 即座読み上げの統合確認
  - **確認ポイント**: 一貫した音量チェック
- **参照要件**: EDGE-4
- 🟡 黄信号: requirements.md EDGE-4から妥当な推測

---

## 5. Web環境テストケース

### TC-051-019: Web環境では音量警告機能が無効化される 🟡

- **テスト名**: Web環境では音量警告機能が無効化される
  - **何をテストするか**: プラットフォーム制限への対応を確認
  - **期待される動作**: Web環境では音量チェックをスキップ
- **入力値**: Web環境でのテスト実行
  - **入力データの意味**: ブラウザ環境
- **期待される結果**: 音量チェックなし、読み上げは正常動作
  - **期待結果の理由**: Web APIの制限
- **テストの目的**: プラットフォーム対応の確認
  - **確認ポイント**: クロスプラットフォーム対応
- **参照要件**: 互換性要件
- 🟡 黄信号: requirements.md互換性要件から妥当な推測

---

## テストケースサマリー

| カテゴリ | テスト数 | 優先度 |
|---------|---------|--------|
| 正常系 | 8 | P0〜P1 |
| 異常系 | 3 | P0〜P1 |
| 境界値 | 4 | P0 |
| 統合テスト | 3 | P1 |
| Web環境 | 1 | P2 |
| **合計** | **19** | - |

---

## 品質判定

### ✅ 高品質
- **テストケース分類**: 正常系・異常系・境界値が網羅されている
- **期待値定義**: 各テストケースの期待値が明確
- **技術選択**: Dart + flutter_test + mocktail（既存テストと一貫）
- **実装可能性**: 既存のTTSテストパターンを踏襲、volume_controllerモックで実現可能

---

## 更新履歴

| 日付 | 更新者 | 内容 |
|------|--------|------|
| 2025-11-26 | Claude Code | 初版作成（TDDテストケース作成フェーズ） |
