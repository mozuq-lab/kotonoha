# TDDテストケース定義書 - TASK-0061: 履歴一覧UI実装

## テスト概要

| 項目 | 内容 |
|------|------|
| **タスクID** | TASK-0061 |
| **タスク名** | 履歴一覧UI実装 |
| **テスト対象** | HistoryScreen, HistoryItemCard, EmptyHistoryWidget |
| **テストフレームワーク** | flutter_test |
| **モックライブラリ** | mocktail |
| **テストケース総数** | 42件 |

---

## 開発言語・フレームワーク 🔵

- **プログラミング言語**: Dart 3.x
  - **言語選択の理由**: Flutterアプリケーションの標準言語
  - **テストに適した機能**: 非同期テスト、ウィジェットテスト対応
- **テストフレームワーク**: flutter_test + mocktail
  - **フレームワーク選択の理由**: Flutterウィジェットテストの標準ツール
  - **テスト実行環境**: `flutter test` コマンド

---

## テスト対象ファイル

| ファイル | 説明 |
|----------|------|
| `lib/features/history/presentation/history_screen.dart` | 履歴一覧画面（メイン画面） |
| `lib/features/history/presentation/widgets/history_item_card.dart` | 履歴項目カードウィジェット |
| `lib/features/history/presentation/widgets/empty_history_widget.dart` | 空状態表示ウィジェット |
| `lib/features/history/providers/history_provider.dart` | 履歴状態管理プロバイダー（既存） |

---

## 1. HistoryScreen テストケース

### 1.1 正常系テスト - 履歴一覧表示

#### TC-061-001: 履歴一覧が正しく表示される 🔵

- **テスト名**: 履歴一覧が時系列順（新しい順）に正しく表示される
  - **何をテストするか**: HistoryScreenが履歴リストを正しく表示すること
  - **期待される動作**: 渡された履歴データが新しい順でリスト形式で表示される
- **前提条件**: 5件の履歴データが存在する状態
- **実行手順**:
  1. 5件の履歴データ（異なる日時）を準備する
  2. HistoryScreenを表示する
  3. 履歴項目の表示順序を確認する
- **期待される結果**:
  - 5件すべての履歴が表示される
  - 新しい履歴が上部に表示される
  - 各履歴項目にテキスト内容、日時、種類が表示される
- **テストの目的**: 基本的な一覧表示機能の確認
  - **確認ポイント**: 履歴項目の数、表示順序、各項目の内容
- **関連要件**: FR-061-001, AC-061-001
- **優先度**: P0 必須

#### TC-061-002: 履歴項目に日時が表示される 🔵

- **テスト名**: 各履歴項目に「MM/DD HH:mm」形式で日時が表示される
  - **何をテストするか**: 日時フォーマットの正確性
  - **期待される動作**: 日時が読みやすい形式で表示される
- **前提条件**: 日時が2024/11/28 14:30の履歴が存在する
- **実行手順**:
  1. 特定日時の履歴データを作成する
  2. HistoryScreenを表示する
  3. 日時の表示形式を確認する
- **期待される結果**: 「11/28 14:30」と表示される
- **テストの目的**: 日時フォーマットの確認
  - **確認ポイント**: 日時文字列のフォーマット
- **関連要件**: FR-061-002, NFR-061-005
- **優先度**: P0 必須

#### TC-061-003: 履歴の種類アイコンが表示される 🟡

- **テスト名**: 各履歴項目に種類に応じたアイコンが表示される
  - **何をテストするか**: 履歴種類の視覚的区別
  - **期待される動作**: 履歴種類に応じたアイコンが表示される
- **前提条件**: 異なる種類の履歴（文字盤入力、定型文、AI変換、大ボタン）が存在する
- **実行手順**:
  1. 各種類の履歴データを作成する
  2. HistoryScreenを表示する
  3. 各アイコンの存在を確認する
- **期待される結果**:
  - 文字盤入力: キーボードアイコン
  - 定型文: リストアイコン
  - AI変換結果: AIアイコン
  - 大ボタン: ボタンアイコン
- **テストの目的**: 視覚的区別の確認
  - **確認ポイント**: アイコンの存在と種類
- **関連要件**: NFR-061-008
- **優先度**: P1 重要

#### TC-061-004: スクロール可能なリスト表示 🔵

- **テスト名**: 履歴一覧がスクロール可能であること
  - **何をテストするか**: ListView.builderによるスクロール可能なリスト実装
  - **期待される動作**: 履歴が多数ある場合にスクロール可能
- **前提条件**: 20件の履歴データが存在する
- **実行手順**:
  1. 20件の履歴データを準備する
  2. HistoryScreenを表示する
  3. ListViewの存在を確認する
- **期待される結果**: ListViewウィジェットが使用されている
- **テストの目的**: スクロール機能の確認
  - **確認ポイント**: ListViewの存在
- **関連要件**: FR-061-005
- **優先度**: P0 必須

### 1.2 空状態テスト

#### TC-061-005: 履歴0件で空状態メッセージ表示 🔵

- **テスト名**: 履歴が0件の場合「履歴がありません」と表示される
  - **何をテストするか**: 空リスト時の表示
  - **期待される動作**: EmptyHistoryWidgetが表示される
- **前提条件**: 履歴データが0件の状態
- **実行手順**:
  1. 空の履歴リストを準備する
  2. HistoryScreenを表示する
  3. 空状態メッセージの表示を確認する
- **期待される結果**:
  - 「履歴がありません」メッセージが画面中央に表示される
  - 全削除ボタンが非表示になる
- **テストの目的**: 空状態の適切な表示確認
  - **確認ポイント**: 空状態メッセージの存在、削除ボタンの非表示
- **関連要件**: FR-061-004, AC-061-002, EDGE-061-004
- **優先度**: P0 必須

### 1.3 再読み上げ機能テスト

#### TC-061-006: 履歴項目タップで再読み上げが実行される 🔵

- **テスト名**: 履歴項目をタップすると即座にTTS読み上げが開始される
  - **何をテストするか**: 再読み上げ機能のインタラクション
  - **期待される動作**: タップ時にTTSプロバイダーのspeakメソッドが呼び出される
- **前提条件**: 1件以上の履歴データが存在する
- **実行手順**:
  1. 履歴データを準備する
  2. TTSプロバイダーをモック化する
  3. HistoryScreenを表示する
  4. 履歴項目をタップする
- **期待される結果**:
  - TTSプロバイダーのspeakメソッドが1回呼び出される
  - 呼び出し時の引数がタップした履歴のcontentと一致する
- **テストの目的**: タップインタラクションの確認
  - **確認ポイント**: モックコールバックの呼び出し回数と引数
- **関連要件**: FR-061-006, AC-061-003
- **優先度**: P0 必須

#### TC-061-007: 読み上げ中は「読み上げ中」インジケーターが表示される 🟡

- **テスト名**: TTS読み上げ実行中は該当履歴項目に読み上げ中インジケーターが表示される
  - **何をテストするか**: 読み上げ状態の視覚的フィードバック
  - **期待される動作**: 読み上げ中の履歴項目が視覚的に識別可能
- **前提条件**:
  - 履歴データが存在する
  - TTS読み上げが実行中の状態
- **実行手順**:
  1. 履歴データを準備する
  2. TTSプロバイダーをモック化し、isSpeaking=trueの状態にする
  3. HistoryScreenを表示する
  4. インジケーターの表示を確認する
- **期待される結果**: 読み上げ中の履歴項目に視覚的インジケーター（アイコンやアニメーション）が表示される
- **テストの目的**: 読み上げ状態の視覚的フィードバック確認
  - **確認ポイント**: インジケーターウィジェットの存在
- **関連要件**: FR-061-015
- **優先度**: P1 重要

### 1.4 削除機能テスト

#### TC-061-008: 個別削除ボタンをタップすると確認ダイアログが表示される 🔵

- **テスト名**: 履歴項目の削除ボタンをタップすると確認ダイアログが表示される
  - **何をテストするか**: 削除確認ダイアログの表示
  - **期待される動作**: 確認ダイアログが表示され、削除とキャンセルボタンが存在する
- **前提条件**: 1件以上の履歴データが存在する
- **実行手順**:
  1. 履歴データを準備する
  2. HistoryScreenを表示する
  3. 履歴項目の削除ボタンをタップする
  4. ダイアログの表示を確認する
- **期待される結果**:
  - AlertDialogが表示される
  - 「この履歴を削除しますか？」メッセージが表示される
  - 「削除」ボタンと「キャンセル」ボタンが表示される
- **テストの目的**: 誤操作防止のための確認ダイアログ表示確認
  - **確認ポイント**: ダイアログの存在、メッセージ、ボタン
- **関連要件**: FR-061-008, AC-061-004
- **優先度**: P0 必須

#### TC-061-009: 確認後に個別削除が実行される 🔵

- **テスト名**: 確認ダイアログで「削除」を選択すると該当履歴が削除される
  - **何をテストするか**: 個別削除の実行
  - **期待される動作**: 該当履歴が削除され、一覧から消える
- **前提条件**: 3件の履歴データが存在する
- **実行手順**:
  1. 3件の履歴データを準備する
  2. HistoryScreenを表示する
  3. 2番目の履歴の削除ボタンをタップする
  4. 確認ダイアログで「削除」ボタンをタップする
- **期待される結果**:
  - 2番目の履歴が削除される
  - 残り2件の履歴が表示される
  - UIが即座に更新される（100ms以内）
- **テストの目的**: 削除機能の実行確認
  - **確認ポイント**: 履歴項目の削除、UI更新
- **関連要件**: FR-061-007, AC-061-004, NFR-061-003
- **優先度**: P0 必須

#### TC-061-010: キャンセルで個別削除が中止される 🔵

- **テスト名**: 確認ダイアログで「キャンセル」を選択すると削除が中止される
  - **何をテストするか**: 削除キャンセル機能
  - **期待される動作**: 履歴が削除されず、ダイアログが閉じる
- **前提条件**: 3件の履歴データが存在する
- **実行手順**:
  1. 3件の履歴データを準備する
  2. HistoryScreenを表示する
  3. 削除ボタンをタップする
  4. 確認ダイアログで「キャンセル」ボタンをタップする
- **期待される結果**:
  - 履歴が削除されない
  - 3件すべての履歴が残っている
  - ダイアログが閉じる
- **テストの目的**: キャンセル操作の確認
  - **確認ポイント**: 履歴項目の保持、ダイアログの閉鎖
- **関連要件**: FR-061-012
- **優先度**: P0 必須

#### TC-061-011: 全削除ボタンが表示される 🔵

- **テスト名**: 履歴が1件以上存在する場合、AppBarに全削除ボタンが表示される
  - **何をテストするか**: 全削除ボタンの表示条件
  - **期待される動作**: 履歴が存在する場合のみ全削除ボタンが表示される
- **前提条件**: 1件以上の履歴データが存在する
- **実行手順**:
  1. 履歴データを準備する
  2. HistoryScreenを表示する
  3. AppBar内の全削除ボタンを確認する
- **期待される結果**: AppBarのアクションエリアに全削除ボタン（またはアイコン）が表示される
- **テストの目的**: 全削除ボタンの表示確認
  - **確認ポイント**: ボタンの存在
- **関連要件**: FR-061-009
- **優先度**: P0 必須

#### TC-061-012: 全削除ボタンをタップすると確認ダイアログが表示される 🔵

- **テスト名**: 全削除ボタンをタップすると確認ダイアログが表示される
  - **何をテストするか**: 全削除確認ダイアログの表示
  - **期待される動作**: 全削除の確認ダイアログが表示される
- **前提条件**: 複数件の履歴データが存在する
- **実行手順**:
  1. 複数件の履歴データを準備する
  2. HistoryScreenを表示する
  3. 全削除ボタンをタップする
- **期待される結果**:
  - AlertDialogが表示される
  - 「すべての履歴を削除しますか？」メッセージが表示される
  - 「削除」ボタンと「キャンセル」ボタンが表示される
- **テストの目的**: 全削除確認ダイアログの表示確認
  - **確認ポイント**: ダイアログの存在、メッセージ
- **関連要件**: FR-061-010, AC-061-005
- **優先度**: P0 必須

#### TC-061-013: 確認後に全削除が実行される 🔵

- **テスト名**: 確認ダイアログで「削除」を選択するとすべての履歴が削除される
  - **何をテストするか**: 全削除の実行
  - **期待される動作**: すべての履歴が削除され、空状態が表示される
- **前提条件**: 5件の履歴データが存在する
- **実行手順**:
  1. 5件の履歴データを準備する
  2. HistoryScreenを表示する
  3. 全削除ボタンをタップする
  4. 確認ダイアログで「削除」ボタンをタップする
- **期待される結果**:
  - すべての履歴が削除される
  - 「履歴がありません」メッセージが表示される
  - 全削除ボタンが非表示になる
- **テストの目的**: 全削除機能の実行確認
  - **確認ポイント**: 全履歴の削除、空状態表示
- **関連要件**: FR-061-010, AC-061-005
- **優先度**: P0 必須

#### TC-061-014: キャンセルで全削除が中止される 🔵

- **テスト名**: 確認ダイアログで「キャンセル」を選択すると全削除が中止される
  - **何をテストするか**: 全削除キャンセル機能
  - **期待される動作**: 履歴が削除されず、ダイアログが閉じる
- **前提条件**: 5件の履歴データが存在する
- **実行手順**:
  1. 5件の履歴データを準備する
  2. HistoryScreenを表示する
  3. 全削除ボタンをタップする
  4. 確認ダイアログで「キャンセル」ボタンをタップする
- **期待される結果**:
  - 履歴が削除されない
  - 5件すべての履歴が残っている
  - ダイアログが閉じる
- **テストの目的**: キャンセル操作の確認
  - **確認ポイント**: 履歴項目の保持
- **関連要件**: FR-061-013
- **優先度**: P0 必須

#### TC-061-015: 削除確認ダイアログ外タップで閉じない 🔵

- **テスト名**: 削除確認ダイアログ外をタップしてもダイアログが閉じない
  - **何をテストするか**: 誤操作防止（barrierDismissible: false）
  - **期待される動作**: バリアタップでダイアログが閉じない
- **前提条件**: 履歴データが存在する
- **実行手順**:
  1. 履歴データを準備する
  2. HistoryScreenを表示する
  3. 削除ボタンをタップしてダイアログを表示する
  4. ダイアログ外（バリア部分）をタップする
- **期待される結果**: ダイアログが閉じず、引き続き表示される
- **テストの目的**: 誤操作防止の確認
  - **確認ポイント**: ダイアログの表示状態
- **関連要件**: FR-061-008, REQ-5002, EDGE-013パターン
- **優先度**: P0 必須

### 1.5 パフォーマンステスト

#### TC-061-016: 50件の履歴を1秒以内に表示する 🔵

- **テスト名**: 履歴50件を1秒以内に表示できること
  - **何をテストするか**: 表示パフォーマンス
  - **期待される動作**: 上限件数でも高速表示
- **前提条件**: 50件の履歴データが存在する
- **実行手順**:
  1. 50件の履歴データを準備する
  2. 開始時刻を記録する
  3. HistoryScreenを表示する（pumpAndSettle）
  4. 終了時刻を記録する
  5. 経過時間を計算する
- **期待される結果**: 表示完了までの時間が1秒以内
- **テストの目的**: パフォーマンス要件の確認
  - **確認ポイント**: 表示時間
- **関連要件**: NFR-061-001, AC-061-006
- **優先度**: P0 必須

### 1.6 アクセシビリティテスト

#### TC-061-017: タップターゲットサイズが44px以上 🔵

- **テスト名**: 履歴項目のタップターゲットが44px以上
  - **何をテストするか**: アクセシビリティ要件のタップターゲットサイズ
  - **期待される動作**: 各項目の高さが44px以上
- **前提条件**: 1件以上の履歴データが存在する
- **実行手順**:
  1. 履歴データを準備する
  2. HistoryScreenを表示する
  3. HistoryItemCardの高さを測定する
- **期待される結果**: カードの高さが44px以上
- **テストの目的**: アクセシビリティ要件の確認
  - **確認ポイント**: ウィジェットの高さ
- **関連要件**: NFR-061-004, AC-061-007
- **優先度**: P0 必須

#### TC-061-018: 推奨タップターゲットサイズが60px以上 🟡

- **テスト名**: 履歴項目のタップターゲットが推奨60px以上
  - **何をテストするか**: 推奨タップターゲットサイズ
  - **期待される動作**: 各項目の高さが60px以上
- **前提条件**: 1件以上の履歴データが存在する
- **実行手順**:
  1. 履歴データを準備する
  2. HistoryScreenを表示する
  3. HistoryItemCardの高さを測定する
- **期待される結果**: カードの高さが60px以上
- **テストの目的**: 推奨サイズの確認
  - **確認ポイント**: ウィジェットの高さ
- **関連要件**: NFR-061-004, NFR-202
- **優先度**: P1 重要

#### TC-061-019: フォントサイズ「大」で表示される 🔵

- **テスト名**: フォントサイズが「大」に設定されている場合、履歴項目のテキストが大きく表示される
  - **何をテストするか**: フォントサイズ設定の反映
  - **期待される動作**: 設定に応じたフォントサイズで表示される
- **前提条件**:
  - 履歴データが存在する
  - アプリ設定でフォントサイズが「大」に設定されている
- **実行手順**:
  1. 履歴データを準備する
  2. フォントサイズ設定を「大」にする
  3. HistoryScreenを表示する
  4. テキストウィジェットのスタイルを確認する
- **期待される結果**: テキストが大きいフォントサイズで表示される
- **テストの目的**: フォントサイズ設定の反映確認
  - **確認ポイント**: TextStyleのfontSize
- **関連要件**: NFR-061-006, AC-061-007
- **優先度**: P0 必須

### 1.7 テーマ対応テスト

#### TC-061-020: ライトテーマで正しく表示される 🔵

- **テスト名**: ライトテーマで履歴一覧が正しく表示される
  - **何をテストするか**: ライトテーマでの表示
  - **期待される動作**: ライトテーマの配色で表示される
- **前提条件**: ライトテーマが選択されている
- **実行手順**:
  1. ライトテーマを設定する
  2. 履歴データを準備する
  3. HistoryScreenを表示する
- **期待される結果**: ウィジェットがエラーなく描画される
- **テストの目的**: テーマ適用確認
  - **確認ポイント**: エラーなく表示
- **関連要件**: NFR-061-007, AC-061-008
- **優先度**: P1 重要

#### TC-061-021: ダークテーマで正しく表示される 🔵

- **テスト名**: ダークテーマで履歴一覧が正しく表示される
  - **何をテストするか**: ダークテーマでの表示
  - **期待される動作**: ダークテーマの配色で表示される
- **前提条件**: ダークテーマが選択されている
- **実行手順**:
  1. ダークテーマを設定する
  2. 履歴データを準備する
  3. HistoryScreenを表示する
- **期待される結果**: ウィジェットがエラーなく描画される
- **テストの目的**: テーマ適用確認
  - **確認ポイント**: エラーなく表示
- **関連要件**: NFR-061-007, AC-061-008
- **優先度**: P1 重要

#### TC-061-022: 高コントラストテーマで正しく表示される 🔵

- **テスト名**: 高コントラストテーマで履歴一覧が正しく表示される
  - **何をテストするか**: 高コントラストテーマでの表示
  - **期待される動作**: 高コントラスト配色で表示される
- **前提条件**: 高コントラストテーマが選択されている
- **実行手順**:
  1. 高コントラストテーマを設定する
  2. 履歴データを準備する
  3. HistoryScreenを表示する
- **期待される結果**: ウィジェットがエラーなく描画される
- **テストの目的**: テーマ適用確認
  - **確認ポイント**: エラーなく表示
- **関連要件**: NFR-061-007, NFR-061-009, AC-061-008
- **優先度**: P0 必須

---

## 2. HistoryItemCard テストケース

### 2.1 正常系テスト

#### TC-061-023: 履歴項目カードが正しく表示される 🔵

- **テスト名**: HistoryItemCardが履歴内容を正しく表示する
  - **何をテストするか**: 個別カードの表示
  - **期待される動作**: content、日時、種類アイコンが表示される
- **前提条件**: 1件の履歴データ
- **実行手順**:
  1. 履歴データ（content: "こんにちは", type: characterBoard）を作成する
  2. HistoryItemCardを表示する
  3. 各要素の表示を確認する
- **期待される結果**:
  - 「こんにちは」が表示される
  - 日時が「MM/DD HH:mm」形式で表示される
  - キーボードアイコンが表示される
- **テストの目的**: カード表示の確認
  - **確認ポイント**: テキスト、日時、アイコンの表示
- **関連要件**: FR-061-002, FR-061-003
- **優先度**: P0 必須

#### TC-061-024: タップ時にコールバックが発火する 🔵

- **テスト名**: HistoryItemCardタップでonTapコールバックが発火する
  - **何をテストするか**: タップイベントの伝播
  - **期待される動作**: タップでonTapが呼び出される
- **前提条件**: 履歴データとコールバック関数
- **実行手順**:
  1. 履歴データを作成する
  2. モックコールバックを準備する
  3. HistoryItemCardを表示する
  4. カードをタップする
- **期待される結果**:
  - コールバックが1回呼び出される
  - 正しい履歴IDが渡される
- **テストの目的**: タップハンドリング確認
  - **確認ポイント**: コールバック呼び出し
- **関連要件**: FR-061-011
- **優先度**: P0 必須

#### TC-061-025: 削除ボタンが表示される 🔵

- **テスト名**: HistoryItemCardに削除ボタンが表示される
  - **何をテストするか**: 削除ボタンの表示
  - **期待される動作**: 各カードに削除ボタンが存在する
- **前提条件**: 履歴データ
- **実行手順**:
  1. 履歴データを作成する
  2. HistoryItemCardを表示する
  3. 削除ボタン（アイコン）の存在を確認する
- **期待される結果**: 削除ボタン（ゴミ箱アイコンなど）が表示される
- **テストの目的**: 削除ボタンの表示確認
  - **確認ポイント**: ボタンの存在
- **関連要件**: FR-061-007
- **優先度**: P0 必須

#### TC-061-026: 削除ボタンタップでコールバックが発火する 🔵

- **テスト名**: 削除ボタンタップでonDeleteコールバックが発火する
  - **何をテストするか**: 削除ボタンのインタラクション
  - **期待される動作**: 削除ボタンタップでonDeleteが呼び出される
- **前提条件**: 履歴データと削除コールバック関数
- **実行手順**:
  1. 履歴データを作成する
  2. モック削除コールバックを準備する
  3. HistoryItemCardを表示する
  4. 削除ボタンをタップする
- **期待される結果**:
  - 削除コールバックが1回呼び出される
  - 正しい履歴IDが渡される
- **テストの目的**: 削除ボタンのハンドリング確認
  - **確認ポイント**: コールバック呼び出し
- **関連要件**: FR-061-007
- **優先度**: P0 必須

#### TC-061-027: 長文が省略表示される 🟡

- **テスト名**: 長い履歴テキストが省略表示される
  - **何をテストするか**: テキストオーバーフロー処理
  - **期待される動作**: 長いテキストが...で省略される
- **前提条件**: 500文字の長い履歴データ
- **実行手順**:
  1. 500文字の履歴データを作成する
  2. HistoryItemCardを表示する
  3. Textウィジェットのoverflow設定を確認する
- **期待される結果**:
  - テキストが最初の100文字程度で省略される
  - 省略記号「...」が表示される
- **テストの目的**: テキストオーバーフロー処理確認
  - **確認ポイント**: TextのmaxLinesとoverflow設定
- **関連要件**: EDGE-061-006
- **優先度**: P1 重要

### 2.2 種類別アイコンテスト

#### TC-061-028: 文字盤入力アイコンが表示される 🟡

- **テスト名**: 文字盤入力の履歴にキーボードアイコンが表示される
  - **何をテストするか**: 種類別アイコン表示
  - **期待される動作**: HistoryType.characterBoardの場合、キーボードアイコン表示
- **前提条件**: 文字盤入力の履歴データ
- **実行手順**:
  1. type=characterBoardの履歴を作成する
  2. HistoryItemCardを表示する
  3. キーボードアイコンの存在を確認する
- **期待される結果**: Icons.keyboardまたは同等のアイコンが表示される
- **テストの目的**: 種類別アイコン表示確認
  - **確認ポイント**: アイコンの種類
- **関連要件**: NFR-061-008
- **優先度**: P1 重要

#### TC-061-029: 定型文アイコンが表示される 🟡

- **テスト名**: 定型文の履歴にリストアイコンが表示される
  - **何をテストするか**: 種類別アイコン表示
  - **期待される動作**: HistoryType.presetPhraseの場合、リストアイコン表示
- **前提条件**: 定型文の履歴データ
- **実行手順**:
  1. type=presetPhraseの履歴を作成する
  2. HistoryItemCardを表示する
  3. リストアイコンの存在を確認する
- **期待される結果**: Icons.listまたは同等のアイコンが表示される
- **テストの目的**: 種類別アイコン表示確認
  - **確認ポイント**: アイコンの種類
- **関連要件**: NFR-061-008
- **優先度**: P1 重要

#### TC-061-030: AI変換アイコンが表示される 🟡

- **テスト名**: AI変換結果の履歴にAIアイコンが表示される
  - **何をテストするか**: 種類別アイコン表示
  - **期待される動作**: HistoryType.aiConversionの場合、AIアイコン表示
- **前提条件**: AI変換の履歴データ
- **実行手順**:
  1. type=aiConversionの履歴を作成する
  2. HistoryItemCardを表示する
  3. AIアイコンの存在を確認する
- **期待される結果**: Icons.auto_awesomeまたは同等のアイコンが表示される
- **テストの目的**: 種類別アイコン表示確認
  - **確認ポイント**: アイコンの種類
- **関連要件**: NFR-061-008
- **優先度**: P1 重要

#### TC-061-031: 大ボタンアイコンが表示される 🟡

- **テスト名**: 大ボタンの履歴にボタンアイコンが表示される
  - **何をテストするか**: 種類別アイコン表示
  - **期待される動作**: HistoryType.quickResponseの場合、ボタンアイコン表示
- **前提条件**: 大ボタンの履歴データ
- **実行手順**:
  1. type=quickResponseの履歴を作成する
  2. HistoryItemCardを表示する
  3. ボタンアイコンの存在を確認する
- **期待される結果**: Icons.smart_buttonまたは同等のアイコンが表示される
- **テストの目的**: 種類別アイコン表示確認
  - **確認ポイント**: アイコンの種類
- **関連要件**: NFR-061-008
- **優先度**: P1 重要

### 2.3 サイズ・アクセシビリティテスト

#### TC-061-032: カードの最小高さが44px以上 🔵

- **テスト名**: HistoryItemCardの最小高さが44px以上
  - **何をテストするか**: アクセシビリティ要件
  - **期待される動作**: カード高さが44px以上
- **前提条件**: 短いテキストの履歴データ
- **実行手順**:
  1. 短いテキストの履歴を作成する
  2. HistoryItemCardを表示する
  3. カードの高さを測定する
- **期待される結果**: 高さが44px以上
- **テストの目的**: サイズ要件確認
  - **確認ポイント**: ウィジェットの高さ
- **関連要件**: NFR-061-004, REQ-5001
- **優先度**: P0 必須

---

## 3. EmptyHistoryWidget テストケース

### 3.1 正常系テスト

#### TC-061-033: 空状態メッセージが表示される 🔵

- **テスト名**: EmptyHistoryWidgetが空状態メッセージを表示する
  - **何をテストするか**: 空状態のUI表示
  - **期待される動作**: 「履歴がありません」メッセージが表示される
- **前提条件**: なし
- **実行手順**:
  1. EmptyHistoryWidgetを表示する
  2. メッセージテキストを確認する
- **期待される結果**: 「履歴がありません」が画面中央に表示される
- **テストの目的**: 空状態UI確認
  - **確認ポイント**: メッセージテキスト
- **関連要件**: FR-061-004, EDGE-061-004
- **優先度**: P0 必須

#### TC-061-034: 空状態アイコンが表示される 🟡

- **テスト名**: EmptyHistoryWidgetにアイコンが表示される
  - **何をテストするか**: 空状態の視覚的表示
  - **期待される動作**: アイコンが表示される
- **前提条件**: なし
- **実行手順**:
  1. EmptyHistoryWidgetを表示する
  2. アイコンの存在を確認する
- **期待される結果**: 空状態を示すアイコン（履歴アイコンなど）が表示される
- **テストの目的**: 視覚的要素確認
  - **確認ポイント**: アイコンの存在
- **関連要件**: UX
- **優先度**: P2 低

#### TC-061-035: 使い方のヒントが表示される 🟡

- **テスト名**: EmptyHistoryWidgetに使い方のヒントが表示される
  - **何をテストするか**: ユーザーガイダンス
  - **期待される動作**: 履歴機能の使い方ヒントが表示される
- **前提条件**: なし
- **実行手順**:
  1. EmptyHistoryWidgetを表示する
  2. ヒントテキストの存在を確認する
- **期待される結果**: 「読み上げた内容が履歴として保存されます」などのヒントが表示される
- **テストの目的**: ユーザーガイダンス確認
  - **確認ポイント**: ヒントテキスト
- **関連要件**: EDGE-061-004
- **優先度**: P2 低

---

## 4. エラーハンドリング・エッジケーステスト

### 4.1 エラー処理テスト

#### TC-061-036: TTS読み上げエラー時の処理 🟡

- **テスト名**: TTS読み上げエラー時にエラーメッセージが表示される
  - **何をテストするか**: TTS読み上げエラー処理
  - **期待される動作**: エラー通知が表示され、アプリはクラッシュしない
- **前提条件**:
  - 履歴データが存在する
  - TTSプロバイダーがエラーを投げる状態
- **実行手順**:
  1. TTSプロバイダーをモック化し、エラーを投げるように設定する
  2. 履歴データを準備する
  3. HistoryScreenを表示する
  4. 履歴項目をタップする
- **期待される結果**:
  - エラー通知（SnackBarまたはダイアログ）が表示される
  - アプリがクラッシュしない
  - 履歴項目は選択状態のまま
- **テストの目的**: エラーハンドリング確認
  - **確認ポイント**: エラー通知、アプリの安定性
- **関連要件**: EDGE-061-002, AC-061-009
- **優先度**: P1 重要

#### TC-061-037: 履歴削除エラー時の処理 🟡

- **テスト名**: 履歴削除エラー時にエラーメッセージが表示される
  - **何をテストするか**: 削除エラー処理
  - **期待される動作**: エラーメッセージが表示され、削除が中止される
- **前提条件**:
  - 履歴データが存在する
  - HistoryProviderの削除処理がエラーを投げる状態
- **実行手順**:
  1. HistoryProviderをモック化し、削除時にエラーを投げるように設定する
  2. 履歴データを準備する
  3. HistoryScreenを表示する
  4. 削除ボタンをタップし、確認ダイアログで「削除」を選択する
- **期待される結果**:
  - 「削除に失敗しました」エラーメッセージが表示される
  - 履歴が削除されず残っている
- **テストの目的**: エラーハンドリング確認
  - **確認ポイント**: エラーメッセージ、履歴の保持
- **関連要件**: EDGE-061-003
- **優先度**: P1 重要

### 4.2 特殊ケーステスト

#### TC-061-038: 読み上げ中に別の履歴をタップ 🟡

- **テスト名**: 読み上げ中に別の履歴項目をタップすると現在の読み上げが停止し、新しい項目の読み上げが開始される
  - **何をテストするか**: 読み上げの切り替え処理
  - **期待される動作**: 現在の読み上げが停止し、新しい読み上げが開始される
- **前提条件**:
  - 複数の履歴データが存在する
  - 1件目の読み上げが実行中
- **実行手順**:
  1. 複数の履歴データを準備する
  2. TTSプロバイダーをモック化する
  3. HistoryScreenを表示する
  4. 1件目の履歴をタップして読み上げを開始する
  5. すぐに2件目の履歴をタップする
- **期待される結果**:
  - TTSのstopメソッドが呼び出される
  - 2件目のspeakメソッドが呼び出される
- **テストの目的**: 読み上げ切り替え処理確認
  - **確認ポイント**: stop/speakの呼び出し順序
- **関連要件**: EDGE-061-008, REQ-403
- **優先度**: P1 重要

#### TC-061-039: 音量0の状態で履歴をタップ 🟡

- **テスト名**: OS音量が0（ミュート）の状態で履歴項目をタップすると音量警告が表示される
  - **何をテストするか**: 音量警告の表示
  - **期待される動作**: 「音量が0です」という視覚的警告が表示される
- **前提条件**:
  - 履歴データが存在する
  - OS音量が0の状態
- **実行手順**:
  1. 音量チェック機能をモック化し、音量0を返すように設定する
  2. 履歴データを準備する
  3. HistoryScreenを表示する
  4. 履歴項目をタップする
- **期待される結果**:
  - 「音量が0です」または同等の警告メッセージが表示される
  - VolumeWarningWidgetが表示される
- **テストの目的**: 音量警告の表示確認
  - **確認ポイント**: 警告ウィジェットの存在
- **関連要件**: EDGE-061-009, EDGE-202
- **優先度**: P1 重要

#### TC-061-040: アプリがバックグラウンドから復帰 🟡

- **テスト名**: アプリがバックグラウンドから復帰した場合、履歴一覧の状態が復元される
  - **何をテストするか**: 状態復元処理
  - **期待される動作**: スクロール位置などの状態が保持される
- **前提条件**:
  - 複数の履歴データが存在する
  - スクロール位置が中間にある状態
- **実行手順**:
  1. 複数の履歴データを準備する
  2. HistoryScreenを表示する
  3. スクロールして中間位置に移動する
  4. アプリライフサイクルイベント（一時停止→復帰）をシミュレートする
- **期待される結果**:
  - スクロール位置が保持される
  - 履歴データが保持される
- **テストの目的**: 状態復元確認
  - **確認ポイント**: スクロール位置、データの保持
- **関連要件**: EDGE-061-007, EDGE-201
- **優先度**: P2 低

---

## 5. 統合テスト

### 5.1 Providerとのインテグレーションテスト

#### TC-061-041: HistoryProviderとの連携テスト 🔵

- **テスト名**: HistoryScreenがHistoryProviderと正しく連携する
  - **何をテストするか**: Provider連携
  - **期待される動作**: Providerの状態変更がUIに反映される
- **前提条件**: なし
- **実行手順**:
  1. ProviderScopeでHistoryScreenをラップする
  2. HistoryProviderに履歴を追加する
  3. UIが更新されることを確認する
- **期待される結果**:
  - 追加した履歴が一覧に表示される
  - 削除した履歴が一覧から消える
- **テストの目的**: Provider連携確認
  - **確認ポイント**: 状態同期
- **関連要件**: 技術実装要件
- **優先度**: P0 必須

#### TC-061-042: TTSProviderとの連携テスト 🔵

- **テスト名**: 履歴タップがTTSProviderと正しく連携する
  - **何をテストするか**: TTS連携
  - **期待される動作**: タップ時にTTS読み上げが開始される
- **前提条件**: なし
- **実行手順**:
  1. ProviderScopeでHistoryScreenをラップする
  2. TTSProviderをモック化する
  3. 履歴項目をタップする
- **期待される結果**: TTSProviderのspeakメソッドが呼び出される
- **テストの目的**: TTS連携確認
  - **確認ポイント**: speakメソッド呼び出し
- **関連要件**: FR-061-006, TASK-0048連携
- **優先度**: P0 必須

---

## テストカバレッジ目標

| カテゴリ | 目標カバレッジ |
|----------|--------------|
| **全体** | 80%以上 |
| **ビジネスロジック** | 90%以上 |
| **ウィジェット表示** | 80%以上 |
| **エラーハンドリング** | 70%以上 |

---

## テスト実行コマンド

```bash
# すべてのテストを実行
flutter test

# 履歴関連のテストのみ実行
flutter test test/features/history/

# カバレッジレポート生成
flutter test --coverage
genhtml coverage/lcov.info -o coverage/html
open coverage/html/index.html
```

---

## 信頼性レベルサマリー

- 🔵 **青信号**（確実な要件）: 33件
  - 要件定義書（FR-061-XXX）、受け入れ基準（AC-061-XXX）に基づく
  - TC-061-001〜006, 008〜020, 023〜026, 032, 033, 041, 042

- 🟡 **黄信号**（妥当な推測）: 9件
  - 要件定義書から推測される機能、エラーハンドリング、UX向上
  - TC-061-007, 018, 027〜031, 034〜040

- 🔴 **赤信号**（完全な推測）: 0件
  - なし

---

## テストデータ準備ヘルパー

各テストでは以下のヘルパー関数を使用してテストデータを準備します：

```dart
/// 【テストデータ準備】: テスト用の履歴データを生成するヘルパー関数
History createTestHistory({
  required String id,
  required String content,
  required HistoryType type,
  DateTime? createdAt,
}) {
  return History(
    id: id,
    content: content,
    type: type,
    createdAt: createdAt ?? DateTime.now(),
  );
}

/// 【テストデータ準備】: 複数件の履歴データを生成
List<History> createTestHistories(int count, {HistoryType? type}) {
  return List.generate(
    count,
    (i) => createTestHistory(
      id: 'test_$i',
      content: 'テスト履歴$i',
      type: type ?? HistoryType.values[i % HistoryType.values.length],
      createdAt: DateTime.now().subtract(Duration(minutes: i)),
    ),
  );
}
```

---

## 参考資料

- **要件定義書**: `/Volumes/external/dev/kotonoha/docs/implements/kotonoha/TASK-0061/kotonoha-requirements.md`
- **データモデル**: `/Volumes/external/dev/kotonoha/frontend/kotonoha_app/lib/features/history/domain/models/history.dart`
- **プロバイダー**: `/Volumes/external/dev/kotonoha/frontend/kotonoha_app/lib/features/history/providers/history_provider.dart`
- **先行タスク**: TASK-0048（TTS読み上げ機能）、TASK-0059（履歴保存・読み込み）
