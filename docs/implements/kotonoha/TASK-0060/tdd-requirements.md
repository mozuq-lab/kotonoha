# TASK-0060: Phase 3 統合テスト - TDD要件定義書

## タスク情報

- **タスクID**: TASK-0060
- **タスク名**: Phase 3 統合テスト
- **タスクタイプ**: TDD
- **推定工数**: 8時間
- **フェーズ**: Phase 3 (Week 12, Day 24)
- **関連要件**: すべてのPhase 3要件（REQ-001～REQ-5006を含む）
- **依存タスク**: TASK-0037〜TASK-0059（すべてのPhase 3タスク）

## 【信頼性レベル凡例】

- 🔵 **青信号**: EARS要件定義書・設計文書を参考にした確実な要件
- 🟡 **黄信号**: EARS要件定義書・設計文書から妥当な推測による要件
- 🔴 **赤信号**: EARS要件定義書・設計文書にない推測による要件

---

## 1. 統合テストの目的

Phase 3で実装されたフロントエンド基本機能（文字盤UI、定型文管理、大ボタン、緊急ボタン、TTS読み上げ、ローカルストレージ）の統合的な動作を検証し、エンドツーエンドで要件を満たすことを確認する。

### 1.1 統合テストの範囲 🔵

**検証対象機能**:
- 文字盤入力から読み上げまでの一連のフロー
- 定型文選択から即座読み上げのフロー
- 緊急ボタンの2段階確認から緊急音再生までのフロー
- TTS読み上げ機能（1秒以内開始）
- ローカルストレージでのデータ永続化
- オフライン動作の確認
- パフォーマンス要件の検証
- アクセシビリティ要件の検証

**検証対象外**:
- AI変換機能（Phase 4以降）
- 履歴・お気に入り機能の詳細UI（Phase 4）
- 設定画面の詳細UI（Phase 4以降）
- バックエンドAPI連携（Phase 5以降）

---

## 2. 機能要件の整理

### 2.1 文字入力から読み上げまでのフロー 🔵

**要件**: ユーザーが文字盤で文字を入力し、読み上げボタンをタップすると、入力したテキストが音声で読み上げられる

**関連要件**:
- REQ-001: 五十音配列の文字盤UI表示
- REQ-002: 文字盤タップで入力欄に文字追加
- REQ-401: OS標準TTSで読み上げ
- REQ-601: 読み上げ後に履歴として自動保存
- NFR-001: TTS読み上げ開始までの時間を1秒以内
- NFR-003: 文字盤タップから入力欄への文字反映まで100ms以内

**ユーザーストーリー**:
```
AS A 発話困難なユーザー
I WANT TO 文字盤で「こんにちは」と入力して読み上げボタンをタップする
SO THAT 介護スタッフに挨拶を伝えることができる
```

**エンドツーエンドフロー**:
1. ユーザーが文字盤で「こ」「ん」「に」「ち」「は」を順番にタップ
2. 入力欄に「こんにちは」が表示される（各タップ100ms以内で反映）
3. ユーザーが読み上げボタンをタップ
4. 1秒以内にTTS読み上げが開始される
5. 読み上げ完了後、「こんにちは」が履歴に自動保存される

**検証項目**:
- 文字盤タップ → 入力欄反映が100ms以内に完了する
- 読み上げボタンタップ → TTS開始が1秒以内に完了する
- 読み上げ完了後、履歴にテキストが保存される
- アプリ再起動後も履歴が保持される

---

### 2.2 定型文選択から即座読み上げのフロー 🔵

**要件**: ユーザーが定型文をタップすると、即座に読み上げが実行される

**関連要件**:
- REQ-101: 定型文を一覧表示
- REQ-102: 定型文タップで入力欄に反映
- REQ-103: 定型文を直接タップで即座に読み上げ
- REQ-105: お気に入り定型文を一覧上部に優先表示
- REQ-107: 50-100個程度の汎用的な定型文サンプル初期データ提供
- NFR-001: TTS読み上げ開始までの時間を1秒以内
- NFR-004: 定型文一覧の表示（100件程度）を1秒以内に完了

**ユーザーストーリー**:
```
AS A 発話困難なユーザー
I WANT TO 定型文「トイレに行きたいです」をタップする
SO THAT 介護スタッフにトイレ介助の依頼を素早く伝えることができる
```

**エンドツーエンドフロー**:
1. アプリ起動時、定型文一覧が1秒以内に表示される
2. お気に入り定型文が一覧上部に表示される
3. ユーザーが定型文「トイレに行きたいです」をタップ
4. 1秒以内にTTS読み上げが開始される
5. 読み上げ完了後、「トイレに行きたいです」が履歴に保存される

**検証項目**:
- 定型文一覧が1秒以内に表示される（100件程度）
- お気に入り定型文が上部に表示される
- 定型文タップ → TTS開始が1秒以内に完了する
- 読み上げ完了後、履歴にテキストが保存される

---

### 2.3 緊急ボタンの2段階確認から緊急音再生のフロー 🔵

**要件**: ユーザーが緊急ボタンをタップし、確認ダイアログで「はい」を選択すると、緊急音が再生され、画面が赤く表示される

**関連要件**:
- REQ-301: 緊急呼び鈴ボタンをすべての画面で表示
- REQ-302: 緊急ボタンを2段階確認で動作
- REQ-303: 緊急ボタン押下時に周囲の人が気づきやすい音を発生
- REQ-304: 緊急ボタン押下時に画面全体を目立つ色で表示
- REQ-2004: 緊急ボタン1回タップ時に確認ダイアログ表示
- REQ-2005: 確認ダイアログで「はい」タップ時に緊急音発生と画面切り替え
- REQ-5002: 重要な操作に誤操作防止の仕組みを設ける

**ユーザーストーリー**:
```
AS A 発話困難なユーザー
I WANT TO 緊急ボタンをタップして確認後に緊急音を鳴らす
SO THAT 介護スタッフに緊急事態を知らせることができる
```

**エンドツーエンドフロー**:
1. ユーザーが緊急ボタンをタップ
2. 確認ダイアログ「緊急呼び出しを実行しますか?」が表示される
3. ユーザーが「はい」ボタンをタップ
4. 緊急音が再生される
5. 画面全体が赤く表示される
6. リセットボタンで通常画面に戻る

**検証項目**:
- 緊急ボタンがすべての画面に表示される
- 1回目のタップで確認ダイアログが表示される
- 「はい」タップで緊急音が再生される
- 画面全体が赤く表示される
- リセットボタンで通常画面に戻れる
- 「いいえ」タップでキャンセルされる

---

### 2.4 大ボタン・状態ボタンの即座読み上げ 🔵

**要件**: 「はい」「いいえ」「わからない」の大ボタンや「痛い」「トイレ」などの状態ボタンをタップすると、即座に読み上げられる

**関連要件**:
- REQ-201: 「はい」「いいえ」「わからない」の3つの大ボタンを画面上部に常時表示
- REQ-202: 状態を表すボタン（「痛い」「トイレ」「暑い」「寒い」など）を画面上部に表示
- REQ-203: 状態ボタンを8-12個の固定文言として提供
- REQ-204: 大ボタンおよび状態ボタンのタップ時に即座に読み上げを実行
- NFR-001: TTS読み上げ開始までの時間を1秒以内
- NFR-202: タップ領域を視認性が高く押しやすいサイズ（推奨60px × 60px以上）で設計

**ユーザーストーリー**:
```
AS A 発話困難なユーザー
I WANT TO 「痛い」ボタンをタップする
SO THAT 介護スタッフに痛みを素早く伝えることができる
```

**エンドツーエンドフロー**:
1. 画面上部に大ボタン（はい/いいえ/わからない）が表示される
2. 画面上部に状態ボタン（痛い/トイレ/暑い/寒い等）が表示される
3. ユーザーが「痛い」ボタンをタップ
4. 1秒以内にTTS読み上げが開始される
5. 読み上げ完了後、「痛い」が履歴に保存される

**検証項目**:
- 大ボタン3個が画面上部に常時表示される
- 状態ボタン8-12個が表示される
- ボタンサイズが60px × 60px以上
- ボタンタップ → TTS開始が1秒以内に完了する
- 読み上げ完了後、履歴にテキストが保存される

---

### 2.5 対面表示モードと画面回転 🔵

**要件**: ユーザーが対面表示モードを有効にすると、テキストが拡大表示され、画面を180度回転できる

**関連要件**:
- REQ-501: 読み上げテキストを画面中央に大きく表示する拡大表示モードを提供
- REQ-502: 画面を180度回転させて対面の相手から読みやすい表示に切り替える機能を提供
- REQ-503: 通常モードと対面表示モードをシンプルな操作で切り替え可能

**ユーザーストーリー**:
```
AS A 発話困難なユーザー
I WANT TO 対面表示モードで画面を180度回転する
SO THAT 対面の介護スタッフが読みやすい向きで見せることができる
```

**エンドツーエンドフロー**:
1. ユーザーが対面表示モードボタンをタップ
2. テキストが画面中央に大きく表示される
3. ユーザーが画面回転ボタンをタップ
4. 画面が180度回転する
5. ユーザーが通常モードに戻るボタンをタップ
6. 通常画面に戻る

**検証項目**:
- 対面表示モードでテキストが拡大表示される
- 画面が180度回転する
- 回転後も文字が読みやすい
- 通常モードに戻れる

---

### 2.6 削除ボタン・全消去ボタンの動作 🔵

**要件**: ユーザーが削除ボタンで最後の1文字を削除し、全消去ボタンで全文を削除できる（誤操作防止の確認ダイアログ付き）

**関連要件**:
- REQ-003: 削除ボタンで最後の1文字を削除
- REQ-004: 全消去ボタンですべての文字を削除
- REQ-2001: 全消去ボタンタップ時に確認ダイアログを表示
- REQ-5002: 重要な操作に誤操作防止の仕組みを設ける

**ユーザーストーリー**:
```
AS A 発話困難なユーザー
I WANT TO 入力した文字を1文字ずつ削除する、または全消去する
SO THAT 入力ミスを修正できる
```

**エンドツーエンドフロー**:
1. ユーザーが文字盤で「こんにちは」と入力
2. ユーザーが削除ボタンをタップ
3. 最後の1文字「は」が削除される → 「こんにち」
4. ユーザーが全消去ボタンをタップ
5. 確認ダイアログが表示される
6. ユーザーが「はい」をタップ
7. すべての文字が削除される

**検証項目**:
- 削除ボタンで最後の1文字が削除される
- 全消去ボタンで確認ダイアログが表示される
- 「はい」タップですべての文字が削除される
- 「いいえ」タップでキャンセルされる

---

## 3. 非機能要件の整理

### 3.1 パフォーマンス要件 🔵

**NFR-001**: TTS読み上げ開始までの時間を1秒以内としなければならない

**検証方法**:
- Stopwatchで読み上げボタンタップからTTS開始までの時間を計測
- 平均3回の計測で1秒以内であることを確認

**NFR-003**: 文字盤タップから入力欄への文字反映まで100ms以内としなければならない

**検証方法**:
- Stopwatchで文字盤タップから入力欄反映までの時間を計測
- 平均10回の計測で100ms以内であることを確認

**NFR-004**: 定型文一覧の表示（100件程度）を1秒以内に完了しなければならない

**検証方法**:
- Stopwatchでアプリ起動から定型文一覧表示までの時間を計測
- 100件の定型文で1秒以内であることを確認

---

### 3.2 データ永続化要件 🔵

**REQ-5003**: アプリが強制終了しても定型文・設定・履歴を失わない永続化機構を実装しなければならない

**検証方法**:
- 定型文・履歴・設定を保存
- アプリを強制終了（シミュレーション）
- アプリを再起動
- すべてのデータが復元されることを確認

**NFR-302**: アプリクラッシュからの復旧時に、最後の入力状態を復元しなければならない

**検証方法**:
- 文字盤で「こんにちは」と入力
- アプリを強制終了（シミュレーション）
- アプリを再起動
- 入力欄に「こんにちは」が復元されることを確認

---

### 3.3 オフライン動作要件 🔵

**REQ-1001**: 文字盤入力・定型文・履歴・TTSをオフライン環境で利用可能にしなければならない

**検証方法**:
- ネットワーク接続を切断（シミュレーション）
- 文字盤入力が動作することを確認
- 定型文選択が動作することを確認
- TTS読み上げが動作することを確認
- ローカルストレージへの保存が動作することを確認

**REQ-1002**: オフライン時にAI変換が利用不可であることを明示しなければならない

**検証方法**:
- ネットワーク接続を切断（シミュレーション）
- AI変換ボタンが無効化またはグレーアウト表示されることを確認
- オフライン表示が明示されることを確認

---

### 3.4 アクセシビリティ要件 🔵

**REQ-5001**: タップターゲット（ボタン・キー）のサイズを44px × 44px以上としなければならない

**検証方法**:
- 文字盤の各文字ボタンのサイズを計測
- 削除ボタン、全消去ボタンのサイズを計測
- すべて44px × 44px以上であることを確認

**NFR-202**: タップ領域を視認性が高く押しやすいサイズ（推奨60px × 60px以上）で設計しなければならない

**検証方法**:
- 大ボタン（はい/いいえ/わからない）のサイズを計測
- 緊急ボタンのサイズを計測
- 推奨60px × 60px以上であることを確認

**REQ-5006**: 高コントラストモードでWCAG 2.1 AAレベルのコントラスト比（4.5:1以上）を確保しなければならない

**検証方法**:
- 高コントラストテーマに切り替え
- テキストと背景のコントラスト比を計測
- 4.5:1以上であることを確認

---

## 4. エッジケース・境界値テスト

### 4.1 入力文字数の境界値テスト 🟡

**EDGE-101**: 入力欄の文字数が1000文字を超えた場合、システムは警告を表示し、1000文字で入力を制限しなければならない

**検証方法**:
- 文字盤で1000文字以上入力を試みる
- 1000文字で入力が制限されることを確認
- 警告メッセージが表示されることを確認

---

### 4.2 履歴の最大件数テスト 🔵

**REQ-3002**: 履歴が50件に達した状態にある場合、システムは新しい履歴を追加する際に最も古い履歴を自動削除しなければならない

**検証方法**:
- 50件の履歴を作成
- 51件目の履歴を追加
- 最も古い履歴が削除されることを確認
- 履歴件数が50件に保たれることを確認

---

### 4.3 OS音量0の警告表示テスト 🟡

**EDGE-202**: OS音量が0（ミュート）の状態で読み上げを実行した場合、システムは「音量が0です」という視覚的警告を表示しなければならない

**検証方法**:
- OS音量を0に設定（モック）
- 読み上げボタンをタップ
- 「音量が0です」という警告が表示されることを確認

---

### 4.4 読み上げ中の速度変更テスト 🟡

**EDGE-1**: 読み上げ中に速度を変更した場合、現在の読み上げは元の速度で継続し、次回の読み上げから新しい速度が適用されることを確認

**検証方法**:
- 速度「普通」で長いテキストを読み上げ開始
- 読み上げ中に速度を「速い」に変更
- 現在の読み上げは元の速度で継続することを確認
- 次回の読み上げから新しい速度が適用されることを確認

---

## 5. 統合テストシナリオ

### 5.1 E2Eテストシナリオ1: 文字入力から読み上げ・履歴保存まで 🔵

**シナリオ**: ユーザーが文字盤で「こんにちは」と入力し、読み上げボタンをタップして、履歴に保存されるまでの一連のフロー

**手順**:
1. アプリを起動
2. 文字盤で「こ」「ん」「に」「ち」「は」を順番にタップ
3. 入力欄に「こんにちは」が表示されることを確認（各タップ100ms以内）
4. 読み上げボタンをタップ
5. 1秒以内にTTS読み上げが開始されることを確認
6. 読み上げ完了を待つ
7. 履歴に「こんにちは」が保存されることを確認
8. アプリを再起動
9. 履歴に「こんにちは」が保持されていることを確認

**期待される結果**:
- すべての文字が100ms以内に入力欄に反映される
- 読み上げが1秒以内に開始される
- 読み上げ完了後、履歴に保存される
- アプリ再起動後も履歴が保持される

---

### 5.2 E2Eテストシナリオ2: 定型文即座読み上げ 🔵

**シナリオ**: ユーザーが定型文「トイレに行きたいです」をタップして、即座に読み上げられるまでのフロー

**手順**:
1. アプリを起動
2. 定型文一覧が1秒以内に表示されることを確認
3. 定型文「トイレに行きたいです」をタップ
4. 1秒以内にTTS読み上げが開始されることを確認
5. 読み上げ完了を待つ
6. 履歴に「トイレに行きたいです」が保存されることを確認

**期待される結果**:
- 定型文一覧が1秒以内に表示される
- 定型文タップから1秒以内に読み上げが開始される
- 読み上げ完了後、履歴に保存される

---

### 5.3 E2Eテストシナリオ3: 緊急ボタン → 2段階確認 → 緊急音 🔵

**シナリオ**: ユーザーが緊急ボタンをタップし、確認ダイアログで「はい」を選択して、緊急音が再生されるまでのフロー

**手順**:
1. アプリを起動
2. 緊急ボタンが表示されることを確認
3. 緊急ボタンをタップ
4. 確認ダイアログ「緊急呼び出しを実行しますか?」が表示されることを確認
5. 「はい」ボタンをタップ
6. 緊急音が再生されることを確認
7. 画面全体が赤く表示されることを確認
8. リセットボタンをタップ
9. 通常画面に戻ることを確認

**期待される結果**:
- 緊急ボタンがすべての画面に表示される
- 1回目のタップで確認ダイアログが表示される
- 「はい」タップで緊急音が再生される
- 画面全体が赤く表示される
- リセットボタンで通常画面に戻る

---

### 5.4 E2Eテストシナリオ4: 大ボタン即座読み上げ 🔵

**シナリオ**: ユーザーが「はい」ボタンをタップして、即座に読み上げられるまでのフロー

**手順**:
1. アプリを起動
2. 大ボタン「はい」が画面上部に表示されることを確認
3. 「はい」ボタンをタップ
4. 1秒以内にTTS読み上げが開始されることを確認
5. 読み上げ完了を待つ
6. 履歴に「はい」が保存されることを確認

**期待される結果**:
- 大ボタンが画面上部に常時表示される
- ボタンタップから1秒以内に読み上げが開始される
- 読み上げ完了後、履歴に保存される

---

### 5.5 E2Eテストシナリオ5: 削除ボタン・全消去ボタン 🔵

**シナリオ**: ユーザーが文字を入力し、削除ボタンで1文字削除、全消去ボタンで全文削除するフロー

**手順**:
1. アプリを起動
2. 文字盤で「こんにちは」と入力
3. 削除ボタンをタップ
4. 最後の1文字「は」が削除されることを確認 → 「こんにち」
5. 全消去ボタンをタップ
6. 確認ダイアログが表示されることを確認
7. 「はい」ボタンをタップ
8. すべての文字が削除されることを確認

**期待される結果**:
- 削除ボタンで最後の1文字が削除される
- 全消去ボタンで確認ダイアログが表示される
- 「はい」タップですべての文字が削除される

---

### 5.6 E2Eテストシナリオ6: 対面表示モードと画面回転 🔵

**シナリオ**: ユーザーが対面表示モードを有効にし、画面を180度回転するフロー

**手順**:
1. アプリを起動
2. 文字盤で「こんにちは」と入力
3. 対面表示モードボタンをタップ
4. テキストが画面中央に大きく表示されることを確認
5. 画面回転ボタンをタップ
6. 画面が180度回転することを確認
7. 通常モードに戻るボタンをタップ
8. 通常画面に戻ることを確認

**期待される結果**:
- 対面表示モードでテキストが拡大表示される
- 画面が180度回転する
- 回転後も文字が読みやすい
- 通常モードに戻れる

---

### 5.7 E2Eテストシナリオ7: オフライン動作確認 🔵

**シナリオ**: ネットワーク接続を切断した状態で、基本機能が動作することを確認

**手順**:
1. ネットワーク接続を切断（シミュレーション）
2. アプリを起動
3. 文字盤で「こんにちは」と入力
4. 入力欄に「こんにちは」が表示されることを確認
5. 読み上げボタンをタップ
6. TTS読み上げが開始されることを確認
7. 定型文「ありがとうございます」をタップ
8. TTS読み上げが開始されることを確認
9. AI変換ボタンが無効化またはグレーアウト表示されることを確認
10. オフライン表示が明示されることを確認

**期待される結果**:
- オフライン時も文字盤入力が動作する
- オフライン時も定型文選択が動作する
- オフライン時もTTS読み上げが動作する
- AI変換ボタンが無効化またはグレーアウト表示される
- オフライン状態が明示される

---

### 5.8 E2Eテストシナリオ8: データ永続化テスト 🔵

**シナリオ**: アプリ再起動後も定型文・履歴・設定が保持されることを確認

**手順**:
1. アプリを起動
2. 定型文を1件追加（「テスト定型文」）
3. 文字盤で「テスト」と入力して読み上げ（履歴に保存）
4. 設定でフォントサイズを「大」に変更
5. アプリを強制終了（シミュレーション）
6. アプリを再起動
7. 定型文一覧に「テスト定型文」が表示されることを確認
8. 履歴に「テスト」が表示されることを確認
9. フォントサイズが「大」のまま保持されていることを確認

**期待される結果**:
- アプリ再起動後も定型文が保持される
- アプリ再起動後も履歴が保持される
- アプリ再起動後も設定が保持される

---

## 6. パフォーマンステスト要件

### 6.1 文字盤タップ応答速度テスト 🔵

**要件**: NFR-003 - 文字盤タップから入力欄への文字反映まで100ms以内

**テスト方法**:
- Stopwatchで文字盤タップから入力欄反映までの時間を計測
- 10回の計測で平均100ms以内であることを確認

**合格基準**:
- 平均応答時間が100ms以内
- 最大応答時間が150ms以内（余裕を持った基準）

---

### 6.2 TTS読み上げ開始速度テスト 🔵

**要件**: NFR-001 - TTS読み上げ開始までの時間を1秒以内

**テスト方法**:
- Stopwatchで読み上げボタンタップからTTS開始までの時間を計測
- 5回の計測で平均1秒以内であることを確認

**合格基準**:
- 平均応答時間が1秒以内
- 最大応答時間が1.5秒以内（余裕を持った基準）

---

### 6.3 定型文一覧表示速度テスト 🔵

**要件**: NFR-004 - 定型文一覧の表示（100件程度）を1秒以内に完了

**テスト方法**:
- Stopwatchでアプリ起動から定型文一覧表示までの時間を計測
- 100件の定型文で1秒以内であることを確認

**合格基準**:
- 表示時間が1秒以内
- 最大表示時間が1.5秒以内（余裕を持った基準）

---

## 7. アクセシビリティテスト要件

### 7.1 タップターゲットサイズテスト 🔵

**要件**: REQ-5001 - タップターゲットのサイズを44px × 44px以上

**テスト方法**:
- 文字盤の各文字ボタンのサイズを取得（tester.getSize()）
- 削除ボタン、全消去ボタンのサイズを取得
- すべて44px × 44px以上であることを確認

**合格基準**:
- すべてのボタンが44px × 44px以上
- 大ボタン・緊急ボタンは60px × 60px以上（推奨サイズ）

---

### 7.2 高コントラストモードテスト 🔵

**要件**: REQ-5006 - 高コントラストモードでWCAG 2.1 AAレベルのコントラスト比（4.5:1以上）を確保

**テスト方法**:
- 高コントラストテーマに切り替え
- テキストと背景の色を取得
- コントラスト比を計算
- 4.5:1以上であることを確認

**合格基準**:
- すべてのテキスト要素のコントラスト比が4.5:1以上

---

### 7.3 フォントサイズ変更テスト 🔵

**要件**: REQ-801 - フォントサイズを「小」「中」「大」の3段階から選択可能
**要件**: REQ-2007 - フォントサイズ変更時に即座にすべてのテキスト要素のサイズを変更

**テスト方法**:
- フォントサイズを「小」に設定
- 文字盤、定型文一覧、ボタンラベルのフォントサイズを確認
- フォントサイズを「大」に変更
- すべてのテキスト要素のフォントサイズが変更されることを確認

**合格基準**:
- フォントサイズ変更が即座に反映される
- 文字盤、定型文一覧、ボタンラベルのすべてが変更される

---

## 8. テストカバレッジ目標

### 8.1 カバレッジ目標 🔵

**全体カバレッジ**: 80%以上（NFR-501）
**ビジネスロジック・APIエンドポイント**: 90%以上（NFR-502）

**Phase 3での対象**:
- フロントエンド（Flutter）のみ
- バックエンドAPIは含まない（Phase 5以降）

**カバレッジ計測対象**:
- 文字盤入力ロジック
- 定型文CRUD操作
- TTS読み上げロジック
- 緊急ボタンロジック
- データ永続化ロジック
- 状態管理（Riverpod Provider）

---

## 9. 完了条件

### 9.1 機能テスト完了条件 🔵

- [ ] すべてのE2Eテストシナリオ（5.1〜5.8）が合格
- [ ] 文字入力から読み上げまでのフローが正常動作
- [ ] 定型文即座読み上げが正常動作
- [ ] 緊急ボタンの2段階確認から緊急音再生が正常動作
- [ ] 大ボタン・状態ボタンの即座読み上げが正常動作
- [ ] 削除ボタン・全消去ボタンが正常動作
- [ ] 対面表示モードと画面回転が正常動作
- [ ] オフライン動作が正常動作
- [ ] データ永続化が正常動作

---

### 9.2 パフォーマンステスト完了条件 🔵

- [ ] 文字盤タップ応答が100ms以内（平均）
- [ ] TTS読み上げ開始が1秒以内（平均）
- [ ] 定型文一覧表示が1秒以内（100件）

---

### 9.3 アクセシビリティテスト完了条件 🔵

- [ ] すべてのタップターゲットが44px × 44px以上
- [ ] 大ボタン・緊急ボタンが60px × 60px以上
- [ ] 高コントラストモードのコントラスト比が4.5:1以上
- [ ] フォントサイズ変更がすべてのテキスト要素に反映される

---

### 9.4 カバレッジ完了条件 🔵

- [ ] 全体カバレッジ80%以上
- [ ] ビジネスロジック（文字盤、定型文、TTS、緊急ボタン、データ永続化）のカバレッジ90%以上

---

## 10. 次のステップ（TDD Green/Refactorフェーズ）

### 10.1 TDD Redフェーズ（このドキュメント）✅

要件を整理し、テストケースを定義しました。

### 10.2 TDD Greenフェーズ（次のステップ）

以下の統合テストファイルを作成します:

1. **E2Eテストファイル**:
   - `test/integration/e2e_text_input_flow_test.dart` - 文字入力から読み上げまでのフロー
   - `test/integration/e2e_preset_phrase_flow_test.dart` - 定型文即座読み上げフロー
   - `test/integration/e2e_emergency_button_flow_test.dart` - 緊急ボタンフロー
   - `test/integration/e2e_large_button_flow_test.dart` - 大ボタン即座読み上げフロー
   - `test/integration/e2e_delete_button_flow_test.dart` - 削除ボタン・全消去ボタンフロー
   - `test/integration/e2e_face_to_face_flow_test.dart` - 対面表示モードと画面回転フロー
   - `test/integration/e2e_offline_flow_test.dart` - オフライン動作確認
   - `test/integration/e2e_data_persistence_test.dart` - データ永続化テスト

2. **パフォーマンステストファイル**:
   - `test/performance/character_board_response_test.dart` - 文字盤タップ応答速度
   - `test/performance/tts_start_speed_test.dart` - TTS読み上げ開始速度
   - `test/performance/preset_phrase_load_speed_test.dart` - 定型文一覧表示速度

3. **アクセシビリティテストファイル**:
   - `test/accessibility/tap_target_size_test.dart` - タップターゲットサイズ
   - `test/accessibility/high_contrast_test.dart` - 高コントラストモード
   - `test/accessibility/font_size_test.dart` - フォントサイズ変更

### 10.3 TDD Refactorフェーズ（最終ステップ）

テストが通った後、コード品質を改善します:
- 重複コードの削除
- テストコードのリファクタリング
- ドキュメント更新

---

## 11. 参考資料

### 11.1 関連ドキュメント

- [要件定義書](/Volumes/external/dev/kotonoha/docs/spec/kotonoha-requirements.md)
- [アーキテクチャ設計](/Volumes/external/dev/kotonoha/docs/design/kotonoha/architecture.md)
- [インターフェース定義](/Volumes/external/dev/kotonoha/docs/design/kotonoha/interfaces.dart)
- [Phase 3タスク一覧](/Volumes/external/dev/kotonoha/docs/tasks/kotonoha-phase3.md)

### 11.2 既存の統合テスト例

- `/Volumes/external/dev/kotonoha/frontend/kotonoha_app/test/integration/tts_speed_integration_test.dart`
- `/Volumes/external/dev/kotonoha/frontend/kotonoha_app/test/integration/navigation_test.dart`
- `/Volumes/external/dev/kotonoha/frontend/kotonoha_app/test/performance/data_load_performance_test.dart`

---

## 12. まとめ

このTDD要件定義書では、Phase 3統合テストで検証すべき機能要件・非機能要件を整理しました。

**主要な検証ポイント**:
1. **E2Eフロー**: 文字入力→読み上げ、定型文即座読み上げ、緊急ボタン、大ボタン等
2. **パフォーマンス**: 文字盤タップ100ms以内、TTS開始1秒以内、定型文表示1秒以内
3. **データ永続化**: アプリ再起動後もデータ保持
4. **オフライン動作**: ネットワーク切断時も基本機能が動作
5. **アクセシビリティ**: タップターゲット44px以上、高コントラスト4.5:1以上

**信頼性レベル**:
- 🔵 **青信号**: 大部分の要件は EARS要件定義書・設計文書に明確に記載
- 🟡 **黄信号**: 一部の境界値テストやエッジケースは妥当な推測

次のステップでは、これらの要件に基づいてテストコードを作成します（TDD Greenフェーズ）。
