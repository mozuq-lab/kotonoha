# TASK-0060: Phase 3 統合テスト - テストケース定義書

## タスク情報

- **タスクID**: TASK-0060
- **タスク名**: Phase 3 統合テスト
- **タスクタイプ**: TDD
- **フェーズ**: Phase 3 (Week 12, Day 24)
- **関連要件**: すべてのPhase 3要件（REQ-001〜REQ-5006を含む）
- **依存タスク**: TASK-0037〜TASK-0059（すべてのPhase 3タスク）

## 【信頼性レベル凡例】

- 🔵 **青信号**: EARS要件定義書・設計文書を参考にした確実なテスト
- 🟡 **黄信号**: EARS要件定義書・設計文書から妥当な推測によるテスト
- 🔴 **赤信号**: EARS要件定義書・設計文書にない推測によるテスト

## 開発言語・フレームワーク

- **プログラミング言語**: Dart 3.10+
  - **言語選択の理由**: Flutter標準言語、Null Safety対応、型安全性が高い 🔵
  - **テストに適した機能**: 非同期テストサポート（async/await）、モッキング容易
- **テストフレームワーク**: flutter_test + flutter_riverpod + mocktail
  - **フレームワーク選択の理由**: Flutter標準テストフレームワーク、Riverpodプロバイダーのテスト容易性 🔵
  - **テスト実行環境**: flutter test コマンド、CI/CDでの自動実行

---

## テストケース一覧

### 1. E2Eテストケース（8シナリオ）

---

#### TC-060-E2E-001: 文字入力から読み上げ・履歴保存までのフロー

##### 1.1 正常系テストケース

**テスト名**: 文字盤で入力したテキストを読み上げて履歴に保存する
- **何をテストするか**: 文字盤入力→入力バッファ反映→TTS読み上げ→履歴保存の一連のフロー
- **期待される動作**: ユーザーが文字を入力し、読み上げボタンをタップすると音声で読み上げられ、履歴に保存される
- 🔵 **青信号**: REQ-001, REQ-002, REQ-401, REQ-601に基づく

**入力値**:
- 文字列: 「こんにちは」（5文字）
- **入力データの意味**: 日常的な挨拶、典型的なユースケース

**期待される結果**:
- 各文字タップから入力欄反映まで100ms以内（NFR-003）
- 読み上げボタンタップから1秒以内にTTS開始（NFR-001）
- 読み上げ完了後、履歴に「こんにちは」が保存される
- **期待結果の理由**: 発話困難な方が素早くコミュニケーションできることを保証

**テストの目的**: エンドツーエンドでの基本コミュニケーションフロー検証
- **確認ポイント**: パフォーマンス要件（100ms, 1秒）の達成

```dart
// 【テスト目的】: 文字入力から読み上げ・履歴保存までの一連のフローを確認 🔵
// 【テスト内容】: 文字盤で「こんにちは」を入力し、読み上げボタンで読み上げ、履歴に保存
// 【期待される動作】: 各文字100ms以内に反映、1秒以内に読み上げ開始、履歴保存
testWidgets('TC-060-E2E-001: 文字入力から読み上げ・履歴保存までのフロー', (tester) async {
  // Given（準備フェーズ）
  // 【テストデータ準備】: アプリを起動し、文字盤画面を表示
  // 【初期条件設定】: 入力バッファは空、履歴は空

  // When（実行フェーズ）
  // 【実際の処理実行】: 文字盤で「こんにちは」を入力
  // 【処理内容】: 「こ」「ん」「に」「ち」「は」を順番にタップ
  // 【実行タイミング】: 各タップ間に十分な間隔を置く

  // Then（検証フェーズ）
  // 【結果検証】: 入力欄に「こんにちは」が表示される
  // 【期待値確認】: 各文字100ms以内に反映（NFR-003）
  // 【品質保証】: 応答性能の保証
});
```

---

##### 1.2 パフォーマンステストケース

**テスト名**: 文字盤タップ応答が100ms以内であることを確認
- **何をテストするか**: 文字盤タップから入力欄への文字反映までの時間
- **期待される動作**: 100ms以内に文字が反映される
- 🔵 **青信号**: NFR-003に基づく

**入力値**:
- 文字: 「あ」
- 計測回数: 10回
- **入力データの意味**: 代表的な日本語文字、統計的有意性のための複数回計測

**期待される結果**:
- 平均応答時間: 100ms以内
- 最大応答時間: 150ms以内（余裕を持った基準）
- **期待結果の理由**: NFR-003「文字盤タップから入力欄への文字反映まで100ms以内」

**テストの目的**: パフォーマンス要件NFR-003の検証
- **確認ポイント**: ユーザー体験を損なわない応答速度

```dart
// 【テスト目的】: 文字盤タップ応答速度がNFR-003を満たすことを確認 🔵
// 【テスト内容】: 文字盤タップから入力欄反映までの時間を計測
// 【期待される動作】: 100ms以内
test('TC-060-E2E-001-PERF: 文字盤タップ応答が100ms以内', () async {
  // Stopwatchで計測
  final stopwatch = Stopwatch();
  // 10回計測して平均を取る
  // expect(averageMs, lessThan(100));
});
```

---

#### TC-060-E2E-002: 定型文即座読み上げフロー

##### 2.1 正常系テストケース

**テスト名**: 定型文をタップすると即座に読み上げられる
- **何をテストするか**: 定型文タップ→TTS即座読み上げ→履歴保存のフロー
- **期待される動作**: 定型文タップから1秒以内にTTS読み上げが開始される
- 🔵 **青信号**: REQ-103, NFR-001に基づく

**入力値**:
- 定型文: 「トイレに行きたいです」
- **入力データの意味**: よく使われる定型文、介護シーンでの典型的なコミュニケーション

**期待される結果**:
- 定型文一覧が1秒以内に表示される（NFR-004）
- 定型文タップから1秒以内にTTS開始（NFR-001）
- 履歴に定型文が保存される
- **期待結果の理由**: REQ-103「定型文を直接タップで即座に読み上げを実行」

**テストの目的**: 定型文機能のエンドツーエンド検証
- **確認ポイント**: 即座読み上げの実現

```dart
// 【テスト目的】: 定型文即座読み上げフローを確認 🔵
// 【テスト内容】: 定型文「トイレに行きたいです」をタップして即座に読み上げ
// 【期待される動作】: 1秒以内にTTS開始、履歴に保存
testWidgets('TC-060-E2E-002: 定型文即座読み上げフロー', (tester) async {
  // Given: 定型文一覧を表示
  // When: 定型文をタップ
  // Then: 1秒以内にTTS開始、履歴に保存
});
```

---

##### 2.2 お気に入り優先表示テストケース

**テスト名**: お気に入り定型文が一覧上部に優先表示される
- **何をテストするか**: お気に入りフラグが立っている定型文の表示順
- **期待される動作**: お気に入り定型文が通常の定型文より上に表示される
- 🔵 **青信号**: REQ-105に基づく

**入力値**:
- お気に入り定型文: 3件
- 通常定型文: 10件
- **入力データの意味**: お気に入りが混在する典型的なデータセット

**期待される結果**:
- リストの先頭3件がお気に入り定型文
- **期待結果の理由**: REQ-105「お気に入り定型文を一覧上部に優先表示」

**テストの目的**: お気に入り機能のUI表示検証
- **確認ポイント**: 表示順の正確性

```dart
// 【テスト目的】: お気に入り定型文の優先表示を確認 🔵
// 【テスト内容】: お気に入りフラグのある定型文が上部に表示される
// 【期待される動作】: お気に入り3件が先頭に表示
testWidgets('TC-060-E2E-002-FAV: お気に入り定型文が上部に表示', (tester) async {
  // Given: お気に入り3件、通常10件の定型文
  // When: 定型文一覧を表示
  // Then: 先頭3件がお気に入り
});
```

---

#### TC-060-E2E-003: 緊急ボタン2段階確認から緊急音再生フロー

##### 3.1 正常系テストケース

**テスト名**: 緊急ボタン→確認ダイアログ→はい→緊急音・赤画面
- **何をテストするか**: 緊急ボタンの2段階確認フロー全体
- **期待される動作**: 1回目タップで確認ダイアログ、「はい」で緊急音再生・画面赤表示
- 🔵 **青信号**: REQ-302, REQ-303, REQ-304, REQ-2004, REQ-2005に基づく

**入力値**:
- 緊急ボタンタップ: 1回
- 確認ダイアログ「はい」タップ: 1回
- **入力データの意味**: 正常な緊急呼び出しフロー

**期待される結果**:
- 確認ダイアログ「緊急呼び出しを実行しますか?」が表示される
- 「はい」タップで緊急音が再生される
- 画面全体が赤く表示される
- **期待結果の理由**: REQ-302「緊急ボタンを2段階確認で動作」

**テストの目的**: 緊急機能のエンドツーエンド検証
- **確認ポイント**: 誤操作防止の2段階確認、緊急音・赤画面表示

```dart
// 【テスト目的】: 緊急ボタン2段階確認フローを確認 🔵
// 【テスト内容】: 緊急ボタン→確認ダイアログ→はい→緊急音・赤画面
// 【期待される動作】: 2段階確認後に緊急音と赤画面
testWidgets('TC-060-E2E-003: 緊急ボタン2段階確認フロー', (tester) async {
  // Given: アプリを起動、緊急ボタンが表示
  // When: 緊急ボタンをタップ
  // Then: 確認ダイアログが表示
  // When: 「はい」をタップ
  // Then: 緊急音再生、画面赤表示
});
```

---

##### 3.2 キャンセルテストケース

**テスト名**: 確認ダイアログで「いいえ」をタップするとキャンセルされる
- **何をテストするか**: 確認ダイアログでのキャンセル動作
- **期待される動作**: 「いいえ」タップでダイアログが閉じ、通常画面に戻る
- 🔵 **青信号**: REQ-302, REQ-5002に基づく

**入力値**:
- 緊急ボタンタップ: 1回
- 確認ダイアログ「いいえ」タップ: 1回
- **入力データの意味**: 誤操作時のキャンセルフロー

**期待される結果**:
- 確認ダイアログが閉じる
- 緊急音は再生されない
- 画面は通常状態のまま
- **期待結果の理由**: REQ-5002「重要な操作に誤操作防止の仕組み」

**テストの目的**: 誤操作防止機能の検証
- **確認ポイント**: キャンセル時に緊急処理が実行されないこと

```dart
// 【テスト目的】: 緊急ボタンのキャンセルフローを確認 🔵
// 【テスト内容】: 確認ダイアログで「いいえ」をタップするとキャンセル
// 【期待される動作】: ダイアログ閉じる、緊急音なし、通常画面
testWidgets('TC-060-E2E-003-CANCEL: 緊急ボタンキャンセルフロー', (tester) async {
  // Given: 緊急ボタンをタップして確認ダイアログ表示
  // When: 「いいえ」をタップ
  // Then: ダイアログが閉じ、通常画面に戻る
});
```

---

##### 3.3 リセットテストケース

**テスト名**: 緊急画面からリセットボタンで通常画面に戻る
- **何をテストするか**: 緊急画面からの復帰フロー
- **期待される動作**: リセットボタンタップで通常画面に戻る
- 🔵 **青信号**: REQ-304に基づく

**入力値**:
- リセットボタンタップ: 1回
- **入力データの意味**: 緊急状態からの復帰フロー

**期待される結果**:
- 緊急音が停止する
- 画面が通常色に戻る
- 通常の操作が可能になる
- **期待結果の理由**: REQ-304「リセットボタンで通常画面に戻る」

**テストの目的**: 緊急状態からの復帰機能の検証
- **確認ポイント**: 完全な状態復帰

```dart
// 【テスト目的】: 緊急画面からの復帰フローを確認 🔵
// 【テスト内容】: リセットボタンで通常画面に戻る
// 【期待される動作】: 緊急音停止、画面色復帰、通常操作可能
testWidgets('TC-060-E2E-003-RESET: 緊急画面リセットフロー', (tester) async {
  // Given: 緊急画面が表示されている
  // When: リセットボタンをタップ
  // Then: 通常画面に戻る
});
```

---

#### TC-060-E2E-004: 大ボタン即座読み上げフロー

##### 4.1 正常系テストケース（はい/いいえ/わからない）

**テスト名**: 大ボタン「はい」をタップすると即座に読み上げられる
- **何をテストするか**: 大ボタンの即座読み上げ機能
- **期待される動作**: タップから1秒以内にTTS読み上げ開始
- 🔵 **青信号**: REQ-201, REQ-204, NFR-001に基づく

**入力値**:
- ボタン: 「はい」「いいえ」「わからない」
- **入力データの意味**: 3つの大ボタンすべてをテスト

**期待される結果**:
- 各ボタンタップから1秒以内にTTS開始
- 履歴に保存される
- **期待結果の理由**: REQ-204「大ボタンのタップ時に即座に読み上げ」

**テストの目的**: 大ボタン機能のエンドツーエンド検証
- **確認ポイント**: 即座読み上げの実現

```dart
// 【テスト目的】: 大ボタン即座読み上げフローを確認 🔵
// 【テスト内容】: 「はい」「いいえ」「わからない」ボタンの即座読み上げ
// 【期待される動作】: 1秒以内にTTS開始
testWidgets('TC-060-E2E-004: 大ボタン即座読み上げフロー', (tester) async {
  // Given: アプリを起動、大ボタンが表示
  // When: 「はい」ボタンをタップ
  // Then: 1秒以内にTTS開始、履歴に「はい」保存
});
```

---

##### 4.2 状態ボタンテストケース

**テスト名**: 状態ボタン「痛い」をタップすると即座に読み上げられる
- **何をテストするか**: 状態ボタンの即座読み上げ機能
- **期待される動作**: タップから1秒以内にTTS読み上げ開始
- 🔵 **青信号**: REQ-202, REQ-203, REQ-204に基づく

**入力値**:
- ボタン: 「痛い」「トイレ」「暑い」「寒い」など8-12個
- **入力データの意味**: 典型的な状態表現

**期待される結果**:
- 各ボタンタップから1秒以内にTTS開始
- 履歴に保存される
- **期待結果の理由**: REQ-204「状態ボタンのタップ時に即座に読み上げ」

**テストの目的**: 状態ボタン機能のエンドツーエンド検証
- **確認ポイント**: 即座読み上げの実現

```dart
// 【テスト目的】: 状態ボタン即座読み上げフローを確認 🔵
// 【テスト内容】: 「痛い」「トイレ」等の状態ボタンの即座読み上げ
// 【期待される動作】: 1秒以内にTTS開始
testWidgets('TC-060-E2E-004-STATE: 状態ボタン即座読み上げフロー', (tester) async {
  // Given: アプリを起動、状態ボタンが表示
  // When: 「痛い」ボタンをタップ
  // Then: 1秒以内にTTS開始、履歴に「痛い」保存
});
```

---

#### TC-060-E2E-005: 削除ボタン・全消去ボタンフロー

##### 5.1 削除ボタンテストケース

**テスト名**: 削除ボタンで最後の1文字が削除される
- **何をテストするか**: 削除ボタンの動作
- **期待される動作**: 最後の1文字が削除される
- 🔵 **青信号**: REQ-003に基づく

**入力値**:
- 初期入力: 「こんにちは」
- 削除ボタンタップ: 1回
- **入力データの意味**: 末尾文字の削除

**期待される結果**:
- 入力欄が「こんにち」になる
- **期待結果の理由**: REQ-003「削除ボタンで最後の1文字を削除」

**テストの目的**: 削除機能の検証
- **確認ポイント**: 正確な1文字削除

```dart
// 【テスト目的】: 削除ボタンの動作を確認 🔵
// 【テスト内容】: 「こんにちは」から削除ボタンで「こんにち」になる
// 【期待される動作】: 最後の1文字「は」が削除される
testWidgets('TC-060-E2E-005-DEL: 削除ボタンで1文字削除', (tester) async {
  // Given: 入力欄に「こんにちは」
  // When: 削除ボタンをタップ
  // Then: 入力欄が「こんにち」になる
});
```

---

##### 5.2 全消去ボタンテストケース

**テスト名**: 全消去ボタンで確認ダイアログ後に全文削除される
- **何をテストするか**: 全消去ボタンの2段階確認動作
- **期待される動作**: 確認ダイアログで「はい」を選択すると全文削除
- 🔵 **青信号**: REQ-004, REQ-2001, REQ-5002に基づく

**入力値**:
- 初期入力: 「こんにちは」
- 全消去ボタンタップ: 1回
- 確認ダイアログ「はい」: 1回
- **入力データの意味**: 全文削除のフロー

**期待される結果**:
- 確認ダイアログが表示される
- 「はい」タップで入力欄が空になる
- **期待結果の理由**: REQ-004「全消去ボタンですべての文字を削除」

**テストの目的**: 全消去機能と誤操作防止の検証
- **確認ポイント**: 確認ダイアログの表示、全文削除の実行

```dart
// 【テスト目的】: 全消去ボタンの2段階確認を確認 🔵
// 【テスト内容】: 全消去ボタン→確認ダイアログ→はい→全文削除
// 【期待される動作】: 確認後に全文削除
testWidgets('TC-060-E2E-005-CLEAR: 全消去ボタンで全文削除', (tester) async {
  // Given: 入力欄に「こんにちは」
  // When: 全消去ボタンをタップ
  // Then: 確認ダイアログ表示
  // When: 「はい」をタップ
  // Then: 入力欄が空になる
});
```

---

#### TC-060-E2E-006: 対面表示モードと画面回転フロー

##### 6.1 対面表示モードテストケース

**テスト名**: 対面表示モードでテキストが拡大表示される
- **何をテストするか**: 対面表示モードの拡大表示機能
- **期待される動作**: テキストが画面中央に大きく表示される
- 🔵 **青信号**: REQ-501, REQ-503に基づく

**入力値**:
- 入力テキスト: 「こんにちは」
- 対面表示モードボタンタップ: 1回
- **入力データの意味**: 対面の相手に見せる典型的なシナリオ

**期待される結果**:
- テキストが画面中央に大きく表示される
- 背景がシンプルで読みやすい
- **期待結果の理由**: REQ-501「読み上げテキストを画面中央に大きく表示」

**テストの目的**: 対面表示モードのUI検証
- **確認ポイント**: 拡大表示、シンプルな背景

```dart
// 【テスト目的】: 対面表示モードの拡大表示を確認 🔵
// 【テスト内容】: 対面表示モードでテキストが大きく表示される
// 【期待される動作】: 画面中央に大きなテキスト
testWidgets('TC-060-E2E-006: 対面表示モード拡大表示', (tester) async {
  // Given: 入力欄に「こんにちは」
  // When: 対面表示モードボタンをタップ
  // Then: テキストが画面中央に大きく表示される
});
```

---

##### 6.2 180度画面回転テストケース

**テスト名**: 画面回転ボタンで180度回転する
- **何をテストするか**: 画面の180度回転機能
- **期待される動作**: 画面が180度回転して対面の相手から読みやすくなる
- 🔵 **青信号**: REQ-502に基づく

**入力値**:
- 画面回転ボタンタップ: 1回
- **入力データの意味**: 対面の相手に見せるための回転

**期待される結果**:
- 画面が180度回転する
- 回転後も文字が読みやすい
- 再度タップで元に戻る
- **期待結果の理由**: REQ-502「画面を180度回転させて対面の相手から読みやすい表示」

**テストの目的**: 画面回転機能の検証
- **確認ポイント**: 正確な180度回転、可逆性

```dart
// 【テスト目的】: 180度画面回転を確認 🔵
// 【テスト内容】: 画面回転ボタンで180度回転
// 【期待される動作】: 画面が180度回転、再タップで元に戻る
testWidgets('TC-060-E2E-006-ROTATE: 180度画面回転', (tester) async {
  // Given: 対面表示モード
  // When: 画面回転ボタンをタップ
  // Then: 画面が180度回転
  // When: 再度タップ
  // Then: 元に戻る
});
```

---

#### TC-060-E2E-007: オフライン動作確認フロー

##### 7.1 オフライン時の基本機能動作テストケース

**テスト名**: オフライン時も文字盤入力・定型文・TTSが動作する
- **何をテストするか**: ネットワーク切断時の基本機能動作
- **期待される動作**: オフラインでも文字盤入力、定型文選択、TTS読み上げが正常動作
- 🔵 **青信号**: REQ-1001に基づく

**入力値**:
- ネットワーク状態: オフライン（モック）
- 文字入力: 「こんにちは」
- **入力データの意味**: オフライン環境でのコミュニケーション

**期待される結果**:
- 文字盤入力が動作する
- 定型文選択が動作する
- TTS読み上げが動作する
- **期待結果の理由**: REQ-1001「文字盤入力・定型文・履歴・TTSをオフライン環境で利用可能」

**テストの目的**: オフライン動作の検証
- **確認ポイント**: 基本機能のオフライン動作保証

```dart
// 【テスト目的】: オフライン時の基本機能動作を確認 🔵
// 【テスト内容】: ネットワーク切断状態で文字盤入力・定型文・TTSが動作
// 【期待される動作】: すべての基本機能が正常動作
testWidgets('TC-060-E2E-007: オフライン基本機能動作', (tester) async {
  // Given: ネットワーク切断（モック）
  // When: 文字盤で入力、定型文タップ、読み上げボタンタップ
  // Then: すべて正常動作
});
```

---

##### 7.2 オフライン時のAI変換ボタン無効化テストケース

**テスト名**: オフライン時にAI変換ボタンが無効化される
- **何をテストするか**: オフライン時のAI変換ボタン状態
- **期待される動作**: AI変換ボタンが無効化またはグレーアウト表示
- 🔵 **青信号**: REQ-1002に基づく

**入力値**:
- ネットワーク状態: オフライン（モック）
- **入力データの意味**: オフライン環境でのAI機能制限

**期待される結果**:
- AI変換ボタンが無効化またはグレーアウト表示
- オフライン状態が明示される
- **期待結果の理由**: REQ-1002「オフライン時にAI変換が利用不可であることを明示」

**テストの目的**: オフライン時の適切なUI表示
- **確認ポイント**: AI変換ボタンの無効化、オフライン表示

```dart
// 【テスト目的】: オフライン時のAI変換ボタン無効化を確認 🔵
// 【テスト内容】: オフライン時にAI変換ボタンが無効化
// 【期待される動作】: グレーアウト表示、オフライン明示
testWidgets('TC-060-E2E-007-AI: オフライン時AI変換ボタン無効化', (tester) async {
  // Given: ネットワーク切断（モック）
  // When: AI変換ボタンを確認
  // Then: 無効化/グレーアウト表示
});
```

---

#### TC-060-E2E-008: データ永続化テストフロー

##### 8.1 データ永続化テストケース

**テスト名**: アプリ再起動後も定型文・履歴・設定が保持される
- **何をテストするか**: データの永続化
- **期待される動作**: アプリ再起動後もすべてのデータが保持される
- 🔵 **青信号**: REQ-5003, NFR-302に基づく

**入力値**:
- 追加定型文: 「テスト定型文」
- 履歴テキスト: 「テスト」
- 設定変更: フォントサイズ「大」
- **入力データの意味**: 各種データの永続化確認

**期待される結果**:
- アプリ再起動後も定型文が保持される
- アプリ再起動後も履歴が保持される
- アプリ再起動後も設定が保持される
- **期待結果の理由**: REQ-5003「アプリが強制終了しても定型文・設定・履歴を失わない」

**テストの目的**: データ永続化の検証
- **確認ポイント**: 完全なデータ復元

```dart
// 【テスト目的】: データ永続化を確認 🔵
// 【テスト内容】: アプリ再起動後も定型文・履歴・設定が保持
// 【期待される動作】: すべてのデータが復元される
testWidgets('TC-060-E2E-008: データ永続化', (tester) async {
  // Given: 定型文追加、履歴保存、設定変更
  // When: アプリを強制終了・再起動（シミュレーション）
  // Then: すべてのデータが復元される
});
```

---

##### 8.2 入力状態復元テストケース

**テスト名**: アプリクラッシュからの復旧時に入力状態が復元される
- **何をテストするか**: 入力中テキストの復元
- **期待される動作**: アプリ再起動後も入力中のテキストが復元される
- 🔵 **青信号**: NFR-302に基づく

**入力値**:
- 入力中テキスト: 「こんにちは」
- **入力データの意味**: 入力途中でのクラッシュシナリオ

**期待される結果**:
- アプリ再起動後も入力欄に「こんにちは」が表示される
- **期待結果の理由**: NFR-302「アプリクラッシュからの復旧時に、最後の入力状態を復元」

**テストの目的**: 入力状態復元の検証
- **確認ポイント**: 入力途中のテキスト復元

```dart
// 【テスト目的】: 入力状態復元を確認 🔵
// 【テスト内容】: アプリ再起動後も入力中テキストが復元
// 【期待される動作】: 入力欄に「こんにちは」が表示される
testWidgets('TC-060-E2E-008-INPUT: 入力状態復元', (tester) async {
  // Given: 入力欄に「こんにちは」
  // When: アプリを強制終了・再起動（シミュレーション）
  // Then: 入力欄に「こんにちは」が復元される
});
```

---

### 2. パフォーマンステストケース（3項目）

---

#### TC-060-PERF-001: 文字盤タップ応答速度テスト

**テスト名**: 文字盤タップから入力欄反映まで100ms以内
- **何をテストするか**: 文字盤タップの応答速度
- **期待される動作**: 100ms以内に文字が反映される
- 🔵 **青信号**: NFR-003に基づく

**入力値**:
- 計測回数: 10回
- **入力データの意味**: 統計的有意性のための複数回計測

**期待される結果**:
- 平均応答時間: 100ms以内
- 最大応答時間: 150ms以内（余裕を持った基準）
- **期待結果の理由**: NFR-003「文字盤タップから入力欄への文字反映まで100ms以内」

**テストの目的**: パフォーマンス要件NFR-003の検証
- **確認ポイント**: 応答速度の一貫性

```dart
// 【テスト目的】: 文字盤タップ応答速度を検証 🔵
// 【テスト内容】: 10回計測して平均100ms以内
// 【期待される動作】: 平均100ms以内、最大150ms以内
test('TC-060-PERF-001: 文字盤タップ応答100ms以内', () async {
  final stopwatch = Stopwatch();
  final times = <int>[];

  for (var i = 0; i < 10; i++) {
    stopwatch.reset();
    stopwatch.start();
    // 文字盤タップシミュレーション
    stopwatch.stop();
    times.add(stopwatch.elapsedMilliseconds);
  }

  final average = times.reduce((a, b) => a + b) / times.length;
  expect(average, lessThan(100));
  expect(times.reduce((a, b) => a > b ? a : b), lessThan(150));
});
```

---

#### TC-060-PERF-002: TTS読み上げ開始速度テスト

**テスト名**: 読み上げボタンタップから1秒以内にTTS開始
- **何をテストするか**: TTS読み上げ開始までの時間
- **期待される動作**: 1秒以内にTTS読み上げが開始される
- 🔵 **青信号**: NFR-001に基づく

**入力値**:
- 計測回数: 5回
- **入力データの意味**: 統計的有意性のための複数回計測

**期待される結果**:
- 平均応答時間: 1秒以内
- 最大応答時間: 1.5秒以内（余裕を持った基準）
- **期待結果の理由**: NFR-001「TTS読み上げ開始までの時間を1秒以内」

**テストの目的**: パフォーマンス要件NFR-001の検証
- **確認ポイント**: 読み上げ開始速度の一貫性

```dart
// 【テスト目的】: TTS読み上げ開始速度を検証 🔵
// 【テスト内容】: 5回計測して平均1秒以内
// 【期待される動作】: 平均1秒以内、最大1.5秒以内
test('TC-060-PERF-002: TTS読み上げ開始1秒以内', () async {
  final stopwatch = Stopwatch();
  final times = <int>[];

  for (var i = 0; i < 5; i++) {
    stopwatch.reset();
    stopwatch.start();
    // TTS読み上げ開始シミュレーション
    stopwatch.stop();
    times.add(stopwatch.elapsedMilliseconds);
  }

  final average = times.reduce((a, b) => a + b) / times.length;
  expect(average, lessThan(1000));
  expect(times.reduce((a, b) => a > b ? a : b), lessThan(1500));
});
```

---

#### TC-060-PERF-003: 定型文一覧表示速度テスト

**テスト名**: 定型文一覧（100件）が1秒以内に表示される
- **何をテストするか**: 定型文一覧の表示速度
- **期待される動作**: 100件の定型文が1秒以内に表示される
- 🔵 **青信号**: NFR-004に基づく

**入力値**:
- 定型文件数: 100件
- **入力データの意味**: 要件で指定された件数

**期待される結果**:
- 表示時間: 1秒以内
- **期待結果の理由**: NFR-004「定型文一覧の表示（100件程度）を1秒以内に完了」

**テストの目的**: パフォーマンス要件NFR-004の検証
- **確認ポイント**: 大量データでの表示速度

```dart
// 【テスト目的】: 定型文一覧表示速度を検証 🔵
// 【テスト内容】: 100件の定型文を1秒以内に表示
// 【期待される動作】: 表示時間1秒以内
test('TC-060-PERF-003: 定型文一覧表示1秒以内', () async {
  final stopwatch = Stopwatch();

  // 100件の定型文を準備
  stopwatch.start();
  // 定型文一覧表示シミュレーション
  stopwatch.stop();

  expect(stopwatch.elapsedMilliseconds, lessThan(1000));
});
```

---

### 3. アクセシビリティテストケース（3項目）

---

#### TC-060-A11Y-001: タップターゲットサイズテスト

**テスト名**: すべてのタップターゲットが44px × 44px以上
- **何をテストするか**: タップターゲットのサイズ
- **期待される動作**: すべてのボタン・キーが44px × 44px以上
- 🔵 **青信号**: REQ-5001に基づく

**入力値**:
- 対象: 文字盤ボタン、削除ボタン、全消去ボタン、大ボタン、緊急ボタン
- **入力データの意味**: インタラクティブな要素すべて

**期待される結果**:
- すべてのボタンが44px × 44px以上
- 大ボタン・緊急ボタンは60px × 60px以上（推奨サイズ）
- **期待結果の理由**: REQ-5001「タップターゲットのサイズを44px × 44px以上」

**テストの目的**: アクセシビリティ要件REQ-5001の検証
- **確認ポイント**: 運動機能に制限のある方でも操作しやすいサイズ

```dart
// 【テスト目的】: タップターゲットサイズを検証 🔵
// 【テスト内容】: すべてのボタンが44px以上
// 【期待される動作】: 最小44px、大ボタン・緊急ボタンは60px以上
testWidgets('TC-060-A11Y-001: タップターゲット44px以上', (tester) async {
  // Given: アプリを起動
  // When: 各ボタンのサイズを取得
  // Then: すべて44px以上、大ボタン・緊急ボタンは60px以上
});
```

---

#### TC-060-A11Y-002: 高コントラストモードテスト

**テスト名**: 高コントラストモードでコントラスト比4.5:1以上
- **何をテストするか**: 高コントラストモードのコントラスト比
- **期待される動作**: テキストと背景のコントラスト比が4.5:1以上
- 🔵 **青信号**: REQ-5006に基づく

**入力値**:
- テーマ: 高コントラストモード
- **入力データの意味**: 視覚障害のある方向けの設定

**期待される結果**:
- すべてのテキスト要素のコントラスト比が4.5:1以上
- **期待結果の理由**: REQ-5006「高コントラストモードでWCAG 2.1 AAレベルのコントラスト比（4.5:1以上）」

**テストの目的**: アクセシビリティ要件REQ-5006の検証
- **確認ポイント**: WCAG 2.1 AA準拠

```dart
// 【テスト目的】: 高コントラストモードのコントラスト比を検証 🔵
// 【テスト内容】: テキストと背景のコントラスト比4.5:1以上
// 【期待される動作】: WCAG 2.1 AA準拠
testWidgets('TC-060-A11Y-002: 高コントラスト4.5:1以上', (tester) async {
  // Given: 高コントラストテーマに切り替え
  // When: テキストと背景の色を取得
  // Then: コントラスト比4.5:1以上
});
```

---

#### TC-060-A11Y-003: フォントサイズ変更テスト

**テスト名**: フォントサイズ変更がすべてのテキスト要素に即座に反映される
- **何をテストするか**: フォントサイズ設定の反映
- **期待される動作**: フォントサイズ変更が即座にすべてのテキストに反映される
- 🔵 **青信号**: REQ-801, REQ-2007に基づく

**入力値**:
- フォントサイズ: 「小」→「大」
- **入力データの意味**: 最小から最大への変更

**期待される結果**:
- 文字盤、定型文一覧、ボタンラベルのフォントサイズが変更される
- 変更が即座に反映される
- **期待結果の理由**: REQ-2007「フォントサイズ変更時に即座にすべてのテキスト要素のサイズを変更」

**テストの目的**: フォントサイズ設定の検証
- **確認ポイント**: 即座の反映、すべての要素への適用

```dart
// 【テスト目的】: フォントサイズ変更の反映を検証 🔵
// 【テスト内容】: フォントサイズ変更が即座にすべてのテキストに反映
// 【期待される動作】: 文字盤、定型文、ボタンラベルすべてが変更
testWidgets('TC-060-A11Y-003: フォントサイズ即座反映', (tester) async {
  // Given: フォントサイズ「小」
  // When: フォントサイズを「大」に変更
  // Then: すべてのテキスト要素が即座に変更
});
```

---

### 4. 境界値テストケース（4項目）

---

#### TC-060-BV-001: 入力文字数1000文字制限テスト

**テスト名**: 入力欄の文字数が1000文字で制限される
- **何をテストするか**: 入力文字数の上限
- **期待される動作**: 1000文字を超えると入力が制限される
- 🟡 **黄信号**: EDGE-101に基づく

**入力値**:
- 入力文字数: 1001文字
- **入力データの意味**: 上限を超えた入力

**期待される結果**:
- 入力が1000文字で制限される
- 警告メッセージが表示される
- **期待結果の理由**: EDGE-101「入力欄の文字数が1000文字を超えた場合、システムは警告を表示し、1000文字で入力を制限」

**テストの目的**: 境界値条件の検証
- **確認ポイント**: 上限値での正確な動作

```dart
// 【テスト目的】: 1000文字制限を検証 🟡
// 【テスト内容】: 1001文字入力で1000文字に制限
// 【期待される動作】: 1000文字で制限、警告表示
testWidgets('TC-060-BV-001: 1000文字制限', (tester) async {
  // Given: 空の入力欄
  // When: 1001文字を入力
  // Then: 1000文字で制限、警告メッセージ表示
});
```

---

#### TC-060-BV-002: 履歴50件上限テスト

**テスト名**: 履歴が50件に達すると最古が自動削除される
- **何をテストするか**: 履歴の上限管理
- **期待される動作**: 51件目追加時に最古の履歴が削除される
- 🔵 **青信号**: REQ-3002に基づく

**入力値**:
- 履歴件数: 50件（上限）
- 新規履歴: 1件
- **入力データの意味**: 上限到達後の追加

**期待される結果**:
- 最古の履歴が削除される
- 履歴件数が50件に保たれる
- **期待結果の理由**: REQ-3002「履歴が50件に達した状態にある場合、システムは新しい履歴を追加する際に最も古い履歴を自動削除」

**テストの目的**: 履歴上限管理の検証
- **確認ポイント**: 自動削除の正確性

```dart
// 【テスト目的】: 履歴50件上限を検証 🔵
// 【テスト内容】: 51件目追加時に最古が削除
// 【期待される動作】: 履歴件数50件を維持
test('TC-060-BV-002: 履歴50件上限', () async {
  // Given: 履歴50件
  // When: 51件目を追加
  // Then: 最古が削除され、50件を維持
});
```

---

#### TC-060-BV-003: OS音量0警告表示テスト

**テスト名**: OS音量が0の場合に警告が表示される
- **何をテストするか**: 音量0時の警告表示
- **期待される動作**: 読み上げ時に「音量が0です」という警告が表示される
- 🟡 **黄信号**: EDGE-202に基づく

**入力値**:
- OS音量: 0（モック）
- **入力データの意味**: ミュート状態での読み上げ

**期待される結果**:
- 「音量が0です」という警告が表示される
- 音量調整への誘導がある
- **期待結果の理由**: EDGE-202「OS音量が0（ミュート）の状態で読み上げを実行した場合、システムは視覚的警告を表示」

**テストの目的**: エッジケースの検証
- **確認ポイント**: ユーザーへの適切な通知

```dart
// 【テスト目的】: OS音量0警告を検証 🟡
// 【テスト内容】: 音量0で読み上げ時に警告表示
// 【期待される動作】: 「音量が0です」警告、音量調整誘導
testWidgets('TC-060-BV-003: OS音量0警告', (tester) async {
  // Given: OS音量を0に設定（モック）
  // When: 読み上げボタンをタップ
  // Then: 警告表示、音量調整への誘導
});
```

---

#### TC-060-BV-004: 読み上げ中の速度変更テスト

**テスト名**: 読み上げ中に速度変更しても現在の読み上げは継続
- **何をテストするか**: 読み上げ中の速度変更の安全性
- **期待される動作**: 現在の読み上げは元の速度で継続、次回から新しい速度
- 🟡 **黄信号**: EDGE-1に基づく

**入力値**:
- 初期速度: 「普通」
- 変更後速度: 「速い」
- **入力データの意味**: 読み上げ中の設定変更

**期待される結果**:
- 現在の読み上げは元の速度で継続
- 次回の読み上げから新しい速度が適用
- **期待結果の理由**: EDGE-1「読み上げ中に速度を変更した場合、現在の読み上げは元の速度で継続」

**テストの目的**: 並行処理の安全性検証
- **確認ポイント**: 状態遷移の正確性

```dart
// 【テスト目的】: 読み上げ中の速度変更を検証 🟡
// 【テスト内容】: 読み上げ中に速度変更しても現在は継続
// 【期待される動作】: 次回から新しい速度適用
test('TC-060-BV-004: 読み上げ中速度変更', () async {
  // Given: 「普通」速度で読み上げ中
  // When: 速度を「速い」に変更
  // Then: 現在の読み上げは継続、次回から新速度
});
```

---

## テストケースサマリー

| カテゴリ | テストケース数 | 信頼性レベル |
|---------|--------------|-------------|
| E2Eテスト | 16件 | 🔵 15件、🟡 1件 |
| パフォーマンステスト | 3件 | 🔵 3件 |
| アクセシビリティテスト | 3件 | 🔵 3件 |
| 境界値テスト | 4件 | 🔵 2件、🟡 2件 |
| **合計** | **26件** | **🔵 23件、🟡 3件** |

## テストファイル構成

```
test/
├── integration/
│   ├── e2e_text_input_flow_test.dart        # TC-060-E2E-001
│   ├── e2e_preset_phrase_flow_test.dart     # TC-060-E2E-002
│   ├── e2e_emergency_button_flow_test.dart  # TC-060-E2E-003
│   ├── e2e_large_button_flow_test.dart      # TC-060-E2E-004
│   ├── e2e_delete_button_flow_test.dart     # TC-060-E2E-005
│   ├── e2e_face_to_face_flow_test.dart      # TC-060-E2E-006
│   ├── e2e_offline_flow_test.dart           # TC-060-E2E-007
│   └── e2e_data_persistence_test.dart       # TC-060-E2E-008
├── performance/
│   ├── character_board_response_test.dart   # TC-060-PERF-001
│   ├── tts_start_speed_test.dart            # TC-060-PERF-002
│   └── preset_phrase_load_speed_test.dart   # TC-060-PERF-003
├── accessibility/
│   ├── tap_target_size_test.dart            # TC-060-A11Y-001
│   ├── high_contrast_test.dart              # TC-060-A11Y-002
│   └── font_size_test.dart                  # TC-060-A11Y-003
└── boundary/
    ├── input_limit_test.dart                # TC-060-BV-001
    ├── history_limit_test.dart              # TC-060-BV-002
    ├── volume_warning_test.dart             # TC-060-BV-003
    └── speed_change_during_speech_test.dart # TC-060-BV-004
```

## 品質判定

✅ **高品質**:
- テストケース分類: 正常系・異常系・境界値が網羅されている ✅
- 期待値定義: 各テストケースの期待値が明確 ✅
- 技術選択: Dart + flutter_test + mocktail で確定 ✅
- 実装可能性: 現在の技術スタックで実現可能 ✅

## 次のステップ

次のお勧めステップ: `/tsumiki:tdd-red` でRedフェーズ（失敗テスト作成）を開始します。

---

## 更新履歴

- **2025-11-27**: テストケース定義書作成（TASK-0060 Phase 3 統合テスト）
