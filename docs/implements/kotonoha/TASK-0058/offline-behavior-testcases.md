# TASK-0058: オフライン動作確認 - テストケース仕様書

## ドキュメント情報

- **作成日**: 2025-11-27
- **作成者**: Claude Code (Tsumiki TDD Testcases Phase)
- **関連タスク**: TASK-0058（オフライン動作確認）
- **フェーズ**: Phase 3 - Week 12 - Day 22
- **関連要件**: REQ-1001, REQ-1002, REQ-1003, NFR-303

---

## テストケース概要

このドキュメントは、オフライン環境における基本機能（文字盤入力、定型文選択、TTS読み上げ、大ボタン、緊急ボタン）の動作確認と、AI変換機能の適切な無効化を検証するためのテストケースをまとめたものです。

### テストカテゴリ

1. **ネットワーク状態管理テスト（NetworkProvider統合）**: 7件
2. **オフライン時の基本機能動作テスト**: 18件
   - 文字盤入力: 4件
   - 定型文選択・読み上げ: 5件
   - 大ボタン（クイックレスポンス）: 3件
   - 緊急ボタン: 3件
   - TTS読み上げ: 3件
3. **AI変換ボタン無効化テスト**: 6件
4. **オフライン表示インジケーターテスト**: 4件
5. **オンライン復帰通知テスト**: 3件
6. **ローカルストレージ動作確認テスト**: 5件
7. **エラーハンドリングテスト**: 4件
8. **境界値・異常系テスト**: 5件

**合計テストケース数**: 55件

---

## 1. ネットワーク状態管理テスト（NetworkProvider統合）

### TC-058-001: NetworkProviderがアプリ全体で利用可能

- **区分**: 正常系
- **関連要件**: REQ-1001, REQ-1002
- **事前条件**: アプリが起動されている
- **入力/操作**: ProviderScopeでNetworkProviderを初期化
- **期待結果**:
  - NetworkProviderが正しく初期化される
  - 初期状態は`NetworkState.checking`
  - 全画面でNetworkProviderにアクセス可能
- **信頼性レベル**: 🔵

### TC-058-002: NetworkStateがonline状態に遷移

- **区分**: 正常系
- **関連要件**: REQ-1001, REQ-1002
- **事前条件**: NetworkProviderが初期化されている
- **入力/操作**: `networkProvider.notifier.setOnline()`を呼び出し
- **期待結果**:
  - NetworkStateが`online`に変更される
  - `isAIConversionAvailable`が`true`を返す
- **信頼性レベル**: 🔵

### TC-058-003: NetworkStateがoffline状態に遷移

- **区分**: 正常系
- **関連要件**: REQ-1001, REQ-1002
- **事前条件**: NetworkProviderが初期化されている
- **入力/操作**: `networkProvider.notifier.setOffline()`を呼び出し
- **期待結果**:
  - NetworkStateが`offline`に変更される
  - `isAIConversionAvailable`が`false`を返す
- **信頼性レベル**: 🔵

### TC-058-004: ネットワーク状態変更時にUIがリビルドされる

- **区分**: 正常系
- **関連要件**: REQ-1002
- **事前条件**: NetworkProviderを監視するWidgetが描画されている
- **入力/操作**: NetworkStateを`online`→`offline`→`online`に切り替え
- **期待結果**:
  - 各状態変更時にWidgetがリビルドされる
  - UI要素が最新のNetworkStateを反映する
  - 状態変更が1秒以内にUIに反映される
- **信頼性レベル**: 🔵

### TC-058-005: 複数回のネットワーク切り替えが正常動作

- **区分**: 境界値
- **関連要件**: NFR-303
- **事前条件**: NetworkProviderが初期化されている
- **入力/操作**: ネットワーク状態を5回以上連続で切り替え（online↔offline）
- **期待結果**:
  - 各切り替えが正しく反映される
  - アプリがクラッシュしない
  - メモリリークが発生しない
- **信頼性レベル**: 🔵

### TC-058-006: NetworkState.checkingでAI変換が無効

- **区分**: デフォルト値
- **関連要件**: REQ-1002
- **事前条件**: NetworkProviderが初期化されたばかり（checking状態）
- **入力/操作**: `isAIConversionAvailable`を取得
- **期待結果**:
  - `isAIConversionAvailable`が`false`を返す
  - AI変換ボタンが無効化される
- **信頼性レベル**: 🟡

### TC-058-007: NetworkProviderのDispose処理が正常動作

- **区分**: 正常系
- **関連要件**: NFR-303
- **事前条件**: NetworkProviderがProviderContainerに登録されている
- **入力/操作**: ProviderContainer.dispose()を呼び出し
- **期待結果**:
  - NetworkProviderが正しくdisposeされる
  - メモリリークが発生しない
- **信頼性レベル**: 🔵

---

## 2. オフライン時の基本機能動作テスト

### 2.1 文字盤入力

### TC-058-008: オフライン時も文字盤タップで文字入力可能

- **区分**: 正常系
- **関連要件**: REQ-1001, NFR-003（文字盤タップ応答100ms以内）
- **事前条件**:
  - NetworkStateが`offline`
  - 文字盤画面が表示されている
- **入力/操作**: 文字盤の「あ」をタップ
- **期待結果**:
  - タップから100ms以内に「あ」が入力バッファに追加される
  - UIに「あ」が表示される
  - inputBufferProviderの状態が「あ」に更新される
- **信頼性レベル**: 🔵

### TC-058-009: オフライン時も五十音すべての文字が入力可能

- **区分**: 正常系
- **関連要件**: REQ-1001
- **事前条件**:
  - NetworkStateが`offline`
  - 文字盤画面が表示されている
- **入力/操作**: 五十音（あ〜わ）すべての文字をタップ
- **期待結果**:
  - すべての文字が正しく入力バッファに追加される
  - 各タップの応答時間が100ms以内
  - 濁点・半濁点・小文字も正常動作
- **信頼性レベル**: 🔵

### TC-058-010: オフライン時も削除ボタンが動作

- **区分**: 正常系
- **関連要件**: REQ-1001, REQ-004
- **事前条件**:
  - NetworkStateが`offline`
  - 入力バッファに「あいう」が入力されている
- **入力/操作**: 削除ボタンをタップ
- **期待結果**:
  - 最後の1文字「う」が削除される
  - 入力バッファが「あい」になる
  - UIが即座に更新される（100ms以内）
- **信頼性レベル**: 🔵

### TC-058-011: オフライン時も全消去ボタンが動作

- **区分**: 正常系
- **関連要件**: REQ-1001, REQ-005
- **事前条件**:
  - NetworkStateが`offline`
  - 入力バッファに「あいうえお」が入力されている
- **入力/操作**: 全消去ボタンをタップ→確認ダイアログで「はい」をタップ
- **期待結果**:
  - 入力バッファがすべてクリアされる
  - 入力バッファが空文字列になる
  - UIが即座に更新される
- **信頼性レベル**: 🔵

---

### 2.2 定型文選択・読み上げ

### TC-058-012: オフライン時も定型文一覧が表示される

- **区分**: 正常系
- **関連要件**: REQ-1001, REQ-101
- **事前条件**:
  - NetworkStateが`offline`
  - 定型文データがHiveに保存されている
- **入力/操作**: 定型文画面に遷移
- **期待結果**:
  - 1秒以内に定型文一覧が表示される
  - デフォルト定型文がすべて表示される
  - カテゴリ別表示が機能する
- **信頼性レベル**: 🔵

### TC-058-013: オフライン時も定型文タップで即座読み上げ実行

- **区分**: 正常系
- **関連要件**: REQ-1001, REQ-102, NFR-001（TTS開始1秒以内）
- **事前条件**:
  - NetworkStateが`offline`
  - 定型文「ありがとう」が表示されている
- **入力/操作**: 定型文「ありがとう」をタップ
- **期待結果**:
  - 1秒以内にTTS読み上げが開始される
  - 「ありがとう」と読み上げられる
  - OS標準TTSが使用される
- **信頼性レベル**: 🔵

### TC-058-014: オフライン時もお気に入り優先表示が機能

- **区分**: 正常系
- **関連要件**: REQ-1001, REQ-103
- **事前条件**:
  - NetworkStateが`offline`
  - お気に入り定型文「ありがとう」が設定されている
- **入力/操作**: 定型文画面に遷移
- **期待結果**:
  - お気に入り定型文が一覧の上部に表示される
  - お気に入りアイコンが表示される
  - 優先表示が1秒以内に完了する
- **信頼性レベル**: 🔵

### TC-058-015: オフライン時も定型文の追加が可能

- **区分**: 正常系
- **関連要件**: REQ-1001, REQ-104
- **事前条件**:
  - NetworkStateが`offline`
  - 定型文画面が表示されている
- **入力/操作**: 追加ボタンをタップ→定型文「新しい定型文」を入力→保存
- **期待結果**:
  - 新しい定型文がHiveに保存される
  - 定型文一覧に即座に追加される
  - アプリ再起動後も保持される
- **信頼性レベル**: 🔵

### TC-058-016: オフライン時も定型文の編集・削除が可能

- **区分**: 正常系
- **関連要件**: REQ-1001, REQ-105
- **事前条件**:
  - NetworkStateが`offline`
  - 定型文「ありがとう」が存在する
- **入力/操作**: 編集ボタンをタップ→「ありがとうございます」に変更→保存
- **期待結果**:
  - 定型文がHiveで更新される
  - 一覧表示が即座に更新される
  - 変更がアプリ再起動後も保持される
- **信頼性レベル**: 🔵

---

### 2.3 大ボタン（クイックレスポンス）

### TC-058-017: オフライン時も「はい」「いいえ」「わからない」ボタンが動作

- **区分**: 正常系
- **関連要件**: REQ-1001, REQ-201, REQ-202
- **事前条件**:
  - NetworkStateが`offline`
  - ホーム画面が表示されている
- **入力/操作**: 「はい」ボタンをタップ
- **期待結果**:
  - 1秒以内にTTS読み上げが開始される
  - 「はい」と読み上げられる
  - OS標準TTSが使用される
- **信頼性レベル**: 🔵

### TC-058-018: オフライン時も3ボタンが画面上部に常時表示

- **区分**: 正常系
- **関連要件**: REQ-1001, REQ-201
- **事前条件**:
  - NetworkStateが`offline`
- **入力/操作**: ホーム画面、定型文画面を順に表示
- **期待結果**:
  - すべての画面で大ボタンが上部に表示される
  - 左から「はい」「いいえ」「わからない」の順序
  - ボタン間隔が12px以上
- **信頼性レベル**: 🔵

### TC-058-019: オフライン時も状態ボタン（体調等）が即座読み上げ実行

- **区分**: 正常系
- **関連要件**: REQ-1001, REQ-203, REQ-204
- **事前条件**:
  - NetworkStateが`offline`
  - 状態ボタンが表示されている
- **入力/操作**: 「暑い」ボタンをタップ
- **期待結果**:
  - 1秒以内にTTS読み上げが開始される
  - 「暑いです」と読み上げられる
  - OS標準TTSが使用される
- **信頼性レベル**: 🟡

---

### 2.4 緊急ボタン

### TC-058-020: オフライン時も緊急ボタンが2段階確認で動作

- **区分**: 正常系
- **関連要件**: REQ-1001, REQ-301, REQ-302
- **事前条件**:
  - NetworkStateが`offline`
  - ホーム画面が表示されている
- **入力/操作**: 緊急ボタンをタップ
- **期待結果**:
  - 確認ダイアログが表示される
  - 「緊急ボタンを押しますか?」メッセージが表示される
  - 「はい」「いいえ」ボタンが表示される
- **信頼性レベル**: 🔵

### TC-058-021: オフライン時も緊急音・画面赤表示が実行される

- **区分**: 正常系
- **関連要件**: REQ-1001, REQ-303, REQ-304
- **事前条件**:
  - NetworkStateが`offline`
  - 緊急ボタンの確認ダイアログが表示されている
- **入力/操作**: 確認ダイアログで「はい」をタップ
- **期待結果**:
  - 画面が赤く表示される
  - 緊急音（ビープ音）が再生される
  - リセットボタンが表示される
- **信頼性レベル**: 🔵

### TC-058-022: オフライン時も緊急画面からリセットで通常画面に戻る

- **区分**: 正常系
- **関連要件**: REQ-1001, REQ-304
- **事前条件**:
  - NetworkStateが`offline`
  - 緊急画面（画面赤表示）が表示されている
- **入力/操作**: リセットボタンをタップ
- **期待結果**:
  - 緊急音が停止する
  - 通常のホーム画面に戻る
  - 画面色が通常に戻る
- **信頼性レベル**: 🔵

---

### 2.5 TTS読み上げ

### TC-058-023: オフライン時もTTS読み上げが1秒以内に開始される

- **区分**: 正常系
- **関連要件**: REQ-1001, REQ-401, NFR-001（TTS開始1秒以内）
- **事前条件**:
  - NetworkStateが`offline`
  - 入力バッファに「こんにちは」が入力されている
- **入力/操作**: 読み上げボタンをタップ
- **期待結果**:
  - 1秒以内にTTS読み上げが開始される
  - 「こんにちは」と読み上げられる
  - OS標準TTSが使用される
- **信頼性レベル**: 🔵

### TC-058-024: オフライン時もTTS読み上げ中断が動作

- **区分**: 正常系
- **関連要件**: REQ-1001, REQ-402
- **事前条件**:
  - NetworkStateが`offline`
  - TTS読み上げが実行中
- **入力/操作**: 中断ボタンをタップ
- **期待結果**:
  - TTS読み上げが即座に停止する
  - 読み上げボタンが再度押せる状態に戻る
- **信頼性レベル**: 🔵

### TC-058-025: オフライン時もTTS速度設定が反映される

- **区分**: 正常系
- **関連要件**: REQ-1001, REQ-403
- **事前条件**:
  - NetworkStateが`offline`
  - TTS速度が「遅い」に設定されている
- **入力/操作**: 入力テキストを読み上げ
- **期待結果**:
  - 遅い速度で読み上げられる
  - 速度設定がshared_preferencesに保存される
- **信頼性レベル**: 🔵

---

## 3. AI変換ボタン無効化テスト

### TC-058-026: オフライン時にAI変換ボタンがグレーアウト表示

- **区分**: 正常系
- **関連要件**: REQ-1002, REQ-3004
- **事前条件**:
  - NetworkStateが`offline`
  - AI変換ボタンが含まれる画面が表示されている
- **入力/操作**: AI変換ボタンの状態を確認
- **期待結果**:
  - AI変換ボタンが視覚的にグレーアウトされる
  - ボタンの透明度が0.5程度に低下する
  - ボタンがdisabled状態（enabled: false）になる
- **信頼性レベル**: 🔵

### TC-058-027: オフライン時にAI変換ボタンがタップ不可

- **区分**: 正常系
- **関連要件**: REQ-1002, REQ-3004
- **事前条件**:
  - NetworkStateが`offline`
  - AI変換ボタンが表示されている
- **入力/操作**: AI変換ボタンをタップ
- **期待結果**:
  - ボタンのonPressedコールバックが呼ばれない
  - AI変換処理が実行されない
  - ボタンがタップに反応しない
- **信頼性レベル**: 🔵

### TC-058-028: オフライン時にAI変換ボタンタップで無効化メッセージ表示

- **区分**: 正常系
- **関連要件**: REQ-1002, REQ-3004
- **事前条件**:
  - NetworkStateが`offline`
  - AI変換ボタンが表示されている
- **入力/操作**: AI変換ボタンをタップ（またはロングプレス）
- **期待結果**:
  - 「オフライン中はAI変換を利用できません」メッセージが表示される
  - SnackBarまたはツールチップで表示される
  - メッセージが3秒後に自動で消える
- **信頼性レベル**: 🟡

### TC-058-029: オフライン時にAI変換フォールバック動作が提供される

- **区分**: 正常系
- **関連要件**: REQ-1003, REQ-2003
- **事前条件**:
  - NetworkStateが`offline`
  - 入力バッファに「ありがとう」が入力されている
- **入力/操作**: AI変換ボタンをタップ（フォールバック有効時）
- **期待結果**:
  - 「オフラインです。入力テキストをそのまま使用しますか?」確認ダイアログが表示される
  - 「はい」で入力文「ありがとう」がそのまま採用される
  - 「いいえ」でキャンセルされる
- **信頼性レベル**: 🟡

### TC-058-030: オンライン時にAI変換ボタンが有効化される

- **区分**: 正常系
- **関連要件**: REQ-1002
- **事前条件**:
  - NetworkStateが`online`
  - AI変換ボタンが表示されている
- **入力/操作**: AI変換ボタンの状態を確認
- **期待結果**:
  - AI変換ボタンが通常の色で表示される
  - ボタンがenabled状態（enabled: true）になる
  - ボタンがタップ可能
- **信頼性レベル**: 🔵

### TC-058-031: ネットワーク状態切り替えでAI変換ボタンが動的に有効/無効化

- **区分**: 正常系
- **関連要件**: REQ-1002
- **事前条件**:
  - NetworkStateが`online`
  - AI変換ボタンが表示されている
- **入力/操作**: NetworkStateを`online`→`offline`→`online`に切り替え
- **期待結果**:
  - offline時にボタンが無効化される
  - online時にボタンが有効化される
  - 各切り替えが1秒以内にUIに反映される
- **信頼性レベル**: 🔵

---

## 4. オフライン表示インジケーターテスト

### TC-058-032: オフライン時に「オフライン」インジケーターが表示される

- **区分**: 正常系
- **関連要件**: REQ-1002, EDGE-001
- **事前条件**:
  - NetworkStateが`offline`
- **入力/操作**: アプリを表示
- **期待結果**:
  - 画面上部または下部に「オフライン」インジケーターが表示される
  - 「オフライン」テキストまたはWiFiオフアイコンが表示される
  - 控えめな色（グレー等）で表示される
- **信頼性レベル**: 🔵

### TC-058-033: オフライン時に「基本機能のみ利用可能」メッセージが表示される

- **区分**: 正常系
- **関連要件**: REQ-1002
- **事前条件**:
  - NetworkStateが`offline`
- **入力/操作**: オフラインインジケーターを確認
- **期待結果**:
  - 「オフライン - 基本機能のみ利用可能」メッセージが表示される
  - メッセージが読みやすいフォントサイズで表示される
  - メッセージがユーザー操作を妨げない位置に表示される
- **信頼性レベル**: 🔵

### TC-058-034: オンライン時にオフラインインジケーターが非表示

- **区分**: 正常系
- **関連要件**: REQ-1002
- **事前条件**:
  - NetworkStateが`online`
- **入力/操作**: アプリを表示
- **期待結果**:
  - オフラインインジケーターが表示されない
  - 画面上部または下部がクリーンな状態
- **信頼性レベル**: 🔵

### TC-058-035: オフライン通知がユーザー操作を妨げない

- **区分**: 正常系
- **関連要件**: NFR-203（主要機能を1画面でアクセス可能）
- **事前条件**:
  - NetworkStateが`offline`
  - オフラインインジケーターが表示されている
- **入力/操作**: 文字盤、定型文、大ボタンを操作
- **期待結果**:
  - オフラインインジケーターが操作を妨げない
  - モーダルダイアログではなくSnackBar/Bannerで表示される
  - ユーザーが閉じなくても操作可能
- **信頼性レベル**: 🔵

---

## 5. オンライン復帰通知テスト

### TC-058-036: オンライン復帰時に「オンラインに戻りました」通知が表示される

- **区分**: 正常系
- **関連要件**: EDGE-001（エラーメッセージと復旧方法）
- **事前条件**:
  - NetworkStateが`offline`
- **入力/操作**: NetworkStateを`online`に切り替え
- **期待結果**:
  - 「オンラインに戻りました」メッセージが表示される
  - SnackBarで一時的に表示される
  - メッセージが3秒後に自動で消える
- **信頼性レベル**: 🔵

### TC-058-037: オンライン復帰時に「AI変換が利用可能です」メッセージが表示される

- **区分**: 正常系
- **関連要件**: EDGE-001
- **事前条件**:
  - NetworkStateが`offline`
- **入力/操作**: NetworkStateを`online`に切り替え
- **期待結果**:
  - 「オンラインに戻りました。AI変換が利用可能です」メッセージが表示される
  - AI変換ボタンが有効化される
  - メッセージが3秒後に自動で消える
- **信頼性レベル**: 🔵

### TC-058-038: オンライン復帰通知がユーザー操作を妨げない

- **区分**: 正常系
- **関連要件**: NFR-203
- **事前条件**:
  - NetworkStateが`offline`
- **入力/操作**: NetworkStateを`online`に切り替え→即座に文字盤を操作
- **期待結果**:
  - オンライン復帰通知が表示される
  - 通知が文字盤操作を妨げない
  - SnackBarで画面下部に表示される
- **信頼性レベル**: 🔵

---

## 6. ローカルストレージ動作確認テスト

### TC-058-039: オフライン時も定型文がHiveに保存される

- **区分**: 正常系
- **関連要件**: REQ-1001, REQ-5003（永続化機構）, NFR-101（端末内保存）
- **事前条件**:
  - NetworkStateが`offline`
- **入力/操作**: 新しい定型文「テスト定型文」を追加
- **期待結果**:
  - 定型文がHiveに保存される
  - アプリ再起動後も定型文が保持される
  - Hive保存操作がUIをブロックしない
- **信頼性レベル**: 🔵

### TC-058-040: オフライン時も設定がshared_preferencesに保存される

- **区分**: 正常系
- **関連要件**: REQ-1001, NFR-101
- **事前条件**:
  - NetworkStateが`offline`
- **入力/操作**: フォントサイズを「大」に変更
- **期待結果**:
  - 設定がshared_preferencesに保存される
  - アプリ再起動後も設定が保持される
  - 保存操作がUIをブロックしない
- **信頼性レベル**: 🔵

### TC-058-041: オフライン時も履歴がHiveに保存される

- **区分**: 正常系
- **関連要件**: REQ-1001, REQ-5003
- **事前条件**:
  - NetworkStateが`offline`
- **入力/操作**: 入力テキスト「こんにちは」を読み上げ
- **期待結果**:
  - 履歴がHiveに保存される
  - 履歴画面に表示される
  - アプリ再起動後も履歴が保持される
- **信頼性レベル**: 🟡

### TC-058-042: Hive読み込みが1秒以内に完了する

- **区分**: 正常系
- **関連要件**: REQ-1001, パフォーマンス要件
- **事前条件**:
  - NetworkStateが`offline`
  - Hiveに100件の定型文が保存されている
- **入力/操作**: 定型文画面に遷移
- **期待結果**:
  - 1秒以内に定型文一覧が表示される
  - Hive読み込みがUIをブロックしない
  - 非同期処理が正しく実装されている
- **信頼性レベル**: 🔵

### TC-058-043: オフライン時もローカルストレージI/Oエラーハンドリングが動作

- **区分**: 異常系
- **関連要件**: NFR-303
- **事前条件**:
  - NetworkStateが`offline`
  - ストレージ容量が不足している（モック）
- **入力/操作**: 新しい定型文を追加
- **期待結果**:
  - エラーメッセージが表示される
  - 「ストレージ容量が不足しています」メッセージが表示される
  - アプリがクラッシュしない
- **信頼性レベル**: 🟡

---

## 7. エラーハンドリングテスト

### TC-058-044: オフライン時のエラーメッセージが分かりやすい日本語で表示

- **区分**: 正常系
- **関連要件**: NFR-204（分かりやすいエラーメッセージ）
- **事前条件**:
  - NetworkStateが`offline`
  - AI変換ボタンを含む画面が表示されている
- **入力/操作**: AI変換ボタンをタップ
- **期待結果**:
  - 「インターネットに接続されていません」メッセージが表示される
  - 「オフライン中はAI変換を利用できません」メッセージが表示される
  - 専門用語を避けた分かりやすい表現
- **信頼性レベル**: 🔵

### TC-058-045: エラーメッセージに復旧方法が提示される

- **区分**: 正常系
- **関連要件**: NFR-204, EDGE-001
- **事前条件**:
  - NetworkStateが`offline`
- **入力/操作**: オフライン時にAI変換ボタンをタップ
- **期待結果**:
  - 「WiFi設定を確認してください」等の復旧方法が提示される
  - 「基本機能（文字入力、定型文、読み上げ）は利用可能です」メッセージが表示される
  - ユーザーが次に取るべき行動が明確
- **信頼性レベル**: 🟡

### TC-058-046: オフライン状態でもアプリがクラッシュしない

- **区分**: 異常系
- **関連要件**: NFR-303
- **事前条件**:
  - NetworkStateが`offline`
- **入力/操作**: すべての基本機能（文字盤、定型文、TTS、大ボタン、緊急ボタン）を30分間連続使用
- **期待結果**:
  - アプリがクラッシュしない
  - メモリリークが発生しない
  - すべての機能が正常動作を維持
- **信頼性レベル**: 🔵

### TC-058-047: ネットワーク切り替えが連続5回以上でも正常動作

- **区分**: 境界値
- **関連要件**: NFR-303
- **事前条件**:
  - アプリが起動されている
- **入力/操作**: NetworkStateを`online`↔`offline`に5回以上連続で切り替え
- **期待結果**:
  - 各切り替えが正しく反映される
  - UI更新が正常に動作する
  - アプリがクラッシュしない
  - メモリリークが発生しない
- **信頼性レベル**: 🔵

---

## 8. 境界値・異常系テスト

### TC-058-048: オフライン時に1000文字入力しても正常動作

- **区分**: 境界値
- **関連要件**: REQ-1001, EDGE-101（1000文字制限）
- **事前条件**:
  - NetworkStateが`offline`
- **入力/操作**: 文字盤で1000文字入力
- **期待結果**:
  - 1000文字まで入力可能
  - 1001文字目は入力されない
  - アプリがクラッシュしない
  - UIが正常に表示される
- **信頼性レベル**: 🔵

### TC-058-049: オフライン時に定型文100件登録しても正常動作

- **区分**: 境界値
- **関連要件**: REQ-1001
- **事前条件**:
  - NetworkStateが`offline`
- **入力/操作**: 定型文を100件登録
- **期待結果**:
  - すべて正常に保存される
  - 定型文一覧が1秒以内に表示される
  - Hive I/Oがブロックしない
- **信頼性レベル**: 🟡

### TC-058-050: オフライン時にTTS読み上げを10回連続実行しても正常動作

- **区分**: 境界値
- **関連要件**: REQ-1001, NFR-001
- **事前条件**:
  - NetworkStateが`offline`
- **入力/操作**: TTS読み上げを10回連続実行
- **期待結果**:
  - すべての読み上げが1秒以内に開始される
  - 読み上げが正常に実行される
  - アプリがクラッシュしない
- **信頼性レベル**: 🔵

### TC-058-051: オフライン時に空文字列を読み上げようとした場合のエラーハンドリング

- **区分**: 異常系
- **関連要件**: NFR-303
- **事前条件**:
  - NetworkStateが`offline`
  - 入力バッファが空
- **入力/操作**: 読み上げボタンをタップ
- **期待結果**:
  - エラーメッセージが表示される
  - 「読み上げる内容がありません」メッセージが表示される
  - アプリがクラッシュしない
- **信頼性レベル**: 🟡

### TC-058-052: NetworkState.checking状態でAI変換ボタンが無効化

- **区分**: デフォルト値
- **関連要件**: REQ-1002
- **事前条件**:
  - アプリが起動したばかり（NetworkState.checking）
- **入力/操作**: AI変換ボタンの状態を確認
- **期待結果**:
  - AI変換ボタンが無効化される
  - `isAIConversionAvailable`が`false`を返す
  - グレーアウト表示される
- **信頼性レベル**: 🟡

---

## 9. パフォーマンステスト

### TC-058-053: オフライン切り替えからUI反映まで1秒以内

- **区分**: 正常系
- **関連要件**: パフォーマンス要件
- **事前条件**:
  - NetworkStateが`online`
- **入力/操作**: NetworkStateを`offline`に切り替え
- **期待結果**:
  - 1秒以内にオフラインインジケーターが表示される
  - 1秒以内にAI変換ボタンが無効化される
  - UIが即座に更新される
- **信頼性レベル**: 🔵

### TC-058-054: オンライン復帰からUI反映まで1秒以内

- **区分**: 正常系
- **関連要件**: パフォーマンス要件
- **事前条件**:
  - NetworkStateが`offline`
- **入力/操作**: NetworkStateを`online`に切り替え
- **期待結果**:
  - 1秒以内にオンライン復帰通知が表示される
  - 1秒以内にAI変換ボタンが有効化される
  - UIが即座に更新される
- **信頼性レベル**: 🔵

### TC-058-055: オフライン時の基本機能がパフォーマンス要件を満たす

- **区分**: 正常系
- **関連要件**: NFR-003（文字盤100ms）, NFR-001（TTS 1秒）
- **事前条件**:
  - NetworkStateが`offline`
- **入力/操作**:
  - 文字盤タップ
  - 定型文タップ
  - 読み上げボタンタップ
  - 大ボタンタップ
- **期待結果**:
  - 文字盤タップ応答: 100ms以内
  - 定型文一覧表示: 1秒以内
  - TTS読み上げ開始: 1秒以内
  - 大ボタンTTS開始: 1秒以内
- **信頼性レベル**: 🔵

---

## テストカバレッジ目標

### カバレッジ基準

- **全体カバレッジ**: 90%以上
- **NetworkProvider統合**: 100%
- **オフライン時の基本機能**: 90%以上
- **AI変換ボタン無効化**: 100%
- **オフライン表示インジケーター**: 90%以上
- **エラーハンドリング**: 80%以上

### テストタイプ別内訳

| テストタイプ | テストケース数 | 割合 |
|------------|--------------|------|
| 正常系 | 42件 | 76% |
| 異常系 | 4件 | 7% |
| 境界値 | 6件 | 11% |
| デフォルト値 | 3件 | 5% |
| **合計** | **55件** | **100%** |

### 信頼性レベル別内訳

| 信頼性レベル | テストケース数 | 割合 |
|-------------|--------------|------|
| 🔵 青信号（要件定義書ベース） | 47件 | 85% |
| 🟡 黄信号（妥当な推測） | 8件 | 15% |
| 🔴 赤信号（完全な推測） | 0件 | 0% |
| **合計** | **55件** | **100%** |

---

## テスト実装優先度

### P0（最優先）

1. **TC-058-001〜007**: NetworkProvider統合テスト
2. **TC-058-008〜011**: 文字盤入力テスト
3. **TC-058-026〜031**: AI変換ボタン無効化テスト
4. **TC-058-032〜035**: オフラインインジケーターテスト

### P1（高優先度）

5. **TC-058-012〜016**: 定型文テスト
6. **TC-058-023〜025**: TTS読み上げテスト
7. **TC-058-039〜042**: ローカルストレージテスト
8. **TC-058-044〜047**: エラーハンドリングテスト

### P2（中優先度）

9. **TC-058-017〜019**: 大ボタンテスト
10. **TC-058-020〜022**: 緊急ボタンテスト
11. **TC-058-036〜038**: オンライン復帰通知テスト
12. **TC-058-048〜052**: 境界値・異常系テスト
13. **TC-058-053〜055**: パフォーマンステスト

---

## テスト環境

### 必要な環境

- **Flutter SDK**: 3.38.1以上
- **Dart SDK**: 3.0以上
- **テストフレームワーク**: flutter_test, mockito
- **デバイス**: iOS 14.0+, Android 10+, Web（Chrome/Safari/Edge）

### モック/スタブ

- **NetworkProvider**: `setOnline()`, `setOffline()`, `setChecking()`で状態をシミュレート
- **TTS**: OS標準TTSをモックで代替（テスト時）
- **Hive**: メモリ内Hiveまたはモックを使用
- **shared_preferences**: MockSharedPreferencesを使用

### テストデータ

- デフォルト定型文10件
- テスト用カスタム定型文5件
- 履歴データ20件（オプション）

---

## 備考

### TASK-0057との連携

- TASK-0057で実装されたNetworkProviderを活用
- `isAIConversionAvailable`ゲッターを使用してAI変換ボタンの有効/無効を切り替え
- NetworkStateの変更をリッスンしてUIをリアルタイム更新

### 将来拡張（TASK-0058範囲外）

- **connectivity_plus統合**: 実際のネットワーク接続を自動監視（Phase 4以降）
- **オフラインキャッシュ**: AI変換結果のローカルキャッシュ（MVP範囲外）
- **バックグラウンド同期**: オンライン復帰時の自動データ同期（MVP範囲外）

### 注意事項

- テストケースは単体テスト + ウィジェットテストで実装
- E2Eテストは必要に応じてintegration_testで追加
- パフォーマンステストは実機で検証推奨
- オフライン状態のシミュレーションは`NetworkProvider.setOffline()`を使用

---

## 参照ドキュメント

- **要件定義書**: `/Volumes/external/dev/kotonoha/docs/implements/kotonoha/TASK-0058/offline-behavior-requirements.md`
- **NetworkProvider実装**: `/Volumes/external/dev/kotonoha/frontend/kotonoha_app/lib/features/network/providers/network_provider.dart`
- **NetworkState定義**: `/Volumes/external/dev/kotonoha/frontend/kotonoha_app/lib/features/network/domain/models/network_state.dart`
- **TASK-0057テスト**: `/Volumes/external/dev/kotonoha/frontend/kotonoha_app/test/features/network/providers/network_provider_test.dart`
- **CLAUDE.md**: `/Volumes/external/dev/kotonoha/CLAUDE.md`

---

## 変更履歴

| 日付 | 変更内容 | 作成者 |
|------|---------|--------|
| 2025-11-27 | 初版作成（テストケース55件） | Claude Code |

---

**次のステップ**: `/tsumiki:tdd-red` - 失敗するテストケースの作成
