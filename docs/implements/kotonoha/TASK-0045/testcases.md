# TASK-0045: 緊急ボタンUI実装 - テストケース一覧

## 概要

緊急ボタンウィジェット（目立つデザイン・赤色等）のテストケース一覧。
既存のEmergencyButton（TASK-0017）を拡張し、確認ダイアログ連携、テーマ対応、アクセシビリティ対応を追加する。

## テスト対象

1. **EmergencyButtonWithConfirmation** - 確認ダイアログ付き緊急ボタン
2. **EmergencyConfirmationDialog** - 緊急呼び出し確認ダイアログ

## テストファイル構成

```
frontend/kotonoha_app/test/features/emergency/
├── presentation/
│   └── widgets/
│       ├── emergency_button_with_confirmation_test.dart
│       └── emergency_confirmation_dialog_test.dart
```

---

## 1. EmergencyButtonWithConfirmation テストケース

### 1.1 レンダリングテスト

| ID | テストケース | 入力 | 期待結果 | 優先度 | 関連要件 | 信頼性 |
|----|------------|------|---------|--------|----------|--------|
| TC-045-001 | 緊急ボタンが表示される | なし | EmergencyButtonWithConfirmationがレンダリングされる | P0 | REQ-301 | 🔵 |
| TC-045-002 | ボタンが円形で表示される | なし | CircleBorderが適用される | P0 | FR-002 | 🔵 |
| TC-045-003 | 背景色が赤色（#D32F2F）である | なし | backgroundColor = AppColors.emergency | P0 | FR-001 | 🔵 |
| TC-045-004 | notifications_activeアイコンが表示される | なし | Icons.notifications_activeが存在する | P0 | FR-004 | 🔵 |
| TC-045-005 | アイコンの色が白である | なし | foregroundColor = Colors.white | P0 | FR-004 | 🔵 |
| TC-045-006 | エレベーション（影）が適用されている | なし | elevation >= 4 | P1 | FR-008 | 🟡 |

### 1.2 サイズテスト

| ID | テストケース | 入力 | 期待結果 | 優先度 | 関連要件 | 信頼性 |
|----|------------|------|---------|--------|----------|--------|
| TC-045-007 | デフォルトサイズが60x60pxである | なし | width = 60, height = 60 | P0 | FR-003, NFR-202 | 🔵 |
| TC-045-008 | カスタムサイズ（80px）が適用される | size: 80.0 | width = 80, height = 80 | P1 | FR-003 | 🔵 |
| TC-045-009 | 最小サイズ（44px）未満に設定できない | size: 30.0 | width >= 44, height >= 44 | P0 | FR-201, REQ-5001 | 🔵 |
| TC-045-010 | 境界値: 44pxが適用される | size: 44.0 | width = 44, height = 44 | P1 | FR-201 | 🔵 |

### 1.3 タップ・イベントテスト

| ID | テストケース | 入力 | 期待結果 | 優先度 | 関連要件 | 信頼性 |
|----|------------|------|---------|--------|----------|--------|
| TC-045-011 | タップ時に確認ダイアログが表示される | ボタンタップ | EmergencyConfirmationDialogが表示される | P0 | FR-101, REQ-302 | 🔵 |
| TC-045-012 | タップ時に視覚的フィードバック（リップル）が発生する | ボタンタップ | InkWell/Materialリップルが表示される | P1 | FR-102 | 🟡 |
| TC-045-013 | 確認ダイアログで「はい」タップ後、onEmergencyConfirmedが呼ばれる | 「はい」タップ | onEmergencyConfirmedコールバックが1回実行される | P0 | FR-104, REQ-2005 | 🔵 |
| TC-045-014 | 確認ダイアログで「いいえ」タップ後、ダイアログが閉じる | 「いいえ」タップ | ダイアログが閉じ、通常状態に戻る | P0 | FR-105, REQ-302 | 🔵 |
| TC-045-015 | 確認ダイアログで「いいえ」タップ後、onEmergencyConfirmedは呼ばれない | 「いいえ」タップ | コールバックが実行されない | P0 | FR-105 | 🔵 |

### 1.4 アクセシビリティテスト

| ID | テストケース | 入力 | 期待結果 | 優先度 | 関連要件 | 信頼性 |
|----|------------|------|---------|--------|----------|--------|
| TC-045-016 | Semanticsラベルが「緊急呼び出しボタン」である | なし | Semantics.labelに「緊急呼び出しボタン」が含まれる | P0 | FR-007, NFR-A001 | 🔵 |
| TC-045-017 | ボタンセマンティクス（button: true）が設定されている | なし | Semantics.button = true | P0 | NFR-A001 | 🔵 |
| TC-045-018 | タップターゲットが44x44px以上を常に満たす | なし | width >= 44, height >= 44 | P0 | FR-201, REQ-5001 | 🔵 |
| TC-045-019 | 色だけでなくアイコンで緊急性を表現 | なし | notifications_activeアイコンが存在する | P0 | NFR-A002 | 🔵 |

### 1.5 テーマ対応テスト

| ID | テストケース | 入力 | 期待結果 | 優先度 | 関連要件 | 信頼性 |
|----|------------|------|---------|--------|----------|--------|
| TC-045-020 | ライトモードで赤色（#D32F2F）で表示される | lightTheme | backgroundColor = Color(0xFFD32F2F) | P0 | FR-103, REQ-803 | 🔵 |
| TC-045-021 | ダークモードで明るい赤色（#EF5350）で表示される | darkTheme | backgroundColor = Color(0xFFEF5350) | P0 | FR-103, REQ-803 | 🔵 |
| TC-045-022 | 高コントラストモードで純粋な赤色（#FF0000）で表示される | highContrastTheme | backgroundColor = Color(0xFFFF0000) | P0 | FR-103, REQ-803, REQ-5006 | 🔵 |
| TC-045-023 | 高コントラストモードでコントラスト比4.5:1以上を確保 | highContrastTheme | 白アイコン on 赤背景でコントラスト比確認 | P0 | FR-202, REQ-5006 | 🔵 |

### 1.6 エッジケーステスト

| ID | テストケース | 入力 | 期待結果 | 優先度 | 関連要件 | 信頼性 |
|----|------------|------|---------|--------|----------|--------|
| TC-045-024 | 連続タップ時に複数のダイアログが表示されない | 連続3回タップ | ダイアログは1つのみ表示される | P0 | EDGE-001 | 🟡 |
| TC-045-025 | ダイアログ表示中に緊急ボタンをタップしても無視される | ダイアログ表示中にタップ | 既存ダイアログが維持される | P1 | EDGE-001 | 🟡 |
| TC-045-026 | onEmergencyConfirmedがnullでもエラーにならない | onEmergencyConfirmed: null的な状態 | エラーなく動作（※通常は必須パラメータ） | P2 | - | 🟡 |
| TC-045-027 | カスタムダイアログビルダーが適用される | dialogBuilder指定 | カスタムダイアログが表示される | P2 | - | 🟡 |

---

## 2. EmergencyConfirmationDialog テストケース

### 2.1 表示テスト

| ID | テストケース | 入力 | 期待結果 | 優先度 | 関連要件 | 信頼性 |
|----|------------|------|---------|--------|----------|--------|
| TC-045-028 | ダイアログが表示される | showDialog呼び出し | EmergencyConfirmationDialogが画面に表示される | P0 | REQ-2004 | 🔵 |
| TC-045-029 | タイトル「緊急呼び出し」が表示される | なし | 「緊急呼び出し」テキストが存在する | P0 | AC-006 | 🟡 |
| TC-045-030 | メッセージ「緊急呼び出しを実行しますか?」が表示される | なし | 該当テキストが存在する | P0 | FR-101, AC-006 | 🔵 |
| TC-045-031 | 補足メッセージ「周囲に緊急音が鳴り、画面が赤くなります。」が表示される | なし | 該当テキストが存在する | P1 | REQ-303, REQ-304 | 🟡 |
| TC-045-032 | 「はい」ボタンが表示される | なし | 「はい」ボタンが存在する | P0 | AC-007 | 🔵 |
| TC-045-033 | 「いいえ」ボタンが表示される | なし | 「いいえ」ボタンが存在する | P0 | AC-007 | 🔵 |
| TC-045-034 | 「はい」ボタンが赤色で表示される | なし | backgroundColor = 赤系カラー | P1 | NFR-U001 | 🟡 |
| TC-045-035 | 「いいえ」ボタンがグレー系で表示される | なし | backgroundColor = グレー系カラー | P1 | - | 🟡 |

### 2.2 インタラクションテスト

| ID | テストケース | 入力 | 期待結果 | 優先度 | 関連要件 | 信頼性 |
|----|------------|------|---------|--------|----------|--------|
| TC-045-036 | 「はい」ボタンタップでonConfirmが呼ばれる | 「はい」タップ | onConfirmコールバックが1回実行される | P0 | FR-104, AC-008 | 🔵 |
| TC-045-037 | 「いいえ」ボタンタップでonCancelが呼ばれる | 「いいえ」タップ | onCancelコールバックが1回実行される | P0 | FR-105, AC-009 | 🔵 |
| TC-045-038 | ダイアログ外タップでダイアログが閉じる | ダイアログ外タップ | ダイアログが閉じる（barrierDismissible: true） | P1 | AC-010, EDGE-005 | 🟡 |
| TC-045-039 | ダイアログ外タップでonCancelが呼ばれる | ダイアログ外タップ | onCancelコールバックが実行される | P1 | FR-105 | 🟡 |

### 2.3 アクセシビリティテスト

| ID | テストケース | 入力 | 期待結果 | 優先度 | 関連要件 | 信頼性 |
|----|------------|------|---------|--------|----------|--------|
| TC-045-040 | 「はい」ボタンのタップターゲットが44x44px以上 | なし | width >= 44, height >= 44 | P0 | AC-014, REQ-5001 | 🔵 |
| TC-045-041 | 「いいえ」ボタンのタップターゲットが44x44px以上 | なし | width >= 44, height >= 44 | P0 | AC-014, REQ-5001 | 🔵 |
| TC-045-042 | 「はい」ボタン幅が100px以上である | なし | width >= 100 | P1 | 境界値 | 🟡 |
| TC-045-043 | 「いいえ」ボタン幅が100px以上である | なし | width >= 100 | P1 | 境界値 | 🟡 |
| TC-045-044 | ダイアログにSemantics情報が設定されている | なし | 適切なSemanticsラベルが存在する | P1 | NFR-A003 | 🟡 |

### 2.4 テーマ対応テスト

| ID | テストケース | 入力 | 期待結果 | 優先度 | 関連要件 | 信頼性 |
|----|------------|------|---------|--------|----------|--------|
| TC-045-045 | ライトモードで適切な配色で表示される | lightTheme | 背景白、テキスト黒 | P0 | FR-103 | 🔵 |
| TC-045-046 | ダークモードで適切な配色で表示される | darkTheme | 背景グレー、テキスト白 | P0 | FR-103 | 🔵 |
| TC-045-047 | 高コントラストモードで適切な配色で表示される | highContrastTheme | 背景白、テキスト黒、コントラスト比4.5:1以上 | P0 | FR-103, FR-202 | 🔵 |

### 2.5 エッジケーステスト

| ID | テストケース | 入力 | 期待結果 | 優先度 | 関連要件 | 信頼性 |
|----|------------|------|---------|--------|----------|--------|
| TC-045-048 | 「はい」ボタン連続タップでonConfirmが1回だけ呼ばれる | 連続3回タップ | コールバックは1回のみ実行される | P1 | EDGE-001 | 🟡 |
| TC-045-049 | 「いいえ」ボタン連続タップでonCancelが1回だけ呼ばれる | 連続3回タップ | コールバックは1回のみ実行される | P1 | EDGE-001 | 🟡 |

---

## 3. 統合テスト（EmergencyButtonWithConfirmation + Dialog）

### 3.1 フロー全体テスト

| ID | テストケース | 入力 | 期待結果 | 優先度 | 関連要件 | 信頼性 |
|----|------------|------|---------|--------|----------|--------|
| TC-045-050 | 2段階確認フロー全体が正しく動作する | ボタンタップ→「はい」 | ボタンタップ→ダイアログ表示→「はい」→onEmergencyConfirmed実行 | P0 | REQ-302, FR-204 | 🔵 |
| TC-045-051 | キャンセルフロー全体が正しく動作する | ボタンタップ→「いいえ」 | ボタンタップ→ダイアログ表示→「いいえ」→通常状態に戻る | P0 | REQ-302 | 🔵 |
| TC-045-052 | タップ操作のみで完結する（スワイプ不要） | タップ操作のみ | 全ての操作がタップのみで完了する | P0 | FR-203, REQ-5005 | 🔵 |

---

## テストケース統計

| カテゴリ | P0（必須） | P1（重要） | P2（オプション） | 合計 |
|---------|-----------|-----------|-----------------|------|
| EmergencyButtonWithConfirmation - レンダリング | 5 | 1 | 0 | 6 |
| EmergencyButtonWithConfirmation - サイズ | 2 | 2 | 0 | 4 |
| EmergencyButtonWithConfirmation - タップ・イベント | 4 | 1 | 0 | 5 |
| EmergencyButtonWithConfirmation - アクセシビリティ | 4 | 0 | 0 | 4 |
| EmergencyButtonWithConfirmation - テーマ対応 | 4 | 0 | 0 | 4 |
| EmergencyButtonWithConfirmation - エッジケース | 1 | 1 | 2 | 4 |
| EmergencyConfirmationDialog - 表示 | 5 | 3 | 0 | 8 |
| EmergencyConfirmationDialog - インタラクション | 2 | 2 | 0 | 4 |
| EmergencyConfirmationDialog - アクセシビリティ | 2 | 3 | 0 | 5 |
| EmergencyConfirmationDialog - テーマ対応 | 3 | 0 | 0 | 3 |
| EmergencyConfirmationDialog - エッジケース | 0 | 2 | 0 | 2 |
| 統合テスト | 3 | 0 | 0 | 3 |
| **合計** | **35** | **15** | **2** | **52** |

---

## 信頼性レベル凡例

- 🔵 **青信号**: 要件定義書に明確に記載された要件に基づくテストケース
- 🟡 **黄信号**: 要件定義書から妥当に推測されるテストケース
- 🔴 **赤信号**: 要件定義書にない推測によるテストケース（オプション機能向け）

---

## 受け入れ基準との対応

| 受け入れ基準 | テストケースID |
|-------------|---------------|
| AC-001: 緊急ボタンが円形で赤色（#D32F2F）で表示される | TC-045-002, TC-045-003 |
| AC-002: 緊急ボタンのサイズが60px x 60px（デフォルト）である | TC-045-007 |
| AC-003: notifications_activeアイコンが白色で表示される | TC-045-004, TC-045-005 |
| AC-004: タップ時に視覚的フィードバック（リップル）が表示される | TC-045-012 |
| AC-005: タップ時に確認ダイアログが表示される | TC-045-011 |
| AC-006: 確認ダイアログに「緊急呼び出しを実行しますか?」のメッセージが表示される | TC-045-030 |
| AC-007: 確認ダイアログに「はい」「いいえ」ボタンが表示される | TC-045-032, TC-045-033 |
| AC-008: 「はい」タップでonEmergencyConfirmedコールバックが呼び出される | TC-045-013, TC-045-036 |
| AC-009: 「いいえ」タップでダイアログが閉じる | TC-045-014, TC-045-037 |
| AC-010: ダイアログ外タップでダイアログが閉じる | TC-045-038 |
| AC-011: ボタンにエレベーション（影）が適用されている | TC-045-006 |
| AC-012: Semanticsラベルに「緊急呼び出しボタン」が設定されている | TC-045-016 |
| AC-013: 高コントラストモードでコントラスト比4.5:1以上を確保している | TC-045-023 |
| AC-014: 確認ダイアログのボタンサイズが44px以上である | TC-045-040, TC-045-041 |
| AC-015: ライトモードで適切な配色で表示される | TC-045-020, TC-045-045 |
| AC-016: ダークモードで適切な配色で表示される | TC-045-021, TC-045-046 |
| AC-017: 高コントラストモードで適切な配色で表示される | TC-045-022, TC-045-047 |
| AC-018: 連続タップ時に複数のダイアログが表示されない | TC-045-024 |
| AC-019: 画面回転時にボタンの視認性が維持される | （実機テスト推奨）|
| AC-020: カスタムサイズ（例: 80px）が適用される | TC-045-008 |
| AC-021: 最小サイズ（44px）が保証される | TC-045-009, TC-045-010 |
| AC-022: ボタンが他のUI要素と重ならない位置に配置できる | （レイアウトテスト）|
| AC-023: Positionedウィジェット等で固定位置に配置できる | （レイアウトテスト）|

---

## 備考

- 画面回転テスト（AC-019）およびレイアウト配置テスト（AC-022, AC-023）は、実機またはエミュレータでの手動テストを推奨
- 振動フィードバック（FR-301）およびパルスアニメーション（FR-302）はオプション要件のため、本テストケースには含めていない
- 緊急音再生・画面全体の赤表示は後続タスク（TASK-0047）で実装するため、本タスクではonEmergencyConfirmedコールバックの呼び出しのみを検証

---

**ドキュメント作成日**: 2025-11-24
**タスクID**: TASK-0045
**関連要件**: REQ-301, REQ-302, REQ-5002, NFR-202
