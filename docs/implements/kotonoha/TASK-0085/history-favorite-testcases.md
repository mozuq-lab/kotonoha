# 履歴・お気に入りE2Eテスト テストケース一覧

## TASK-0085: 履歴・お気に入りE2Eテスト

**作成日**: 2025-11-29
**関連要件**: REQ-601, REQ-602, REQ-603, REQ-701, REQ-702, REQ-703
**依存タスク**: TASK-0081 (E2Eテスト環境構築)

---

## 開発言語・フレームワーク

- **プログラミング言語**: Dart 3.10+
  - **言語選択の理由**: Flutterの標準言語、型安全性が高い
  - **テストに適した機能**: 非同期処理のサポート、nullセーフティ
- **テストフレームワーク**: flutter_test + integration_test
  - **フレームワーク選択の理由**: Flutter公式E2Eテストパッケージ
  - **テスト実行環境**: iOS/Android/Web シミュレーター/エミュレーター
- 🔵 信頼性レベル: 青信号 - tech-stack.mdに基づく

---

## 1. 正常系テストケース（基本的な動作）

### TC-E2E-085-001: 読み上げ → 履歴自動保存 → 履歴一覧表示 🔵

- **テスト名**: 読み上げ後に履歴が自動保存される
  - **何をテストするか**: TTS読み上げ実行後、履歴画面に自動保存されること
  - **期待される動作**: 読み上げたテキストが履歴一覧に表示される
- **入力値**: テキスト「テスト」を入力して読み上げ
  - **入力データの意味**: 最小限の日本語テキストで基本動作を確認
- **期待される結果**: 履歴画面に「テスト」が表示される
  - **期待結果の理由**: REQ-601に基づく履歴自動保存機能
- **テストの目的**: REQ-601の検証
  - **確認ポイント**: 履歴保存のタイミング、一覧表示の正確性
- 🔵 信頼性レベル: 青信号 - REQ-601に基づく

### TC-E2E-085-002: 履歴タップ → 再読み上げ 🔵

- **テスト名**: 履歴タップで再読み上げが実行される
  - **何をテストするか**: 履歴項目をタップするとTTS再読み上げが開始されること
  - **期待される動作**: タップ後1秒以内にTTS読み上げが開始される
- **入力値**: 履歴項目「テスト」をタップ
  - **入力データの意味**: 事前に保存された履歴項目
- **期待される結果**: TTS読み上げが開始される（停止ボタン表示で確認）
  - **期待結果の理由**: REQ-603に基づく再読み上げ機能
- **テストの目的**: REQ-603の検証
  - **確認ポイント**: 読み上げ開始までの応答時間（NFR-001: 1秒以内）
- 🔵 信頼性レベル: 青信号 - REQ-603に基づく

### TC-E2E-085-003: 履歴からお気に入り登録 → お気に入り一覧表示 🔵

- **テスト名**: 履歴からお気に入りに登録できる
  - **何をテストするか**: 履歴項目を長押ししてお気に入り登録できること
  - **期待される動作**: コンテキストメニューから「お気に入りに追加」を選択後、お気に入り一覧に表示される
- **入力値**: 履歴項目「テスト」を長押し → 「お気に入りに追加」選択
  - **入力データの意味**: 履歴からお気に入りへの連携フロー
- **期待される結果**: お気に入り画面に「テスト」が表示される
  - **期待結果の理由**: REQ-701に基づくお気に入り登録機能
- **テストの目的**: REQ-701の検証
  - **確認ポイント**: 登録成功メッセージ、お気に入り一覧への反映
- 🔵 信頼性レベル: 青信号 - REQ-701に基づく

### TC-E2E-085-004: お気に入りタップ → 再読み上げ 🔵

- **テスト名**: お気に入りタップで再読み上げが実行される
  - **何をテストするか**: お気に入り項目をタップするとTTS再読み上げが開始されること
  - **期待される動作**: タップ後1秒以内にTTS読み上げが開始される
- **入力値**: お気に入り項目「テスト」をタップ
  - **入力データの意味**: 事前に登録されたお気に入り項目
- **期待される結果**: TTS読み上げが開始される
  - **期待結果の理由**: お気に入りからの読み上げ機能
- **テストの目的**: お気に入り再読み上げの検証
  - **確認ポイント**: 読み上げ開始までの応答時間
- 🔵 信頼性レベル: 青信号 - REQ-702に基づく

### TC-E2E-085-005: お気に入り並び順変更（編集モード） 🔵

- **テスト名**: お気に入りの並び順を変更できる
  - **何をテストするか**: 編集モードでドラッグ&ドロップにより並び順を変更できること
  - **期待される動作**: 変更後の並び順が保存される
- **入力値**: 2件以上のお気に入りを登録 → 編集モード → ドラッグ&ドロップ
  - **入力データの意味**: 並び替え機能の検証に必要な複数件データ
- **期待される結果**: 新しい並び順で表示される
  - **期待結果の理由**: REQ-703に基づく並び順変更機能
- **テストの目的**: REQ-703の検証
  - **確認ポイント**: displayOrderの更新、永続化
- 🔵 信頼性レベル: 青信号 - REQ-703に基づく

### TC-E2E-085-006: 履歴個別削除（確認ダイアログ） 🔵

- **テスト名**: 履歴を個別削除できる（確認ダイアログ付き）
  - **何をテストするか**: 削除ボタンタップ後、確認ダイアログが表示され、削除が実行されること
  - **期待される動作**: 「削除」選択後、一覧から削除される
- **入力値**: 履歴項目の削除ボタンタップ → 「削除」選択
  - **入力データの意味**: 誤操作防止の確認フロー
- **期待される結果**: 履歴項目が一覧から消える
  - **期待結果の理由**: 確認ダイアログによる安全な削除
- **テストの目的**: 個別削除機能の検証
  - **確認ポイント**: barrierDismissible: false、削除の完了
- 🔵 信頼性レベル: 青信号 - 実装コードに基づく

### TC-E2E-085-007: お気に入り個別削除（確認ダイアログ） 🔵

- **テスト名**: お気に入りを個別削除できる（確認ダイアログ付き）
  - **何をテストするか**: REQ-704に基づく確認ダイアログ表示と削除実行
  - **期待される動作**: 「削除」選択後、一覧から削除される
- **入力値**: お気に入り項目の削除ボタンタップ → 「削除」選択
  - **入力データの意味**: 誤操作防止の確認フロー
- **期待される結果**: お気に入り項目が一覧から消える
  - **期待結果の理由**: REQ-704に基づく確認ダイアログ必須
- **テストの目的**: REQ-704の検証
  - **確認ポイント**: 確認ダイアログの表示、barrierDismissible: false
- 🔵 信頼性レベル: 青信号 - REQ-704に基づく

---

## 2. 異常系テストケース（エラーハンドリング）

### TC-E2E-085-008: 履歴0件の状態で空メッセージ表示 🔵

- **テスト名**: 履歴0件で「履歴がありません」が表示される
  - **エラーケースの概要**: 履歴がない状態での適切なUI表示
  - **エラー処理の重要性**: ユーザーに明確なフィードバックを提供
- **入力値**: 履歴が0件の状態
  - **不正な理由**: 通常の使用開始時の初期状態
  - **実際の発生シナリオ**: 新規インストール直後、全削除後
- **期待される結果**: 「履歴がありません」メッセージが表示される
  - **エラーメッセージの内容**: EmptyHistoryWidget表示
  - **システムの安全性**: アプリがクラッシュしない
- **テストの目的**: EDGE-103の検証
  - **品質保証の観点**: 空状態でのユーザビリティ確保
- 🔵 信頼性レベル: 青信号 - EDGE-103に基づく

### TC-E2E-085-009: お気に入り0件の状態で空メッセージ表示 🔵

- **テスト名**: お気に入り0件で「お気に入りがありません」が表示される
  - **エラーケースの概要**: お気に入りがない状態での適切なUI表示
  - **エラー処理の重要性**: ユーザーに明確なフィードバックを提供
- **入力値**: お気に入りが0件の状態
  - **不正な理由**: 通常の使用開始時の初期状態
  - **実際の発生シナリオ**: 新規インストール直後、全削除後
- **期待される結果**: 「お気に入りがありません」メッセージが表示される
  - **エラーメッセージの内容**: EmptyFavoriteWidget表示
  - **システムの安全性**: アプリがクラッシュしない
- **テストの目的**: EDGE-104の検証
  - **品質保証の観点**: 空状態でのユーザビリティ確保
- 🔵 信頼性レベル: 青信号 - EDGE-104に基づく

### TC-E2E-085-010: お気に入り重複登録の防止 🔵

- **テスト名**: 同じ内容は重複してお気に入り登録できない
  - **エラーケースの概要**: 重複データの防止
  - **エラー処理の重要性**: データの一意性確保
- **入力値**: 同じ内容を2回お気に入り登録
  - **不正な理由**: 重複はユーザーの混乱を招く
  - **実際の発生シナリオ**: 同じ履歴を複数回お気に入り登録しようとする
- **期待される結果**: 「既にお気に入りに登録されています」エラーメッセージ
  - **エラーメッセージの内容**: HistoryUIConstants.addToFavoriteDuplicate
  - **システムの安全性**: 2件目は登録されない
- **テストの目的**: 重複防止機能の検証
  - **品質保証の観点**: データ整合性の確保
- 🔵 信頼性レベル: 青信号 - 実装コードに基づく

### TC-E2E-085-011: 削除確認ダイアログでキャンセル → 削除されない 🔵

- **テスト名**: 削除確認でキャンセルすると削除されない
  - **エラーケースの概要**: 誤操作時のキャンセル機能
  - **エラー処理の重要性**: 意図しない削除の防止
- **入力値**: 削除ボタンタップ → 「キャンセル」選択
  - **不正な理由**: ユーザーが削除を中止
  - **実際の発生シナリオ**: 誤って削除ボタンを押した場合
- **期待される結果**: 項目が一覧に残る
  - **エラーメッセージの内容**: ダイアログが閉じるのみ
  - **システムの安全性**: データが保持される
- **テストの目的**: キャンセル機能の検証
  - **品質保証の観点**: 誤操作防止（REQ-5002）
- 🔵 信頼性レベル: 青信号 - REQ-5002に基づく

### TC-E2E-085-012: 履歴全削除確認ダイアログ 🔵

- **テスト名**: 履歴全削除で確認ダイアログが表示される
  - **エラーケースの概要**: 全削除という重大操作の確認
  - **エラー処理の重要性**: 大量データの一括削除防止
- **入力値**: 全削除ボタンタップ → 「削除」選択
  - **不正な理由**: 重大操作には確認が必須
  - **実際の発生シナリオ**: ユーザーが全履歴を削除したい場合
- **期待される結果**: 確認後にすべての履歴が削除される
  - **エラーメッセージの内容**: 「すべての履歴を削除しますか?」
  - **システムの安全性**: 確認なしでは削除されない
- **テストの目的**: 全削除確認機能の検証
  - **品質保証の観点**: 重大操作の保護
- 🔵 信頼性レベル: 青信号 - 実装コードに基づく

---

## 3. 境界値テストケース（最小値、最大値、null等）

### TC-E2E-085-013: 履歴50件制限・自動削除 🔵

- **テスト名**: 履歴51件目追加で最古が自動削除される
  - **境界値の意味**: REQ-602の50件制限
  - **境界値での動作保証**: 50件を超えた場合の自動削除
- **入力値**: 50件の履歴 + 1件追加
  - **境界値選択の根拠**: REQ-602の上限値
  - **実際の使用場面**: 長期間使用後の履歴管理
- **期待される結果**: 最古の履歴が削除され、50件のまま
  - **境界での正確性**: 常に50件以下を維持
  - **一貫した動作**: FIFO方式での削除
- **テストの目的**: REQ-602の検証
  - **堅牢性の確認**: 大量データでも安定動作
- 🔵 信頼性レベル: 青信号 - REQ-602に基づく

### TC-E2E-085-014: 履歴1件の状態で削除 → 0件 🟡

- **テスト名**: 履歴1件削除で空状態になる
  - **境界値の意味**: 最小件数での削除動作
  - **境界値での動作保証**: 1件から0件への遷移
- **入力値**: 履歴1件の状態で削除
  - **境界値選択の根拠**: 境界値の最小値
  - **実際の使用場面**: 最後の履歴を削除
- **期待される結果**: 空メッセージ「履歴がありません」が表示される
  - **境界での正確性**: 正常に空状態に遷移
  - **一貫した動作**: UIが適切に更新される
- **テストの目的**: 最小境界値の検証
  - **堅牢性の確認**: 空状態への遷移が安全
- 🟡 信頼性レベル: 黄信号 - 境界値テストとして推測

### TC-E2E-085-015: お気に入り1件の状態で編集ボタン非表示 🟡

- **テスト名**: お気に入り1件では編集ボタン（並び替え）が非表示
  - **境界値の意味**: 並び替えに必要な最小件数
  - **境界値での動作保証**: 2件以上でのみ編集可能
- **入力値**: お気に入り1件の状態
  - **境界値選択の根拠**: 並び替えには2件以上必要
  - **実際の使用場面**: 1件しか登録していない場合
- **期待される結果**: 編集ボタンが表示されない
  - **境界での正確性**: 不要な機能の非表示
  - **一貫した動作**: 2件以上で表示される
- **テストの目的**: UI表示の境界値検証
  - **堅牢性の確認**: 適切な条件分岐
- 🟡 信頼性レベル: 黄信号 - 実装から推測

---

## 4. パフォーマンステストケース

### TC-E2E-085-016: 履歴50件表示が1秒以内 🔵

- **テスト名**: 履歴50件の一覧表示が1秒以内
  - **何をテストするか**: 履歴一覧画面の表示パフォーマンス
  - **期待される動作**: 画面遷移から表示完了まで1秒以内
- **入力値**: 履歴50件の状態
  - **入力データの意味**: 上限件数でのパフォーマンス
- **期待される結果**: 1秒以内に表示完了
  - **期待結果の理由**: NFR-004の応用
- **テストの目的**: パフォーマンス要件の検証
  - **確認ポイント**: スクロールの滑らかさも確認
- 🔵 信頼性レベル: 青信号 - NFR-004に基づく

### TC-E2E-085-017: 履歴タップから再読み上げ開始が1秒以内 🔵

- **テスト名**: 履歴タップからTTS開始が1秒以内
  - **何をテストするか**: 再読み上げの応答時間
  - **期待される動作**: タップから読み上げ開始まで1秒以内
- **入力値**: 履歴項目をタップ
  - **入力データの意味**: 通常の再読み上げ操作
- **期待される結果**: 1秒以内にTTS開始（停止ボタン表示で確認）
  - **期待結果の理由**: NFR-001に基づく
- **テストの目的**: NFR-001の検証
  - **確認ポイント**: TTS開始までの遅延時間
- 🔵 信頼性レベル: 青信号 - NFR-001に基づく

---

## 5. データ永続化テストケース

### TC-E2E-085-018: 履歴がローカル保存される 🔵

- **テスト名**: アプリ再起動後も履歴が保持される
  - **何をテストするか**: Hiveによるローカルストレージ永続化
  - **期待される動作**: 再起動後も履歴データが保持される
- **入力値**: 履歴追加後にアプリ再起動
  - **入力データの意味**: 永続化の検証
- **期待される結果**: 履歴データが完全に保持される
  - **期待結果の理由**: NFR-101に基づくローカル保存
- **テストの目的**: データ永続化の検証
  - **確認ポイント**: REQ-5003（データ永続化）
- 🔵 信頼性レベル: 青信号 - NFR-101に基づく

### TC-E2E-085-019: お気に入りがローカル保存される 🔵

- **テスト名**: アプリ再起動後もお気に入りが保持される
  - **何をテストするか**: お気に入りの永続化
  - **期待される動作**: 再起動後もお気に入りデータと並び順が保持される
- **入力値**: お気に入り登録・並び順変更後にアプリ再起動
  - **入力データの意味**: 永続化の検証
- **期待される結果**: お気に入りデータと並び順が保持される
  - **期待結果の理由**: NFR-101に基づくローカル保存
- **テストの目的**: データ永続化の検証
  - **確認ポイント**: displayOrderも保持されること
- 🔵 信頼性レベル: 青信号 - NFR-101に基づく

---

## 6. 統合テストケース

### TC-E2E-085-020: 読み上げ→履歴保存→お気に入り登録の一連フロー 🔵

- **テスト名**: 読み上げから履歴保存、お気に入り登録までの統合フロー
  - **何をテストするか**: 機能間の連携が正常に動作すること
  - **期待される動作**: すべてのステップが正常に完了する
- **入力値**:
  1. 文字入力「統合テスト」→ 読み上げ
  2. 履歴画面で確認
  3. お気に入り登録
  4. お気に入り画面で確認
- **期待される結果**: すべてのステップでデータが正確に反映される
  - **期待結果の理由**: 機能間のデータ一貫性
- **テストの目的**: エンドツーエンドの統合検証
  - **確認ポイント**: データの流れ、UI更新の正確性
- 🔵 信頼性レベル: 青信号 - 複数要件の統合確認

### TC-E2E-085-021: お気に入り並び替え後の再読み上げ 🔵

- **テスト名**: 並び替え後もお気に入りから再読み上げが正常動作
  - **何をテストするか**: 並び替え後のデータ整合性
  - **期待される動作**: 並び替え後も各項目が正常に読み上げられる
- **入力値**:
  1. 複数お気に入り登録
  2. 並び順変更
  3. 各項目をタップして読み上げ
- **期待される結果**: すべての項目が正常に読み上げられる
  - **期待結果の理由**: displayOrder更新後のデータ整合性
- **テストの目的**: 並び替え後の動作検証
  - **確認ポイント**: 並び順の永続化、読み上げ機能の継続
- 🔵 信頼性レベル: 青信号 - 機能統合の検証

---

## テストケース要約

| カテゴリ | テストケース数 | 信頼性レベル |
|---------|--------------|-------------|
| 正常系 | 7 | 🔵 7 |
| 異常系 | 5 | 🔵 5 |
| 境界値 | 3 | 🔵 1, 🟡 2 |
| パフォーマンス | 2 | 🔵 2 |
| データ永続化 | 2 | 🔵 2 |
| 統合 | 2 | 🔵 2 |
| **合計** | **21** | **🔵 19, 🟡 2** |

---

## 品質判定

### 判定結果: ✅ 高品質

| 基準 | 状況 |
|------|------|
| テストケース分類 | 正常系・異常系・境界値が網羅 |
| 期待値定義 | 各テストケースの期待値が明確 |
| 技術選択 | Dart + flutter_test + integration_test |
| 実装可能性 | 既存パターン（TASK-0083）を参考に実現可能 |

### 要件カバレッジ

| 要件ID | テストケース |
|--------|------------|
| REQ-601 | TC-E2E-085-001 |
| REQ-602 | TC-E2E-085-013 |
| REQ-603 | TC-E2E-085-002 |
| REQ-701 | TC-E2E-085-003 |
| REQ-702 | TC-E2E-085-004 |
| REQ-703 | TC-E2E-085-005 |
| REQ-704 | TC-E2E-085-007 |
| NFR-001 | TC-E2E-085-017 |
| NFR-004 | TC-E2E-085-016 |
| NFR-101 | TC-E2E-085-018, TC-E2E-085-019 |
| EDGE-103 | TC-E2E-085-008 |
| EDGE-104 | TC-E2E-085-009 |

---

## 次のステップ

次のお勧めステップ: `/tsumiki:tdd-red` でRedフェーズ（失敗テスト作成）を開始します。
