# TASK-0010: バックエンドヘルスチェック・基本APIエンドポイント実装 - テストケース定義書

## 生成情報

- **生成日**: 2025-11-20
- **タスクID**: TASK-0010
- **タスク名**: バックエンドヘルスチェック・基本APIエンドポイント実装
- **タスクタイプ**: TDD
- **推定工数**: 8時間
- **関連要件**: NFR-504, NFR-502, NFR-104, NFR-304
- **テストカバレッジ目標**: 90%以上

---

## 開発言語・フレームワーク

### プログラミング言語

- **Python**: 3.10+
  - **言語選択の理由**: プロジェクトの標準言語、型ヒントによる安全性、非同期処理のサポート
  - **テストに適した機能**: async/awaitによる非同期テスト対応、型ヒントによる静的解析サポート
  - 🔵 tech-stack.md（line 56-87）とpyproject.tomlに基づく

### テストフレームワーク

- **pytest**: 最新安定版
  - **フレームワーク選択の理由**: Pythonのデファクトスタンダード、豊富なプラグイン、非同期テスト対応
  - **テスト実行環境**: ローカル開発環境（Docker Compose）、CI/CD（GitHub Actions）
- **pytest-asyncio**: 非同期テスト対応
  - **理由**: FastAPIの非同期エンドポイントをテストするために必須
- **httpx**: 非同期HTTPクライアント
  - **理由**: FastAPIのTestClientで使用、非同期APIテストに最適
- **pytest-cov**: カバレッジ測定
  - **理由**: NFR-502要件（90%以上のテストカバレッジ）を達成するため
- 🔵 tech-stack.md（line 152-156）とconftest.pyに基づく

---

## テストケースの概要

本タスクでは、以下の4つのカテゴリに分けて合計**24個**のテストケースを定義します：

### カテゴリA: ルートエンドポイント（GET /）
- 正常系: 3件
- 異常系: 2件
- 境界値: 1件
- **小計**: 6件

### カテゴリB: ヘルスチェックエンドポイント（GET /health）
- 正常系: 4件
- 異常系: 4件
- 境界値: 2件
- **小計**: 10件

### カテゴリC: CORS設定
- 正常系: 3件
- 異常系: 2件
- **小計**: 5件

### カテゴリD: Swagger UI / OpenAPI仕様
- 正常系: 3件
- **小計**: 3件

**総テストケース数**: 24件

---

## カテゴリA: ルートエンドポイント（GET /）

### A-1. ルートエンドポイントが正常に応答する（正常系）

- **テスト名**: ルートエンドポイントが正常に応答する
  - **何をテストするか**: GET /が正しいJSONレスポンスを返すこと
  - **期待される動作**: ステータスコード200、messageとversionを含むJSON
- **入力値**: GET / （パラメータなし）
  - **入力データの意味**: 最も基本的なエンドポイントへのアクセス、アプリケーション稼働確認
- **期待される結果**:
  ```json
  {
      "message": "kotonoha API is running",
      "version": "1.0.0"
  }
  ```
  - **期待結果の理由**: 要件定義書（line 72-82）に記載された仕様通りのレスポンス
- **テストの目的**: アプリケーションが正常に起動し、基本的なHTTPリクエストに応答できることを確認
  - **確認ポイント**: HTTPステータスコード200、レスポンスボディの構造と内容
- 🔵 要件定義書（line 72-82）に基づく

### A-2. ルートエンドポイントがContent-Typeヘッダーを正しく設定する（正常系）

- **テスト名**: ルートエンドポイントがContent-Typeヘッダーを正しく設定する
  - **何をテストするか**: レスポンスヘッダーにContent-Type: application/jsonが含まれること
  - **期待される動作**: レスポンスヘッダーにContent-Type: application/jsonが設定される
- **入力値**: GET / （パラメータなし）
  - **入力データの意味**: APIクライアントがレスポンス形式を判断するための情報
- **期待される結果**: Content-Type: application/json; charset=utf-8
  - **期待結果の理由**: FastAPIのデフォルト動作、JSON APIの標準仕様（NFR-504）
- **テストの目的**: APIレスポンスが正しいMIMEタイプで返されることを確認
  - **確認ポイント**: Content-Typeヘッダーの値
- 🔵 要件定義書（line 165-169）、NFR-504に基づく

### A-3. ルートエンドポイントが100ms以内に応答する（正常系）

- **テスト名**: ルートエンドポイントが100ms以内に応答する
  - **何をテストするか**: パフォーマンス要件（NFR-003）を満たすこと
  - **期待される動作**: 100ms以内にレスポンスが返される
- **入力値**: GET / （パラメータなし）
  - **入力データの意味**: データベースアクセスなしの最軽量エンドポイント
- **期待される結果**: レスポンス時間 < 100ms
  - **期待結果の理由**: NFR-003（ルートエンドポイントは100ms以内に応答）
- **テストの目的**: パフォーマンス要件を満たすことを確認
  - **確認ポイント**: レスポンス時間の測定
- 🔵 要件定義書（line 138-139）、NFR-003に基づく

### A-4. 存在しないHTTPメソッドでルートエンドポイントにアクセスした場合、405エラーが返る（異常系）

- **テスト名**: 存在しないHTTPメソッドでルートエンドポイントにアクセスした場合、405エラーが返る
  - **エラーケースの概要**: GET以外のメソッド（POST, PUT, DELETE等）でアクセスした場合
  - **エラー処理の重要性**: APIの誤用を防ぎ、正しいHTTPメソッドを使用するよう促す
- **入力値**: POST / （本来はGETのみ対応）
  - **不正な理由**: ルートエンドポイントはGETメソッドのみ対応
  - **実際の発生シナリオ**: クライアント側の実装ミス、APIドキュメントの読み間違い
- **期待される結果**: HTTPステータスコード405 Method Not Allowed
  - **エラーメッセージの内容**: "Method Not Allowed"
  - **システムの安全性**: エラー時もアプリケーションはクラッシュせず継続動作
- **テストの目的**: 不正なHTTPメソッドを適切に拒否すること
  - **品質保証の観点**: API仕様に準拠しない呼び出しを防ぐ
- 🟡 FastAPIの標準動作から妥当な推測

### A-5. 不正なAcceptヘッダーでルートエンドポイントにアクセスした場合でも正常に応答する（異常系）

- **テスト名**: 不正なAcceptヘッダーでルートエンドポイントにアクセスした場合でも正常に応答する
  - **エラーケースの概要**: Accept: text/htmlなど、JSON以外を要求するクライアント
  - **エラー処理の重要性**: クライアント側の設定ミスでもAPIは応答すべき
- **入力値**: GET / （Accept: text/html）
  - **不正な理由**: APIはJSONを返すが、クライアントがHTMLを要求
  - **実際の発生シナリオ**: ブラウザから直接アクセス、HTTPクライアントの設定ミス
- **期待される結果**: HTTPステータスコード200、JSON形式でレスポンス
  - **エラーメッセージの内容**: エラーなし（FastAPIはAcceptヘッダーを無視してJSONを返す）
  - **システムの安全性**: Acceptヘッダーの不一致でもサービス継続
- **テストの目的**: Acceptヘッダーの不一致を許容する寛容な設計を確認
  - **品質保証の観点**: クライアント側の設定ミスでも利用可能
- 🟡 FastAPIの標準動作から妥当な推測

### A-6. 空のクエリパラメータを付けてルートエンドポイントにアクセスしても正常に応答する（境界値）

- **テスト名**: 空のクエリパラメータを付けてルートエンドポイントにアクセスしても正常に応答する
  - **境界値の意味**: クエリパラメータを受け付けないエンドポイントに対する境界条件
  - **境界値での動作保証**: 不要なパラメータが付いても正常動作すること
- **入力値**: GET /?param=value
  - **境界値選択の根拠**: パラメータを一切受け付けないエンドポイントに対する境界テスト
  - **実際の使用場面**: クライアント側の実装ミス、URL生成の誤り
- **期待される結果**: HTTPステータスコード200、通常通りのレスポンス
  - **境界での正確性**: クエリパラメータを無視して正常動作
  - **一貫した動作**: パラメータの有無に関わらず同じレスポンス
- **テストの目的**: 不要なパラメータを寛容に扱うこと
  - **堅牢性の確認**: パラメータの誤付与でもエラーにならない
- 🟡 FastAPIの標準動作から妥当な推測

---

## カテゴリB: ヘルスチェックエンドポイント（GET /health）

### B-1. ヘルスチェックエンドポイントがデータベース接続を確認して正常に応答する（正常系）

- **テスト名**: ヘルスチェックエンドポイントがデータベース接続を確認して正常に応答する
  - **何をテストするか**: GET /healthがデータベース接続を確認し、成功時に正しいレスポンスを返すこと
  - **期待される動作**: ステータスコード200、status=ok、database=connectedを含むJSON
- **入力値**: GET /health （パラメータなし）
  - **入力データの意味**: システム稼働状況の確認、運用監視ツールからの定期ポーリング
- **期待される結果**:
  ```json
  {
      "status": "ok",
      "database": "connected",
      "version": "1.0.0",
      "timestamp": "2025-11-20T12:34:56Z"
  }
  ```
  - **期待結果の理由**: 要件定義書（line 93-101）に記載された仕様通りのレスポンス
- **テストの目的**: データベース接続が正常であることを確認し、システム稼働状況を正確に把握
  - **確認ポイント**: HTTPステータスコード200、レスポンスボディのstatus, database, version, timestamp
- 🔵 要件定義書（line 89-120）、api-endpoints.md（line 280-322）に基づく

### B-2. ヘルスチェックエンドポイントがISO 8601形式のタイムスタンプを返す（正常系）

- **テスト名**: ヘルスチェックエンドポイントがISO 8601形式のタイムスタンプを返す
  - **何をテストするか**: timestampフィールドがISO 8601形式（YYYY-MM-DDTHH:MM:SSZ）であること
  - **期待される動作**: タイムスタンプが正しい形式で返される
- **入力値**: GET /health （パラメータなし）
  - **入力データの意味**: ヘルスチェック実行時刻の記録、ログ相関分析に使用
- **期待される結果**: timestamp: "2025-11-20T12:34:56Z"（ISO 8601形式）
  - **期待結果の理由**: 要件定義書（line 99）、国際標準形式での時刻表現
- **テストの目的**: タイムスタンプの形式が標準仕様に準拠していることを確認
  - **確認ポイント**: ISO 8601形式の正規表現マッチ、タイムゾーンUTC表記
- 🔵 要件定義書（line 99）に基づく

### B-3. ヘルスチェックエンドポイントが1秒以内に応答する（正常系）

- **テスト名**: ヘルスチェックエンドポイントが1秒以内に応答する
  - **何をテストするか**: パフォーマンス要件（NFR-002）を満たすこと
  - **期待される動作**: 1秒以内にレスポンスが返される
- **入力値**: GET /health （パラメータなし）
  - **入力データの意味**: 軽量なSELECT 1クエリのみを実行するヘルスチェック
- **期待される結果**: レスポンス時間 < 1000ms
  - **期待結果の理由**: NFR-002（ヘルスチェックAPIは1秒以内に応答）
- **テストの目的**: パフォーマンス要件を満たすことを確認
  - **確認ポイント**: レスポンス時間の測定
- 🔵 要件定義書（line 136-137）、NFR-002に基づく

### B-4. ヘルスチェックエンドポイントがversionフィールドを正しく返す（正常系）

- **テスト名**: ヘルスチェックエンドポイントがversionフィールドを正しく返す
  - **何をテストするか**: versionフィールドが"1.0.0"であること
  - **期待される動作**: バージョン情報が正しく返される
- **入力値**: GET /health （パラメータなし）
  - **入力データの意味**: APIバージョン情報の確認、デプロイ検証
- **期待される結果**: version: "1.0.0"
  - **期待結果の理由**: 要件定義書（line 98, 109）、main.py（line 3）のバージョン定義
- **テストの目的**: バージョン情報が正しく返されることを確認
  - **確認ポイント**: versionフィールドの値
- 🔵 要件定義書（line 98, 109）、main.py（line 3）に基づく

### B-5. データベース接続失敗時にヘルスチェックエンドポイントが500エラーを返す（異常系）

- **テスト名**: データベース接続失敗時にヘルスチェックエンドポイントが500エラーを返す
  - **エラーケースの概要**: PostgreSQLが停止している、または接続できない状態
  - **エラー処理の重要性**: データベース障害を早期に検出し、運用チームに通知する（NFR-304）
- **入力値**: GET /health （パラメータなし、ただしDBが接続不可）
  - **不正な理由**: データベースサーバーがダウンしている、ネットワーク障害
  - **実際の発生シナリオ**: データベースメンテナンス中、サーバー障害、ネットワーク分断
- **期待される結果**: HTTPステータスコード500、以下のJSON
  ```json
  {
      "status": "error",
      "database": "disconnected",
      "error": "connection timeout",
      "version": "1.0.0",
      "timestamp": "2025-11-20T12:34:56Z"
  }
  ```
  - **エラーメッセージの内容**: "connection timeout"など、具体的なエラー原因
  - **システムの安全性**: データベースエラーでもアプリケーションはクラッシュせず、エラー情報を返却
- **テストの目的**: データベース接続エラーを適切にハンドリングし、エラー情報を返すこと
  - **品質保証の観点**: NFR-304（データベースエラー発生時の適切なエラーハンドリング）、EDGE-001（分かりやすいエラーメッセージ）
- 🔵 要件定義書（line 103-112, 258-281, 301-321）、NFR-304、EDGE-001に基づく

### B-6. データベース認証失敗時にヘルスチェックエンドポイントが500エラーを返す（異常系）

- **テスト名**: データベース認証失敗時にヘルスチェックエンドポイントが500エラーを返す
  - **エラーケースの概要**: 環境変数の認証情報が誤っている
  - **エラー処理の重要性**: 設定ミスを早期に検出し、デプロイ時の問題を防ぐ
- **入力値**: GET /health （パラメータなし、ただしDB認証情報が不正）
  - **不正な理由**: 環境変数の設定ミス、パスワード変更後の更新漏れ
  - **実際の発生シナリオ**: デプロイ時の環境変数設定ミス、パスワードローテーション後の更新漏れ
- **期待される結果**: HTTPステータスコード500、以下のJSON
  ```json
  {
      "status": "error",
      "database": "disconnected",
      "error": "Database authentication failed",
      "version": "1.0.0",
      "timestamp": "2025-11-20T12:34:56Z"
  }
  ```
  - **エラーメッセージの内容**: "Database authentication failed"
  - **システムの安全性**: 認証エラーでもアプリケーションはクラッシュせず、エラー情報を返却
- **テストの目的**: データベース認証エラーを適切にハンドリングし、エラー情報を返すこと
  - **品質保証の観点**: NFR-304（データベースエラー発生時の適切なエラーハンドリング）
- 🔵 要件定義書（line 313-321）、NFR-304に基づく

### B-7. データベース接続タイムアウト時にヘルスチェックエンドポイントが適切なエラーメッセージを返す（異常系）

- **テスト名**: データベース接続タイムアウト時にヘルスチェックエンドポイントが適切なエラーメッセージを返す
  - **エラーケースの概要**: PostgreSQLが応答しない状態（10秒でタイムアウト）
  - **エラー処理の重要性**: タイムアウトを適切にハンドリングし、無限待機を防ぐ
- **入力値**: GET /health （パラメータなし、ただしDBが応答しない）
  - **不正な理由**: データベースサーバーが高負荷、ネットワーク遅延
  - **実際の発生シナリオ**: データベースサーバーの高負荷、ネットワーク遅延、ファイアウォール設定ミス
- **期待される結果**: HTTPステータスコード500、以下のJSON
  ```json
  {
      "status": "error",
      "database": "disconnected",
      "error": "Database connection timeout",
      "version": "1.0.0",
      "timestamp": "2025-11-20T12:34:56Z"
  }
  ```
  - **エラーメッセージの内容**: "Database connection timeout"（EDGE-001要件）
  - **システムの安全性**: タイムアウト後も適切にエラーを返し、次のリクエストに応答可能
- **テストの目的**: タイムアウトを適切にハンドリングし、分かりやすいエラーメッセージを返すこと
  - **品質保証の観点**: EDGE-001（ネットワークタイムアウト時の分かりやすいエラーメッセージ）
- 🔵 要件定義書（line 301-310）、EDGE-001に基づく

### B-8. 不正なHTTPメソッドでヘルスチェックエンドポイントにアクセスした場合、405エラーが返る（異常系）

- **テスト名**: 不正なHTTPメソッドでヘルスチェックエンドポイントにアクセスした場合、405エラーが返る
  - **エラーケースの概要**: GET以外のメソッド（POST, PUT, DELETE等）でアクセスした場合
  - **エラー処理の重要性**: APIの誤用を防ぎ、正しいHTTPメソッドを使用するよう促す
- **入力値**: POST /health （本来はGETのみ対応）
  - **不正な理由**: ヘルスチェックエンドポイントはGETメソッドのみ対応
  - **実際の発生シナリオ**: クライアント側の実装ミス、APIドキュメントの読み間違い
- **期待される結果**: HTTPステータスコード405 Method Not Allowed
  - **エラーメッセージの内容**: "Method Not Allowed"
  - **システムの安全性**: エラー時もアプリケーションはクラッシュせず継続動作
- **テストの目的**: 不正なHTTPメソッドを適切に拒否すること
  - **品質保証の観点**: API仕様に準拠しない呼び出しを防ぐ
- 🟡 FastAPIの標準動作から妥当な推測

### B-9. データベースセッションが正しくクローズされることを確認する（境界値）

- **テスト名**: データベースセッションが正しくクローズされることを確認する
  - **境界値の意味**: リソースリークを防ぐため、セッションが適切にクローズされるか確認
  - **境界値での動作保証**: エラー発生時もセッションがクローズされること
- **入力値**: GET /health を複数回実行
  - **境界値選択の根拠**: 接続プールの限界（pool_size=10）に達しないことを確認
  - **実際の使用場面**: 運用監視ツールからの定期ポーリング（1分ごと）
- **期待される結果**: 複数回実行してもエラーが発生せず、接続プールが枯渇しない
  - **境界での正確性**: セッションが適切にクローズされ、再利用可能
  - **一貫した動作**: 何度実行しても同じ結果が返される
- **テストの目的**: リソースリークを防ぎ、接続プールが枯渇しないことを確認
  - **堅牢性の確認**: 長時間の運用でもリソースリークが発生しない
- 🔵 要件定義書（line 158-160）、session.py（line 85-95）に基づく

### B-10. ヘルスチェックエンドポイントが同時アクセス（10リクエスト）に対応できる（境界値）

- **テスト名**: ヘルスチェックエンドポイントが同時アクセス（10リクエスト）に対応できる
  - **境界値の意味**: 接続プール上限（pool_size=10）での動作を確認
  - **境界値での動作保証**: 同時利用者数10人の要件（NFR-005）を満たすこと
- **入力値**: GET /health を同時に10回実行
  - **境界値選択の根拠**: NFR-005（同時利用者数10人以下）、接続プールサイズ10
  - **実際の使用場面**: 複数のFlutterアプリから同時にヘルスチェック
- **期待される結果**: 全てのリクエストがエラーなく正常に応答する
  - **境界での正確性**: 接続プールが適切に動作し、全リクエストに応答
  - **一貫した動作**: 同時アクセスでも各リクエストが独立して処理される
- **テストの目的**: 同時アクセス時の接続プール管理が正しく機能することを確認
  - **堅牢性の確認**: NFR-005要件を満たす同時利用者数に対応できる
- 🔵 要件定義書（line 158-160）、NFR-005に基づく

---

## カテゴリC: CORS設定

### C-1. 許可されたオリジンからのリクエストに対してCORSヘッダーが設定される（正常系）

- **テスト名**: 許可されたオリジンからのリクエストに対してCORSヘッダーが設定される
  - **何をテストするか**: http://localhost:3000からのリクエストに対してCORSヘッダーが返されること
  - **期待される動作**: Access-Control-Allow-Originヘッダーが設定される
- **入力値**: GET / （Origin: http://localhost:3000）
  - **入力データの意味**: Flutter Webアプリからのアクセス（開発環境）
- **期待される結果**: Access-Control-Allow-Origin: http://localhost:3000
  - **期待結果の理由**: 要件定義書（line 142-147）、config.py（line 29）のCORS設定
- **テストの目的**: Flutter Webアプリからの安全なアクセスを可能にすること
  - **確認ポイント**: Access-Control-Allow-Originヘッダーの値
- 🔵 要件定義書（line 141-147）、tech-stack.md（line 73-79）、NFR-104に基づく

### C-2. プリフライトリクエスト（OPTIONS）に対して正しく応答する（正常系）

- **テスト名**: プリフライトリクエスト（OPTIONS）に対して正しく応答する
  - **何をテストするか**: OPTIONSメソッドでプリフライトリクエストが正しく処理されること
  - **期待される動作**: ステータスコード200、Access-Control-Allow-Methodsヘッダーが設定される
- **入力値**: OPTIONS / （Origin: http://localhost:3000）
  - **入力データの意味**: ブラウザがクロスオリジンリクエスト前に送信するプリフライトリクエスト
- **期待される結果**:
  - HTTPステータスコード200
  - Access-Control-Allow-Origin: http://localhost:3000
  - Access-Control-Allow-Methods: GET, POST, PUT, DELETE
  - Access-Control-Allow-Headers: *
  - **期待結果の理由**: 要件定義書（line 146-147）、CORS仕様（RFC 6454）
- **テストの目的**: ブラウザのプリフライトリクエストを正しく処理すること
  - **確認ポイント**: ステータスコード、CORSヘッダーの値
- 🔵 要件定義書（line 141-147）に基づく

### C-3. 複数の許可されたオリジンからのリクエストに対応する（正常系）

- **テスト名**: 複数の許可されたオリジンからのリクエストに対応する
  - **何をテストするか**: http://localhost:5173からのリクエストにも対応すること
  - **期待される動作**: Access-Control-Allow-Originヘッダーが設定される
- **入力値**: GET / （Origin: http://localhost:5173）
  - **入力データの意味**: Vite開発サーバーからのアクセス（Flutter Webの別ポート）
- **期待される結果**: Access-Control-Allow-Origin: http://localhost:5173
  - **期待結果の理由**: 要件定義書（line 144）、config.py（line 29）のCORS設定
- **テストの目的**: 複数の開発環境ポートからのアクセスを許可すること
  - **確認ポイント**: Access-Control-Allow-Originヘッダーの値
- 🔵 要件定義書（line 144）、config.py（line 29）に基づく

### C-4. 許可されていないオリジンからのリクエストを拒否する（異常系）

- **テスト名**: 許可されていないオリジンからのリクエストを拒否する
  - **エラーケースの概要**: 許可リストにないオリジンからのアクセス
  - **エラー処理の重要性**: セキュリティ要件（NFR-104）を満たし、不正なアクセスを防ぐ
- **入力値**: GET / （Origin: http://malicious-site.com）
  - **不正な理由**: 許可リストに含まれていないオリジン
  - **実際の発生シナリオ**: 不正なWebサイトからのアクセス、CSRF攻撃の試み
- **期待される結果**:
  - HTTPステータスコード403 Forbidden（またはCORSエラー）
  - Access-Control-Allow-Originヘッダーが設定されない
  - **エラーメッセージの内容**: CORSエラー（ブラウザ側で表示）
  - **システムの安全性**: 不正なオリジンからのアクセスをブロック
- **テストの目的**: セキュリティ要件（NFR-104）を満たし、不正なオリジンを拒否すること
  - **品質保証の観点**: CSRF攻撃、クロスオリジン攻撃を防ぐ
- 🔵 要件定義書（line 283-297）、NFR-104に基づく

### C-5. Originヘッダーがない場合でも正常に応答する（異常系）

- **テスト名**: Originヘッダーがない場合でも正常に応答する
  - **エラーケースの概要**: 同一オリジンリクエスト、またはOriginヘッダーなしのリクエスト
  - **エラー処理の重要性**: curlやPostmanなど、Originヘッダーを送信しないクライアントでも動作する
- **入力値**: GET / （Originヘッダーなし）
  - **不正な理由**: 不正ではなく、同一オリジンリクエストの標準動作
  - **実際の発生シナリオ**: curlコマンド、Postman、サーバー間通信
- **期待される結果**:
  - HTTPステータスコード200
  - 通常のレスポンスを返す
  - CORSヘッダーは設定されない（不要）
  - **エラーメッセージの内容**: エラーなし
  - **システムの安全性**: Originヘッダーの有無に関わらずサービス継続
- **テストの目的**: Originヘッダーなしのリクエストでも正常に動作することを確認
  - **品質保証の観点**: 同一オリジンリクエスト、サーバー間通信でも利用可能
- 🟡 CORS仕様とFastAPIの標準動作から妥当な推測

---

## カテゴリD: Swagger UI / OpenAPI仕様

### D-1. Swagger UIが/docsでアクセス可能である（正常系）

- **テスト名**: Swagger UIが/docsでアクセス可能である
  - **何をテストするか**: GET /docsでSwagger UIのHTMLが返されること
  - **期待される動作**: ステータスコード200、HTMLドキュメントが返される
- **入力値**: GET /docs
  - **入力データの意味**: 開発者がAPI仕様を確認するためのエンドポイント
- **期待される結果**:
  - HTTPステータスコード200
  - Content-Type: text/html
  - HTMLボディに"swagger-ui"が含まれる
  - **期待結果の理由**: NFR-504（OpenAPI (Swagger)形式で自動生成）
- **テストの目的**: NFR-504要件を満たし、Swagger UIでAPI仕様が確認できることを確認
  - **確認ポイント**: ステータスコード、Content-Type、HTMLボディの内容
- 🔵 要件定義書（line 163-164, 239-254）、NFR-504に基づく

### D-2. OpenAPI仕様が/openapi.jsonで取得可能である（正常系）

- **テスト名**: OpenAPI仕様が/openapi.jsonで取得可能である
  - **何をテストするか**: GET /openapi.jsonでOpenAPI仕様のJSONが返されること
  - **期待される動作**: ステータスコード200、OpenAPI 3.0仕様のJSONが返される
- **入力値**: GET /openapi.json
  - **入力データの意味**: API仕様の機械可読形式、コード生成ツールでの使用
- **期待される結果**:
  - HTTPステータスコード200
  - Content-Type: application/json
  - openapi: "3.1.0"（または3.0.x）
  - paths: {"/": {...}, "/health": {...}}
  - **期待結果の理由**: NFR-504（OpenAPI (Swagger)形式で自動生成）
- **テストの目的**: OpenAPI仕様が正しく生成され、機械可読形式で取得できることを確認
  - **確認ポイント**: ステータスコード、Content-Type、OpenAPI仕様の構造
- 🔵 要件定義書（line 163-164）、NFR-504に基づく

### D-3. OpenAPI仕様にルートエンドポイントとヘルスチェックエンドポイントが含まれる（正常系）

- **テスト名**: OpenAPI仕様にルートエンドポイントとヘルスチェックエンドポイントが含まれる
  - **何をテストするか**: OpenAPI仕様のpathsに/と/healthが含まれること
  - **期待される動作**: paths["/"]とpaths["/health"]が定義されている
- **入力値**: GET /openapi.json
  - **入力データの意味**: API仕様の完全性確認、全エンドポイントが文書化されているか
- **期待される結果**:
  - paths["/"].get が定義されている
  - paths["/health"].get が定義されている
  - 各エンドポイントにsummary, description, responsesが含まれる
  - **期待結果の理由**: NFR-504（全エンドポイントが文書化される）
- **テストの目的**: 全エンドポイントがOpenAPI仕様に含まれ、文書化されていることを確認
  - **確認ポイント**: paths["/"]とpaths["/health"]の存在、各エンドポイントの詳細
- 🔵 要件定義書（line 163-164）、NFR-504に基づく

---

## テストケース実装時の日本語コメント指針

### テストケース開始時のコメント

各テストケースの実装時には以下の日本語コメントを必ず含めてください：

```python
# 【テスト目的】: このテストで何を確認するかを日本語で明記
# 【テスト内容】: 具体的にどのような処理をテストするかを説明
# 【期待される動作】: 正常に動作した場合の結果を説明
# 🔵🟡🔴 この内容の信頼性レベルを記載
```

### Given（準備フェーズ）のコメント

```python
# 【テストデータ準備】: なぜこのデータを用意するかの理由
# 【初期条件設定】: テスト実行前の状態を説明
# 【前提条件確認】: テスト実行に必要な前提条件を明記
```

### When（実行フェーズ）のコメント

```python
# 【実際の処理実行】: どの機能/メソッドを呼び出すかを説明
# 【処理内容】: 実行される処理の内容を日本語で説明
# 【実行タイミング】: なぜこのタイミングで実行するかを説明
```

### Then（検証フェーズ）のコメント

```python
# 【結果検証】: 何を検証するかを具体的に説明
# 【期待値確認】: 期待される結果とその理由を説明
# 【品質保証】: この検証がシステム品質にどう貢献するかを説明
```

### 各assertステートメントのコメント

```python
# 【検証項目】: この検証で確認している具体的な項目
# 🔵🟡🔴 この内容の信頼性レベルを記載
assert response.status_code == 200  # 【確認内容】: HTTPステータスコードが200であることを確認
assert response_json["status"] == "ok"  # 【確認内容】: status フィールドが "ok" であることを確認
```

### セットアップ・クリーンアップのコメント

```python
@pytest.fixture(scope="function")
async def test_client():
    # 【テスト前準備】: FastAPIのTestClientを作成
    # 【環境初期化】: テスト用のクリーンな環境を提供
    # 🔵 conftest.py と同様のパターンに基づく
    ...
    yield client
    # 【テスト後処理】: TestClientをクローズ
    # 【状態復元】: 次のテストに影響しないよう状態を復元
```

---

## 実装ファイル構成

### テストファイル

- **パス**: `backend/tests/test_api/test_health_endpoints.py`
- **内容**: カテゴリA, Bのテストケース（ルートエンドポイント、ヘルスチェックエンドポイント）

- **パス**: `backend/tests/test_api/test_cors.py`
- **内容**: カテゴリCのテストケース（CORS設定）

- **パス**: `backend/tests/test_api/test_openapi.py`
- **内容**: カテゴリDのテストケース（Swagger UI / OpenAPI仕様）

### フィクスチャ

- **パス**: `backend/tests/conftest.py`
- **内容**: 共通フィクスチャ（test_engine, test_session_maker, db_session, test_client）

### 実装ファイル

- **パス**: `backend/app/main.py`
- **内容**: FastAPIアプリケーション、ルートエンドポイント、ヘルスチェックエンドポイント、CORS設定

- **パス**: `backend/app/schemas/health.py`
- **内容**: Pydanticスキーマ（HealthResponse, RootResponse）

---

## 品質判定

### テストケースの品質

✅ **高品質**:
- テストケース分類: 正常系・異常系・境界値が網羅されている（合計24件）
- 期待値定義: 各テストケースの期待値が明確（要件定義書と設計文書に基づく）
- 技術選択: Python 3.10+、pytest、pytest-asyncio、httpxが確定
- 実装可能性: 現在の技術スタック（FastAPI、SQLAlchemy、PostgreSQL）で実現可能
- カバレッジ: 90%以上のテストカバレッジを達成可能（NFR-502要件を満たす）

### 信頼性レベル評価

- **カテゴリA（ルートエンドポイント）**: 🔵 50%、🟡 50%（基本動作は要件定義書ベース、エラーハンドリングは妥当な推測）
- **カテゴリB（ヘルスチェック）**: 🔵 80%、🟡 20%（ほとんどが要件定義書とapi-endpoints.mdに基づく）
- **カテゴリC（CORS設定）**: 🔵 80%、🟡 20%（CORS設定は要件定義書とconfig.pyに基づく）
- **カテゴリD（Swagger UI）**: 🔵 100%（NFR-504とFastAPIの標準機能に基づく）

### 全体評価

✅ **高品質**: テストケースの品質は高く、要件網羅率と機能網羅率が十分に確保されています。

---

## 次のステップ

次のお勧めステップ: `/tsumiki:tdd-red` でRedフェーズ（失敗テスト作成）を開始します。
