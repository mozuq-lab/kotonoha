# 180度画面回転機能 テストケース一覧

## TASK-0053: 180度画面回転機能実装

**作成日**: 2025-11-26
**テスト対象**: 180度画面回転機能（Screen Rotation）
**関連要件**: REQ-502, REQ-503
**依存タスク**: TASK-0052 (対面表示モード) - 完了済み
**テストフレームワーク**: flutter_test + mocktail

---

## 開発言語・フレームワーク

- **プログラミング言語**: Dart 3.5+
  - **言語選択の理由**: Flutter プロジェクトの標準言語
  - **テストに適した機能**: null safety、非同期テスト対応
- **テストフレームワーク**: flutter_test + mocktail
  - **フレームワーク選択の理由**: Flutter公式推奨 + 既存プロジェクトでの使用実績
  - **テスト実行環境**: `flutter test` コマンド
- 🔵 青信号: CLAUDE.md の技術スタック定義に基づく

---

## テストケース分類

### 1. FaceToFaceState（状態モデル拡張）テスト

| ID | テスト名 | 優先度 | 信頼性 |
|----|---------|--------|--------|
| TC-053-001 | 初期状態でisRotated180がfalse | P0 | 🔵 |
| TC-053-002 | copyWithでisRotated180を更新できる | P0 | 🔵 |
| TC-053-003 | isRotated180とisEnabledが独立して動作 | P0 | 🔵 |

### 2. FaceToFaceNotifier（状態管理拡張）テスト

| ID | テスト名 | 優先度 | 信頼性 |
|----|---------|--------|--------|
| TC-053-004 | toggleRotationで回転状態がトグルされる | P0 | 🔵 |
| TC-053-005 | enableRotationで回転が有効化される | P0 | 🔵 |
| TC-053-006 | disableRotationで回転が無効化される | P0 | 🔵 |
| TC-053-007 | 回転とテキスト更新が正しく共存する | P1 | 🟡 |

### 3. RotatedWrapper（回転ラッパー）テスト

| ID | テスト名 | 優先度 | 信頼性 |
|----|---------|--------|--------|
| TC-053-008 | isRotated=falseで子ウィジェットをそのまま表示 | P0 | 🔵 |
| TC-053-009 | isRotated=trueでTransform.rotate適用 | P0 | 🔵 |
| TC-053-010 | Transform.rotateの角度がmath.pi（180度） | P0 | 🔵 |
| TC-053-011 | 回転の中心点が画面中央（Alignment.center） | P0 | 🔵 |

### 4. RotationToggleButton（回転ボタン）テスト

| ID | テスト名 | 優先度 | 信頼性 |
|----|---------|--------|--------|
| TC-053-012 | 回転ボタンが表示される | P0 | 🔵 |
| TC-053-013 | ボタンタップで回転状態がトグルされる | P0 | 🔵 |
| TC-053-014 | ボタンのサイズが44px×44px以上 | P0 | 🔵 |
| TC-053-015 | 回転状態に応じてボタンの視覚的フィードバック | P1 | 🟡 |
| TC-053-016 | 回転アイコンが分かりやすい | P1 | 🟡 |

### 5. 対面表示モードとの統合テスト

| ID | テスト名 | 優先度 | 信頼性 |
|----|---------|--------|--------|
| TC-053-017 | 通常モード + 回転OFF = 通常表示 | P0 | 🔵 |
| TC-053-018 | 通常モード + 回転ON = 通常画面180度回転 | P0 | 🔵 |
| TC-053-019 | 対面表示ON + 回転OFF = 拡大表示のみ | P0 | 🔵 |
| TC-053-020 | 対面表示ON + 回転ON = 拡大表示+180度回転 | P0 | 🔵 |
| TC-053-021 | 回転状態で対面表示を切り替えても回転維持 | P1 | 🟡 |
| TC-053-022 | 対面表示状態で回転を切り替えても対面表示維持 | P1 | 🟡 |

### 6. パフォーマンステスト

| ID | テスト名 | 優先度 | 信頼性 |
|----|---------|--------|--------|
| TC-053-023 | 回転応答時間が100ms以内 | P0 | 🟡 |
| TC-053-024 | 回転切り替えがスムーズ（フレーム落ちなし） | P1 | 🟡 |
| TC-053-025 | メモリ使用量が通常動作範囲内 | P1 | 🟡 |

### 7. アクセシビリティテスト

| ID | テスト名 | 優先度 | 信頼性 |
|----|---------|--------|--------|
| TC-053-026 | ライトテーマで回転が正常動作 | P1 | 🔵 |
| TC-053-027 | ダークテーマで回転が正常動作 | P1 | 🔵 |
| TC-053-028 | 高コントラストテーマで回転が正常動作 | P1 | 🔵 |
| TC-053-029 | 回転後もボタンがアクセス可能な位置 | P0 | 🔵 |
| TC-053-030 | Semanticsラベルが設定されている | P1 | 🟡 |

### 8. 境界値テスト

| ID | テスト名 | 優先度 | 信頼性 |
|----|---------|--------|--------|
| TC-053-031 | 高速連続タップでも正常動作（デバウンス） | P1 | 🟡 |
| TC-053-032 | 空文字列でも回転機能が動作 | P1 | 🟡 |
| TC-053-033 | 1000文字のテキストを回転しても正常表示 | P1 | 🔵 |

### 9. エッジケーステスト

| ID | テスト名 | 優先度 | 信頼性 |
|----|---------|--------|--------|
| TC-053-034 | 回転中に新しいテキスト入力しても回転維持 | P1 | 🟡 |
| TC-053-035 | アプリがバックグラウンドから復帰時に回転状態復元 | P1 | 🟡 |
| TC-053-036 | 回転中に文字盤タップしても正常動作 | P0 | 🟡 |
| TC-053-037 | 回転中にTTS読み上げしても正常動作 | P0 | 🟡 |

---

## テストケース詳細

### 1. 正常系テストケース（基本的な回転動作）

#### TC-053-001: 初期状態でisRotated180がfalse 🔵

- **テスト名**: 初期状態でisRotated180がfalse
  - **何をテストするか**: FaceToFaceStateの初期状態（回転フラグ）
  - **期待される動作**: アプリ起動時は回転なし
- **入力値**: なし（デフォルトコンストラクタ）
  - **入力データの意味**: 初期状態の確認
- **期待される結果**: `isRotated180 == false`
  - **期待結果の理由**: 通常表示がデフォルト（REQ-502）
- **テストの目的**: 初期状態の正確性確認
  - **確認ポイント**: デフォルト値が正しいこと
- 🔵 青信号: REQ-502, REQ-503から、デフォルトは通常表示

---

#### TC-053-002: copyWithでisRotated180を更新できる 🔵

- **テスト名**: copyWithでisRotated180を更新できる
  - **何をテストするか**: 状態モデルの不変性（immutability）
  - **期待される動作**: copyWithで新しい状態オブジェクトが生成される
- **入力値**: `state.copyWith(isRotated180: true)`
  - **入力データの意味**: 回転状態の更新
- **期待される結果**: 新しい状態で`isRotated180 == true`、元の状態は変更なし
  - **期待結果の理由**: Riverpod StateNotifierパターン
- **テストの目的**: 状態管理の正確性確認
  - **確認ポイント**: 不変性が保たれること
- 🔵 青信号: 設計文書のFaceToFaceState定義に基づく

---

#### TC-053-003: isRotated180とisEnabledが独立して動作 🔵

- **テスト名**: isRotated180とisEnabledが独立して動作
  - **何をテストするか**: 回転フラグと対面表示フラグの独立性
  - **期待される動作**: 2つのフラグが互いに影響しない
- **入力値**:
  - `state.copyWith(isRotated180: true, isEnabled: false)`
  - `state.copyWith(isRotated180: false, isEnabled: true)`
- **期待される結果**: 各フラグが独立して設定可能
  - **期待結果の理由**: REQ-502「対面表示モードと独立して利用可能」
- **テストの目的**: 独立動作の確認
  - **確認ポイント**: 4つの組み合わせすべてが可能
- 🔵 青信号: 要件定義書「対面表示モードと独立して動作」

---

#### TC-053-004: toggleRotationで回転状態がトグルされる 🔵

- **テスト名**: toggleRotationで回転状態がトグルされる
  - **何をテストするか**: 回転トグル機能
  - **期待される動作**: false→true→false と切り替わる
- **入力値**: `notifier.toggleRotation()`を2回呼び出し
  - **入力データの意味**: ユーザーが回転ボタンを繰り返しタップ
- **期待される結果**:
  - 初期: `isRotated180 == false`
  - 1回目: `isRotated180 == true`
  - 2回目: `isRotated180 == false`
- **テストの目的**: トグル機能の確認
  - **確認ポイント**: 正確なON/OFF切り替え
- 🔵 青信号: 要件定義書「再度タップで元に戻る」

---

#### TC-053-005: enableRotationで回転が有効化される 🔵

- **テスト名**: enableRotationで回転が有効化される
  - **何をテストするか**: 回転有効化メソッド
  - **期待される動作**: isRotated180がtrueになる
- **入力値**: `notifier.enableRotation()`
  - **入力データの意味**: 回転を明示的に有効化
- **期待される結果**: `state.isRotated180 == true`
  - **期待結果の理由**: メソッド名の意味通り
- **テストの目的**: 有効化メソッドの確認
  - **確認ポイント**: 確実にtrueになること
- 🔵 青信号: 設計文書のFaceToFaceNotifier定義に基づく

---

#### TC-053-006: disableRotationで回転が無効化される 🔵

- **テスト名**: disableRotationで回転が無効化される
  - **何をテストするか**: 回転無効化メソッド
  - **期待される動作**: isRotated180がfalseになる
- **入力値**:
  - 前提: `notifier.enableRotation()`で有効化
  - 実行: `notifier.disableRotation()`
- **期待される結果**: `state.isRotated180 == false`
  - **期待結果の理由**: メソッド名の意味通り
- **テストの目的**: 無効化メソッドの確認
  - **確認ポイント**: 確実にfalseになること
- 🔵 青信号: 設計文書のFaceToFaceNotifier定義に基づく

---

#### TC-053-009: isRotated=trueでTransform.rotate適用 🔵

- **テスト名**: isRotated=trueでTransform.rotate適用
  - **何をテストするか**: RotatedWrapperの回転処理
  - **期待される動作**: Transform.rotateウィジェットが適用される
- **入力値**:
  ```dart
  RotatedWrapper(
    isRotated: true,
    child: Text('テスト'),
  )
  ```
- **期待される結果**: Transform.rotateウィジェットが存在し、角度がmath.pi
  - **期待結果の理由**: 要件定義書のTransform.rotate()仕様
- **テストの目的**: 回転実装の確認
  - **確認ポイント**: 正しいTransformが適用されること
- 🔵 青信号: 要件定義書の技術的実装詳細に基づく

---

#### TC-053-010: Transform.rotateの角度がmath.pi（180度） 🔵

- **テスト名**: Transform.rotateの角度がmath.pi（180度）
  - **何をテストするか**: 回転角度の正確性
  - **期待される動作**: 180度（πラジアン）で回転
- **入力値**: `RotatedWrapper(isRotated: true, child: ...)`
  - **入力データの意味**: 回転有効時の角度確認
- **期待される結果**: `Transform.rotate`の`angle`パラメータが`math.pi`
  - **期待結果の理由**: REQ-502「180度回転」
- **テストの目的**: 角度の正確性確認
  - **確認ポイント**: 正確に180度であること
- 🔵 青信号: REQ-502「画面を180度回転」

---

#### TC-053-011: 回転の中心点が画面中央（Alignment.center） 🔵

- **テスト名**: 回転の中心点が画面中央
  - **何をテストするか**: 回転の軸（中心点）
  - **期待される動作**: 画面中央を軸に回転
- **入力値**: `RotatedWrapper(isRotated: true, child: ...)`
  - **入力データの意味**: 回転軸の確認
- **期待される結果**: `Transform.rotate`の`alignment`が`Alignment.center`
  - **期待結果の理由**: 要件定義書「回転の中心点は画面の中心」
- **テストの目的**: 回転軸の正確性確認
  - **確認ポイント**: 自然な回転動作
- 🔵 青信号: 要件定義書のUI/UX要件に基づく

---

#### TC-053-013: ボタンタップで回転状態がトグルされる 🔵

- **テスト名**: ボタンタップで回転状態がトグルされる
  - **何をテストするか**: 回転ボタンの機能
  - **期待される動作**: タップで回転ON/OFF切り替え
- **入力値**: 回転ボタンのタップイベント
  - **入力データの意味**: ユーザーが回転切り替えしたい場合
- **期待される結果**: タップごとに`isRotated180`がトグルされる
  - **期待結果の理由**: REQ-503「シンプルな操作で切り替え」
- **テストの目的**: 切り替え機能の確認
  - **確認ポイント**: 1タップで切り替わること
- 🔵 青信号: REQ-503に基づく

---

#### TC-053-014: ボタンのサイズが44px×44px以上 🔵

- **テスト名**: 回転ボタンのサイズが44px×44px以上
  - **何をテストするか**: アクセシビリティ要件の遵守
  - **期待される動作**: ボタンのタップ領域が十分なサイズ
- **入力値**: なし
  - **入力データの意味**: UI表示の確認
- **期待される結果**: ボタンサイズが44px×44px以上（推奨60px×60px）
  - **期待結果の理由**: REQ-5001「タップターゲット44px×44px以上」
- **テストの目的**: アクセシビリティ確認
  - **確認ポイント**: 運動機能に制約のあるユーザーでも操作可能
- 🔵 青信号: REQ-5001に基づく

---

#### TC-053-029: 回転後もボタンがアクセス可能な位置 🔵

- **テスト名**: 回転後もボタンがアクセス可能な位置
  - **何をテストするか**: 回転後の操作性
  - **期待される動作**: 回転後も回転ボタンや他の操作ボタンにアクセス可能
- **入力値**: 回転状態 = ON
  - **入力データの意味**: 回転後のUI配置確認
- **期待される結果**: ボタンが画面内に表示され、タップ可能
  - **期待結果の理由**: 要件定義書「回転後もアクセス可能な位置」
- **テストの目的**: 回転後の操作性確認
  - **確認ポイント**: ユーザーが元に戻せること
- 🔵 青信号: 要件定義書のUI/UX要件、完了条件に基づく

---

### 2. 異常系テストケース（エラーハンドリング）

#### TC-053-007: 回転とテキスト更新が正しく共存する 🟡

- **テスト名**: 回転とテキスト更新が正しく共存する
  - **エラーケースの概要**: 回転状態でテキストを更新した場合
  - **エラー処理の重要性**: 回転中のテキスト変更でクラッシュしない
- **入力値**:
  1. `enableRotation()`で回転有効化
  2. `updateText("新しいテキスト")`でテキスト更新
- **期待される結果**: 回転状態を維持しつつ、テキストが更新される
  - **エラーメッセージの内容**: なし（正常動作）
  - **システムの安全性**: 状態の整合性維持
- **テストの目的**: 複数状態の共存確認
  - **品質保証の観点**: 複雑な状態管理でもクラッシュしない
- 🟡 黄信号: EDGE-103「操作中のテキスト変更」パターンから推測

---

### 3. 境界値テストケース（最小値、最大値、エッジケース）

#### TC-053-031: 高速連続タップでも正常動作（デバウンス） 🟡

- **テスト名**: 高速連続タップでも正常動作
  - **境界値の意味**: 連続タップ（連打）への対応
  - **境界値での動作保証**: 連打してもクラッシュしない
- **入力値**: 回転ボタンを0.1秒間隔で10回タップ
  - **境界値選択の根拠**: 実際のユーザーが連打する可能性
  - **実際の使用場面**: 誤タップや連続操作
- **期待される結果**: 正確にトグルされる（10回 → 偶数回 → false）
  - **境界での正確性**: 状態の整合性維持
  - **一貫した動作**: デバウンス処理で保護
- **テストの目的**: 連打対策の確認
  - **堅牢性の確認**: 高速操作でも安定動作
- 🟡 黄信号: 要件定義書「高速連続タップ」エッジケースから推測

---

#### TC-053-032: 空文字列でも回転機能が動作 🟡

- **テスト名**: 空文字列でも回転機能が動作
  - **境界値の意味**: 表示内容が空の状態での回転
  - **境界値での動作保証**: テキストの有無に依存しない
- **入力値**: `displayText = ""`, `isRotated180 = true`
  - **境界値選択の根拠**: 回転は表示内容と独立
  - **実際の使用場面**: テキスト入力前に回転を試す
- **期待される結果**: 回転状態が正常に適用される
  - **境界での正確性**: 空でも機能する
  - **一貫した動作**: テキストの有無で動作が変わらない
- **テストの目的**: 独立性の確認
  - **堅牢性の確認**: 空状態でも安定動作
- 🟡 黄信号: 回転の独立性から推測

---

#### TC-053-033: 1000文字のテキストを回転しても正常表示 🔵

- **テスト名**: 1000文字のテキストを回転しても正常表示
  - **境界値の意味**: 最大文字数での回転
  - **境界値での動作保証**: 長文でもパフォーマンス低下なし
- **入力値**: `displayText = 'あ' * 1000`, `isRotated180 = true`
  - **境界値選択の根拠**: EDGE-101の1000文字制限
  - **実際の使用場面**: ユーザーが長文を入力後に回転
- **期待される結果**: 1000文字が180度回転して正常表示
  - **境界での正確性**: 全文字が回転表示
  - **一貫した動作**: 短文と同じ動作
- **テストの目的**: 長文対応の確認
  - **堅牢性の確認**: 最大長でも安定動作
- 🔵 青信号: EDGE-101に基づく

---

### 4. アクセシビリティテストケース

#### TC-053-026: ライトテーマで回転が正常動作 🔵

- **テスト名**: ライトテーマで回転が正常動作
  - **何をテストするか**: テーマ対応（ライト）
  - **期待される動作**: ライトテーマで回転が視認可能
- **入力値**: テーマ = ライト、回転 = ON
  - **入力データの意味**: ライトテーマでの表示確認
- **期待される結果**: 回転後もテキストとUIが正常表示
  - **期待結果の理由**: REQ-5002「3種類のテーマ対応」
- **テストの目的**: テーマ対応の確認
  - **確認ポイント**: ライトテーマで視認性確保
- 🔵 青信号: REQ-5002に基づく

---

#### TC-053-027: ダークテーマで回転が正常動作 🔵

- **テスト名**: ダークテーマで回転が正常動作
  - **何をテストするか**: テーマ対応（ダーク）
  - **期待される動作**: ダークテーマで回転が視認可能
- **入力値**: テーマ = ダーク、回転 = ON
  - **入力データの意味**: ダークテーマでの表示確認
- **期待される結果**: 回転後もテキストとUIが正常表示
  - **期待結果の理由**: REQ-5002「3種類のテーマ対応」
- **テストの目的**: テーマ対応の確認
  - **確認ポイント**: ダークテーマで視認性確保
- 🔵 青信号: REQ-5002に基づく

---

#### TC-053-028: 高コントラストテーマで回転が正常動作 🔵

- **テスト名**: 高コントラストテーマで回転が正常動作
  - **何をテストするか**: テーマ対応（高コントラスト）
  - **期待される動作**: 高コントラストテーマで回転が視認可能
- **入力値**: テーマ = 高コントラスト、回転 = ON
  - **入力データの意味**: 高コントラストテーマでの表示確認
- **期待される結果**: 回転後もテキストとUIが正常表示、コントラスト比4.5:1以上
  - **期待結果の理由**: REQ-5006「WCAG 2.1 AA準拠」
- **テストの目的**: アクセシビリティ確認
  - **確認ポイント**: 視認性が最も高い状態で正常動作
- 🔵 青信号: REQ-5006に基づく

---

#### TC-053-015: 回転状態に応じてボタンの視覚的フィードバック 🟡

- **テスト名**: 回転状態に応じてボタンの視覚的フィードバック
  - **何をテストするか**: ボタンの状態表示
  - **期待される動作**: 回転ON時とOFF時でボタンの見た目が変わる
- **入力値**: 回転状態 = ON / OFF
  - **入力データの意味**: 現在の状態を視覚的に表示
- **期待される結果**: 色やアイコンの変化で状態が分かる
  - **期待結果の理由**: 要件定義書「回転状態が分かるUI」
- **テストの目的**: 視覚的フィードバックの確認
  - **確認ポイント**: ユーザーが現在の状態を理解できる
- 🟡 黄信号: UI/UX要件から推測

---

#### TC-053-016: 回転アイコンが分かりやすい 🟡

- **テスト名**: 回転アイコンが分かりやすい
  - **何をテストするか**: アイコンの適切性
  - **期待される動作**: 回転を示す明確なアイコン表示
- **入力値**: なし
  - **入力データの意味**: アイコンデザインの確認
- **期待される結果**: 回転を連想させるアイコン（例: Icons.screen_rotation）
  - **期待結果の理由**: 要件定義書「明確なアイコン」
- **テストの目的**: ユーザビリティ確認
  - **確認ポイント**: 直感的に理解できるアイコン
- 🟡 黄信号: アクセシビリティ要件から推測

---

#### TC-053-030: Semanticsラベルが設定されている 🟡

- **テスト名**: Semanticsラベルが設定されている
  - **何をテストするか**: アクセシビリティ（スクリーンリーダー対応）
  - **期待される動作**: 回転ボタンにSemanticsラベルが設定される
- **入力値**: なし
  - **入力データの意味**: Semanticsツリーの確認
- **期待される結果**: "画面を180度回転"などのラベルが存在
  - **期待結果の理由**: アクセシビリティベストプラクティス
- **テストの目的**: スクリーンリーダー対応確認
  - **確認ポイント**: 視覚障害のあるユーザーでも利用可能
- 🟡 黄信号: アクセシビリティベストプラクティスから推測

---

### 5. 統合テストケース（対面表示との組み合わせ）

#### TC-053-017: 通常モード + 回転OFF = 通常表示 🔵

- **テスト名**: 通常モード + 回転OFF = 通常表示
  - **何をテストするか**: デフォルト状態
  - **期待される動作**: 何も変更されていない通常表示
- **入力値**: `isEnabled = false`, `isRotated180 = false`
  - **入力データの意味**: 初期状態
- **期待される結果**: 通常の入力画面が表示される
  - **期待結果の理由**: デフォルト動作
- **テストの目的**: 初期状態の確認
  - **確認ポイント**: 何もしない状態が正常
- 🔵 青信号: 要件定義書の組み合わせパターン

---

#### TC-053-018: 通常モード + 回転ON = 通常画面180度回転 🔵

- **テスト名**: 通常モード + 回転ON = 通常画面180度回転
  - **何をテストするか**: 通常画面の回転
  - **期待される動作**: 入力画面全体が180度回転
- **入力値**: `isEnabled = false`, `isRotated180 = true`
  - **入力データの意味**: 対面表示なしで回転のみ
- **期待される結果**: 通常画面が180度回転して表示される
  - **期待結果の理由**: ユースケース1「通常モードで180度回転」
- **テストの目的**: 回転単独動作の確認
  - **確認ポイント**: 対面表示なしでも回転可能
- 🔵 青信号: 要件定義書の使用例に基づく

---

#### TC-053-019: 対面表示ON + 回転OFF = 拡大表示のみ 🔵

- **テスト名**: 対面表示ON + 回転OFF = 拡大表示のみ
  - **何をテストするか**: 対面表示単独動作
  - **期待される動作**: テキストが拡大表示される（回転なし）
- **入力値**: `isEnabled = true`, `isRotated180 = false`
  - **入力データの意味**: 対面表示のみ、回転なし
- **期待される結果**: 対面表示画面（拡大）が通常向きで表示
  - **期待結果の理由**: TASK-0052の基本機能
- **テストの目的**: 対面表示単独動作の確認
  - **確認ポイント**: 回転なしでも対面表示可能
- 🔵 青信号: 要件定義書の組み合わせパターン

---

#### TC-053-020: 対面表示ON + 回転ON = 拡大表示+180度回転 🔵

- **テスト名**: 対面表示ON + 回転ON = 拡大表示+180度回転
  - **何をテストするか**: 対面表示と回転の組み合わせ
  - **期待される動作**: 拡大表示されたテキストが180度回転
- **入力値**: `isEnabled = true`, `isRotated180 = true`
  - **入力データの意味**: 両方の機能を有効化
- **期待される結果**: 対面表示画面が180度回転して表示される
  - **期待結果の理由**: ユースケース2「対面表示 + 180度回転」
- **テストの目的**: 統合動作の確認
  - **確認ポイント**: 2つの機能が正しく組み合わさる
- 🔵 青信号: 要件定義書の使用例に基づく

---

#### TC-053-021: 回転状態で対面表示を切り替えても回転維持 🟡

- **テスト名**: 回転状態で対面表示を切り替えても回転維持
  - **何をテストするか**: 独立性（回転 → 対面表示切り替え）
  - **期待される動作**: 回転状態が保持される
- **入力値**:
  1. 回転ON
  2. 対面表示をON→OFF→ON切り替え
- **期待される結果**: 対面表示切り替え後も回転状態が維持される
  - **期待結果の理由**: REQ-502「独立して利用可能」
- **テストの目的**: 独立性の確認
  - **確認ポイント**: 一方の変更が他方に影響しない
- 🟡 黄信号: 要件定義書の独立性要件から推測

---

#### TC-053-022: 対面表示状態で回転を切り替えても対面表示維持 🟡

- **テスト名**: 対面表示状態で回転を切り替えても対面表示維持
  - **何をテストするか**: 独立性（対面表示 → 回転切り替え）
  - **期待される動作**: 対面表示状態が保持される
- **入力値**:
  1. 対面表示ON
  2. 回転をON→OFF→ON切り替え
- **期待される結果**: 回転切り替え後も対面表示状態が維持される
  - **期待結果の理由**: REQ-502「独立して利用可能」
- **テストの目的**: 独立性の確認
  - **確認ポイント**: 一方の変更が他方に影響しない
- 🟡 黄信号: 要件定義書の独立性要件から推測

---

### 6. パフォーマンステストケース

#### TC-053-023: 回転応答時間が100ms以内 🟡

- **テスト名**: 回転応答時間が100ms以内
  - **何をテストするか**: パフォーマンス要件の遵守
  - **期待される動作**: ボタンタップから回転完了まで100ms以内
- **入力値**: 回転ボタンタップ
  - **入力データの意味**: ユーザーの操作応答性
- **期待される結果**: タップから回転UI更新まで100ms以内
  - **期待結果の理由**: NFR-003「文字盤タップ応答100ms以内」から推測
- **テストの目的**: 応答性の確認
  - **確認ポイント**: ユーザーが待たされない
- 🟡 黄信号: NFR-003から推測（要件定義書では明示）

---

#### TC-053-024: 回転切り替えがスムーズ（フレーム落ちなし） 🟡

- **テスト名**: 回転切り替えがスムーズ
  - **何をテストするか**: アニメーション品質
  - **期待される動作**: 60fps以上でスムーズな回転
- **入力値**: 回転ボタンタップ（アニメーション有効時）
  - **入力データの意味**: UI品質の確認
- **期待される結果**: フレームドロップが発生しない
  - **期待結果の理由**: 要件定義書「スムーズな遷移」
- **テストの目的**: UI品質の確認
  - **確認ポイント**: 視覚的に滑らか
- 🟡 黄信号: パフォーマンス要件から推測

---

#### TC-053-025: メモリ使用量が通常動作範囲内 🟡

- **テスト名**: メモリ使用量が通常動作範囲内
  - **何をテストするか**: メモリリーク防止
  - **期待される動作**: 回転機能で追加メモリ消費が最小限
- **入力値**: 回転ON/OFF切り替えを100回繰り返し
  - **入力データの意味**: 長時間使用時のメモリ安定性
- **期待される結果**: メモリ使用量が通常動作範囲内（増加し続けない）
  - **期待結果の理由**: NFR-301「基本機能の継続性」
- **テストの目的**: 安定性の確認
  - **確認ポイント**: メモリリークがない
- 🟡 黄信号: 非機能要件から推測

---

### 7. エッジケーステストケース

#### TC-053-034: 回転中に新しいテキスト入力しても回転維持 🟡

- **テスト名**: 回転中に新しいテキスト入力しても回転維持
  - **エッジケースの概要**: 回転状態でユーザーが入力を続ける
  - **エッジケースの重要性**: 実際の使用シナリオ
- **入力値**:
  1. 回転ON
  2. 文字盤で新しい文字を入力
- **期待される結果**: 回転状態を維持しつつ、入力が反映される
  - **期待結果の理由**: 要件定義書「回転中に新しい入力」
- **テストの目的**: 実用性の確認
  - **確認ポイント**: 回転中も通常通り操作可能
- 🟡 黄信号: 要件定義書のエッジケースから推測

---

#### TC-053-035: アプリがバックグラウンドから復帰時に回転状態復元 🟡

- **テスト名**: バックグラウンド復帰時に回転状態復元
  - **エッジケースの概要**: アプリのライフサイクル
  - **エッジケースの重要性**: ユーザー体験の一貫性
- **入力値**:
  1. 回転ON
  2. アプリをバックグラウンドに移動
  3. アプリをフォアグラウンドに復帰
- **期待される結果**: 復帰後も回転状態が維持される
  - **期待結果の理由**: EDGE-201「画面状態の復元」
- **テストの目的**: 状態復元の確認
  - **確認ポイント**: ユーザーが再設定する必要がない
- 🟡 黄信号: EDGE-201から推測（要件定義書では明示）

---

#### TC-053-036: 回転中に文字盤タップしても正常動作 🟡

- **テスト名**: 回転中に文字盤タップしても正常動作
  - **エッジケースの概要**: 回転状態での基本機能使用
  - **エッジケースの重要性**: 基本機能の継続性
- **入力値**:
  1. 回転ON
  2. 文字盤の文字をタップ
- **期待される結果**: 文字が正常に入力される（回転状態維持）
  - **期待結果の理由**: 要件定義書「回転後も全ての操作が正常動作」
- **テストの目的**: 基本機能の確認
  - **確認ポイント**: 回転中も文字入力可能
- 🟡 黄信号: 完了条件から推測

---

#### TC-053-037: 回転中にTTS読み上げしても正常動作 🟡

- **テスト名**: 回転中にTTS読み上げしても正常動作
  - **エッジケースの概要**: 回転状態での基本機能使用（TTS）
  - **エッジケースの重要性**: 基本機能の継続性
- **入力値**:
  1. 回転ON
  2. TTS読み上げボタンをタップ
- **期待される結果**: TTSが正常に読み上げられる（回転状態維持）
  - **期待結果の理由**: 要件定義書「回転後も全ての操作が正常動作」
- **テストの目的**: 基本機能の確認
  - **確認ポイント**: 回転中もTTS機能可能
- 🟡 黄信号: 完了条件から推測

---

### 8. ウィジェットテストケース（UI表示）

#### TC-053-008: isRotated=falseで子ウィジェットをそのまま表示 🔵

- **テスト名**: isRotated=falseで子ウィジェットをそのまま表示
  - **何をテストするか**: RotatedWrapperの通常時動作
  - **期待される動作**: 回転なしの場合、Transformが適用されない
- **入力値**:
  ```dart
  RotatedWrapper(
    isRotated: false,
    child: Text('テスト'),
  )
  ```
- **期待される結果**: Text('テスト')がそのまま表示される（Transform.rotateなし）
  - **期待結果の理由**: パフォーマンス最適化（不要なTransform回避）
- **テストの目的**: 通常時のパフォーマンス確認
  - **確認ポイント**: 回転OFF時はオーバーヘッドなし
- 🔵 青信号: 要件定義書のRotatedWrapper実装仕様に基づく

---

#### TC-053-012: 回転ボタンが表示される 🔵

- **テスト名**: 回転ボタンが表示される
  - **何をテストするか**: RotationToggleButtonの表示
  - **期待される動作**: ボタンウィジェットが画面に表示される
- **入力値**: なし
  - **入力データの意味**: UI表示の確認
- **期待される結果**: RotationToggleButtonウィジェットが存在
  - **期待結果の理由**: 基本的なUI要件
- **テストの目的**: UI実装の確認
  - **確認ポイント**: ボタンが可視状態
- 🔵 青信号: 要件定義書のRotationToggleButton定義に基づく

---

## テストファイル構成

```
test/features/face_to_face/
├── domain/
│   └── models/
│       └── face_to_face_state_test.dart           # TC-053-001〜003
├── presentation/
│   ├── screens/
│   │   └── face_to_face_screen_test.dart          # TC-053-017〜022（統合）
│   └── widgets/
│       ├── rotation_toggle_button_test.dart       # TC-053-012〜016
│       └── rotated_wrapper_test.dart              # TC-053-008〜011
└── providers/
    └── face_to_face_provider_test.dart            # TC-053-004〜007, 026〜028, 030〜037
```

**注**: TASK-0053はTASK-0052の拡張なので、既存のテストファイルに追加テストを加える形になります。

---

## 品質判定

### 判定結果: ✅ 高品質

| 基準 | 状態 |
|------|------|
| テストケース分類 | 正常系・異常系・境界値・アクセシビリティ・統合が網羅されている |
| 期待値定義 | 各テストケースの期待値が明確 |
| 技術選択 | Dart + flutter_test + mocktail（確定） |
| 実装可能性 | TASK-0052の拡張として実現可能 |

### 信頼性レベルサマリー

- 🔵 青信号（確実）: 22件（59%）
  - REQ-502, REQ-503, REQ-5001, REQ-5006に基づくテスト
  - 要件定義書で明確に定義された機能
- 🟡 黄信号（妥当な推測）: 15件（41%）
  - エッジケース、パフォーマンス要件、一部のアクセシビリティ
  - NFR-003等の非機能要件から推測

### テストケース総数

- **合計**: 37件
- **P0（必須）**: 19件
- **P1（高優先度）**: 18件

---

## テスト実行計画

### Phase 1: 基本機能テスト（P0）
1. 状態管理テスト（TC-053-001〜006）
2. RotatedWrapperテスト（TC-053-008〜011）
3. ボタン基本機能テスト（TC-053-012〜014）
4. アクセシビリティ基本テスト（TC-053-029）

### Phase 2: 統合テスト（P0）
1. 対面表示との組み合わせテスト（TC-053-017〜020）

### Phase 3: アクセシビリティ・境界値テスト（P1）
1. テーマ対応テスト（TC-053-026〜028）
2. 境界値テスト（TC-053-031〜033）
3. 視覚的フィードバック（TC-053-015〜016）

### Phase 4: エッジケース・パフォーマンステスト（P1）
1. パフォーマンステスト（TC-053-023〜025）
2. エッジケース（TC-053-034〜037）
3. 独立性テスト（TC-053-021〜022）

---

## 次のステップ

`/tsumiki:tdd-red` でRedフェーズ（失敗テスト作成）を開始します。
