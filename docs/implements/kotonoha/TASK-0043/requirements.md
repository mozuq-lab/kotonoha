# TASK-0043: 「はい」「いいえ」「わからない」大ボタン実装 - 要件定義書

## 概要

ユーザーが質問に対して即座に回答できるよう、「はい」「いいえ」「わからない」の3つの大ボタンを画面上部に常時表示する機能を実装する。

**タスクタイプ**: TDD
**推定工数**: 8時間

## 関連要件

### 直接関連要件

| 要件ID | 要件内容 | 信頼性 |
|--------|----------|--------|
| REQ-201 | システムは「はい」「いいえ」「わからない」の3つの大ボタンを画面上部に常時表示しなければならない | 🔵 |
| REQ-204 | システムは大ボタンおよび状態ボタンのタップ時に即座に読み上げを実行しなければならない | 🟡 |
| NFR-202 | システムはボタン・タップ領域を視認性が高く押しやすいサイズ（推奨60px × 60px以上）で設計しなければならない | 🟡 |

### 間接関連要件

| 要件ID | 要件内容 | 信頼性 |
|--------|----------|--------|
| REQ-5001 | システムはタップターゲット（ボタン・キー）のサイズを44px × 44px以上としなければならない | 🟡 |
| REQ-5005 | システムはタップ主体の操作で完結し、スワイプ等のジェスチャーへの依存を避けなければならない | 🔵 |
| NFR-001 | システムはTTS読み上げ開始までの時間を1秒以内としなければならない | 🟡 |
| REQ-803 | システムは「ライトモード」「ダークモード」「高コントラストモード」の3つのテーマを提供しなければならない | 🔵 |
| REQ-801 | システムはフォントサイズを「小」「中」「大」の3段階から選択できなければならない | 🔵 |

## 機能要件（EARS記法）

### 通常要件（SHALL）

#### FR-001: 大ボタン3種類の表示
- **要件**: システムは「はい」「いいえ」「わからない」の3つのボタンを表示しなければならない
- **根拠**: REQ-201
- **信頼性**: 🔵 青信号

#### FR-002: 画面上部への常時配置
- **要件**: システムは大ボタンをホーム画面（文字盤画面）の上部に常時表示しなければならない
- **根拠**: REQ-201、NFR-203（主要機能を1画面でアクセス可能）
- **信頼性**: 🔵 青信号

#### FR-003: タップターゲットサイズの保証
- **要件**: システムは各大ボタンの高さを推奨60px以上、最小44px以上としなければならない
- **根拠**: REQ-5001、NFR-202
- **信頼性**: 🔵 青信号

#### FR-004: 横幅の適切な設計
- **要件**: システムは各大ボタンの横幅を、3つのボタンが画面幅に収まりかつ視認性を確保できるサイズ（最小100px推奨）としなければならない
- **根拠**: NFR-202、NFR-203
- **信頼性**: 🟡 黄信号

#### FR-005: ボタン間の適切な間隔
- **要件**: システムは大ボタン間に8px以上の間隔を設けなければならない
- **根拠**: 誤タップ防止、NFR-202
- **信頼性**: 🟡 黄信号

#### FR-006: 視認性の高いラベル表示
- **要件**: システムは各ボタンに「はい」「いいえ」「わからない」のラベルを明確に表示しなければならない
- **根拠**: REQ-201、アクセシビリティ要件
- **信頼性**: 🔵 青信号

#### FR-007: フォントサイズ設定への追従
- **要件**: システムは大ボタンのラベルフォントサイズをフォントサイズ設定（小/中/大）に追従させなければならない
- **根拠**: REQ-802
- **信頼性**: 🔵 青信号

### 条件付き要件（WHEN/IF-THEN）

#### FR-101: タップ時の即座読み上げ
- **条件**: ユーザーが大ボタンをタップした場合
- **動作**: システムは即座に（1秒以内に）ボタンのラベルテキストをTTSで読み上げなければならない
- **根拠**: REQ-204、NFR-001
- **信頼性**: 🔵 青信号

#### FR-102: 視覚的フィードバック
- **条件**: ユーザーが大ボタンをタップした場合
- **動作**: システムはタップ時に視覚的フィードバック（色変化、リップルエフェクト等）を提供しなければならない
- **根拠**: UX標準、アクセシビリティ
- **信頼性**: 🟡 黄信号

#### FR-103: テーマ変更時の配色追従
- **条件**: ユーザーがテーマ（ライト/ダーク/高コントラスト）を変更した場合
- **動作**: システムは大ボタンの配色を即座に変更後のテーマに追従させなければならない
- **根拠**: REQ-803、REQ-2008
- **信頼性**: 🔵 青信号

#### FR-104: 画面回転時のレイアウト維持
- **条件**: デバイスが縦向き/横向きに回転した場合
- **動作**: システムは大ボタンの視認性とタップ可能性を維持した状態でレイアウトを調整しなければならない
- **根拠**: NFR-403
- **信頼性**: 🟡 黄信号

### 制約要件（MUST）

#### FR-201: 最小タップターゲット保証
- **要件**: 大ボタンのタップ領域は、いかなる場合も44px × 44px未満にしてはならない
- **根拠**: REQ-5001、WCAG 2.1 AA
- **信頼性**: 🔵 青信号

#### FR-202: 高コントラストモードでのコントラスト比
- **要件**: 高コントラストモードにおいて、大ボタンのラベルと背景のコントラスト比は4.5:1以上でなければならない
- **根拠**: REQ-5006、WCAG 2.1 AA
- **信頼性**: 🔵 青信号

#### FR-203: タップ操作のみでの完結
- **要件**: 大ボタンの操作はタップのみで完結し、スワイプやロングプレスを必須としてはならない
- **根拠**: REQ-5005
- **信頼性**: 🔵 青信号

## 非機能要件

### パフォーマンス

| 要件ID | 内容 | 根拠 |
|--------|------|------|
| NFR-P001 | タップから読み上げ開始まで1秒以内 | NFR-001 |
| NFR-P002 | タップからの視覚フィードバックは100ms以内 | NFR-003 |

### ユーザビリティ

| 要件ID | 内容 | 根拠 |
|--------|------|------|
| NFR-U001 | ボタン配置は一目で理解できる設計 | NFR-203 |
| NFR-U002 | 「はい」「いいえ」「わからない」の配置順序は直感的（左から肯定→否定→中立） | UX標準 |
| NFR-U003 | 各ボタンの色分けは意味を反映（例: はい=青/緑系、いいえ=赤系、わからない=グレー系） | アクセシビリティ |

### アクセシビリティ

| 要件ID | 内容 | 根拠 |
|--------|------|------|
| NFR-A001 | 色覚多様性に配慮し、色だけでなくラベルテキストで識別可能 | WCAG |
| NFR-A002 | ボタン間隔は誤タップを防ぐ十分な余白を確保 | NFR-202 |

## エッジケース・境界値

### エッジケース

#### EDGE-001: TTS読み上げ中のボタン再タップ
- **状況**: ユーザーがTTS読み上げ中に別の大ボタンをタップした場合
- **期待動作**: システムは現在の読み上げを中断し、新しいボタンのラベルを読み上げる
- **信頼性**: 🟡 黄信号

#### EDGE-002: 音量ゼロ状態でのタップ
- **状況**: デバイス音量がゼロ（ミュート）の状態で大ボタンをタップした場合
- **期待動作**: システムは視覚的フィードバックを提供し、可能であれば音量警告を表示する
- **根拠**: EDGE-202
- **信頼性**: 🟡 黄信号

#### EDGE-003: TTSサービス未初期化/エラー時
- **状況**: TTSサービスが利用不可または初期化未完了の状態でタップした場合
- **期待動作**: システムは視覚的フィードバックのみ提供し、エラー時はエラーメッセージを表示する
- **信頼性**: 🟡 黄信号

#### EDGE-004: 連続タップ
- **状況**: ユーザーが同じボタンを短時間に連続タップした場合
- **期待動作**: システムは最初のタップのみを処理し、読み上げ完了まで後続タップを無視する（デバウンス）
- **信頼性**: 🟡 黄信号

#### EDGE-005: 超小画面での表示
- **状況**: 画面幅が狭い端末（スマートフォン等）で表示した場合
- **期待動作**: システムはボタンサイズを最小44pxまで縮小するが、それ以下にはしない
- **信頼性**: 🟡 黄信号

### 境界値

| 項目 | 最小値 | 推奨値 | 最大値 |
|------|--------|--------|--------|
| ボタン高さ | 44px | 60px | 制限なし |
| ボタン幅 | 100px | 画面幅の30% | 制限なし |
| ボタン間隔 | 8px | 12px | 16px |
| フォントサイズ（小） | 14px | 16px | - |
| フォントサイズ（中） | 18px | 20px | - |
| フォントサイズ（大） | 22px | 24px | - |

## 受け入れ基準

### 機能テスト

- [ ] AC-001: 「はい」「いいえ」「わからない」の3つのボタンが表示される
- [ ] AC-002: ボタンがホーム画面の上部に配置されている
- [ ] AC-003: 各ボタンの高さが60px以上である
- [ ] AC-004: 各ボタンの幅が100px以上である
- [ ] AC-005: ボタン間に8px以上の間隔がある
- [ ] AC-006: 各ボタンのラベルが正しく表示されている
- [ ] AC-007: 「はい」ボタンタップで「はい」と読み上げられる
- [ ] AC-008: 「いいえ」ボタンタップで「いいえ」と読み上げられる
- [ ] AC-009: 「わからない」ボタンタップで「わからない」と読み上げられる
- [ ] AC-010: タップから読み上げ開始まで1秒以内である

### テーマ対応テスト

- [ ] AC-011: ライトモードで適切な配色で表示される
- [ ] AC-012: ダークモードで適切な配色で表示される
- [ ] AC-013: 高コントラストモードで4.5:1以上のコントラスト比を確保している

### フォントサイズ対応テスト

- [ ] AC-014: フォントサイズ「小」でラベルが適切なサイズで表示される
- [ ] AC-015: フォントサイズ「中」でラベルが適切なサイズで表示される
- [ ] AC-016: フォントサイズ「大」でラベルが適切なサイズで表示される

### エッジケーステスト

- [ ] AC-017: 連続タップ時にデバウンスが機能する
- [ ] AC-018: 画面回転時にレイアウトが崩れない
- [ ] AC-019: 縦向き・横向きの両方で最小タップターゲットが確保されている

## 技術仕様

### 使用コンポーネント

- `LargeButton` ウィジェット（既存、`shared/widgets/large_button.dart`）
- `AppSizes` 定数（既存、`core/constants/app_sizes.dart`）
- `AppColors` 定数（既存、`core/constants/app_colors.dart`）

### 新規作成ウィジェット

| ウィジェット名 | 説明 |
|----------------|------|
| `QuickResponseButtons` | 「はい」「いいえ」「わからない」の3ボタンを横並びで表示するコンテナウィジェット |
| `QuickResponseButton` | 個々のクイック応答ボタン（LargeButtonを拡張、TTS読み上げ機能付き） |

### データ構造

```dart
/// クイック応答ボタンの種類
enum QuickResponseType {
  yes,     // 「はい」
  no,      // 「いいえ」
  unknown, // 「わからない」
}

/// クイック応答ボタンのラベル定義
const quickResponseLabels = {
  QuickResponseType.yes: 'はい',
  QuickResponseType.no: 'いいえ',
  QuickResponseType.unknown: 'わからない',
};
```

### 配置・レイアウト

```
+--------------------------------------------------+
|  [  はい  ]   [  いいえ  ]   [ わからない ]       |  <- QuickResponseButtons
+--------------------------------------------------+
|                                                  |
|              （文字盤エリア）                      |
|                                                  |
+--------------------------------------------------+
```

## 依存関係

### 依存するタスク（完了済み）

- TASK-0037: 五十音文字盤UI実装 ✅
- TASK-0016: テーマ実装（ライト・ダーク・高コントラスト） ✅
- TASK-0017: 共通UIコンポーネント実装 ✅

### 後続タスクへの影響

- TASK-0044: 状態ボタン実装（「痛い」「トイレ」等） - TASK-0043に依存
- TASK-0045: TTS読み上げ機能実装 - QuickResponseButtonでのTTS呼び出しパターンを参考にする

## 備考

- 信頼性レベル凡例:
  - 🔵 **青信号**: 要件定義書に明確に記載された要件
  - 🟡 **黄信号**: 要件定義書から妥当に推測される要件
  - 🔴 **赤信号**: 要件定義書にない推測による要件

---

**ドキュメント作成日**: 2025-11-23
**タスクID**: TASK-0043
**関連要件**: REQ-201, REQ-204, NFR-202
