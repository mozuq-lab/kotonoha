# TDD要件定義書 - TASK-0040: 定型文一覧UI実装

## タスク情報

| 項目 | 内容 |
|------|------|
| **タスクID** | TASK-0040 |
| **タスク名** | 定型文一覧UI実装 |
| **タスクタイプ** | TDD |
| **フェーズ** | Phase 3 - Week 9, Day 4 |
| **推定工数** | 8時間 |
| **関連要件** | REQ-101, REQ-105, REQ-106, NFR-004 |
| **依存タスク** | TASK-0016 (テーマ), TASK-0037 (五十音文字盤UI) |

---

## 1. 機能の概要

### 1.1 機能説明 🔵

定型文一覧UIは、ユーザーが登録・管理する定型文をリスト形式で表示し、タップ操作で素早く選択できる機能を提供する。

- **目的**: 発話困難なユーザーが頻繁に使用するフレーズを素早く選択・発話できるようにする
- **ユーザーストーリー**: 「利用者として、よく使うフレーズ（挨拶・要望など）を事前に登録しておき、ワンタップで読み上げたい」
- **システム内位置づけ**: メイン画面の定型文タブに配置、文字盤UIと並列表示

### 1.2 参照EARS要件 🔵

| 要件ID | 要件内容 | 信頼性 |
|--------|----------|--------|
| REQ-101 | システムは定型文を一覧表示しなければならない | 🔵 |
| REQ-105 | システムはお気に入り定型文を一覧上部に優先表示しなければならない | 🔵 |
| REQ-106 | システムは定型文を2-3種類のシンプルなカテゴリ（「日常」「体調」「その他」など）で分類しなければならない | 🔵 |
| NFR-004 | システムは定型文一覧の表示（100件程度）を1秒以内に完了しなければならない | 🟡 |

---

## 2. 入力・出力の仕様

### 2.1 入力パラメータ 🔵

| パラメータ | 型 | 制約 | 説明 |
|------------|------|------|------|
| phrases | `List<PresetPhrase>` | 0〜500件 | 表示対象の定型文リスト |
| selectedCategory | `PresetCategory?` | null可 | フィルタリング用カテゴリ（null=全て表示） |
| onPhraseSelected | `Function(PresetPhrase)` | 必須 | 定型文タップ時のコールバック |
| onFavoriteToggle | `Function(PresetPhrase)?` | 任意 | お気に入り切り替え時のコールバック |

### 2.2 出力（UI表示） 🔵

| 要素 | 説明 |
|------|------|
| お気に入りセクション | お気に入り定型文をリスト上部に表示 |
| カテゴリセクション | 「日常」「体調」「その他」のカテゴリごとに分類表示 |
| 定型文アイテム | 各定型文を44px以上のタップターゲットで表示 |
| 空状態メッセージ | 定型文が0件の場合「定型文がありません」と表示 |

### 2.3 データフロー 🔵

```
[ローカルストレージ(Hive)]
        ↓ 読み込み
[PresetPhraseProvider (Riverpod)]
        ↓ 状態管理
[PhraseListWidget]
        ↓ 表示
[ユーザー操作]
        ↓ onPhraseSelected
[入力欄に反映 or 即座に読み上げ]
```

---

## 3. 制約条件

### 3.1 パフォーマンス要件 🟡

| 制約 | 値 | 根拠 |
|------|-----|------|
| 100件表示時間 | 1秒以内 | NFR-004 |
| リスト描画方式 | `ListView.builder` | 仮想化スクロールで大量データ対応 |
| 初回ロード | キャッシュ優先 | Riverpodキャッシュ活用 |

### 3.2 アクセシビリティ要件 🔵

| 制約 | 値 | 根拠 |
|------|-----|------|
| タップターゲット | 44px × 44px 以上 | REQ-5001 |
| 推奨タップターゲット | 60px以上 | NFR-202 |
| フォントサイズ対応 | 小/中/大の3段階 | REQ-801, REQ-802 |
| テーマ対応 | ライト/ダーク/高コントラスト | REQ-803 |

### 3.3 UI制約 🔵

| 制約 | 説明 | 根拠 |
|------|------|------|
| タップ主体操作 | スワイプジェスチャーに依存しない | REQ-5005 |
| カテゴリ数 | 3種類固定（日常/体調/その他） | REQ-106 |
| 空カテゴリ | 非表示またはメッセージ表示 | EDGE-204 |

---

## 4. 想定される使用例

### 4.1 正常系 🔵

#### UC-001: 定型文一覧表示
1. ユーザーが定型文タブを開く
2. システムがローカルストレージから定型文を読み込む
3. お気に入り定型文が上部に表示される
4. カテゴリ別に定型文が分類表示される

#### UC-002: 定型文選択
1. ユーザーが定型文をタップ
2. onPhraseSelectedコールバックが発火
3. 選択された定型文が入力欄に反映される（または即座に読み上げ）

#### UC-003: お気に入り優先表示
1. システムがお気に入りフラグ付き定型文を抽出
2. お気に入りセクションをリスト最上部に表示
3. 残りの定型文をカテゴリ別に表示

### 4.2 エッジケース 🟡

#### UC-004: 定型文が0件
1. ユーザーが定型文タブを開く
2. 定型文が登録されていない
3. システムが「定型文がありません」と表示（EDGE-104類似）

#### UC-005: カテゴリが空
1. 特定のカテゴリに定型文がない
2. システムがそのカテゴリを非表示にする（EDGE-204）

#### UC-006: 大量データ（100件以上）
1. 100件以上の定型文が登録されている
2. システムがListView.builderで仮想化スクロール
3. 1秒以内に初期表示が完了する（NFR-004）

---

## 5. 受け入れ基準

### 5.1 機能要件の受け入れ基準 🔵

| ID | 基準 | 検証方法 |
|----|------|----------|
| AC-001 | 定型文が一覧表示される | UIテスト |
| AC-002 | お気に入り定型文がリスト上部に表示される | UIテスト |
| AC-003 | 定型文がカテゴリ別に分類表示される | UIテスト |
| AC-004 | 定型文タップでonPhraseSelectedが発火する | ウィジェットテスト |
| AC-005 | 0件の場合「定型文がありません」と表示される | UIテスト |
| AC-006 | 空カテゴリは非表示になる | UIテスト |

### 5.2 非機能要件の受け入れ基準 🟡

| ID | 基準 | 検証方法 |
|----|------|----------|
| AC-007 | 100件の定型文を1秒以内に表示できる | パフォーマンステスト |
| AC-008 | タップターゲットが44px以上である | ウィジェットテスト |
| AC-009 | テーマ切り替えで表示が適切に変わる | UIテスト |
| AC-010 | フォントサイズ設定が反映される | UIテスト |

---

## 6. 技術設計

### 6.1 実装ウィジェット構成 🟡

```dart
// 定型文一覧ウィジェット
lib/features/preset_phrase/presentation/widgets/
├── phrase_list_widget.dart       // メインリストウィジェット
├── phrase_list_item.dart         // 各定型文アイテム
├── phrase_category_section.dart  // カテゴリセクションヘッダー
├── phrase_empty_state.dart       // 空状態表示
└── widgets.dart                  // バレルファイル
```

### 6.2 依存関係 🔵

| 依存 | 用途 |
|------|------|
| PresetPhrase モデル | データ構造（既存） |
| AppSizes | サイズ定数（既存） |
| テーマ（TASK-0016） | テーマ対応表示（完了済み） |
| flutter_riverpod | 状態管理 |

### 6.3 既存モデル参照 🔵

```dart
// lib/shared/models/preset_phrase.dart
class PresetPhrase extends HiveObject {
  final String id;
  final String content;
  final String category;  // 'daily', 'health', 'other'
  final bool isFavorite;
  final int displayOrder;
  final DateTime createdAt;
  final DateTime updatedAt;
}
```

---

## 7. EARS要件・設計文書との対応関係

### 7.1 参照要件一覧

| 種別 | 要件ID |
|------|--------|
| 機能要件 | REQ-101, REQ-105, REQ-106 |
| 非機能要件 | NFR-004, NFR-201, NFR-202 |
| 制約要件 | REQ-5001, REQ-5005 |
| アクセシビリティ | REQ-801, REQ-802, REQ-803 |
| エッジケース | EDGE-104, EDGE-204 |

### 7.2 参照設計文書

| 文書 | 該当セクション |
|------|----------------|
| interfaces.dart | PresetPhrase, PresetCategory |
| dataflow.md | 定型文管理フロー |
| architecture.md | Presentation Layer - Widgets |

---

## 8. 品質判定

### 判定結果: ✅ 高品質

| 項目 | 状態 |
|------|------|
| 要件の曖昧さ | なし |
| 入出力定義 | 完全 |
| 制約条件 | 明確 |
| 実装可能性 | 確実 |

---

## 9. 次のステップ

次のお勧めステップ: `/tsumiki:tdd-testcases` でテストケースの洗い出しを行います。
