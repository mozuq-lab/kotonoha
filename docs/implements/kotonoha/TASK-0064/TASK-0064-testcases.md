# TASK-0064: お気に入り一覧UI実装 - テストケース定義書

## テストケース洗い出し完了日
2025-11-28

## 概要
お気に入り一覧画面（FavoritesScreen）のテストケース定義書。要件定義書（TASK-0064-requirements.md）に基づき、すべての機能要件・非機能要件・エッジケースを網羅的にテストするためのテストケース一覧を定義します。

## テスト戦略
- **TDDアプローチ**: Red-Green-Refactorサイクルで実装
- **カバレッジ目標**: 全体80%以上、ビジネスロジック90%以上
- **テストレベル**: 単体テスト、ウィジェットテスト、統合テスト
- **参考実装**: `frontend/kotonoha_app/test/features/history/`（履歴機能のテスト構造を参考）

## 信頼性レベル凡例
- 🔵 **青信号**: 要件定義書・受け入れ基準に基づく確実なテスト
- 🟡 **黄信号**: 要件定義書から妥当な推測によるテスト
- 🔴 **赤信号**: 要件定義書にない推測によるテスト

---

## 1. お気に入り一覧表示テスト（FavoritesScreen）

### 1.1 正常系テスト - お気に入り一覧表示

#### TC-064-001: お気に入り一覧がdisplayOrder昇順に正しく表示される 🔵
**優先度**: P0 必須
**関連要件**: FR-064-001, FR-064-011, AC-064-001, AC-064-005
**テスト目的**: お気に入り一覧がdisplayOrder昇順（小さい順）に正しく表示される
**テスト内容**:
- **GIVEN**: displayOrderが2, 0, 1の3件のお気に入りが存在する状態
- **WHEN**: お気に入り画面を開く
- **THEN**:
  - displayOrder昇順（0 → 1 → 2）に表示される
  - 最も小さいdisplayOrderの項目がリスト上部に表示される
  - すべてのお気に入りが表示される

**検証内容**:
- お気に入りの表示順序が正しい
- ListView内のウィジェット順序が正しい

---

#### TC-064-002: 各お気に入り項目に日時・内容が表示される 🔵
**優先度**: P0 必須
**関連要件**: FR-064-002, NFR-064-006, AC-064-001
**テスト目的**: 日時フォーマットと内容表示の正確性確認
**テスト内容**:
- **GIVEN**: 特定日時（2024/11/28 14:30）のお気に入りが存在する
- **WHEN**: お気に入り画面を開く
- **THEN**:
  - お気に入りのテキスト内容が表示される
  - 日時が「11/28 14:30」形式で表示される

**検証内容**:
- テキスト内容が正しく表示される
- 日時フォーマット「MM/DD HH:mm」が正しい

---

#### TC-064-003: お気に入り項目が視認性の高いカード形式で表示される 🔵
**優先度**: P0 必須
**関連要件**: FR-064-003, NFR-064-005
**テスト目的**: カード形式のUI実装確認
**テスト内容**:
- **GIVEN**: お気に入りが1件存在する
- **WHEN**: お気に入り画面を開く
- **THEN**:
  - お気に入り項目がカード形式で表示される
  - カード間に適切な余白がある

**検証内容**:
- Cardウィジェットが使用されている
- 視覚的な区別が可能

---

#### TC-064-004: スクロール可能なリスト表示 🔵
**優先度**: P0 必須
**関連要件**: FR-064-005
**テスト目的**: スクロール機能の確認
**テスト内容**:
- **GIVEN**: 20件のお気に入りが存在する
- **WHEN**: お気に入り画面を開く
- **THEN**:
  - ListViewまたはReorderableListViewが使用されている
  - スクロール可能である

**検証内容**:
- ListView/ReorderableListViewの存在確認
- スクロール動作の確認

---

### 1.2 空状態テスト

#### TC-064-005: お気に入り0件で空状態メッセージ表示 🔵
**優先度**: P0 必須
**関連要件**: FR-064-004, AC-064-002, EDGE-064-004
**テスト目的**: 空状態の適切な表示確認
**テスト内容**:
- **GIVEN**: お気に入りが0件の状態
- **WHEN**: お気に入り画面を開く
- **THEN**:
  - 「お気に入りがありません」メッセージが画面中央に表示される
  - 「履歴や定型文からお気に入りを登録できます」などのヒントが表示される
  - 削除ボタンが非表示になる

**検証内容**:
- EmptyFavoriteWidgetが表示される
- メッセージテキストの確認
- 削除ボタン（全削除、個別削除）が非表示

---

### 1.3 再読み上げ機能テスト

#### TC-064-006: お気に入り項目タップで即座に読み上げが開始される 🔵
**優先度**: P0 必須
**関連要件**: FR-064-006, FR-064-013, AC-064-003, NFR-064-002
**テスト目的**: タップインタラクションとTTS連携の確認
**テスト内容**:
- **GIVEN**: お気に入り「こんにちは」が存在する
- **WHEN**: お気に入り項目をタップする
- **THEN**:
  - TTSプロバイダーのspeakメソッドが「こんにちは」で呼び出される
  - 読み上げ開始まで1秒以内である（NFR-064-002）

**検証内容**:
- ttsProvider.speak()が1回呼び出される
- 引数が正しいテキスト内容である

---

#### TC-064-007: 読み上げ中に「読み上げ中」インジケーターが表示される 🟡
**優先度**: P1 重要
**関連要件**: FR-064-017
**テスト目的**: 読み上げ中の視覚的フィードバック確認
**テスト内容**:
- **GIVEN**: お気に入りが存在し、TTS読み上げ中の状態
- **WHEN**: お気に入り画面を表示する
- **THEN**:
  - 該当お気に入り項目に「読み上げ中」インジケーターが表示される

**検証内容**:
- TTSState.speakingの状態でインジケーターが表示される
- 視覚的なフィードバック（アイコン、色変化など）

---

#### TC-064-008: 読み上げ中に別のお気に入り項目をタップすると現在の読み上げを停止し新しい項目の読み上げを開始する 🟡
**優先度**: P1 重要
**関連要件**: EDGE-064-008
**テスト目的**: 複数読み上げの排他制御確認
**テスト内容**:
- **GIVEN**: お気に入り項目A, Bが存在し、Aを読み上げ中
- **WHEN**: Bをタップする
- **THEN**:
  - ttsProvider.stop()が呼び出される
  - ttsProvider.speak(B.content)が呼び出される

**検証内容**:
- stop()が1回、speak()が1回呼び出される
- 新しいテキストで読み上げが開始される

---

### 1.4 削除機能テスト

#### TC-064-009: 個別削除ボタンをタップすると確認ダイアログが表示される 🔵
**優先度**: P0 必須
**関連要件**: FR-064-007, FR-064-008, FR-064-014, AC-064-004
**テスト目的**: 誤操作防止のための確認ダイアログ表示確認
**テスト内容**:
- **GIVEN**: お気に入りが存在する
- **WHEN**: 削除ボタンをタップする
- **THEN**:
  - AlertDialogが表示される
  - 「このお気に入りを削除しますか？」メッセージが表示される
  - 「削除」ボタンが表示される
  - 「キャンセル」ボタンが表示される

**検証内容**:
- AlertDialog表示の確認
- メッセージテキストの確認
- ボタンの存在確認

---

#### TC-064-010: 削除確認ダイアログで「削除」を選択すると該当お気に入りが削除される 🔵
**優先度**: P0 必須
**関連要件**: FR-064-014, AC-064-004, NFR-064-003
**テスト目的**: 削除機能の動作確認
**テスト内容**:
- **GIVEN**: お気に入り「こんにちは」が存在する
- **WHEN**: 削除ボタンをタップし、確認ダイアログで「削除」を選択する
- **THEN**:
  - favoriteProvider.deleteFavorite()が呼び出される
  - 削除後、一覧から該当項目が消える
  - UI更新が即座（100ms以内）に反映される（NFR-064-003）

**検証内容**:
- deleteFavorite()が1回呼び出される
- UI上から項目が削除される
- パフォーマンス（100ms以内）

---

#### TC-064-011: 削除確認ダイアログで「キャンセル」を選択すると削除されない 🔵
**優先度**: P0 必須
**関連要件**: FR-064-014
**テスト目的**: キャンセル時の誤操作防止確認
**テスト内容**:
- **GIVEN**: お気に入りが存在する
- **WHEN**: 削除ボタンをタップし、確認ダイアログで「キャンセル」を選択する
- **THEN**:
  - ダイアログが閉じる
  - お気に入りは削除されない
  - favoriteProvider.deleteFavorite()が呼び出されない

**検証内容**:
- ダイアログが閉じる
- 項目が残っている
- deleteFavorite()が呼び出されていない

---

#### TC-064-012: 削除確認ダイアログ外をタップしてもダイアログが閉じない 🔵
**優先度**: P0 必須
**関連要件**: FR-064-008, REQ-5002
**テスト目的**: 誤操作防止（barrierDismissible: false）
**テスト内容**:
- **GIVEN**: 削除確認ダイアログが表示されている
- **WHEN**: ダイアログ外（バリア部分）をタップする
- **THEN**:
  - ダイアログが閉じない
  - ダイアログが引き続き表示される

**検証内容**:
- barrierDismissible: falseの確認
- ダイアログが残っている

---

#### TC-064-013: 全削除ボタンが表示される 🟡
**優先度**: P1 重要
**関連要件**: FR-064-009
**テスト目的**: 全削除ボタンの表示条件確認
**テスト内容**:
- **GIVEN**: お気に入りが1件以上存在する
- **WHEN**: お気に入り画面を開く
- **THEN**:
  - AppBarのアクションエリアに全削除ボタン（Icons.delete_sweep等）が表示される

**検証内容**:
- AppBar内の全削除ボタンアイコンの存在確認

---

#### TC-064-014: 全削除ボタンをタップすると確認ダイアログが表示される 🟡
**優先度**: P1 重要
**関連要件**: FR-064-010, FR-064-015, AC-064-009
**テスト目的**: 全削除確認ダイアログの表示確認
**テスト内容**:
- **GIVEN**: お気に入りが複数件存在する
- **WHEN**: 全削除ボタンをタップする
- **THEN**:
  - AlertDialogが表示される
  - 「すべてのお気に入りを削除しますか？」メッセージが表示される
  - 「削除」ボタンが表示される
  - 「キャンセル」ボタンが表示される

**検証内容**:
- AlertDialog表示の確認
- メッセージテキストの確認
- ボタンの存在確認

---

#### TC-064-015: 全削除確認ダイアログで「削除」を選択するとすべてのお気に入りが削除される 🟡
**優先度**: P1 重要
**関連要件**: FR-064-015, AC-064-009
**テスト目的**: 全削除機能の動作確認
**テスト内容**:
- **GIVEN**: お気に入りが5件存在する
- **WHEN**: 全削除ボタンをタップし、確認ダイアログで「削除」を選択する
- **THEN**:
  - favoriteProvider.deleteAllFavorites()が呼び出される
  - すべてのお気に入りが削除される
  - 空状態メッセージ「お気に入りがありません」が表示される

**検証内容**:
- deleteAllFavorites()が1回呼び出される
- 空状態ウィジェットが表示される

---

#### TC-064-016: 空状態では削除ボタンが非表示になる 🔵
**優先度**: P0 必須
**関連要件**: FR-064-016, AC-064-002
**テスト目的**: 空状態時のUI制御確認
**テスト内容**:
- **GIVEN**: お気に入りが0件の状態
- **WHEN**: お気に入り画面を開く
- **THEN**:
  - 全削除ボタンが非表示になる
  - 個別削除ボタンが表示されない

**検証内容**:
- 削除ボタンが見つからない（findsNothing）

---

### 1.5 パフォーマンステスト

#### TC-064-017: 100件のお気に入りを1秒以内に表示できる 🔵
**優先度**: P0 必須
**関連要件**: NFR-064-001, AC-064-006
**テスト目的**: 表示パフォーマンス要件の確認
**テスト内容**:
- **GIVEN**: お気に入りが100件存在する
- **WHEN**: お気に入り画面を開く（初回ロード時）
- **THEN**:
  - 表示完了までの時間が1秒以内
  - すべてのお気に入りがスクロール可能

**検証内容**:
- Stopwatchで表示時間を計測
- 1000ms以内の完了を確認

---

#### TC-064-018: お気に入り項目削除のUI反映が100ms以内 🟡
**優先度**: P1 重要
**関連要件**: NFR-064-003
**テスト目的**: 削除操作のレスポンス性確認
**テスト内容**:
- **GIVEN**: お気に入りが存在する
- **WHEN**: 削除ボタンをタップし、確認ダイアログで削除を実行する
- **THEN**:
  - UI上から項目が即座に削除される（100ms以内）

**検証内容**:
- Stopwatchで削除反映時間を計測
- 100ms以内の完了を確認

---

### 1.6 アクセシビリティテスト

#### TC-064-019: お気に入り項目のタップターゲットが44px以上 🔵
**優先度**: P0 必須
**関連要件**: NFR-064-005, AC-064-007
**テスト目的**: アクセシビリティ要件のタップターゲットサイズ確認
**テスト内容**:
- **GIVEN**: お気に入りが存在する
- **WHEN**: お気に入り画面を開く
- **THEN**:
  - お気に入り項目カードの高さが44px以上
  - 推奨サイズ60px以上が望ましい

**検証内容**:
- tester.getSize()でカードの高さを測定
- 44px以上を確認

---

#### TC-064-020: フォントサイズ設定（大）でテキストサイズが調整される 🔵
**優先度**: P0 必須
**関連要件**: NFR-064-007, AC-064-007
**テスト目的**: フォントサイズ設定の反映確認
**テスト内容**:
- **GIVEN**: フォントサイズが「大」に設定されている
- **WHEN**: お気に入り画面を開く
- **THEN**:
  - すべてのテキストが大きく表示される
  - タップ領域が推奨サイズ（60px以上）である

**検証内容**:
- フォントサイズ設定の反映
- テキストサイズの拡大確認

---

#### TC-064-021: 高コントラストモードで配色が調整される 🔵
**優先度**: P0 必須
**関連要件**: NFR-064-008, NFR-064-010, AC-064-008
**テスト目的**: テーマ対応とコントラスト比の確認
**テスト内容**:
- **GIVEN**: 高コントラストモードが有効な状態
- **WHEN**: お気に入り画面を開く
- **THEN**:
  - すべての要素が高コントラスト配色で表示される
  - コントラスト比が4.5:1以上である

**検証内容**:
- テーマ設定の反映
- 視認性の確保

---

#### TC-064-022: セマンティクスラベルが適切に提供される 🟡
**優先度**: P2 推奨
**関連要件**: NFR-064-009
**テスト目的**: スクリーンリーダー対応確認
**テスト内容**:
- **GIVEN**: お気に入りが存在する
- **WHEN**: お気に入り画面を開く
- **THEN**:
  - お気に入り項目に適切なセマンティクスラベルが設定されている

**検証内容**:
- Semanticsウィジェットの存在確認
- ラベルの適切性

---

### 1.7 エラーハンドリングテスト

#### TC-064-023: お気に入り読み込みエラー時にエラーメッセージを表示 🟡
**優先度**: P1 重要
**関連要件**: EDGE-064-001
**テスト目的**: データ読み込みエラー時の表示確認
**テスト内容**:
- **GIVEN**: お気に入り読み込みがエラーを起こす状態
- **WHEN**: お気に入り画面を開く
- **THEN**:
  - 「お気に入りの読み込みに失敗しました」メッセージが表示される
  - 再試行オプションが提供される

**検証内容**:
- エラーメッセージの表示
- 再試行ボタンの存在

---

#### TC-064-024: TTS読み上げエラー時にエラー通知を表示 🟡
**優先度**: P1 重要
**関連要件**: EDGE-064-002, AC-064-010
**テスト目的**: TTS連携エラー時の表示確認
**テスト内容**:
- **GIVEN**: TTS機能がエラーを起こす状態
- **WHEN**: お気に入り項目をタップする
- **THEN**:
  - エラー通知が表示される
  - お気に入り項目は選択状態のまま
  - アプリがクラッシュしない

**検証内容**:
- エラーメッセージの表示
- クラッシュしない

---

#### TC-064-025: お気に入り削除エラー時にエラーメッセージを表示 🟡
**優先度**: P1 重要
**関連要件**: EDGE-064-003
**テスト目的**: 削除エラー時の表示確認
**テスト内容**:
- **GIVEN**: お気に入り削除がエラーを起こす状態
- **WHEN**: 削除ボタンをタップし、確認ダイアログで「削除」を選択する
- **THEN**:
  - 「削除に失敗しました」メッセージが表示される
  - 削除が中止される
  - お気に入りは残っている

**検証内容**:
- エラーメッセージの表示
- 削除の中止確認

---

### 1.8 Edgeケース・境界値テスト

#### TC-064-026: 長文（500文字以上）のお気に入りが省略表示される 🟡
**優先度**: P2 推奨
**関連要件**: EDGE-064-005, AC-064-011
**テスト目的**: 長文表示の処理確認
**テスト内容**:
- **GIVEN**: 500文字の長いお気に入りが存在する
- **WHEN**: お気に入り画面を開く
- **THEN**:
  - 最初の100文字程度が表示される
  - 「...」で省略される
  - タップすると全文が読み上げられる

**検証内容**:
- テキストの省略表示
- 全文読み上げ確認

---

#### TC-064-027: アプリがバックグラウンドから復帰時にお気に入り一覧の状態を復元 🟡
**優先度**: P2 推奨
**関連要件**: EDGE-064-007
**テスト目的**: 状態復元の確認
**テスト内容**:
- **GIVEN**: お気に入り一覧を表示し、スクロール位置を中間に移動
- **WHEN**: アプリをバックグラウンドに移動し、復帰する
- **THEN**:
  - スクロール位置が保持される
  - お気に入り一覧の状態が復元される

**検証内容**:
- スクロール位置の復元
- 状態の保持

---

#### TC-064-028: 音量0（ミュート）状態でお気に入りタップ時に視覚的警告を表示 🟡
**優先度**: P2 推奨
**関連要件**: EDGE-064-009
**テスト目的**: ミュート状態の警告表示確認
**テスト内容**:
- **GIVEN**: OSの音量が0（ミュート）の状態
- **WHEN**: お気に入り項目をタップする
- **THEN**:
  - 「音量が0です」という視覚的警告が表示される

**検証内容**:
- 警告メッセージの表示
- SnackBar/ダイアログの表示

---

---

## 2. お気に入り項目カードウィジェットテスト（FavoriteItemCard）

### 2.1 正常系テスト

#### TC-064-029: FavoriteItemCardがお気に入り内容を正しく表示する 🔵
**優先度**: P0 必須
**関連要件**: FR-064-002, FR-064-003
**テスト目的**: カードウィジェットの表示確認
**テスト内容**:
- **GIVEN**: お気に入りデータ「こんにちは」（2024/11/28 14:30）
- **WHEN**: FavoriteItemCardを表示する
- **THEN**:
  - 「こんにちは」が表示される
  - 日時が「11/28 14:30」形式で表示される

**検証内容**:
- テキスト内容の表示
- 日時フォーマットの正確性

---

#### TC-064-030: FavoriteItemCardタップでonTapコールバックが発火する 🔵
**優先度**: P0 必須
**関連要件**: FR-064-006
**テスト目的**: タップイベントの確認
**テスト内容**:
- **GIVEN**: FavoriteItemCardとonTapコールバック
- **WHEN**: カードをタップする
- **THEN**:
  - onTapコールバックが1回呼び出される

**検証内容**:
- コールバックの発火確認

---

#### TC-064-031: 削除ボタンが表示される 🔵
**優先度**: P0 必須
**関連要件**: FR-064-007
**テスト目的**: 削除ボタンの表示確認
**テスト内容**:
- **GIVEN**: FavoriteItemCard
- **WHEN**: カードを表示する
- **THEN**:
  - 削除ボタン（ゴミ箱アイコン）が表示される

**検証内容**:
- Icons.deleteの存在確認

---

#### TC-064-032: 削除ボタンタップでonDeleteコールバックが発火する 🔵
**優先度**: P0 必須
**関連要件**: FR-064-007
**テスト目的**: 削除ボタンのイベント確認
**テスト内容**:
- **GIVEN**: FavoriteItemCardとonDeleteコールバック
- **WHEN**: 削除ボタンをタップする
- **THEN**:
  - onDeleteコールバックが1回呼び出される

**検証内容**:
- コールバックの発火確認

---

### 2.2 サイズ・アクセシビリティテスト

#### TC-064-033: FavoriteItemCardの最小高さが44px以上 🔵
**優先度**: P0 必須
**関連要件**: NFR-064-005
**テスト目的**: タップターゲットサイズの確認
**テスト内容**:
- **GIVEN**: 短いテキストのお気に入り
- **WHEN**: FavoriteItemCardを表示する
- **THEN**:
  - カードの高さが44px以上

**検証内容**:
- tester.getSize()でサイズ測定
- 44px以上の確認

---

---

## 3. 空状態ウィジェットテスト（EmptyFavoriteWidget）

### 3.1 正常系テスト

#### TC-064-034: EmptyFavoriteWidgetが空状態メッセージを表示する 🔵
**優先度**: P0 必須
**関連要件**: FR-064-004, AC-064-002
**テスト目的**: 空状態ウィジェットの表示確認
**テスト内容**:
- **GIVEN**: EmptyFavoriteWidget
- **WHEN**: ウィジェットを表示する
- **THEN**:
  - 「お気に入りがありません」が画面中央に表示される

**検証内容**:
- メッセージテキストの表示

---

#### TC-064-035: 空状態アイコンが表示される 🟡
**優先度**: P1 重要
**関連要件**: FR-064-004
**テスト目的**: 視覚的フィードバックの確認
**テスト内容**:
- **GIVEN**: EmptyFavoriteWidget
- **WHEN**: ウィジェットを表示する
- **THEN**:
  - 空状態を示すアイコン（Icons.favorite_border等）が表示される

**検証内容**:
- アイコンの存在確認

---

#### TC-064-036: 使い方のヒントが表示される 🔵
**優先度**: P0 必須
**関連要件**: EDGE-064-004
**テスト目的**: ガイダンスメッセージの確認
**テスト内容**:
- **GIVEN**: EmptyFavoriteWidget
- **WHEN**: ウィジェットを表示する
- **THEN**:
  - 「履歴や定型文からお気に入りを登録できます」などのヒントが表示される

**検証内容**:
- ヒントテキストの表示

---

---

## 4. 統合テスト

### 4.1 ナビゲーションテスト

#### TC-064-037: ホーム画面からお気に入り画面に遷移できる 🔵
**優先度**: P0 必須
**関連要件**: TASK-0015（ナビゲーション）
**テスト目的**: 画面遷移の確認
**テスト内容**:
- **GIVEN**: ホーム画面を表示している
- **WHEN**: お気に入りボタンをタップする
- **THEN**:
  - お気に入り画面に遷移する
  - AppBarタイトルが「お気に入り」である

**検証内容**:
- ルーティングの動作確認

---

### 4.2 Provider連携テスト

#### TC-064-038: FavoriteProviderと連携してお気に入り一覧を取得・表示する 🔵
**優先度**: P0 必須
**関連要件**: FR-064-001
**テスト目的**: 状態管理との連携確認
**テスト内容**:
- **GIVEN**: FavoriteProviderに3件のお気に入りが存在する
- **WHEN**: お気に入り画面を開く
- **THEN**:
  - FavoriteProviderから取得したお気に入りが表示される
  - displayOrder昇順に表示される

**検証内容**:
- Provider連携の確認
- データ取得の確認

---

#### TC-064-039: お気に入り削除後にProviderの状態が更新される 🔵
**優先度**: P0 必須
**関連要件**: FR-064-014
**テスト目的**: 状態管理の更新確認
**テスト内容**:
- **GIVEN**: FavoriteProviderに3件のお気に入りが存在する
- **WHEN**: 1件のお気に入りを削除する
- **THEN**:
  - FavoriteProviderの状態が更新される
  - UI上で2件のお気に入りが表示される

**検証内容**:
- Provider状態の更新
- UI反映の確認

---

### 4.3 TTS連携テスト

#### TC-064-040: お気に入り項目タップでTTSProviderと連携して読み上げが開始される 🔵
**優先度**: P0 必須
**関連要件**: FR-064-006, NFR-064-002
**テスト目的**: TTS連携の確認
**テスト内容**:
- **GIVEN**: お気に入りが存在し、TTSProviderが正常動作する
- **WHEN**: お気に入り項目をタップする
- **THEN**:
  - TTSProviderのspeakメソッドが呼び出される
  - 読み上げ開始まで1秒以内

**検証内容**:
- TTS連携の動作確認
- パフォーマンス確認

---

---

## テストカバレッジ目標

### カバレッジ目標
- **全体**: 80%以上
- **ビジネスロジック**: 90%以上
- **UI層（Widget）**: 80%以上

### 優先度別テストケース数
- **P0（必須）**: 31件 🔵
- **P1（重要）**: 7件 🟡
- **P2（推奨）**: 2件 🟡

### 信頼性レベル別テストケース数
- **🔵 青信号（確実）**: 31件
- **🟡 黄信号（妥当）**: 9件
- **🔴 赤信号（推測）**: 0件

---

## テスト実装ファイル構成

```
frontend/kotonoha_app/test/features/
└── favorites/                             # お気に入り画面テスト（新規作成）
    └── presentation/
        ├── favorites_screen_test.dart     # 新規作成（メイン画面テスト）
        └── widgets/
            ├── favorite_item_card_test.dart      # 新規作成（項目カードテスト）
            └── empty_favorite_widget_test.dart   # 新規作成（空状態ウィジェットテスト）
```

---

## テスト実装順序（TDDサイクル）

### Phase 1: 基本表示テスト（Red）
1. TC-064-029〜036: ウィジェット単体テスト（FavoriteItemCard, EmptyFavoriteWidget）
2. TC-064-001〜005: お気に入り一覧表示、空状態表示

### Phase 2: インタラクションテスト（Red → Green）
3. TC-064-006〜008: 再読み上げ機能
4. TC-064-009〜016: 削除機能（個別削除、全削除、確認ダイアログ）

### Phase 3: 非機能要件テスト（Red → Green）
5. TC-064-017〜018: パフォーマンステスト
6. TC-064-019〜022: アクセシビリティテスト

### Phase 4: エラーハンドリング・エッジケーステスト（Red → Green）
7. TC-064-023〜025: エラーハンドリングテスト
8. TC-064-026〜028: Edgeケース・境界値テスト

### Phase 5: 統合テスト（Red → Green → Refactor）
9. TC-064-037〜040: ナビゲーション、Provider連携、TTS連携

---

## テスト実装時の注意事項

### モックの準備
- `MockFavoriteNotifier`: FavoriteProviderのモック
- `MockTTSNotifier`: TTSProviderのモック（履歴テストのパターンを参考）
- `mocktail`パッケージを使用

### テストヘルパー関数
- `createTestFavorite()`: テスト用お気に入りデータ生成
- `createTestFavorites(int count)`: 複数件のテストデータ生成
- `favoriteProviderOverride()`: Providerオーバーライドヘルパー

### テストデータ例
```dart
Favorite(
  id: 'test_1',
  content: 'こんにちは',
  createdAt: DateTime(2024, 11, 28, 14, 30),
  displayOrder: 0,
)
```

---

## 参考資料
- **要件定義書**: `/Volumes/external/dev/kotonoha/docs/implements/kotonoha/TASK-0064/TASK-0064-requirements.md`
- **履歴テスト参考**: `/Volumes/external/dev/kotonoha/frontend/kotonoha_app/test/features/history/`
- **Favoriteモデル**: `/Volumes/external/dev/kotonoha/frontend/kotonoha_app/lib/features/favorite/domain/models/favorite.dart`
- **FavoriteProvider**: `/Volumes/external/dev/kotonoha/frontend/kotonoha_app/lib/features/favorite/providers/favorite_provider.dart`

---

## 信頼性レベルサマリー

### 🔵 青信号（確実な要件ベース）: 31件
- お気に入り一覧表示、空状態表示、再読み上げ、個別削除、パフォーマンス、アクセシビリティ
- 受け入れ基準AC-064-001〜008に基づく

### 🟡 黄信号（妥当な推測）: 9件
- 全削除機能、読み上げ中インジケーター、エラーハンドリング、エッジケース
- 履歴機能のパターン適用、誤操作防止の一般的な要件

### 🔴 赤信号（完全な推測）: 0件
- なし

---

**作成日**: 2025-11-28
**作成者**: Claude Code (Tsumiki TDD workflow)
**タスクID**: TASK-0064
**信頼性レベル**: 🔵 青信号（要件定義書に基づく）
