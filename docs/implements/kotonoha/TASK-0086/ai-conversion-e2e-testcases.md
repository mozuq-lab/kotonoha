# TASK-0086: AI変換E2Eテスト - テストケース一覧

## タスク情報

- **タスクID**: TASK-0086
- **タスクタイプ**: TDD (E2Eテスト)
- **作成日**: 2025-11-30
- **関連要件**: REQ-901, REQ-902, REQ-903, REQ-904, NFR-002, REQ-2006, REQ-3004

## 開発言語・フレームワーク

- **プログラミング言語**: Dart (Flutter)
  - **言語選択の理由**: フロントエンドがFlutterで実装されているため
  - **テストに適した機能**: flutter_testパッケージ、WidgetTester
- **テストフレームワーク**: Flutter integration_test
  - **フレームワーク選択の理由**: Flutter公式E2Eテストフレームワーク、既存テストとの一貫性
  - **テスト実行環境**: Chrome（Web）、iOS Simulator、Android Emulator
- 🔵 信頼性レベル: 青信号 - tech-stack.mdに基づく

---

## テストケース一覧

### 1. 正常系テストケース（AI変換基本フロー）

#### TC-E2E-086-001: AI変換ボタンが表示される

- **テスト名**: AI変換ボタン表示確認
  - **何をテストするか**: AI変換ボタンがホーム画面に表示されること
  - **期待される動作**: 「AI変換」ラベル付きボタンが表示される
- **入力値**: なし（初期状態確認）
  - **入力データの意味**: 画面初期状態の確認
- **期待される結果**: AI変換ボタンが存在する
  - **期待結果の理由**: REQ-901でAI変換機能の提供が要求されている
- **テストの目的**: UI要素の存在確認
  - **確認ポイント**: ボタンの可視性とラベル
- 🔵 信頼性レベル: 青信号 - REQ-901に基づく

---

#### TC-E2E-086-002: 入力 → AI変換 → 結果表示 → 採用フロー

- **テスト名**: AI変換採用フロー
  - **何をテストするか**: 入力からAI変換、結果採用までの一連フロー
  - **期待される動作**: 変換結果が入力欄に反映される
- **入力値**: 「ありがとう」（文字盤入力）
  - **入力データの意味**: 一般的な短いテキストで変換動作を確認
- **期待される結果**:
  - 変換結果ダイアログが表示される
  - 「採用」タップで変換結果が入力欄に反映される
  - **期待結果の理由**: REQ-902で採用選択機能が要求されている
- **テストの目的**: AI変換メインフローの確認
  - **確認ポイント**: ダイアログ表示、採用ボタン動作、入力欄反映
- 🔵 信頼性レベル: 青信号 - REQ-901, REQ-902に基づく

---

#### TC-E2E-086-003: AI変換 → 再生成フロー

- **テスト名**: AI変換再生成フロー
  - **何をテストするか**: 再生成ボタンで新しい変換結果が取得できること
  - **期待される動作**: 「再生成」タップで新しい変換結果が表示される
- **入力値**: 「ありがとう」
  - **入力データの意味**: 再生成動作確認用の入力
- **期待される結果**:
  - 再生成後に新しい変換結果が表示される
  - **期待結果の理由**: REQ-904で再生成機能が要求されている
- **テストの目的**: 再生成機能の確認
  - **確認ポイント**: 再生成ボタン動作、結果更新
- 🔵 信頼性レベル: 青信号 - REQ-904に基づく

---

#### TC-E2E-086-004: AI変換 → 元の文を使うフロー

- **テスト名**: 元の文を使うフロー
  - **何をテストするか**: 「元の文を使う」ボタンで元のテキストが使用できること
  - **期待される動作**: 元の入力テキストが入力欄に反映される
- **入力値**: 「ありがとう」
  - **入力データの意味**: 元の文使用動作確認用の入力
- **期待される結果**:
  - 入力欄に元のテキスト「ありがとう」が反映される
  - **期待結果の理由**: REQ-904で元の文使用機能が要求されている
- **テストの目的**: 元の文を使う機能の確認
  - **確認ポイント**: ボタン動作、入力欄への正確な反映
- 🔵 信頼性レベル: 青信号 - REQ-904に基づく

---

#### TC-E2E-086-005: 丁寧さレベル「カジュアル」での変換

- **テスト名**: カジュアルレベル変換
  - **何をテストするか**: 丁寧さレベル「カジュアル」での変換動作
  - **期待される動作**: カジュアルなトーンの変換結果が得られる
- **入力値**: 入力テキスト + 丁寧さレベル「カジュアル」
  - **入力データの意味**: カジュアルレベルの変換動作確認
- **期待される結果**:
  - 丁寧さレベルが「カジュアル」と表示される
  - **期待結果の理由**: REQ-903で3段階の丁寧さレベルが要求されている
- **テストの目的**: 丁寧さレベル選択の確認
  - **確認ポイント**: レベル選択UI、結果への反映
- 🔵 信頼性レベル: 青信号 - REQ-903に基づく

---

#### TC-E2E-086-006: 丁寧さレベル「普通」での変換

- **テスト名**: 普通レベル変換
  - **何をテストするか**: 丁寧さレベル「普通」での変換動作
  - **期待される動作**: 普通のトーンの変換結果が得られる
- **入力値**: 入力テキスト + 丁寧さレベル「普通」
  - **入力データの意味**: 普通レベルの変換動作確認
- **期待される結果**:
  - 丁寧さレベルが「普通」と表示される
- **テストの目的**: 丁寧さレベル選択の確認
  - **確認ポイント**: デフォルトレベルの確認
- 🔵 信頼性レベル: 青信号 - REQ-903に基づく

---

#### TC-E2E-086-007: 丁寧さレベル「丁寧」での変換

- **テスト名**: 丁寧レベル変換
  - **何をテストするか**: 丁寧さレベル「丁寧」での変換動作
  - **期待される動作**: 丁寧なトーンの変換結果が得られる
- **入力値**: 入力テキスト + 丁寧さレベル「丁寧」
  - **入力データの意味**: 丁寧レベルの変換動作確認
- **期待される結果**:
  - 丁寧さレベルが「丁寧」と表示される
- **テストの目的**: 丁寧さレベル選択の確認
  - **確認ポイント**: 最も丁寧なレベルでの変換
- 🔵 信頼性レベル: 青信号 - REQ-903に基づく

---

#### TC-E2E-086-008: AI変換 → 採用 → 読み上げフロー

- **テスト名**: AI変換から読み上げまでの統合フロー
  - **何をテストするか**: 変換結果採用後にTTS読み上げできること
  - **期待される動作**: 採用した変換結果が読み上げられる
- **入力値**: 「ありがとう」→ AI変換 → 採用
  - **入力データの意味**: エンドツーエンドのユーザーフロー確認
- **期待される結果**:
  - 採用後に読み上げボタンタップでTTSが開始される
  - **期待結果の理由**: AI変換とTTS機能の連携確認
- **テストの目的**: 機能間連携の確認
  - **確認ポイント**: データフロー、TTS開始
- 🔵 信頼性レベル: 青信号 - REQ-901, REQ-401に基づく

---

### 2. 異常系テストケース（エラーハンドリング）

#### TC-E2E-086-009: 入力が2文字未満の場合AI変換ボタンが無効化

- **テスト名**: 入力不足時のボタン無効化
  - **エラーケースの概要**: 入力文字数が最小値（2文字）未満
  - **エラー処理の重要性**: 無効なリクエスト送信を防止
- **入力値**: 「あ」（1文字）
  - **不正な理由**: API仕様で2文字以上が必須
  - **実際の発生シナリオ**: ユーザーが1文字だけ入力した場合
- **期待される結果**:
  - AI変換ボタンが無効化（グレーアウト）される
  - **エラーメッセージの内容**: ボタン無効化による視覚的フィードバック
  - **システムの安全性**: 無効なAPI呼び出しを防止
- **テストの目的**: 入力バリデーションの確認
  - **品質保証の観点**: ユーザビリティと安全性の両立
- 🔵 信頼性レベル: 青信号 - API仕様に基づく

---

#### TC-E2E-086-010: オフライン時のAI変換ボタン無効化

- **テスト名**: オフライン時のボタン無効化
  - **エラーケースの概要**: ネットワーク接続がない状態
  - **エラー処理の重要性**: オフライン時の適切なUI状態表示
- **入力値**: オフライン状態 + 有効な入力テキスト
  - **不正な理由**: ネットワーク必須機能がオフライン時は使用不可
  - **実際の発生シナリオ**: 機内モード、Wi-Fi切断時
- **期待される結果**:
  - AI変換ボタンが無効化される
  - オフラインインジケーターが表示される
  - **システムの安全性**: 無効な状態でのリクエスト防止
- **テストの目的**: オフライン対応の確認
  - **品質保証の観点**: オフライン時のユーザー体験保護
- 🔵 信頼性レベル: 青信号 - REQ-3004に基づく

---

#### TC-E2E-086-011: オフライン時のフォールバック動作

- **テスト名**: オフライン時のフォールバック
  - **エラーケースの概要**: オフライン時のAI変換試行
  - **エラー処理の重要性**: 代替手段の提供
- **入力値**: オフライン状態での操作
  - **不正な理由**: ネットワーク接続必須
  - **実際の発生シナリオ**: 通信環境が悪い場所での使用
- **期待される結果**:
  - 元の文をそのまま使用できるオプションが提示される
  - **エラーメッセージの内容**: 「オフラインでは利用できません」
- **テストの目的**: フォールバック処理の確認
  - **品質保証の観点**: 機能制限時のユーザー体験確保
- 🔵 信頼性レベル: 青信号 - REQ-1002, REQ-1003に基づく

---

#### TC-E2E-086-012: AI変換APIエラー時のフォールバック

- **テスト名**: APIエラー時のフォールバック
  - **エラーケースの概要**: バックエンドAPIがエラーを返す場合
  - **エラー処理の重要性**: API障害時のユーザー体験保護
- **入力値**: 正常な入力 + モックでエラーレスポンス
  - **不正な理由**: 外部API障害をシミュレート
  - **実際の発生シナリオ**: AI APIの一時的な障害
- **期待される結果**:
  - エラーメッセージが表示される
  - 元の文を使用できるオプションが提示される
  - **システムの安全性**: エラー状態からの適切な回復
- **テストの目的**: エラーハンドリングの確認
  - **品質保証の観点**: システムの堅牢性
- 🔵 信頼性レベル: 青信号 - EDGE-002に基づく

---

#### TC-E2E-086-013: 結果ダイアログ外タップで閉じない

- **テスト名**: ダイアログ誤操作防止
  - **エラーケースの概要**: ダイアログ外タップでの誤操作
  - **エラー処理の重要性**: 変換結果の誤消失防止
- **入力値**: ダイアログ表示中にダイアログ外をタップ
  - **不正な理由**: 誤操作による結果消失のリスク
  - **実際の発生シナリオ**: 操作が不安定なユーザーの誤タップ
- **期待される結果**:
  - ダイアログが閉じない（barrierDismissible: false）
  - **システムの安全性**: 誤操作からの保護
- **テストの目的**: 誤操作防止の確認
  - **品質保証の観点**: アクセシビリティとユーザビリティ
- 🔵 信頼性レベル: 青信号 - REQ-5002に基づく

---

### 3. 境界値テストケース

#### TC-E2E-086-014: 入力2文字（最小値）でAI変換が有効

- **テスト名**: 最小入力での変換有効化
  - **境界値の意味**: API仕様の最小入力文字数
  - **境界値での動作保証**: 最小値でも正常動作すること
- **入力値**: 「あい」（2文字）
  - **境界値選択の根拠**: API仕様で2文字以上が必須
  - **実際の使用場面**: 非常に短い入力での変換
- **期待される結果**:
  - AI変換ボタンが有効化される
  - 変換が正常に実行される
  - **境界での正確性**: 境界値で正常動作
- **テストの目的**: 最小入力での動作確認
  - **堅牢性の確認**: 境界条件での安定動作
- 🔵 信頼性レベル: 青信号 - API仕様に基づく

---

#### TC-E2E-086-015: 入力1文字（最小値-1）でAI変換が無効

- **テスト名**: 最小値未満での変換無効化
  - **境界値の意味**: 最小入力文字数の境界外
  - **境界値での動作保証**: 境界外で適切に無効化されること
- **入力値**: 「あ」（1文字）
  - **境界値選択の根拠**: 最小値（2文字）の1文字手前
  - **実際の使用場面**: 最小入力未満での操作
- **期待される結果**:
  - AI変換ボタンが無効化される
  - **一貫した動作**: 境界内外で動作が一貫
- **テストの目的**: 境界外での動作確認
  - **堅牢性の確認**: バリデーションの正確性
- 🔵 信頼性レベル: 青信号 - API仕様に基づく

---

#### TC-E2E-086-016: 入力0文字（空）でAI変換が無効

- **テスト名**: 空入力での変換無効化
  - **境界値の意味**: 入力なしの極端なケース
  - **境界値での動作保証**: 空入力でもクラッシュしないこと
- **入力値**: 空文字列
  - **境界値選択の根拠**: 最も極端な境界値
  - **実際の使用場面**: 入力前にボタンを確認した場合
- **期待される結果**:
  - AI変換ボタンが無効化される
  - アプリがクラッシュしない
- **テストの目的**: 空入力での安定性確認
  - **堅牢性の確認**: 極端な条件での安定動作
- 🟡 信頼性レベル: 黄信号 - 妥当な推測

---

### 4. パフォーマンステストケース

#### TC-E2E-086-017: AI変換応答時間が3秒以内

- **テスト名**: AI変換応答時間測定
  - **何をテストするか**: AI変換の応答時間がパフォーマンス要件を満たすこと
  - **期待される動作**: 3秒以内に変換結果が表示される
- **入力値**: 標準的な入力テキスト
  - **入力データの意味**: 通常の使用シナリオでの測定
- **期待される結果**:
  - 変換完了まで3秒以内
  - **期待結果の理由**: NFR-002でAI変換応答時間3秒以内が要求されている
- **テストの目的**: パフォーマンス要件の確認
  - **確認ポイント**: 応答時間の測定と検証
- 🔵 信頼性レベル: 青信号 - NFR-002に基づく

---

#### TC-E2E-086-018: 3秒超過時のローディング表示

- **テスト名**: ローディング表示確認
  - **何をテストするか**: 3秒超過時にローディングインジケーターが表示されること
  - **期待される動作**: ローディングインジケーターが表示される
- **入力値**: 遅延レスポンスをシミュレート
  - **入力データの意味**: 3秒以上かかるAPI応答のシミュレーション
- **期待される結果**:
  - ローディングインジケーターが表示される
  - **期待結果の理由**: REQ-2006で3秒超過時のローディング表示が要求されている
- **テストの目的**: ローディング表示の確認
  - **確認ポイント**: ユーザーへの視覚的フィードバック
- 🔵 信頼性レベル: 青信号 - REQ-2006に基づく

---

### 5. 統合テストケース

#### TC-E2E-086-019: AI変換 → 採用 → 履歴保存の一連フロー

- **テスト名**: AI変換結果の履歴保存
  - **何をテストするか**: AI変換で採用したテキストが履歴に保存されること
  - **期待される動作**: 変換結果が履歴画面に表示される
- **入力値**: AI変換 → 採用 → 読み上げ → 履歴確認
  - **入力データの意味**: 複数機能の連携確認
- **期待される結果**:
  - 履歴画面に変換結果が表示される
  - **期待結果の理由**: REQ-601で履歴自動保存が要求されている
- **テストの目的**: 機能間連携の確認
  - **確認ポイント**: AI変換と履歴機能の連携
- 🔵 信頼性レベル: 青信号 - REQ-901, REQ-601に基づく

---

#### TC-E2E-086-020: オンライン復帰時のAI変換ボタン自動有効化

- **テスト名**: オンライン復帰時の自動有効化
  - **何をテストするか**: オフライン→オンライン遷移時にボタンが有効化されること
  - **期待される動作**: オンライン復帰後にAI変換ボタンが有効になる
- **入力値**: オフライン → オンライン遷移
  - **入力データの意味**: ネットワーク状態変化のシミュレーション
- **期待される結果**:
  - AI変換ボタンが自動的に有効化される
  - オフラインインジケーターが消える
- **テストの目的**: ネットワーク状態変化への対応確認
  - **確認ポイント**: リアクティブなUI更新
- 🟡 信頼性レベル: 黄信号 - 実装から推測

---

## テストケースサマリー

| カテゴリ | テストケース数 | 信頼性レベル |
|---------|--------------|--------------|
| 正常系（AI変換基本フロー） | 8 | 🔵 青信号 |
| 異常系（エラーハンドリング） | 5 | 🔵 青信号 |
| 境界値 | 3 | 🔵/🟡 |
| パフォーマンス | 2 | 🔵 青信号 |
| 統合 | 2 | 🔵/🟡 |
| **合計** | **20** | |

---

## 品質判定

✅ **高品質**:
- テストケース分類: 正常系・異常系・境界値・パフォーマンス・統合が網羅されている
- 期待値定義: 各テストケースの期待値が明確に定義されている
- 技術選択: Dart/Flutter + integration_testで確定
- 実装可能性: 既存E2Eテストパターンとモックサーバーを活用可能

## 信頼性レベル

🔵 青信号 - EARS要件定義書（REQ-901〜REQ-904, NFR-002, REQ-2006, REQ-3004）に基づくテストケース設計

---

次のお勧めステップ: `/tsumiki:tdd-red` でRedフェーズ（失敗テスト作成）を開始します。
