# TASK-0083 定型文E2Eテスト テストケース定義書

## 概要

- **タスクID**: TASK-0083
- **タスク名**: 定型文E2Eテスト
- **作成日時**: 2025-11-29
- **テストフレームワーク**: Flutter integration_test
- **テスト実行環境**: Chrome (Web), iOS/Androidエミュレータ
- **関連要件**: REQ-101, REQ-102, REQ-103, REQ-104, REQ-105, REQ-106, REQ-107, NFR-004

---

## 開発言語・テストフレームワーク

### プログラミング言語: Dart (Flutter)

- **言語選択の理由**: kotonohaプロジェクトはFlutter 3.38.1で開発されており、E2EテストもDartで記述
- **テストに適した機能**:
  - Flutterの`integration_test`パッケージを使用したE2Eテスト
  - WidgetTesterによる実際のUI操作
  - async/awaitによる非同期処理のテスト
- 🔵 **信頼性レベル**: 青信号 - `docs/tech-stack.md`の技術スタックに基づく

### テストフレームワーク: integration_test + flutter_test

- **フレームワーク選択の理由**:
  - Flutter公式のE2Eテストフレームワーク
  - TASK-0081でE2Eテスト環境構築済み
  - ヘルパー関数が`integration_test/helpers/test_helpers.dart`に整備済み
- **テスト実行環境**:
  - 開発時: Chrome（Web）でのテスト実行
  - CI/CD: GitHub Actionsでの自動テスト実行
  - 本番確認: iOS/Androidエミュレータでのテスト実行
- 🔵 **信頼性レベル**: 青信号 - TASK-0081の実装成果に基づく

---

## テストケース一覧

### 1. 正常系テストケース（基本的な動作）

#### TC-E2E-083-001: 定型文一覧が正しく表示される

- **テスト名**: 定型文一覧が正しく表示される
  - **何をテストするか**: 定型文画面に遷移すると、登録済みの定型文が一覧表示されること
  - **期待される動作**: すべての定型文がタップ可能なボタンとして表示される
- **入力値**: なし（初期データを使用）
  - **入力データの意味**: REQ-107の初期データ（50-100件の定型文サンプル）
- **期待される結果**:
  - 定型文一覧画面が表示される
  - 各定型文がタップ可能なボタンとして表示される
  - ボタンサイズが最小44px × 44px以上（REQ-5001）
  - **期待結果の理由**: REQ-101の要件を満たす
- **テストの目的**: REQ-101（定型文を一覧表示）の基本動作確認
  - **確認ポイント**:
    - 定型文一覧画面への遷移が正常動作すること
    - すべての定型文が視認可能であること
    - タップ可能なUI要素として表示されること
- 🔵 **信頼性レベル**: 青信号 - REQ-101に基づく

#### TC-E2E-083-002: お気に入り定型文が一覧上部に表示される

- **テスト名**: お気に入り定型文が一覧上部に表示される
  - **何をテストするか**: お気に入りに登録された定型文が一覧の最上部に優先表示されること
  - **期待される動作**: お気に入りマーク（星アイコン）付きの定型文が上部に表示される
- **入力値**:
  - お気に入り定型文: 「お水をください」（isFavorite: true）
  - 通常定型文: 「おはようございます」（isFavorite: false）
  - **入力データの意味**: お気に入り優先表示の動作確認用
- **期待される結果**:
  - お気に入り定型文が一覧の最上部に表示される
  - お気に入りマーク（星アイコン）が表示される
  - 通常定型文より上に配置される
  - **期待結果の理由**: REQ-105のお気に入り優先表示機能
- **テストの目的**: REQ-105（お気に入り定型文を一覧上部に優先表示）の確認
  - **確認ポイント**:
    - お気に入りフラグによる表示順序の制御が正しく動作すること
    - 視覚的な区別（星アイコン）が表示されること
- 🔵 **信頼性レベル**: 青信号 - REQ-105に基づく

#### TC-E2E-083-003: カテゴリごとに定型文が分類表示される

- **テスト名**: カテゴリごとに定型文が分類表示される
  - **何をテストするか**: 定型文が「日常」「体調」「その他」のカテゴリごとに分類表示されること
  - **期待される動作**: カテゴリ名が視認しやすく表示され、各カテゴリ配下に定型文が表示される
- **入力値**:
  - 日常カテゴリ: 「おはようございます」「こんにちは」
  - 体調カテゴリ: 「お水をください」「痛いです」
  - その他カテゴリ: 「はい」「いいえ」
  - **入力データの意味**: 3種類のカテゴリに分類された定型文
- **期待される結果**:
  - カテゴリ名が表示される（「日常」「体調」「その他」）
  - 各カテゴリ配下に該当する定型文が表示される
  - カテゴリ間の切り替えが可能
  - **期待結果の理由**: REQ-106のカテゴリ分類機能
- **テストの目的**: REQ-106（定型文をカテゴリで分類）の確認
  - **確認ポイント**:
    - カテゴリ名が視認しやすく表示されること
    - カテゴリごとに定型文が正しく分類されること
    - カテゴリ切り替えが容易であること
- 🔵 **信頼性レベル**: 青信号 - REQ-106に基づく

#### TC-E2E-083-004: 初期データとして50件以上の定型文が表示される

- **テスト名**: 初期データとして50件以上の定型文が表示される
  - **何をテストするか**: アプリ初回起動時に50-100件の定型文サンプルが表示されること
  - **期待される動作**: 初期状態で50件以上の汎用的な定型文が準備されている
- **入力値**: なし（初期データ）
  - **入力データの意味**: REQ-107の初期データ要件（50-100個程度の汎用的な定型文サンプル）
- **期待される結果**:
  - 定型文一覧に50件以上の定型文が表示される
  - 日常生活、体調管理に関連する汎用的な定型文が含まれる
  - 各定型文が適切なカテゴリに分類されている
  - **期待結果の理由**: REQ-107の初期データ提供要件
- **テストの目的**: REQ-107（初期データとして汎用的な定型文サンプルを提供）の確認
  - **確認ポイント**:
    - 定型文件数が50件以上であること
    - 実用的な定型文が含まれること
    - カテゴリ分類が適切であること
- 🔵 **信頼性レベル**: 青信号 - REQ-107に基づく

#### TC-E2E-083-005: 定型文タップで即座に読み上げが開始される

- **テスト名**: 定型文タップで即座に読み上げが開始される
  - **何をテストするか**: 定型文をタップすると、読み上げボタンを押すことなく即座にTTSで読み上げられること
  - **期待される動作**: タップから1秒以内にTTS読み上げが開始される
- **入力値**: 定型文「こんにちは」をタップ
  - **入力データの意味**: 短い定型文での即座読み上げテスト
- **期待される結果**:
  - 定型文タップから1秒以内にTTS読み上げが開始される（NFR-001）
  - 読み上げ中に停止ボタンが表示される
  - **期待結果の理由**: REQ-103の即座読み上げ機能
- **テストの目的**: REQ-103（定型文を直接タップで即座に読み上げ）の確認
  - **確認ポイント**:
    - 読み上げボタンを押さずに読み上げが開始されること
    - タップから読み上げ開始まで1秒以内であること
    - 読み上げ中に停止ボタンが表示されること
- 🔵 **信頼性レベル**: 青信号 - REQ-103、NFR-001に基づく

#### TC-E2E-083-006: 定型文タップで入力欄に反映される

- **テスト名**: 定型文タップで入力欄に反映される（オプション動作）
  - **何をテストするか**: 定型文を特定の方法でタップすると、文字盤画面の入力欄に定型文が反映されること
  - **期待される動作**: 入力欄の内容が定型文で上書きされる
- **入力値**: 定型文「こんにちは」を長押しまたは設定で反映モードに変更
  - **入力データの意味**: 入力欄への反映動作のテスト
- **期待される結果**:
  - 文字盤画面の入力欄に定型文が反映される
  - 既存の入力内容は消去される（上書き）
  - 入力欄に反映後、読み上げボタンで読み上げ可能
  - **期待結果の理由**: REQ-102の入力欄反映機能
- **テストの目的**: REQ-102（定型文をタップすると入力欄に反映）の確認
  - **確認ポイント**:
    - 定型文が正しく入力欄に反映されること
    - 既存の入力内容が上書きされること
    - 反映後に読み上げボタンで読み上げできること
- 🔵 **信頼性レベル**: 青信号 - REQ-102に基づく

#### TC-E2E-083-007: 新規定型文を追加できる

- **テスト名**: 新規定型文を追加できる
  - **何をテストするか**: ユーザーが新しい定型文を作成して保存できること
  - **期待される動作**: 追加ボタンから新規定型文作成画面に遷移し、保存後に一覧に表示される
- **入力値**:
  - 定型文内容: 「新しい定型文」
  - カテゴリ: 「日常」
  - お気に入りフラグ: false
  - **入力データの意味**: 新規定型文の基本的な追加操作
- **期待される結果**:
  - 追加ボタンをタップすると新規作成画面が表示される
  - テキスト、カテゴリ、お気に入りフラグを設定できる
  - 保存ボタンで保存が完了する
  - 一覧に新しい定型文が表示される
  - **期待結果の理由**: REQ-104の定型文追加機能
- **テストの目的**: REQ-104（定型文の追加機能）の確認
  - **確認ポイント**:
    - 新規作成画面への遷移が正常動作すること
    - すべての項目が設定可能であること
    - 保存後に一覧に反映されること
- 🔵 **信頼性レベル**: 青信号 - REQ-104に基づく

#### TC-E2E-083-008: 定型文を編集できる

- **テスト名**: 定型文を編集できる
  - **何をテストするか**: 既存の定型文の内容、カテゴリ、お気に入りフラグを変更できること
  - **期待される動作**: 編集画面で変更後、保存すると一覧に反映される
- **入力値**:
  - 編集前: 「元の内容」（日常、お気に入りなし）
  - 編集後: 「更新後の内容」（体調、お気に入りあり）
  - **入力データの意味**: すべての項目の変更操作をテスト
- **期待される結果**:
  - 編集ボタンをタップすると編集画面が表示される
  - テキスト、カテゴリ、お気に入りフラグを変更できる
  - 保存ボタンで変更が保存される
  - 一覧に更新後の内容が表示される
  - **期待結果の理由**: REQ-104の定型文編集機能
- **テストの目的**: REQ-104（定型文の編集機能）の確認
  - **確認ポイント**:
    - 編集画面への遷移が正常動作すること
    - すべての項目が変更可能であること
    - 保存後に一覧に反映されること
- 🔵 **信頼性レベル**: 青信号 - REQ-104に基づく

#### TC-E2E-083-009: 定型文を削除できる（確認ダイアログ付き）

- **テスト名**: 定型文を削除できる（確認ダイアログ付き）
  - **何をテストするか**: 定型文を削除する際に確認ダイアログが表示され、「はい」を選択すると削除されること
  - **期待される動作**: 確認ダイアログで「はい」を選択すると削除が実行される
- **入力値**: 定型文「削除予定」を削除
  - **入力データの意味**: 削除操作の基本動作テスト
- **期待される結果**:
  - 削除ボタンをタップすると確認ダイアログが表示される
  - ダイアログに「削除しますか？」というメッセージが表示される
  - 「はい」を選択すると定型文が削除される
  - 一覧から削除された定型文が消える
  - **期待結果の理由**: REQ-104の削除機能とREQ-5002の誤操作防止
- **テストの目的**: REQ-104（定型文の削除機能）とREQ-5002（誤操作防止）の確認
  - **確認ポイント**:
    - 確認ダイアログが表示されること
    - 「はい」選択で削除が実行されること
    - 一覧から削除されること
- 🔵 **信頼性レベル**: 青信号 - REQ-104、REQ-5002に基づく

#### TC-E2E-083-010: お気に入りフラグを切り替えられる

- **テスト名**: お気に入りフラグを切り替えられる
  - **何をテストするか**: 定型文のお気に入りフラグをON/OFFできること
  - **期待される動作**: お気に入りボタンをタップすると、フラグが切り替わり、表示順序が変更される
- **入力値**:
  - 通常定型文「こんにちは」（isFavorite: false）
  - お気に入り定型文「お水をください」（isFavorite: true）
  - **入力データの意味**: お気に入りフラグの切り替え操作
- **期待される結果**:
  - お気に入りボタン（星アイコン）をタップするとフラグが切り替わる
  - お気に入り登録すると一覧上部に移動する
  - お気に入り解除すると元の位置に戻る
  - **期待結果の理由**: REQ-105のお気に入り機能
- **テストの目的**: REQ-105（お気に入り定型文を一覧上部に優先表示）の操作確認
  - **確認ポイント**:
    - お気に入りボタンが機能すること
    - フラグの切り替えが即座に反映されること
    - 表示順序が変更されること
- 🔵 **信頼性レベル**: 青信号 - REQ-105に基づく

---

### 2. 異常系テストケース（エラーハンドリング）

#### TC-E2E-083-011: 定型文0件の状態で適切なメッセージが表示される

- **テスト名**: 定型文0件の状態で適切なメッセージが表示される
  - **エラーケースの概要**: 定型文が1件も登録されていない状態
  - **エラー処理の重要性**: NFR-301（重大エラーでも基本機能を継続利用可能）の確認
- **入力値**: なし（定型文0件の状態）
  - **不正な理由**: データなし状態は通常の状態ではないが、異常ではない
  - **実際の発生シナリオ**: 初期データをクリアした状態、またはすべて削除した状態
- **期待される結果**:
  - 定型文一覧画面に「定型文がありません」というメッセージが表示される
  - 追加ボタンは表示され、新規作成が可能
  - アプリがクラッシュしない
  - **エラーメッセージの内容**: 「定型文がありません」（ユーザーにとって分かりやすい）
  - **システムの安全性**: データなし状態でも安定動作する
- **テストの目的**: エッジケース（0件）でのエラーハンドリング確認
  - **品質保証の観点**: NFR-301の信頼性要件を満たす
- 🟡 **信頼性レベル**: 黄信号 - NFR-301から推測

#### TC-E2E-083-012: 削除確認ダイアログでキャンセルすると削除されない

- **テスト名**: 削除確認ダイアログでキャンセルすると削除されない
  - **エラーケースの概要**: 削除操作をキャンセルする場合
  - **エラー処理の重要性**: REQ-5002の誤操作防止機能の確認
- **入力値**: 定型文「保持予定」を削除しようとするが、キャンセル
  - **不正な理由**: 誤操作をキャンセルする正常な操作
  - **実際の発生シナリオ**: ユーザーが誤って削除ボタンを押した場合
- **期待される結果**:
  - 確認ダイアログが表示される
  - 「いいえ」を選択すると削除がキャンセルされる
  - 定型文が一覧に残る
  - **エラーメッセージの内容**: N/A（キャンセルは正常な操作）
  - **システムの安全性**: 誤操作による削除を防止できる
- **テストの目的**: REQ-5002（誤操作防止の仕組み）の確認
  - **品質保証の観点**: ユーザビリティとデータ保護
- 🔵 **信頼性レベル**: 青信号 - REQ-5002に基づく

#### TC-E2E-083-013: カテゴリが空の場合でも安全に処理される

- **テスト名**: カテゴリが空の場合でも安全に処理される
  - **エラーケースの概要**: 特定のカテゴリに定型文が0件の状態
  - **エラー処理の重要性**: NFR-301の信頼性要件
- **入力値**:
  - 日常カテゴリ: 5件
  - 体調カテゴリ: 0件（空）
  - その他カテゴリ: 3件
  - **不正な理由**: データなし状態は通常の状態ではないが、異常ではない
  - **実際の発生シナリオ**: カテゴリ内のすべての定型文を削除した場合
- **期待される結果**:
  - 空のカテゴリが適切に処理される（非表示または「このカテゴリには定型文がありません」表示）
  - アプリがクラッシュしない
  - 他のカテゴリは正常に表示される
  - **エラーメッセージの内容**: 「このカテゴリには定型文がありません」（オプション）
  - **システムの安全性**: 空カテゴリでも安定動作する
- **テストの目的**: エッジケース（空カテゴリ）でのエラーハンドリング確認
  - **品質保証の観点**: NFR-301の信頼性要件を満たす
- 🟡 **信頼性レベル**: 黄信号 - EDGE-204から推測

---

### 3. 境界値テストケース（最小値、最大値、null等）

#### TC-E2E-083-014: 定型文500文字まで保存できる

- **テスト名**: 定型文500文字まで保存できる
  - **境界値の意味**: 定型文の最大文字数制限（EDGE-102）
  - **境界値での動作保証**: 500文字まで正確に保存・表示できること
- **入力値**: 500文字の定型文「あ」×500
  - **境界値選択の根拠**: EDGE-102の文字数制限
  - **実際の使用場面**: 長い説明や複雑な状況を伝える場合
- **期待される結果**:
  - 500文字の定型文が保存できる
  - 一覧表示で500文字が正しく表示される（またはトリミングされる）
  - 読み上げ時に500文字すべてが読み上げられる
  - **境界での正確性**: 文字欠落なく500文字が保存される
  - **一貫した動作**: 短い定型文と同様に動作する
- **テストの目的**: EDGE-102（定型文500文字制限）の上限値確認
  - **堅牢性の確認**: 最大文字数でも安定動作する
- 🔵 **信頼性レベル**: 青信号 - EDGE-102に基づく

#### TC-E2E-083-015: 定型文501文字目が制限される

- **テスト名**: 定型文501文字目が制限される
  - **境界値の意味**: 定型文の最大文字数を超える場合
  - **境界値での動作保証**: 500文字を超える入力が制限されること
- **入力値**: 501文字の定型文「あ」×501
  - **境界値選択の根拠**: EDGE-102の文字数制限+1
  - **実際の使用場面**: ユーザーが長文を入力しようとした場合
- **期待される結果**:
  - 入力フィールドで501文字目以降が入力されない
  - または警告メッセージ「500文字以内で入力してください」が表示される
  - 保存時にバリデーションエラーが発生する
  - **境界での正確性**: 500文字で厳密に制限される
  - **一貫した動作**: エラーメッセージが表示される
- **テストの目的**: EDGE-102（定型文500文字制限）の制限動作確認
  - **堅牢性の確認**: 制限を超える入力が拒否される
- 🟡 **信頼性レベル**: 黄信号 - EDGE-102から推測

---

### 4. パフォーマンステストケース

#### TC-E2E-083-016: 定型文100件表示が1秒以内

- **テスト名**: 定型文100件表示が1秒以内
  - **何をテストするか**: 100件の定型文を一覧表示する際のパフォーマンス
  - **期待される動作**: 画面遷移から表示完了まで1秒（1000ms）以内
- **入力値**: 100件の定型文データ
  - **入力データの意味**: NFR-004のパフォーマンス要件の上限値
- **期待される結果**:
  - 定型文画面への遷移から一覧表示完了まで1秒（1000ms）以内
  - スクロールが滑らかで遅延がない
  - タップ操作が正常に機能する
  - **期待結果の理由**: NFR-004のパフォーマンス要件
- **テストの目的**: NFR-004（定型文一覧の表示を1秒以内に完了）の確認
  - **確認ポイント**:
    - Stopwatchで画面遷移から表示完了までの時間を計測
    - 1000ms以内であることを確認
    - スクロール操作が滑らかであること
- **計測方法**:
  - `measurePerformance()`ヘルパー関数を使用
  - 複数回計測して平均値が1秒以内であることを確認
- 🔵 **信頼性レベル**: 青信号 - NFR-004に基づく

#### TC-E2E-083-017: 定型文即座読み上げが1秒以内

- **テスト名**: 定型文即座読み上げが1秒以内
  - **何をテストするか**: 定型文タップから読み上げ開始までのパフォーマンス
  - **期待される動作**: タップから読み上げ開始まで1秒（1000ms）以内
- **入力値**: 定型文「こんにちは」をタップ
  - **入力データの意味**: 短い定型文での即座読み上げのパフォーマンステスト
- **期待される結果**:
  - 定型文タップから読み上げ開始まで1秒（1000ms）以内
  - 読み上げ中に停止ボタンが表示される
  - **期待結果の理由**: NFR-001のTTS読み上げ開始パフォーマンス要件
- **テストの目的**: NFR-001（TTS読み上げ開始が1秒以内）の確認
  - **確認ポイント**:
    - Stopwatchでタップから読み上げ開始までの時間を計測
    - 1000ms以内であることを確認
- **計測方法**:
  - `measurePerformance()`ヘルパー関数を使用
  - 停止ボタン表示をTTS開始の指標として使用
- 🔵 **信頼性レベル**: 青信号 - NFR-001に基づく

---

### 5. データ永続化テストケース

#### TC-E2E-083-018: アプリ再起動後も定型文が保持される

- **テスト名**: アプリ再起動後も定型文が保持される
  - **何をテストするか**: 定型文の追加・編集・削除がアプリ再起動後も保持されること
  - **期待される動作**: Hiveによるローカルストレージ永続化が正常動作すること
- **入力値**:
  - 新規定型文「永続化テスト」を追加
  - アプリを再起動
  - **入力データの意味**: 永続化機能のテスト
- **期待される結果**:
  - アプリ再起動後も定型文「永続化テスト」が一覧に表示される
  - 定型文の内容、カテゴリ、お気に入りフラグが保持される
  - **期待結果の理由**: REQ-5003のデータ永続化要件
- **テストの目的**: REQ-5003（データ永続化機構）の確認
  - **確認ポイント**:
    - Hiveボックスを閉じて再度開く操作
    - データが完全に保持されること
- 🔵 **信頼性レベル**: 青信号 - REQ-5003に基づく

#### TC-E2E-083-019: お気に入り設定がアプリ再起動後も保持される

- **テスト名**: お気に入り設定がアプリ再起動後も保持される
  - **何をテストするか**: お気に入りフラグの切り替えがアプリ再起動後も保持されること
  - **期待される動作**: お気に入り設定がローカルストレージに永続化されること
- **入力値**:
  - 通常定型文「こんにちは」をお気に入りに登録
  - アプリを再起動
  - **入力データの意味**: お気に入りフラグの永続化テスト
- **期待される結果**:
  - アプリ再起動後も定型文「こんにちは」がお気に入りとして表示される
  - お気に入りマーク（星アイコン）が表示される
  - 一覧上部に表示される
  - **期待結果の理由**: REQ-5003のデータ永続化要件
- **テストの目的**: REQ-5003（データ永続化機構）とREQ-105の統合確認
  - **確認ポイント**:
    - お気に入りフラグが永続化されること
    - 再起動後も優先表示されること
- 🔵 **信頼性レベル**: 青信号 - REQ-5003、REQ-105に基づく

---

### 6. 統合テストケース

#### TC-E2E-083-020: 定型文追加→お気に入り登録→即座読み上げの一連フローが正常動作

- **テスト名**: 定型文追加→お気に入り登録→即座読み上げの一連フローが正常動作
  - **何をテストするか**: 定型文の追加からお気に入り登録、読み上げまでの一連フローが正常動作すること
  - **期待される動作**: すべての機能が統合されて正常に動作すること
- **入力値**:
  1. 新規定型文「統合テスト」を追加（日常カテゴリ）
  2. お気に入りに登録
  3. タップして即座読み上げ
  - **入力データの意味**: 主要機能の統合動作テスト
- **期待される結果**:
  - 新規定型文が正常に追加される
  - お気に入り登録が成功し、一覧上部に移動する
  - タップすると即座に読み上げが開始される（1秒以内）
  - 読み上げ履歴に保存される
  - **期待結果の理由**: REQ-104、REQ-105、REQ-103の統合動作確認
- **テストの目的**: 主要機能の統合動作確認
  - **確認ポイント**:
    - 各機能が連携して正常動作すること
    - データの一貫性が保たれること
    - パフォーマンス要件を満たすこと
- 🔵 **信頼性レベル**: 青信号 - 複数要件の統合確認

---

## テストケース実装時の日本語コメント指針

### テストケース開始時のコメント

```dart
// 【テスト目的】: このテストで何を確認するかを日本語で明記
// 【テスト内容】: 具体的にどのような処理をテストするかを説明
// 【期待される動作】: 正常に動作した場合の結果を説明
// 🔵🟡🔴 この内容の信頼性レベルを記載
```

### Given（準備フェーズ）のコメント

```dart
// 【テストデータ準備】: なぜこのデータを用意するかの理由
// 【初期条件設定】: テスト実行前の状態を説明
// 【前提条件確認】: テスト実行に必要な前提条件を明記
```

### When（実行フェーズ）のコメント

```dart
// 【実際の処理実行】: どの機能/メソッドを呼び出すかを説明
// 【処理内容】: 実行される処理の内容を日本語で説明
// 【実行タイミング】: なぜこのタイミングで実行するかを説明
```

### Then（検証フェーズ）のコメント

```dart
// 【結果検証】: 何を検証するかを具体的に説明
// 【期待値確認】: 期待される結果とその理由を説明
// 【品質保証】: この検証がシステム品質にどう貢献するかを説明
```

### 各expectステートメントのコメント

```dart
// 【検証項目】: この検証で確認している具体的な項目
// 🔵🟡🔴 この内容の信頼性レベルを記載
expect(presetPhrases.length, 50); // 【確認内容】: 初期データが50件以上あることを確認
expect(favoritePhrase.isFavorite, true); // 【確認内容】: お気に入りフラグがtrueであることを確認
```

### セットアップ・クリーンアップのコメント

```dart
setUp(() async {
  // 【テスト前準備】: 各テスト実行前に行う準備作業の説明
  // 【環境初期化】: テスト環境をクリーンな状態にする理由と方法
  await pumpApp(tester);
});

tearDown(() async {
  // 【テスト後処理】: 各テスト実行後に行うクリーンアップ作業の説明
  // 【状態復元】: 次のテストに影響しないよう状態を復元する理由
  await tester.pumpAndSettle();
});
```

---

## テストケース総数と分類

### 総数: 20件

- **正常系テストケース**: 10件（TC-E2E-083-001 〜 TC-E2E-083-010）
- **異常系テストケース**: 3件（TC-E2E-083-011 〜 TC-E2E-083-013）
- **境界値テストケース**: 2件（TC-E2E-083-014 〜 TC-E2E-083-015）
- **パフォーマンステストケース**: 2件（TC-E2E-083-016 〜 TC-E2E-083-017）
- **データ永続化テストケース**: 2件（TC-E2E-083-018 〜 TC-E2E-083-019）
- **統合テストケース**: 1件（TC-E2E-083-020）

---

## 要件カバレッジ

### 機能要件カバレッジ

| 要件ID | 要件名 | テストケース | カバレッジ |
|--------|--------|--------------|------------|
| REQ-101 | 定型文を一覧表示 | TC-E2E-083-001 | ✅ |
| REQ-102 | 定型文をタップすると入力欄に反映 | TC-E2E-083-006 | ✅ |
| REQ-103 | 定型文を直接タップで即座に読み上げ | TC-E2E-083-005, TC-E2E-083-017 | ✅ |
| REQ-104 | 定型文の追加・編集・削除機能 | TC-E2E-083-007, TC-E2E-083-008, TC-E2E-083-009 | ✅ |
| REQ-105 | お気に入り定型文を一覧上部に優先表示 | TC-E2E-083-002, TC-E2E-083-010, TC-E2E-083-019 | ✅ |
| REQ-106 | 定型文をカテゴリで分類 | TC-E2E-083-003 | ✅ |
| REQ-107 | 初期データとして汎用的な定型文サンプルを提供 | TC-E2E-083-004 | ✅ |

### 非機能要件カバレッジ

| 要件ID | 要件名 | テストケース | カバレッジ |
|--------|--------|--------------|------------|
| NFR-001 | TTS読み上げ開始が1秒以内 | TC-E2E-083-005, TC-E2E-083-017 | ✅ |
| NFR-004 | 定型文一覧の表示が1秒以内 | TC-E2E-083-016 | ✅ |
| NFR-201 | 主要な操作を3タップ以内で完了 | TC-E2E-083-005（1タップ）, TC-E2E-083-006（2タップ） | ✅ |
| NFR-301 | 重大エラーでも基本機能を継続利用可能 | TC-E2E-083-011, TC-E2E-083-013 | ✅ |
| REQ-5002 | 誤操作防止の仕組み | TC-E2E-083-009, TC-E2E-083-012 | ✅ |
| REQ-5003 | データ永続化機構 | TC-E2E-083-018, TC-E2E-083-019 | ✅ |

### 境界値・エッジケースカバレッジ

| エッジケース | テストケース | カバレッジ |
|--------------|--------------|------------|
| 定型文0件の状態 | TC-E2E-083-011 | ✅ |
| 定型文100件の表示 | TC-E2E-083-016 | ✅ |
| 定型文500文字制限 | TC-E2E-083-014, TC-E2E-083-015 | ✅ |
| カテゴリが空の場合 | TC-E2E-083-013 | ✅ |
| 削除のキャンセル | TC-E2E-083-012 | ✅ |

---

## 品質判定

### ✅ 高品質判定

- **テストケース分類**: 正常系（10件）・異常系（3件）・境界値（2件）・パフォーマンス（2件）・永続化（2件）・統合（1件）が網羅されている
- **期待値定義**: 各テストケースの期待値が明確に定義されている
- **技術選択**: Dart + integration_test + flutter_testが確定している
- **実装可能性**: TASK-0081で構築したE2Eテスト環境とヘルパー関数を活用して実現可能

### 要件網羅率: 100%

- すべての機能要件（REQ-101〜REQ-107）がカバーされている
- すべての非機能要件（NFR-001, NFR-004, NFR-201, NFR-301, REQ-5002, REQ-5003）がカバーされている
- すべての境界値・エッジケースがカバーされている

### 機能網羅率: 100%

- 定型文表示機能: 完全カバー
- 定型文選択・読み上げ機能: 完全カバー
- 定型文CRUD操作: 完全カバー
- パフォーマンス: 完全カバー
- データ永続化: 完全カバー

---

## 次のステップ

### 推奨: `/tsumiki:tdd-red` でRedフェーズ（失敗テスト作成）を開始します

このテストケース定義書に基づいて、20件のE2Eテストを実装します。

1. **テストファイル**: `frontend/kotonoha_app/integration_test/preset_phrase_test.dart`
2. **実装方針**:
   - TASK-0081で構築したヘルパー関数を活用
   - TASK-0082の文字入力・読み上げE2Eテストパターンを参考
   - 既存のunit testの定型文データモデルを活用
3. **期待される結果**: すべてのテストが失敗する（Red）
   - 定型文画面がまだ実装されていないため
   - 次のGreenフェーズで実装してテストを通す

---

## 更新履歴

- **2025-11-29**: テストケース定義書作成
  - 正常系10件、異常系3件、境界値2件、パフォーマンス2件、永続化2件、統合1件の計20件を定義
  - 要件カバレッジ100%を達成
  - 日本語コメント指針を明確化
  - 品質判定: ✅ 高品質
