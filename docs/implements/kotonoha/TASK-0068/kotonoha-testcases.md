# TASK-0068: AI変換UIウィジェット テストケース一覧

## 信頼性レベル: 🔵 青信号

EARS要件定義書（REQ-901, REQ-902, REQ-2006）およびインターフェース定義に基づいてテストケースを設計。

---

## 開発言語・フレームワーク

- **プログラミング言語**: Dart 🔵
  - **言語選択の理由**: Flutterアプリ開発の標準言語
  - **テストに適した機能**: Widget Testing、async/await、Riverpod連携
- **テストフレームワーク**: flutter_test + mocktail 🔵
  - **フレームワーク選択の理由**: Flutter標準、Providerのモッキングに適している
  - **テスト実行環境**: `flutter test`

---

## 1. 正常系テストケース

### TC-068-001: AI変換ボタンが表示される

- **テスト名**: AI変換ボタンがウィジェットに表示される
  - **何をテストするか**: AIConversionButtonウィジェットが正しくレンダリングされること
  - **期待される動作**: 「AI変換」というラベルのボタンが表示される
- **入力値**:
  - オンライン状態のネットワーク
  - 入力テキストあり（例: "水 ぬるく"）
  - **入力データの意味**: 通常の使用状態をシミュレート
- **期待される結果**:
  - 「AI変換」ボタンが表示される
  - ボタンが有効状態（タップ可能）
  - **期待結果の理由**: REQ-901に基づき、AI変換機能へのアクセスが必要
- **テストの目的**: REQ-901（AI変換機能）のUI表示検証
  - **確認ポイント**: ボタンが視認性高く表示されること
- 🔵 青信号（REQ-901に明確に定義）

---

### TC-068-002: 丁寧さレベル選択UIが表示される

- **テスト名**: 丁寧さレベル選択セレクタが表示される
  - **何をテストするか**: PolitenessLevelSelector（セグメントコントロール）が正しく表示されること
  - **期待される動作**: 「カジュアル」「普通」「丁寧」の3つのオプションが表示される
- **入力値**:
  - なし（初期表示）
  - **入力データの意味**: REQ-903の3段階丁寧さレベルをUI表示
- **期待される結果**:
  - 3つの丁寧さレベルオプションが表示される
  - デフォルトで「普通」が選択されている
  - **期待結果の理由**: REQ-903に基づく丁寧さレベル3段階
- **テストの目的**: REQ-903（丁寧さレベル選択）の検証
  - **確認ポイント**: 各オプションが明確に区別できること
- 🔵 青信号（REQ-903に明確に定義）

---

### TC-068-003: 丁寧さレベルを変更できる

- **テスト名**: 丁寧さレベルをタップで変更できる
  - **何をテストするか**: 丁寧さレベルの選択が正しく機能すること
  - **期待される動作**: 各レベルをタップすると選択状態が変わる
- **入力値**:
  - 「丁寧」オプションをタップ
  - **入力データの意味**: ユーザーによる丁寧さレベルの変更操作
- **期待される結果**:
  - 「丁寧」が選択状態になる
  - 視覚的に選択状態が区別できる
  - **期待結果の理由**: REQ-903に基づく丁寧さレベル切り替え
- **テストの目的**: 丁寧さレベル選択の操作性検証
  - **確認ポイント**: タップ操作で確実に切り替えができること
- 🔵 青信号

---

### TC-068-004: AI変換ボタンタップでローディング表示される

- **テスト名**: AI変換ボタンタップ後にローディング状態になる
  - **何をテストするか**: AI変換実行中のローディング状態表示
  - **期待される動作**: ボタンタップ後、変換中状態を示すUIに変わる
- **入力値**:
  - 入力テキスト: "水 ぬるく"
  - AI変換ボタンをタップ
  - **入力データの意味**: AI変換の実行開始操作
- **期待される結果**:
  - ボタンがローディング状態になる
  - CircularProgressIndicatorまたは類似のインジケーターが表示される
  - **期待結果の理由**: REQ-2006に基づくローディング表示
- **テストの目的**: REQ-2006（ローディング表示）の検証
  - **確認ポイント**: ユーザーに処理中であることが伝わること
- 🔵 青信号（REQ-2006に明確に定義）

---

### TC-068-005: 3秒超過時にローディングメッセージが表示される

- **テスト名**: 3秒超過時に「変換中...」メッセージが追加表示される
  - **何をテストするか**: REQ-2006の3秒超過時のローディング表示
  - **期待される動作**: 3秒経過後、追加のローディングメッセージが表示される
- **入力値**:
  - AI変換処理が3秒以上かかる状況（モック）
  - **入力データの意味**: 長時間処理のシミュレーション
- **期待される結果**:
  - 「AI変換中...」などのメッセージが表示される
  - 進行状況インジケーターが継続して表示される
  - **期待結果の理由**: REQ-2006の3秒超過時ローディング表示
- **テストの目的**: REQ-2006（3秒超過時のフィードバック）の検証
  - **確認ポイント**: ユーザーが処理継続を認識できること
- 🔵 青信号

---

### TC-068-006: AI変換結果プレビューが表示される

- **テスト名**: AI変換完了後に結果プレビューが表示される
  - **何をテストするか**: 変換結果のプレビュー表示
  - **期待される動作**: 変換完了後、結果テキストがプレビュー表示される
- **入力値**:
  - AI変換成功レスポンス（モック）
  - convertedText: "お水をぬるめでお願いします"
  - **入力データの意味**: 成功した変換結果の表示
- **期待される結果**:
  - 変換結果テキストが表示される
  - ローディングが終了する
  - **期待結果の理由**: REQ-902に基づく結果表示
- **テストの目的**: REQ-902（変換結果の自動表示）の検証
  - **確認ポイント**: 変換結果が読みやすく表示されること
- 🔵 青信号（REQ-902に明確に定義）

---

## 2. 異常系テストケース

### TC-068-007: オフライン時にAI変換ボタンが無効化される

- **テスト名**: オフライン時はAI変換ボタンがグレーアウトされる
  - **エラーケースの概要**: ネットワーク接続がない状態
  - **エラー処理の重要性**: REQ-3004（オフライン時のボタン無効化）
- **入力値**:
  - ネットワーク状態: offline
  - **不正な理由**: AI変換にはネットワーク接続が必須
  - **実際の発生シナリオ**: Wi-Fi切断、機内モード
- **期待される結果**:
  - AI変換ボタンが無効状態（グレーアウト）
  - タップしても反応しない
  - **エラーメッセージの内容**: 必要に応じてツールチップで説明
  - **システムの安全性**: 不要なエラー発生を防止
- **テストの目的**: REQ-3004（オフライン時のボタン無効化）の検証
  - **品質保証の観点**: ユーザーの混乱を防ぐ
- 🔵 青信号（REQ-3004に明確に定義）

---

### TC-068-008: 入力テキストが空の場合ボタンが無効化される

- **テスト名**: 入力欄が空の場合、AI変換ボタンが無効化される
  - **エラーケースの概要**: 変換対象テキストがない状態
  - **エラー処理の重要性**: 無意味なAPI呼び出しの防止
- **入力値**:
  - 入力テキスト: ""（空文字）
  - ネットワーク状態: online
  - **不正な理由**: 変換対象がない
  - **実際の発生シナリオ**: アプリ起動直後、全消去後
- **期待される結果**:
  - AI変換ボタンが無効状態
  - タップしても反応しない
  - **システムの安全性**: 不要なAPI呼び出し防止
- **テストの目的**: 入力バリデーションの検証
  - **品質保証の観点**: UX向上、API負荷軽減
- 🟡 黄信号（EDGE-105から推測）

---

### TC-068-009: 入力テキストが2文字未満の場合ボタンが無効化される

- **テスト名**: 入力文字数が2文字未満の場合、AI変換ボタンが無効化される
  - **エラーケースの概要**: 入力文字数がAPI最小要件を満たさない
  - **エラー処理の重要性**: バックエンドバリデーションエラーの事前防止
- **入力値**:
  - 入力テキスト: "あ"（1文字）
  - **不正な理由**: API仕様の最小文字数2文字を満たさない
  - **実際の発生シナリオ**: 非常に短い入力
- **期待される結果**:
  - AI変換ボタンが無効状態
  - 必要に応じて「もう少し長く入力してください」などのヒント表示
  - **システムの安全性**: 無効なAPIリクエスト防止
- **テストの目的**: クライアントサイドバリデーションの検証
  - **品質保証の観点**: エラー体験の改善
- 🟡 黄信号（EDGE-105から推測）

---

### TC-068-010: AI変換中に重複タップが防止される

- **テスト名**: 変換処理中はボタンを再度タップできない
  - **エラーケースの概要**: 処理中の重複リクエスト
  - **エラー処理の重要性**: 重複API呼び出しの防止
- **入力値**:
  - AI変換処理実行中
  - AI変換ボタンを再度タップ
  - **不正な理由**: 処理中の重複操作
  - **実際の発生シナリオ**: ユーザーの連打操作
- **期待される結果**:
  - ボタンが無効状態でタップを受け付けない
  - または、タップしても新しいリクエストが送信されない
  - **システムの安全性**: 重複APIリクエスト防止
- **テストの目的**: 操作の排他制御検証
  - **品質保証の観点**: システム安定性、レート制限対策
- 🟡 黄信号（REQ-5002から推測）

---

### TC-068-011: ネットワーク状態変化でボタン状態が更新される

- **テスト名**: オンライン→オフライン切り替え時にボタン状態が更新される
  - **エラーケースの概要**: 動的なネットワーク状態変化
  - **エラー処理の重要性**: リアルタイムなUI状態反映
- **入力値**:
  - 初期状態: online（ボタン有効）
  - ネットワーク状態変化: offline
  - **不正な理由**: ネットワーク切断
  - **実際の発生シナリオ**: 使用中のWi-Fi切断
- **期待される結果**:
  - ボタンが自動的にグレーアウト
  - 追加操作なしでUI更新
  - **システムの安全性**: 常に正確なUI状態
- **テストの目的**: ネットワーク状態連携の検証
  - **品質保証の観点**: リアルタイムなフィードバック
- 🔵 青信号（REQ-3004に基づく）

---

## 3. 境界値テストケース

### TC-068-012: 最小有効文字数（2文字）でボタンが有効

- **テスト名**: 2文字入力でAI変換ボタンが有効になる
  - **境界値の意味**: 入力最小文字数の境界
  - **境界値での動作保証**: ちょうど2文字で有効になること
- **入力値**:
  - 入力テキスト: "水水"（2文字）
  - ネットワーク状態: online
  - **境界値選択の根拠**: API仕様の最小値
  - **実際の使用場面**: 極端に短い有効入力
- **期待される結果**:
  - AI変換ボタンが有効状態
  - タップで変換処理が開始できる
  - **境界での正確性**: 2文字で正確に有効化
- **テストの目的**: 入力文字数下限の検証
- 🔵 青信号

---

### TC-068-013: 3秒ジャストでのローディングメッセージ表示

- **テスト名**: 処理開始から3秒ジャストでローディングメッセージが表示される
  - **境界値の意味**: ローディングメッセージ表示の時間境界
  - **境界値での動作保証**: 3秒経過でメッセージが表示されること
- **入力値**:
  - 処理時間: ちょうど3秒
  - **境界値選択の根拠**: REQ-2006の3秒閾値
  - **実際の使用場面**: AI処理の平均的な遅延
- **期待される結果**:
  - 3秒経過時点でローディングメッセージが表示される
  - **境界での正確性**: タイマーが正確に3秒をカウント
- **テストの目的**: REQ-2006のタイムアウト表示検証
- 🔵 青信号

---

### TC-068-014: 各丁寧さレベルが正しく選択・表示される

- **テスト名**: 全3種類の丁寧さレベルが選択可能
  - **境界値の意味**: 丁寧さレベルの全パターン
  - **境界値での動作保証**: 全レベルが正しく機能すること
- **入力値**:
  - casual, normal, politeの各レベルを順に選択
  - **境界値選択の根拠**: REQ-903の3段階定義
  - **実際の使用場面**: ユーザーによるレベル切り替え
- **期待される結果**:
  - 各レベルが選択可能
  - 選択状態が視覚的に区別できる
  - **一貫した動作**: 全レベルで同様の操作性
- **テストの目的**: 丁寧さレベル全パターンの検証
- 🔵 青信号

---

## 4. 単体テストケース（ウィジェット・状態管理）

### TC-068-015: AIConversionButtonウィジェットのアクセシビリティ

- **テスト名**: AI変換ボタンが適切なセマンティクスを持つ
  - **何をテストするか**: アクセシビリティ対応
- **入力値**:
  - AIConversionButtonウィジェット
- **期待される結果**:
  - Semanticsラベルが設定されている
  - タップターゲットが44px以上
  - **期待結果の理由**: REQ-5001のタップターゲットサイズ要件
- **テストの目的**: アクセシビリティ要件の検証
- 🟡 黄信号（REQ-5001から推測）

---

### TC-068-016: ローディングタイマーが正しく動作する

- **テスト名**: 3秒タイマーが正確に動作する
  - **何をテストするか**: ローディングメッセージ表示タイマー
- **入力値**:
  - AI変換開始
- **期待される結果**:
  - 3秒未満: ローディングメッセージなし
  - 3秒以上: ローディングメッセージ表示
  - **期待結果の理由**: REQ-2006の3秒閾値
- **テストの目的**: タイマー動作の正確性検証
- 🔵 青信号

---

### TC-068-017: ウィジェットが正しくDisposeされる

- **テスト名**: ウィジェット破棄時にリソースがクリーンアップされる
  - **何をテストするか**: メモリリーク防止
- **入力値**:
  - ウィジェットをマウント→アンマウント
- **期待される結果**:
  - タイマーがキャンセルされる
  - 状態がクリアされる
  - **期待結果の理由**: Flutterのライフサイクル管理
- **テストの目的**: リソース管理の検証
- 🟡 黄信号

---

### TC-068-018: 丁寧さレベル選択が設定と連携する

- **テスト名**: デフォルト丁寧さレベルが設定から取得される
  - **何をテストするか**: 設定との連携
- **入力値**:
  - 設定の丁寧さレベル: polite
- **期待される結果**:
  - 初期選択が「丁寧」になる
  - **期待結果の理由**: REQ-903と設定機能の連携
- **テストの目的**: 設定連携の検証
- 🟡 黄信号

---

## テストケース一覧表

| テストID | カテゴリ | テスト名 | 信頼性 |
|---------|---------|---------|-------|
| TC-068-001 | 正常系 | AI変換ボタン表示 | 🔵 |
| TC-068-002 | 正常系 | 丁寧さレベル選択UI表示 | 🔵 |
| TC-068-003 | 正常系 | 丁寧さレベル変更 | 🔵 |
| TC-068-004 | 正常系 | ローディング表示 | 🔵 |
| TC-068-005 | 正常系 | 3秒超過ローディングメッセージ | 🔵 |
| TC-068-006 | 正常系 | 変換結果プレビュー表示 | 🔵 |
| TC-068-007 | 異常系 | オフライン時ボタン無効化 | 🔵 |
| TC-068-008 | 異常系 | 空入力時ボタン無効化 | 🟡 |
| TC-068-009 | 異常系 | 2文字未満時ボタン無効化 | 🟡 |
| TC-068-010 | 異常系 | 重複タップ防止 | 🟡 |
| TC-068-011 | 異常系 | ネットワーク状態変化時UI更新 | 🔵 |
| TC-068-012 | 境界値 | 最小有効文字数（2文字） | 🔵 |
| TC-068-013 | 境界値 | 3秒ジャストローディング | 🔵 |
| TC-068-014 | 境界値 | 全丁寧さレベル選択 | 🔵 |
| TC-068-015 | 単体 | アクセシビリティ | 🟡 |
| TC-068-016 | 単体 | ローディングタイマー | 🔵 |
| TC-068-017 | 単体 | Dispose処理 | 🟡 |
| TC-068-018 | 単体 | 設定連携 | 🟡 |

---

## 品質判定

### ✅ 高品質

- **テストケース分類**: 正常系6件、異常系5件、境界値3件、単体4件で網羅
- **期待値定義**: 全テストケースで期待値が明確
- **技術選択**: Dart + flutter_test + mocktail（導入済み）
- **実装可能性**: 全テストケースが現在の技術スタックで実現可能

---

## 次のステップ

次のお勧めステップ: `/tsumiki:tdd-red` でRedフェーズ（失敗テスト作成）を開始します。
