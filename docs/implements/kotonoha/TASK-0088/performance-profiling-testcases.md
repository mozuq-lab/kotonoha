# TASK-0088: パフォーマンス計測・プロファイリング - テストケース一覧

## タスク情報

- **タスクID**: TASK-0088
- **タスクタイプ**: TDD
- **要件名**: kotonoha
- **関連要件**: NFR-001, NFR-002, NFR-003, NFR-004
- **実行日**: 2025-11-30

## 開発言語・フレームワーク

- **プログラミング言語**: Dart 3.10+
  - **言語選択の理由**: Flutterプロジェクトの標準言語
  - **テストに適した機能**: `Stopwatch`クラスによる高精度時間計測
- **テストフレームワーク**: flutter_test + integration_test
  - **フレームワーク選択の理由**: E2Eテスト用公式フレームワーク
  - **テスト実行環境**: iOS Simulator / Android Emulator / 実機
- 🔵 青信号 - 既存のE2Eテストと同一の技術スタック

---

## 1. 正常系テストケース（基本的な動作）

### TC-E2E-088-001: 文字盤タップ応答時間が100ms以内

- **テスト名**: 文字盤タップ応答時間が100ms以内
  - **何をテストするか**: 文字盤の文字をタップしてから入力欄に反映されるまでの時間
  - **期待される動作**: 100ms以内に入力欄に文字が表示される
- **入力値**: 文字盤の「あ」をタップ
  - **入力データの意味**: 最も基本的な文字入力操作
- **期待される結果**: 応答時間 ≤ 100ms
  - **期待結果の理由**: NFR-003で定義されたパフォーマンス要件
- **テストの目的**: 文字盤UIの応答性確認
  - **確認ポイント**: ユーザーがタップした瞬間から視覚的フィードバックまでの遅延
- 🔵 青信号 - NFR-003に基づく

### TC-E2E-088-002: 10文字連続入力時の各タップ応答時間

- **テスト名**: 10文字連続入力時も各タップが100ms以内
  - **何をテストするか**: 連続入力時のパフォーマンス劣化がないことを確認
  - **期待される動作**: 連続入力でも各タップが100ms以内で応答
- **入力値**: 「あいうえおかきくけこ」を連続入力
  - **入力データの意味**: 実際の使用場面に近い連続入力
- **期待される結果**: 各タップの応答時間 ≤ 100ms
  - **期待結果の理由**: 連続操作でもパフォーマンスが維持されること
- **テストの目的**: 連続操作時の安定性確認
  - **確認ポイント**: 状態更新の累積による遅延がないこと
- 🟡 黄信号 - NFR-003から推測した連続操作テスト

### TC-E2E-088-003: TTS読み上げ開始時間が1秒以内

- **テスト名**: TTS読み上げ開始時間が1秒以内
  - **何をテストするか**: 読み上げボタンタップからTTS開始までの時間
  - **期待される動作**: 1秒以内に音声再生が開始される
- **入力値**: 入力欄に「こんにちは」がある状態で読み上げボタンをタップ
  - **入力データの意味**: 標準的な短文の読み上げ
- **期待される結果**: TTS開始時間 ≤ 1000ms
  - **期待結果の理由**: NFR-001で定義されたパフォーマンス要件
- **テストの目的**: TTS応答性確認
  - **確認ポイント**: OS標準TTSの初期化・再生開始までの遅延
- 🔵 青信号 - NFR-001に基づく

### TC-E2E-088-004: 複数回TTS読み上げの安定性

- **テスト名**: 複数回のTTS読み上げで安定して1秒以内
  - **何をテストするか**: 繰り返し読み上げ時のパフォーマンス安定性
  - **期待される動作**: 3回連続で読み上げても各回1秒以内
- **入力値**: 「こんにちは」を3回連続で読み上げ
  - **入力データの意味**: 実際の使用場面での繰り返し操作
- **期待される結果**: 各回のTTS開始時間 ≤ 1000ms
  - **期待結果の理由**: 繰り返し操作での安定性確認
- **テストの目的**: TTS安定性確認
  - **確認ポイント**: TTSエンジンのキャッシュ・再利用が正常に動作すること
- 🟡 黄信号 - NFR-001から推測した安定性テスト

### TC-E2E-088-005: 定型文100件表示が1秒以内

- **テスト名**: 定型文100件が1秒以内に表示完了
  - **何をテストするか**: 定型文一覧の初期表示速度
  - **期待される動作**: 100件の定型文が1秒以内に画面に表示される
- **入力値**: 定型文タブをタップ（100件の定型文データあり）
  - **入力データの意味**: NFR-004で想定されたデータ量
- **期待される結果**: 表示完了時間 ≤ 1000ms
  - **期待結果の理由**: NFR-004で定義されたパフォーマンス要件
- **テストの目的**: 定型文一覧表示速度確認
  - **確認ポイント**: Hiveからのデータ読み込み〜UI描画完了まで
- 🔵 青信号 - NFR-004に基づく

### TC-E2E-088-006: AI変換応答時間が3秒以内

- **テスト名**: AI変換応答時間が平均3秒以内
  - **何をテストするか**: AI変換ボタンタップから結果表示までの時間
  - **期待される動作**: 変換結果が3秒以内に表示される
- **入力値**: 入力欄に「おなかすいた」がある状態でAI変換ボタンをタップ
  - **入力データの意味**: 短文のAI変換リクエスト
- **期待される結果**: AI変換応答時間 ≤ 3000ms（平均）
  - **期待結果の理由**: NFR-002で定義されたパフォーマンス要件
- **テストの目的**: AI変換応答性確認
  - **確認ポイント**: バックエンドAPI通信〜結果表示までの遅延
- 🔵 青信号 - NFR-002に基づく

---

## 2. 異常系テストケース（エラーハンドリング）

### TC-E2E-088-007: AI変換3秒超過時のローディング表示

- **テスト名**: AI変換が3秒超過時にローディング表示される
  - **エラーケースの概要**: AI変換が3秒以上かかる場合のUI対応
  - **エラー処理の重要性**: ユーザーに処理中であることを明示
- **入力値**: 3秒以上かかるAI変換リクエスト（モックで遅延を再現）
  - **不正な理由**: パフォーマンス要件を超過する状況
  - **実際の発生シナリオ**: ネットワーク遅延、サーバー高負荷時
- **期待される結果**: ローディングインジケーターが表示される
  - **エラーメッセージの内容**: 進行状況を示すインジケーター
  - **システムの安全性**: ユーザーがアプリがフリーズしたと誤解しない
- **テストの目的**: ローディング表示の動作確認
  - **品質保証の観点**: UXの維持（処理中であることの明示）
- 🔵 青信号 - REQ-2006に基づく

### TC-E2E-088-008: オフライン時のAI変換ボタン無効化

- **テスト名**: オフライン時にAI変換ボタンが無効化される
  - **エラーケースの概要**: ネットワーク接続がない状態でのAI変換操作
  - **エラー処理の重要性**: 不可能な操作を事前に防止
- **入力値**: オフライン状態でAI変換ボタンをタップ
  - **不正な理由**: ネットワーク接続がないとAI変換は実行不可
  - **実際の発生シナリオ**: 通信圏外、機内モード時
- **期待される結果**: ボタンが無効化/グレーアウト表示
  - **エラーメッセージの内容**: 視覚的にボタンが無効であることを示す
  - **システムの安全性**: 無駄なAPIリクエストを防止
- **テストの目的**: オフライン時のUI対応確認
  - **品質保証の観点**: ユーザー混乱の防止
- 🔵 青信号 - REQ-3004に基づく

---

## 3. 境界値テストケース

### TC-E2E-088-009: 定型文200件表示が2秒以内

- **テスト名**: 定型文200件でも2秒以内に表示
  - **境界値の意味**: 想定を超えるデータ量での余裕確認
  - **境界値での動作保証**: 大量データでも許容範囲内の応答時間
- **入力値**: 定型文タブをタップ（200件の定型文データあり）
  - **境界値選択の根拠**: NFR-004の100件を2倍に設定
  - **実際の使用場面**: ヘビーユーザーの大量定型文登録
- **期待される結果**: 表示完了時間 ≤ 2000ms
  - **境界での正確性**: 余裕を持った基準での動作確認
  - **一貫した動作**: 100件と同等のレスポンス体感
- **テストの目的**: スケーラビリティ確認
  - **堅牢性の確認**: データ量増加時のパフォーマンス劣化度合い
- 🟡 黄信号 - NFR-004から推測した拡張テスト

### TC-E2E-088-010: 長文TTS読み上げ開始時間

- **テスト名**: 長文（500文字）でもTTS読み上げ開始が1秒以内
  - **境界値の意味**: 最大入力文字数に近い長文での動作確認
  - **境界値での動作保証**: 長文でも低遅延を維持
- **入力値**: 500文字のテキストを読み上げ
  - **境界値選択の根拠**: 定型文最大500文字（EDGE-102）に基づく
  - **実際の使用場面**: 長い説明文や複数文の連続読み上げ
- **期待される結果**: TTS開始時間 ≤ 1000ms
  - **境界での正確性**: 文字数に関わらず初回発声までの遅延は一定
  - **一貫した動作**: 短文と同等の開始レスポンス
- **テストの目的**: 長文処理時の応答性確認
  - **堅牢性の確認**: TTSエンジンのバッファリング影響
- 🟡 黄信号 - NFR-001から推測した境界値テスト

### TC-E2E-088-011: 空入力からのTTS応答

- **テスト名**: 空入力状態での読み上げボタン動作
  - **境界値の意味**: 最小入力（0文字）での動作確認
  - **境界値での動作保証**: 空入力時の適切なエラーハンドリング
- **入力値**: 入力欄が空の状態で読み上げボタンをタップ
  - **境界値選択の根拠**: 入力文字数の最小値
  - **実際の使用場面**: 誤操作による空入力読み上げ
- **期待される結果**: エラー表示または無反応（クラッシュしない）
  - **境界での正確性**: 空入力を適切にハンドリング
  - **一貫した動作**: アプリがクラッシュせず安定動作
- **テストの目的**: 空入力時の堅牢性確認
  - **堅牢性の確認**: エッジケースでのクラッシュ防止
- 🟡 黄信号 - EDGE-103から推測

---

## 4. パフォーマンス比較テストケース

### TC-E2E-088-012: UIブロック確認（非同期処理）

- **テスト名**: データ読み込み中もUIがブロックされない
  - **何をテストするか**: 非同期処理中のUI応答性
  - **期待される動作**: データ読み込み中も他の操作が可能
- **入力値**: 定型文読み込み中に別の操作を実行
  - **入力データの意味**: 同時並行操作のシミュレーション
- **期待される結果**: UI操作が可能（フリーズしない）
  - **期待結果の理由**: 非同期処理の正常動作
- **テストの目的**: 非同期処理の確認
  - **確認ポイント**: Future/async処理がUIスレッドをブロックしない
- 🟡 黄信号 - アーキテクチャ設計から推測

### TC-E2E-088-013: 初回起動時のパフォーマンス

- **テスト名**: 初回起動時のアプリ起動速度
  - **何をテストするか**: コールドスタート時のアプリ起動時間
  - **期待される動作**: 3秒以内にホーム画面が表示される
- **入力値**: アプリをコールドスタート
  - **入力データの意味**: ユーザーがアプリを初めて開く場面
- **期待される結果**: ホーム画面表示 ≤ 3000ms
  - **期待結果の理由**: 妥当な起動時間の目安
- **テストの目的**: 起動速度確認
  - **確認ポイント**: Hive初期化、UI初期レンダリング
- 🟡 黄信号 - パフォーマンス要件から推測

---

## 5. テストケースサマリー

| テストID | テスト名 | 対象要件 | 信頼性 |
|----------|----------|----------|--------|
| TC-E2E-088-001 | 文字盤タップ応答時間が100ms以内 | NFR-003 | 🔵 |
| TC-E2E-088-002 | 10文字連続入力時の各タップ応答時間 | NFR-003 | 🟡 |
| TC-E2E-088-003 | TTS読み上げ開始時間が1秒以内 | NFR-001 | 🔵 |
| TC-E2E-088-004 | 複数回TTS読み上げの安定性 | NFR-001 | 🟡 |
| TC-E2E-088-005 | 定型文100件表示が1秒以内 | NFR-004 | 🔵 |
| TC-E2E-088-006 | AI変換応答時間が3秒以内 | NFR-002 | 🔵 |
| TC-E2E-088-007 | AI変換3秒超過時のローディング表示 | REQ-2006 | 🔵 |
| TC-E2E-088-008 | オフライン時のAI変換ボタン無効化 | REQ-3004 | 🔵 |
| TC-E2E-088-009 | 定型文200件表示が2秒以内 | NFR-004 | 🟡 |
| TC-E2E-088-010 | 長文TTS読み上げ開始時間 | NFR-001 | 🟡 |
| TC-E2E-088-011 | 空入力からのTTS応答 | EDGE | 🟡 |
| TC-E2E-088-012 | UIブロック確認（非同期処理） | NFR | 🟡 |
| TC-E2E-088-013 | 初回起動時のパフォーマンス | NFR | 🟡 |

## 6. 品質判定

### 判定結果: ✅ 高品質

| 評価項目 | ステータス |
|----------|------------|
| テストケース分類 | ✅ 正常系6件・異常系2件・境界値5件で網羅 |
| 期待値定義 | ✅ 各テストケースの期待値が明確（具体的な数値） |
| 技術選択 | ✅ Dart + flutter_test + integration_test |
| 実装可能性 | ✅ 既存の`measurePerformance()`ヘルパーを活用可能 |

### 要件カバレッジ

| 要件ID | カバレッジ |
|--------|------------|
| NFR-001 | ✅ TC-E2E-088-003, 004, 010, 011 |
| NFR-002 | ✅ TC-E2E-088-006, 007 |
| NFR-003 | ✅ TC-E2E-088-001, 002 |
| NFR-004 | ✅ TC-E2E-088-005, 009 |
| REQ-2006 | ✅ TC-E2E-088-007 |
| REQ-3004 | ✅ TC-E2E-088-008 |

## 信頼性レベル

🔵 青信号 - EARS要件定義書に基づくテストケース設計

---

次のお勧めステップ: `/tsumiki:tdd-red` でRedフェーズ（失敗テスト作成）を開始します。
