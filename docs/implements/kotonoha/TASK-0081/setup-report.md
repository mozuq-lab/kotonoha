# TASK-0081 E2Eãƒ†ã‚¹ãƒˆç’°å¢ƒæ§‹ç¯‰ è¨­å®šä½œæ¥­å®Ÿè¡Œ

## ä½œæ¥­æ¦‚è¦

- **ã‚¿ã‚¹ã‚¯ID**: TASK-0081
- **ä½œæ¥­å†…å®¹**: E2Eãƒ†ã‚¹ãƒˆç’°å¢ƒæ§‹ç¯‰ï¼ˆintegration_testãƒ‘ãƒƒã‚±ãƒ¼ã‚¸è¨­å®šã€ãƒ¢ãƒƒã‚¯ã‚µãƒ¼ãƒãƒ¼ã€ãƒ†ã‚¹ãƒˆãƒ˜ãƒ«ãƒ‘ãƒ¼ï¼‰
- **å®Ÿè¡Œæ—¥æ™‚**: 2025-11-29
- **ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«**: ğŸŸ¡ é»„ä¿¡å·ï¼ˆãƒ†ã‚¹ãƒˆæˆ¦ç•¥ã¯è¦ä»¶å®šç¾©æ›¸ã‹ã‚‰æ¨æ¸¬ï¼‰

## è¨­è¨ˆæ–‡æ›¸å‚ç…§

- **å‚ç…§æ–‡æ›¸**:
  - `docs/tech-stack.md` - ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«å®šç¾©
  - `docs/tasks/kotonoha-phase5.md` - ã‚¿ã‚¹ã‚¯è©³ç´°
- **é–¢é€£è¦ä»¶**: NFR-501, NFR-502

## å®Ÿè¡Œã—ãŸä½œæ¥­

### 1. ä¾å­˜é–¢ä¿‚ã®è¿½åŠ 

**æ›´æ–°ãƒ•ã‚¡ã‚¤ãƒ«**: `frontend/kotonoha_app/pubspec.yaml`

```yaml
dev_dependencies:
  # E2E/çµ±åˆãƒ†ã‚¹ãƒˆ
  integration_test:
    sdk: flutter

  # ãƒ¢ãƒƒã‚¯ã‚µãƒ¼ãƒãƒ¼ï¼ˆE2Eãƒ†ã‚¹ãƒˆç”¨ï¼‰
  http_mock_adapter: ^0.6.1
```

**è¿½åŠ å†…å®¹**:
- `integration_test`: Flutterå…¬å¼ã®E2Eãƒ†ã‚¹ãƒˆãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
- `http_mock_adapter`: AIå¤‰æ›APIã®ãƒ¢ãƒƒã‚¯ã‚µãƒ¼ãƒãƒ¼ç”¨

### 2. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ä½œæˆ

```
frontend/kotonoha_app/integration_test/
â”œâ”€â”€ README.md                    # E2Eãƒ†ã‚¹ãƒˆã®ä½¿ç”¨æ–¹æ³•
â”œâ”€â”€ test_driver.dart             # ãƒ†ã‚¹ãƒˆãƒ‰ãƒ©ã‚¤ãƒãƒ¼
â”œâ”€â”€ app_startup_test.dart        # ã‚¢ãƒ—ãƒªèµ·å‹•ãƒ†ã‚¹ãƒˆï¼ˆã‚µãƒ³ãƒ—ãƒ«ï¼‰
â””â”€â”€ helpers/
    â”œâ”€â”€ helpers.dart             # ãƒ˜ãƒ«ãƒ‘ãƒ¼ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
    â”œâ”€â”€ test_helpers.dart        # ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
    â”œâ”€â”€ mock_api_server.dart     # ãƒ¢ãƒƒã‚¯APIã‚µãƒ¼ãƒãƒ¼
    â””â”€â”€ test_data_setup.dart     # ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
```

### 3. ãƒ†ã‚¹ãƒˆãƒ˜ãƒ«ãƒ‘ãƒ¼å®Ÿè£…

**ä½œæˆãƒ•ã‚¡ã‚¤ãƒ«**: `integration_test/helpers/test_helpers.dart`

- `initializeE2ETestBinding()`: E2Eãƒ†ã‚¹ãƒˆãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°åˆæœŸåŒ–
- `pumpApp()`: ã‚¢ãƒ—ãƒªã®åˆæœŸåŒ–ã¨ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
- `measurePerformance()`: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨ˆæ¸¬
- `waitForText()`: ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤ºå¾…æ©Ÿ
- `waitForWidget()`: ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆè¡¨ç¤ºå¾…æ©Ÿ
- `tapCharacterOnBoard()`: æ–‡å­—ç›¤ã‚¿ãƒƒãƒ—
- `typeOnCharacterBoard()`: è¤‡æ•°æ–‡å­—å…¥åŠ›
- `tapButton()`: ãƒœã‚¿ãƒ³ã‚¿ãƒƒãƒ—
- `navigateTo()`: ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³
- `takeScreenshot()`: ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆå–å¾—

### 4. ãƒ¢ãƒƒã‚¯APIã‚µãƒ¼ãƒãƒ¼è¨­å®š

**ä½œæˆãƒ•ã‚¡ã‚¤ãƒ«**: `integration_test/helpers/mock_api_server.dart`

- AIå¤‰æ›API (`/api/v1/ai/convert`) ã®ãƒ¢ãƒƒã‚¯
- å†ç”ŸæˆAPI (`/api/v1/ai/regenerate`) ã®ãƒ¢ãƒƒã‚¯
- ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯API (`/api/v1/health`) ã®ãƒ¢ãƒƒã‚¯
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¦ä»¶å®šæ•°ã®å®šç¾©

### 5. ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

**ä½œæˆãƒ•ã‚¡ã‚¤ãƒ«**: `integration_test/helpers/test_data_setup.dart`

- `clearAllTestData()`: å…¨ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢
- `setupTestHistory()`: å±¥æ­´ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
- `setupTestPhrases()`: å®šå‹æ–‡ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
- `setupDefaultSettings()`: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
- `setupMaxHistory()`: 50ä»¶å±¥æ­´ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
- `setupPerformanceTestData()`: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆç”¨å¤§é‡ãƒ‡ãƒ¼ã‚¿
- `setupTestFavorites()`: ãŠæ°—ã«å…¥ã‚Šãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### 6. CIç’°å¢ƒè¨­å®š

**ä½œæˆãƒ•ã‚¡ã‚¤ãƒ«**: `.github/workflows/flutter-test.yml`

- GitHub Actionsãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼è¨­å®š
- å˜ä½“ãƒ†ã‚¹ãƒˆè‡ªå‹•å®Ÿè¡Œ
- çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆChrome headlessï¼‰è‡ªå‹•å®Ÿè¡Œ
- ã‚³ãƒ¼ãƒ‰ã‚«ãƒãƒ¬ãƒƒã‚¸æ¸¬å®š

## ä½œæ¥­çµæœ

- [x] integration_testãƒ‘ãƒƒã‚±ãƒ¼ã‚¸è¿½åŠ å®Œäº†
- [x] ãƒ¢ãƒƒã‚¯ã‚µãƒ¼ãƒãƒ¼è¨­å®šå®Œäº†
- [x] ãƒ†ã‚¹ãƒˆãƒ˜ãƒ«ãƒ‘ãƒ¼å®Ÿè£…å®Œäº†
- [x] ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å®Ÿè£…å®Œäº†
- [x] CIç’°å¢ƒè¨­å®šå®Œäº†
- [x] é™çš„è§£æãƒ‘ã‚¹

## é­é‡ã—ãŸå•é¡Œã¨è§£æ±ºæ–¹æ³•

### å•é¡Œ1: http_mock_adapterãƒãƒ¼ã‚¸ãƒ§ãƒ³ä¸æ•´åˆ

- **ç™ºç”ŸçŠ¶æ³**: `http_mock_adapter: ^0.7.0` ãŒå­˜åœ¨ã—ãªã„
- **ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**: `version solving failed`
- **è§£æ±ºæ–¹æ³•**: ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ `^0.6.1` ã«å¤‰æ›´

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

- `/tsumiki:direct-verify` ã‚’å®Ÿè¡Œã—ã¦è¨­å®šã‚’ç¢ºèª
- TASK-0082: æ–‡å­—å…¥åŠ›ãƒ»èª­ã¿ä¸Šã’E2Eãƒ†ã‚¹ãƒˆå®Ÿè£…

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¦ä»¶

E2Eãƒ†ã‚¹ãƒˆã§æ¤œè¨¼ã™ã‚‹ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¦ä»¶:

| æ©Ÿèƒ½ | ç›®æ¨™æ™‚é–“ | é–¢é€£è¦ä»¶ |
|------|----------|----------|
| æ–‡å­—ç›¤ã‚¿ãƒƒãƒ—å¿œç­” | 100msä»¥å†… | NFR-003 |
| TTSèª­ã¿ä¸Šã’é–‹å§‹ | 1ç§’ä»¥å†… | NFR-001 |
| å®šå‹æ–‡100ä»¶è¡¨ç¤º | 1ç§’ä»¥å†… | NFR-004 |
| AIå¤‰æ›å¿œç­” | å¹³å‡3ç§’ä»¥å†… | NFR-002 |

## ä½œæˆãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§

| ãƒ•ã‚¡ã‚¤ãƒ« | èª¬æ˜ |
|----------|------|
| `pubspec.yaml` | ä¾å­˜é–¢ä¿‚è¿½åŠ ï¼ˆintegration_test, http_mock_adapterï¼‰ |
| `integration_test/README.md` | E2Eãƒ†ã‚¹ãƒˆä½¿ç”¨æ–¹æ³• |
| `integration_test/test_driver.dart` | ãƒ†ã‚¹ãƒˆãƒ‰ãƒ©ã‚¤ãƒãƒ¼ |
| `integration_test/app_startup_test.dart` | ã‚¢ãƒ—ãƒªèµ·å‹•ãƒ†ã‚¹ãƒˆ |
| `integration_test/helpers/helpers.dart` | ãƒ˜ãƒ«ãƒ‘ãƒ¼ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ |
| `integration_test/helpers/test_helpers.dart` | ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ |
| `integration_test/helpers/mock_api_server.dart` | ãƒ¢ãƒƒã‚¯APIã‚µãƒ¼ãƒãƒ¼ |
| `integration_test/helpers/test_data_setup.dart` | ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ— |
| `.github/workflows/flutter-test.yml` | CIè¨­å®š |
