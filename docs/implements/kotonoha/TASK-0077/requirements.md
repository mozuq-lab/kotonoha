# TASK-0077: オフライン時UI表示・AI変換無効化 - 要件定義

## タスク概要

- **タスクID**: TASK-0077
- **タスク名**: オフライン時UI表示・AI変換無効化実装
- **関連要件**: REQ-1002, REQ-1003, REQ-3004, EDGE-001, NFR-203
- **依存タスク**: TASK-0076

## 関連要件（EARS記法）

### REQ-1002: オフライン状態表示 🔵

**EARS記法**: State-driven
> システムがオフライン状態にある場合、ユーザーに視覚的に通知しなければならない

**受け入れ基準**:
- オフライン時に画面上部にバナーが表示される
- バナーに「オフライン - 基本機能のみ利用可能」と表示される
- オンライン時はバナーが非表示になる

### REQ-1003: オフライン時基本機能動作 🔵

**EARS記法**: State-driven
> システムがオフライン状態にある場合、基本機能（文字盤入力、定型文、TTS）は引き続き動作しなければならない

**受け入れ基準**:
- オフラインバナー表示中も子ウィジェットが操作可能
- ユーザー操作を妨げない設計

### REQ-3004: オフライン時AI変換無効化 🔵

**EARS記法**: State-driven
> システムがオフライン状態にある場合、AI変換機能は無効化されなければならない

**受け入れ基準**:
- AI変換ボタンが自動で無効化される
- オフライン時にAI変換ボタンを押すとダイアログが表示される
- 代替機能（定型文・履歴）への誘導がある

### EDGE-001: ネットワーク復帰時の通知 🔵

**EARS記法**: Event-driven
> ユーザーがオフライン状態からオンラインに復帰した場合、システムは復帰通知を表示しなければならない

**受け入れ基準**:
- オフライン→オンライン時に復帰通知が表示される
- 「オンラインに戻りました。AI変換が利用可能です」と表示される
- 通知は一定時間後に自動で非表示になる

### NFR-203: ユーザー操作を妨げない通知 🔵

**EARS記法**: Ubiquitous
> システムの通知はユーザー操作を妨げてはならない

**受け入れ基準**:
- 通知表示中も子ウィジェットが操作可能
- Column構造でコンテンツを押し下げる設計

## 機能要件

### 1. OfflineBanner

| 要件ID | 説明 | 優先度 |
|--------|------|--------|
| BAN-001 | オフライン時にバナーが表示される | 高 |
| BAN-002 | 「オフライン - 基本機能のみ利用可能」テキストを表示 | 高 |
| BAN-003 | wifi_offアイコンを表示 | 中 |
| BAN-004 | オンライン時は自動非表示 | 高 |
| BAN-005 | checking時は自動非表示 | 高 |
| BAN-006 | 状態変更時にリアルタイムで表示/非表示が切り替わる | 高 |
| BAN-007 | Semanticsラベルを設定（アクセシビリティ対応） | 中 |

### 2. OnlineRecoveryNotification

| 要件ID | 説明 | 優先度 |
|--------|------|--------|
| REC-001 | オフライン→オンラインで復帰通知を表示 | 高 |
| REC-002 | 「オンラインに戻りました。AI変換が利用可能です」を表示 | 高 |
| REC-003 | オンライン→オンラインでは通知を表示しない | 高 |
| REC-004 | checking→オンラインでは通知を表示しない | 高 |
| REC-005 | 設定可能な表示時間（デフォルト3秒） | 中 |
| REC-006 | 一定時間後に自動で非表示になる | 高 |
| REC-007 | Timer使用、dispose時にキャンセル | 高 |
| REC-008 | 通知表示中も子ウィジェットが操作可能 | 高 |
| REC-009 | Semanticsラベルを設定（アクセシビリティ対応） | 中 |

### 3. NetworkAwareScaffold

| 要件ID | 説明 | 優先度 |
|--------|------|--------|
| SCAF-001 | オフラインバナーとオンライン復帰通知を統合 | 高 |
| SCAF-002 | 既存のScaffoldと置き換えるだけで使用可能 | 高 |
| SCAF-003 | showOfflineBannerで表示制御可能 | 中 |
| SCAF-004 | showOnlineRecoveryNotificationで表示制御可能 | 中 |

### 4. オフライン時AI変換ダイアログ

| 要件ID | 説明 | 優先度 |
|--------|------|--------|
| DIA-001 | オフライン時にAI変換ボタン押下でダイアログ表示 | 高 |
| DIA-002 | 「AI変換機能はインターネット接続が必要です」メッセージ | 高 |
| DIA-003 | 代替機能（定型文・履歴）への誘導 | 高 |

## 非機能要件

| 要件ID | 説明 | 基準値 |
|--------|------|--------|
| NFR-OFF-001 | バナー表示/非表示切り替え | 100ms以内 |
| NFR-OFF-002 | 復帰通知表示 | 即座（状態変更検知後即時） |
| NFR-OFF-003 | 自動非表示タイマー | 設定可能（デフォルト3秒） |

## 信頼性レベル

- 🔵 **青信号**: REQ-1002, REQ-1003, REQ-3004, EDGE-001, NFR-203 - EARS要件定義書に明記
