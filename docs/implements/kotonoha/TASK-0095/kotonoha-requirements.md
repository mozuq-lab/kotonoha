# TASK-0095: 実機テスト（iOS/Android/タブレット） - 要件定義書

## タスク概要

- **タスクID**: TASK-0095
- **タスク名**: 実機テスト（iOS/Android/タブレット）
- **推定工数**: 8時間
- **タスクタイプ**: TDD
- **フェーズ**: Phase 5 - Week 19 (Day 15)
- **関連要件**: NFR-401, NFR-402, NFR-403

## 🔵 信頼性レベルについて

このタスクは、EARS要件定義書の非機能要件（NFR-401, NFR-402, NFR-403）に明確に記載されている実機動作確認に基づいており、主に 🔵 青信号レベルです。テストケースの具体的な項目については妥当な推測を含むため 🟡 黄信号も含みます。

## 1. 実機テストの目的と範囲

### 1.1 目的 🔵

kotonohaアプリが、以下の実機環境で正常に動作することを確認する：

1. **iOS実機**（iPhone/iPad）での動作確認
2. **Android実機**（スマートフォン/タブレット）での動作確認
3. **タブレット最適表示**（9.7インチ以上）の確認
4. **画面方向対応**（縦向き・横向き）の確認
5. **TTS機能実機動作**の確認

### 1.2 範囲 🔵

**対象範囲**:
- すべてのプラットフォーム（iOS/Android）での基本機能動作
- 各プラットフォーム固有のTTS実装（OS標準TTS）
- タブレット端末での表示最適化
- 画面の縦向き・横向き切り替え対応
- タップ操作の応答性・誤タップ防止

**対象外範囲**:
- パフォーマンスベンチマーク（TASK-0088で実施済み）
- E2Eテストの自動化（TASK-0081〜TASK-0087で実施済み）
- ストアリリース・配布手順（TASK-0099で実施）

## 2. 対象プラットフォームと最小要件

### 2.1 iOS 🔵

**関連要件**: NFR-401

- **最小バージョン**: iOS 14.0以上
- **対象デバイス**:
  - iPhone（iOS 14.0+）
  - iPad（9.7インチ以上推奨、iOS 14.0+）
- **テスト推奨デバイス**:
  - iPhone SE (第2世代) 以上
  - iPad (第7世代、10.2インチ) 以上
  - iPad Air (第3世代、10.5インチ) 以上

**iOS固有確認項目**:
- App Store Connect TestFlight経由での配布・インストール
- iOS標準TTS（AVSpeechSynthesizer）の動作
- iOS「ガイド付きアクセス」設定時の動作（NFR-205参照）
- iOS SafeArea対応（ノッチ、ホームインジケーター）

### 2.2 Android 🔵

**関連要件**: NFR-401

- **最小バージョン**: Android 10（API Level 29）以上
- **対象デバイス**:
  - Android スマートフォン（Android 10+）
  - Android タブレット（9.7インチ以上推奨、Android 10+）
- **テスト推奨デバイス**:
  - Google Pixel 5 以上
  - Samsung Galaxy Tab A7 (10.4インチ) 以上

**Android固有確認項目**:
- Google Play Console 内部テスト経由での配布・インストール
- Android標準TTS（TextToSpeech）の動作
- Android「画面ピン留め」設定時の動作（NFR-205参照）
- Android Navigation Bar対応

### 2.3 Web（参考：実機テストの対象外だが動作確認推奨）🟡

**関連要件**: NFR-401

- **対応ブラウザ**: Chrome、Safari、Edge最新版
- **PWA対応**: インストール可能、オフライン動作（Service Worker）

**Web固有確認項目**:
- Web Speech API（TTS）の動作
- レスポンシブデザイン（タブレット表示）

## 3. テスト対象の機能一覧

### 3.1 基本機能（全プラットフォーム共通）🔵

**関連要件**: REQ-001〜REQ-004（文字入力）、REQ-101〜REQ-107（定型文）

- 文字盤タップ入力・削除・全消去
- 定型文一覧表示・選択・即座読み上げ
- 大ボタン（「はい」「いいえ」「わからない」）タップ
- 状態ボタン（「痛い」「トイレ」「暑い」「寒い」等）タップ
- 緊急ボタン2段階確認・緊急音・画面赤表示

### 3.2 音声読み上げ機能（TTS）🔵

**関連要件**: REQ-401〜REQ-404、NFR-001

- TTS読み上げ開始時間（1秒以内、NFR-001）
- TTS読み上げ速度変更（遅い/普通/速い）
- TTS読み上げ中の停止・中断
- OS音量設定との連動
- マナーモード時の挙動（視覚的警告、EDGE-202）

**プラットフォーム固有TTS確認**:
- iOS: AVSpeechSynthesizer、日本語音声エンジン
- Android: TextToSpeech、日本語音声エンジン（Google TTS等）
- Web: Web Speech API（SpeechSynthesis）

### 3.3 履歴・お気に入り機能 🔵

**関連要件**: REQ-601〜REQ-605、REQ-701〜REQ-704

- 履歴自動保存・一覧表示・再読み上げ
- 50件制限・自動削除
- お気に入り登録・優先表示・並び順変更
- ローカルストレージ永続化（Hive）

### 3.4 AI変換機能 🔵

**関連要件**: REQ-901〜REQ-904、NFR-002

- AI変換ボタンタップ→変換結果表示
- 丁寧さレベル変更（カジュアル/普通/丁寧）
- 再生成・元の文使用
- オフライン時のフォールバック動作

### 3.5 設定・アクセシビリティ機能 🔵

**関連要件**: REQ-801〜REQ-804、NFR-201、NFR-202

- フォントサイズ変更（小/中/大）即時反映
- テーマ変更（ライト/ダーク/高コントラスト）即時反映
- 高コントラストモードのコントラスト比（4.5:1以上、REQ-5006）
- TTS速度・AI丁寧さレベルの設定永続化

### 3.6 対面表示機能 🔵

**関連要件**: REQ-501〜REQ-503

- 拡大表示モード（読み上げテキスト大きく表示）
- 画面180度回転表示（対面の相手から読みやすい）
- 通常モードと対面表示モードの切り替え

## 4. 画面サイズ・向きに関する要件

### 4.1 タブレット最適表示（9.7インチ以上）🔵

**関連要件**: NFR-402

- **9.7インチ以上のタブレット**を主要対象として最適化
- 文字盤ボタンのサイズ・配置がタブレット画面に適切にレイアウトされる
- 定型文一覧が見やすく表示される（スクロール不要で多数表示）
- 大ボタン・緊急ボタンが誤タップしにくい配置・サイズ

**スマートフォンでの基本動作保証** 🟡:
- スマートフォン（5〜6インチ）でも基本機能が動作する
- レイアウトが崩れず、主要なボタンがタップ可能
- ただし、タブレットほどの最適表示は期待しない

### 4.2 縦向き・横向き両対応 🔵

**関連要件**: NFR-403

- **縦向き（Portrait）** : 標準的な表示モード
- **横向き（Landscape）** : タブレット利用時に推奨される表示モード
- 画面回転時にレイアウトが自動調整される
- 画面回転時にユーザー入力状態が保持される（入力欄の文字、選択状態等）

**レイアウト自動調整の確認項目** 🟡:
- 文字盤ボタンの配置が縦/横で適切に再配置される
- 定型文一覧のカラム数が縦/横で調整される（例: 縦1列、横2-3列）
- 大ボタン・緊急ボタンが常に視認可能な位置に配置される

### 4.3 タップターゲットサイズ 🔵

**関連要件**: REQ-5001、NFR-202

- **最小タップターゲット**: 44px × 44px以上（REQ-5001）
- **推奨サイズ**: 60px × 60px以上（大ボタン、緊急ボタン）
- **視認性**: ボタンラベルが明確に読める（フォントサイズ調整機能）
- **誤タップ防止**: ボタン間の適切な余白確保

## 5. TTS実機動作に関する要件

### 5.1 TTS読み上げ開始時間 🔵

**関連要件**: NFR-001

- **目標**: TTS読み上げ開始までの時間を1秒以内とする
- **計測方法**: 読み上げボタンタップから音声出力開始までの時間
- **実機確認**: iOS/Android実機で計測、パフォーマンス要件を満たすことを確認

### 5.2 OS標準TTS利用 🔵

**関連要件**: REQ-401

- **iOS**: AVSpeechSynthesizer（iOS標準）
- **Android**: TextToSpeech（Android標準）
- **Web**: Web Speech API（SpeechSynthesis）

**TTS音声エンジン確認** 🟡:
- 日本語音声エンジンが利用可能（デバイスにインストール済み）
- 音声エンジンが未インストールの場合のエラーハンドリング（EDGE-004）
- ユーザーへの適切なエラーメッセージ表示

### 5.3 TTS速度・音量制御 🔵

**関連要件**: REQ-404、REQ-403

- **速度**: 遅い/普通/速い の3段階
- **音量**: OS標準音量設定に追従
- **停止・中断**: 読み上げ中の停止ボタンで中断可能

**エッジケース確認** 🟡:
- OS音量が0（ミュート）の状態での読み上げ実行（EDGE-202）
- マナーモード有効時の緊急ボタン動作（EDGE-203）

### 5.4 TTS実機確認項目 🟡

以下の項目を実機で確認する：

1. **読み上げ開始遅延**: 1秒以内に音声が再生される
2. **音声品質**: クリアで聞き取りやすい音声
3. **速度変更**: 速度変更が即座に反映される
4. **停止・中断**: 停止ボタンで確実に止まる
5. **長文読み上げ**: 500文字以上の長文でも安定動作
6. **連続読み上げ**: 複数回連続で読み上げても正常動作
7. **バックグラウンド復帰**: アプリをバックグラウンドから復帰しても正常動作

## 6. プラットフォーム固有機能の確認

### 6.1 iOS固有機能 🔵

**関連要件**: NFR-205

- **ガイド付きアクセス**（Guided Access）設定時の動作確認
  - 設定方法がアプリ内ヘルプに記載されている
  - ガイド付きアクセス有効時もアプリが正常動作する
- **SafeArea対応**: ノッチ、ホームインジケーターを考慮したレイアウト
- **iOS通知**: 緊急ボタン押下時の通知動作（将来拡張、MVPでは対象外）

### 6.2 Android固有機能 🔵

**関連要件**: NFR-205

- **画面ピン留め**（Screen Pinning）設定時の動作確認
  - 設定方法がアプリ内ヘルプに記載されている
  - 画面ピン留め有効時もアプリが正常動作する
- **Navigation Bar対応**: 3ボタンナビゲーション、ジェスチャーナビゲーション
- **Android通知**: 緊急ボタン押下時の通知動作（将来拡張、MVPでは対象外）

### 6.3 共通確認項目 🟡

- **アプリアイコン**: 正しく表示される
- **スプラッシュ画面**: 起動時に適切に表示される
- **権限リクエスト**: 必要な権限（ネットワーク等）が適切にリクエストされる
- **アプリ名**: 「kotonoha」が正しく表示される

## 7. テストケース一覧

### 7.1 基本動作テストケース 🟡

| テストID | テスト項目 | 手順 | 期待結果 | iOS | Android |
|---------|----------|------|---------|-----|---------|
| RT-001 | アプリ起動 | ホーム画面からアプリアイコンタップ | アプリが起動し、文字盤画面が表示される | ☐ | ☐ |
| RT-002 | 文字盤タップ入力 | 「あ」ボタンをタップ | 入力欄に「あ」が表示される、100ms以内（NFR-003） | ☐ | ☐ |
| RT-003 | TTS読み上げ | 「こんにちは」と入力し、読み上げボタンタップ | 1秒以内に「こんにちは」が読み上げられる（NFR-001） | ☐ | ☐ |
| RT-004 | TTS速度変更 | 設定で速度「遅い」→「速い」に変更 | 読み上げ速度が変更される | ☐ | ☐ |
| RT-005 | TTS停止 | 読み上げ中に停止ボタンタップ | 読み上げが即座に停止する | ☐ | ☐ |
| RT-006 | 定型文選択 | 定型文「ありがとう」タップ | 即座に「ありがとう」が読み上げられる | ☐ | ☐ |
| RT-007 | 大ボタンタップ | 「はい」ボタンタップ | 「はい」が即座に読み上げられる | ☐ | ☐ |
| RT-008 | 緊急ボタン | 緊急ボタンを2回タップ（確認ダイアログ→「はい」） | 緊急音が鳴り、画面が赤表示される | ☐ | ☐ |
| RT-009 | 履歴保存・再生 | 読み上げ実行→履歴画面→履歴タップ | 履歴が保存され、再読み上げされる | ☐ | ☐ |
| RT-010 | お気に入り登録 | 履歴からお気に入り登録 | お気に入り一覧に表示される | ☐ | ☐ |
| RT-011 | AI変換 | 「おはよう」入力→AI変換ボタン→丁寧「普通」 | 「おはようございます」が表示される、3秒以内（NFR-002） | ☐ | ☐ |
| RT-012 | オフライン動作 | 機内モード→文字入力→読み上げ | 文字盤・TTS・定型文が正常動作する | ☐ | ☐ |
| RT-013 | フォントサイズ変更 | 設定でフォントサイズ「大」に変更 | 文字盤・定型文・ボタンラベルが大きく表示される | ☐ | ☐ |
| RT-014 | テーマ変更 | 設定でテーマ「ダークモード」に変更 | 全画面がダークテーマに変更される | ☐ | ☐ |
| RT-015 | 高コントラストモード | 設定でテーマ「高コントラスト」に変更 | コントラスト比4.5:1以上で表示される（REQ-5006） | ☐ | ☐ |
| RT-016 | 対面表示モード | 対面表示ボタンタップ | 画面が180度回転し、テキストが大きく表示される | ☐ | ☐ |

### 7.2 画面サイズ・向き対応テストケース 🟡

| テストID | テスト項目 | 手順 | 期待結果 | iOS | Android |
|---------|----------|------|---------|-----|---------|
| RT-101 | 縦向き表示 | デバイスを縦向きにする | レイアウトが縦向きに最適化される | ☐ | ☐ |
| RT-102 | 横向き表示 | デバイスを横向きにする | レイアウトが横向きに最適化される | ☐ | ☐ |
| RT-103 | 画面回転時の状態保持 | 入力中にデバイスを回転 | 入力内容が保持される | ☐ | ☐ |
| RT-104 | タブレット表示（9.7インチ以上） | iPad/タブレットで起動 | 文字盤・定型文が見やすく表示される | ☐ | ☐ |
| RT-105 | スマートフォン表示 | iPhone/スマホで起動 | 基本機能が動作する（最適化は期待しない） | ☐ | ☐ |
| RT-106 | タップターゲットサイズ | 文字盤ボタンのサイズ確認 | 44px × 44px以上（REQ-5001） | ☐ | ☐ |
| RT-107 | 大ボタンサイズ | 大ボタン・緊急ボタンのサイズ確認 | 60px × 60px以上（NFR-202） | ☐ | ☐ |

### 7.3 プラットフォーム固有テストケース 🟡

| テストID | テスト項目 | 手順 | 期待結果 | iOS | Android |
|---------|----------|------|---------|-----|---------|
| RT-201 | iOS TTS（AVSpeechSynthesizer） | iOS実機で読み上げ | 日本語音声エンジンで読み上げられる | ☐ | N/A |
| RT-202 | iOS SafeArea | iPhone（ノッチあり）で起動 | レイアウトがSafeArea内に収まる | ☐ | N/A |
| RT-203 | iOS ガイド付きアクセス | ガイド付きアクセス有効化 | アプリが正常動作する | ☐ | N/A |
| RT-204 | Android TTS（TextToSpeech） | Android実機で読み上げ | 日本語音声エンジンで読み上げられる | N/A | ☐ |
| RT-205 | Android Navigation Bar | 3ボタン/ジェスチャーナビゲーション | レイアウトが適切に調整される | N/A | ☐ |
| RT-206 | Android 画面ピン留め | 画面ピン留め有効化 | アプリが正常動作する | N/A | ☐ |

### 7.4 エッジケース・エラーハンドリングテストケース 🟡

| テストID | テスト項目 | 手順 | 期待結果 | iOS | Android |
|---------|----------|------|---------|-----|---------|
| RT-301 | OS音量0での読み上げ | 音量0→読み上げ実行 | 「音量が0です」視覚的警告表示（EDGE-202） | ☐ | ☐ |
| RT-302 | マナーモード時の緊急ボタン | マナーモード→緊急ボタン | 明確な警告表示（音が鳴らない旨）（EDGE-203） | ☐ | ☐ |
| RT-303 | TTS音声エンジン未インストール | 日本語音声エンジンを削除（可能なら） | エラーメッセージ表示、テキスト表示のみ継続（EDGE-004） | ☐ | ☐ |
| RT-304 | バックグラウンド復帰 | アプリをバックグラウンドに→復帰 | 前回の画面状態・入力内容が復元される（EDGE-201） | ☐ | ☐ |
| RT-305 | 長文読み上げ | 500文字以上の長文を読み上げ | 安定して読み上げられる、途中で停止しない | ☐ | ☐ |
| RT-306 | 連続読み上げ | 10回連続で読み上げ実行 | 安定して読み上げられる、メモリリークなし | ☐ | ☐ |
| RT-307 | ストレージ容量不足 | デバイスのストレージを極限まで埋める | 警告表示、古い履歴削除提案（EDGE-003） | ☐ | ☐ |

## 8. 受け入れ基準

### 8.1 基本動作 🔵

- [ ] iOS実機（iPhone/iPad）でアプリが起動し、基本機能（文字盤・定型文・TTS）が正常動作する
- [ ] Android実機（スマートフォン/タブレット）でアプリが起動し、基本機能が正常動作する
- [ ] iOS 14.0以上、Android 10以上で動作する（NFR-401）

### 8.2 TTS実機動作 🔵

- [ ] iOS実機でTTS読み上げが1秒以内に開始される（NFR-001）
- [ ] Android実機でTTS読み上げが1秒以内に開始される（NFR-001）
- [ ] TTS速度変更（遅い/普通/速い）が実機で正常動作する
- [ ] TTS停止・中断が実機で正常動作する

### 8.3 タブレット最適表示 🔵

- [ ] 9.7インチ以上のタブレット（iPad/Android）で最適な表示がされる（NFR-402）
- [ ] 文字盤ボタン・定型文一覧が見やすく配置される
- [ ] タップターゲットサイズが44px × 44px以上（REQ-5001）、大ボタンは60px × 60px以上（NFR-202）

### 8.4 画面方向対応 🔵

- [ ] 縦向き（Portrait）表示が正常に機能する（NFR-403）
- [ ] 横向き（Landscape）表示が正常に機能する（NFR-403）
- [ ] 画面回転時にレイアウトが自動調整される
- [ ] 画面回転時にユーザー入力状態が保持される

### 8.5 プラットフォーム固有機能 🟡

- [ ] iOS SafeArea（ノッチ、ホームインジケーター）に対応したレイアウト
- [ ] Android Navigation Bar（3ボタン/ジェスチャー）に対応したレイアウト
- [ ] iOSガイド付きアクセス設定方法がアプリ内ヘルプに記載され、動作確認済み（NFR-205）
- [ ] Android画面ピン留め設定方法がアプリ内ヘルプに記載され、動作確認済み（NFR-205）

### 8.6 エラーハンドリング 🟡

- [ ] OS音量0での読み上げ実行時に視覚的警告が表示される（EDGE-202）
- [ ] マナーモード時の緊急ボタン押下で明確な警告が表示される（EDGE-203）
- [ ] バックグラウンド復帰時に前回の状態が復元される（EDGE-201）
- [ ] TTS音声エンジン未インストール時にエラーメッセージが表示される（EDGE-004）

### 8.7 テストカバレッジ 🟡

- [ ] 基本動作テストケース（RT-001〜RT-016）がすべて完了し、iOS/Android両方で✓がつく
- [ ] 画面サイズ・向き対応テストケース（RT-101〜RT-107）がすべて完了
- [ ] プラットフォーム固有テストケース（RT-201〜RT-206）がすべて完了
- [ ] エッジケース・エラーハンドリングテストケース（RT-301〜RT-307）が主要項目で完了

## 9. 実機テスト実施計画

### 9.1 テスト環境準備 🟡

**iOS実機テスト環境**:
- iPhone（iOS 14.0+、例: iPhone SE第2世代、iPhone 13等）
- iPad（9.7インチ以上、例: iPad 第7世代、iPad Air第3世代等）
- TestFlight経由でビルド配布

**Android実機テスト環境**:
- Android スマートフォン（Android 10+、例: Google Pixel 5、Samsung Galaxy S21等）
- Android タブレット（9.7インチ以上、例: Samsung Galaxy Tab A7、Lenovo Tab P11等）
- Google Play Console 内部テスト経由でビルド配布

### 9.2 テスト実施手順 🟡

1. **事前準備** (30分)
   - iOS/Android実機を準備
   - TestFlight/Google Play内部テストからアプリインストール
   - テストチェックリスト（RT-001〜RT-307）を印刷/デジタル準備

2. **基本動作テスト** (2時間)
   - RT-001〜RT-016（基本機能）を実機で実施
   - 問題発見時はスクリーンショット・ログ取得

3. **画面サイズ・向き対応テスト** (1.5時間)
   - RT-101〜RT-107（画面回転、タブレット表示）を実機で実施

4. **プラットフォーム固有テスト** (2時間)
   - RT-201〜RT-206（iOS/Android固有機能）を実機で実施

5. **エッジケース・エラーハンドリングテスト** (1.5時間)
   - RT-301〜RT-307（エラーハンドリング）を実機で実施

6. **テスト結果まとめ・報告** (30分)
   - テストチェックリストの完了状況確認
   - 発見した問題のIssue登録
   - テスト結果レポート作成

**総推定時間**: 8時間

### 9.3 テスト結果報告 🟡

テスト完了後、以下の情報を含むレポートを作成する：

- **テスト実施日時**: YYYY-MM-DD
- **テスト実施者**: [担当者名]
- **テスト対象デバイス一覧**:
  - iOS: iPhone [機種名] (iOS [バージョン]), iPad [機種名] (iOS [バージョン])
  - Android: [機種名] (Android [バージョン]), [タブレット機種名] (Android [バージョン])
- **テストケース完了状況**: RT-001〜RT-307の完了/未完了/問題発見
- **発見した問題一覧**: Issue番号、問題内容、再現手順、優先度
- **総合評価**: iOS/Android実機で正常動作するか、リリース可能か

## 10. 完了条件まとめ

このタスク（TASK-0095）は、以下の条件をすべて満たした場合に完了とする：

- [ ] iOS実機（iPhone/iPad）でアプリが正常動作し、基本動作テストケース（RT-001〜RT-016）がすべて✓
- [ ] Android実機（スマートフォン/タブレット）でアプリが正常動作し、基本動作テストケース（RT-001〜RT-016）がすべて✓
- [ ] 9.7インチ以上のタブレット（iPad/Android）で最適表示が確認される（NFR-402）
- [ ] 縦向き・横向き両対応が確認される（NFR-403）
- [ ] TTS実機動作が正常に確認される（NFR-001、読み上げ開始1秒以内）
- [ ] プラットフォーム固有テストケース（RT-201〜RT-206）が主要項目で✓
- [ ] テスト結果レポートが作成され、発見した問題がIssue登録される

## 関連ドキュメント

- [要件定義書](../../../spec/kotonoha-requirements.md)
- [アーキテクチャ設計](../../../design/kotonoha/architecture.md)
- [Phase 5 タスク](../../../tasks/kotonoha-phase5.md)
- [TASK-0091: iOSビルド設定](../TASK-0091/)
- [TASK-0092: Androidビルド設定](../TASK-0092/)
- [TASK-0088: パフォーマンス計測・プロファイリング](../TASK-0088/)

## 更新履歴

- **2025-12-02**: 初回作成（要件定義書作成）
