# TASK-0046: 緊急ボタン2段階確認実装 - テストケース一覧

## 概要

本ドキュメントは、緊急ボタン2段階確認機能（TASK-0046）の包括的なテストケースを定義します。
TASK-0045で実装済みのUI基盤に対して、2段階確認動作の検証、誤操作防止、アクセシビリティ、テーマ対応を網羅的にテストします。

**テスト対象ファイル**:
- `lib/features/emergency/presentation/widgets/emergency_button_with_confirmation.dart`
- `lib/features/emergency/presentation/widgets/emergency_confirmation_dialog.dart`

**既存テストファイル**:
- `test/features/emergency/presentation/widgets/emergency_button_with_confirmation_test.dart`
- `test/features/emergency/presentation/widgets/emergency_confirmation_dialog_test.dart`

---

## テストケース優先度

| 優先度 | 説明 | 対象 |
|--------|------|------|
| **P0** | 必須：コア機能、リリースブロッカー | 2段階確認フロー、誤操作防止、コールバック |
| **P1** | 高優先度：重要だが回避策あり | アクセシビリティ、エッジケース |
| **P2** | 中優先度：品質向上 | UI/デザイン詳細、オプション機能 |
| **P3** | 低優先度：将来対応可 | パフォーマンス最適化 |

---

## 1. 確認ダイアログ表示テスト

### TC-046-001: 緊急ボタンタップで確認ダイアログが表示される [P0]

**関連要件**: FR-001, REQ-302, REQ-2004, AC-001

| 項目 | 内容 |
|------|------|
| **前提条件** | 緊急ボタンが画面に表示されている |
| **テスト手順** | 1. 緊急ボタンをタップする |
| **期待結果** | 確認ダイアログが表示される |
| **検証方法** | `find.byType(EmergencyConfirmationDialog)` が `findsOneWidget` |

### TC-046-002: 確認ダイアログに「緊急呼び出し」タイトルが表示される [P0]

**関連要件**: FR-002, REQ-2004, AC-002

| 項目 | 内容 |
|------|------|
| **前提条件** | 確認ダイアログが表示されている |
| **テスト手順** | 1. ダイアログのタイトル部分を確認する |
| **期待結果** | 「緊急呼び出し」というタイトルが表示される |
| **検証方法** | `find.text('緊急呼び出し')` が `findsOneWidget` |

### TC-046-003: 確認ダイアログに「緊急呼び出しを実行しますか?」メッセージが表示される [P0]

**関連要件**: FR-002, REQ-2004, AC-003

| 項目 | 内容 |
|------|------|
| **前提条件** | 確認ダイアログが表示されている |
| **テスト手順** | 1. ダイアログのメッセージ部分を確認する |
| **期待結果** | 「緊急呼び出しを実行しますか?」というメッセージが表示される |
| **検証方法** | `find.text('緊急呼び出しを実行しますか?')` が `findsOneWidget` |

### TC-046-004: 確認ダイアログに「はい」ボタンが表示される [P0]

**関連要件**: FR-003, AC-004

| 項目 | 内容 |
|------|------|
| **前提条件** | 確認ダイアログが表示されている |
| **テスト手順** | 1. ダイアログのボタン部分を確認する |
| **期待結果** | 「はい」ボタンが表示される |
| **検証方法** | `find.text('はい')` が `findsOneWidget` |

### TC-046-005: 確認ダイアログに「いいえ」ボタンが表示される [P0]

**関連要件**: FR-003, AC-005

| 項目 | 内容 |
|------|------|
| **前提条件** | 確認ダイアログが表示されている |
| **テスト手順** | 1. ダイアログのボタン部分を確認する |
| **期待結果** | 「いいえ」ボタンが表示される |
| **検証方法** | `find.text('いいえ')` が `findsOneWidget` |

### TC-046-006: 「はい」ボタンが赤色背景で表示される [P1]

**関連要件**: FR-004, NFR-T001

| 項目 | 内容 |
|------|------|
| **前提条件** | 確認ダイアログが表示されている（ライトモード） |
| **テスト手順** | 1. 「はい」ボタンの背景色を確認する |
| **期待結果** | ボタン背景色が赤色（#D32F2F）である |
| **検証方法** | ElevatedButtonのstyle.backgroundColorを検証 |

### TC-046-007: 「いいえ」ボタンがグレー系背景で表示される [P1]

**関連要件**: FR-005, NFR-T001

| 項目 | 内容 |
|------|------|
| **前提条件** | 確認ダイアログが表示されている（ライトモード） |
| **テスト手順** | 1. 「いいえ」ボタンの背景色を確認する |
| **期待結果** | ボタン背景色がグレー系（#757575）である |
| **検証方法** | ElevatedButtonのstyle.backgroundColorを検証 |

### TC-046-008: ボタンが「いいえ」「はい」の順（左→右）で配置される [P1]

**関連要件**: FR-006, NFR-U003

| 項目 | 内容 |
|------|------|
| **前提条件** | 確認ダイアログが表示されている |
| **テスト手順** | 1. ボタンの配置順序を確認する |
| **期待結果** | 「いいえ」が左、「はい」が右に配置される |
| **検証方法** | 各ボタンのオフセットX座標を比較 |

### TC-046-009: 補足メッセージ「周囲に緊急音が鳴り、画面が赤くなります。」が表示される [P2]

**関連要件**: FR-301, REQ-303, REQ-304

| 項目 | 内容 |
|------|------|
| **前提条件** | 確認ダイアログが表示されている |
| **テスト手順** | 1. ダイアログの補足メッセージ部分を確認する |
| **期待結果** | 補足メッセージが表示される |
| **検証方法** | `find.textContaining('周囲に緊急音が鳴り')` が `findsOneWidget` |

---

## 2. 「はい」ボタンの動作テスト

### TC-046-010: 「はい」タップでonEmergencyConfirmedコールバックが呼び出される [P0]

**関連要件**: FR-101, REQ-2005, AC-006

| 項目 | 内容 |
|------|------|
| **前提条件** | 確認ダイアログが表示されている |
| **テスト手順** | 1. 「はい」ボタンをタップする |
| **期待結果** | onEmergencyConfirmedコールバックが呼び出される |
| **検証方法** | コールバックフラグがtrueになることを検証 |

### TC-046-011: 「はい」タップで確認ダイアログが閉じる [P0]

**関連要件**: FR-101, AC-007

| 項目 | 内容 |
|------|------|
| **前提条件** | 確認ダイアログが表示されている |
| **テスト手順** | 1. 「はい」ボタンをタップする |
| **期待結果** | 確認ダイアログが閉じる |
| **検証方法** | `find.byType(EmergencyConfirmationDialog)` が `findsNothing` |

### TC-046-012: 「はい」タップでダイアログが閉じてからコールバックが実行される [P1]

**関連要件**: FR-101

| 項目 | 内容 |
|------|------|
| **前提条件** | 確認ダイアログが表示されている |
| **テスト手順** | 1. 「はい」ボタンをタップする<br>2. ダイアログ閉じとコールバック実行順序を確認する |
| **期待結果** | Navigator.pop()が先に実行され、その後onEmergencyConfirmedが実行される |
| **検証方法** | 実行順序をログまたはフラグで検証 |

---

## 3. 「いいえ」ボタンの動作テスト

### TC-046-013: 「いいえ」タップで確認ダイアログが閉じる [P0]

**関連要件**: FR-102, AC-008

| 項目 | 内容 |
|------|------|
| **前提条件** | 確認ダイアログが表示されている |
| **テスト手順** | 1. 「いいえ」ボタンをタップする |
| **期待結果** | 確認ダイアログが閉じる |
| **検証方法** | `find.byType(EmergencyConfirmationDialog)` が `findsNothing` |

### TC-046-014: 「いいえ」タップでonEmergencyConfirmedコールバックが呼ばれない [P0]

**関連要件**: FR-102, AC-009

| 項目 | 内容 |
|------|------|
| **前提条件** | 確認ダイアログが表示されている |
| **テスト手順** | 1. 「いいえ」ボタンをタップする |
| **期待結果** | onEmergencyConfirmedコールバックが呼ばれない |
| **検証方法** | コールバックフラグがfalseのままであることを検証 |

### TC-046-015: 「いいえ」タップ後に通常状態に戻る [P0]

**関連要件**: FR-102

| 項目 | 内容 |
|------|------|
| **前提条件** | 確認ダイアログが表示されている |
| **テスト手順** | 1. 「いいえ」ボタンをタップする<br>2. 画面状態を確認する |
| **期待結果** | ダイアログが閉じ、緊急ボタンが再度タップ可能な状態になる |
| **検証方法** | 緊急ボタンを再度タップして確認ダイアログが表示されることを検証 |

---

## 4. ダイアログ外タップの動作テスト（誤操作防止）

### TC-046-016: ダイアログ外タップでダイアログが閉じない [P0]

**関連要件**: FR-103, REQ-5002, AC-010

| 項目 | 内容 |
|------|------|
| **前提条件** | 確認ダイアログが表示されている（barrierDismissible: false） |
| **テスト手順** | 1. ダイアログ外（モーダルバリア）をタップする |
| **期待結果** | ダイアログが閉じない |
| **検証方法** | `find.byType(EmergencyConfirmationDialog)` が `findsOneWidget` のまま |

### TC-046-017: モーダルバリアが存在する [P1]

**関連要件**: FR-103, REQ-5002

| 項目 | 内容 |
|------|------|
| **前提条件** | 確認ダイアログが表示されている |
| **テスト手順** | 1. モーダルバリアウィジェットの存在を確認する |
| **期待結果** | ModalBarrierウィジェットが存在する |
| **検証方法** | `find.byType(ModalBarrier)` が `findsWidgets` |

### TC-046-018: ダイアログ外の複数回タップでもダイアログが閉じない [P1]

**関連要件**: FR-103, REQ-5002, EDGE-002

| 項目 | 内容 |
|------|------|
| **前提条件** | 確認ダイアログが表示されている |
| **テスト手順** | 1. ダイアログ外を複数回タップする |
| **期待結果** | ダイアログが閉じない |
| **検証方法** | 複数タップ後も `findsOneWidget` |

---

## 5. 連続タップ防止テスト

### TC-046-019: 緊急ボタン連続タップで複数のダイアログが表示されない [P0]

**関連要件**: FR-104, REQ-5002, AC-011, EDGE-001

| 項目 | 内容 |
|------|------|
| **前提条件** | 緊急ボタンが画面に表示されている |
| **テスト手順** | 1. 緊急ボタンを短時間に連続でタップする（3回） |
| **期待結果** | 確認ダイアログは1つのみ表示される |
| **検証方法** | `find.byType(EmergencyConfirmationDialog)` が `findsOneWidget` |

### TC-046-020: ダイアログ表示中に緊急ボタン領域タップが遮断される [P0]

**関連要件**: FR-105, REQ-5002, AC-012

| 項目 | 内容 |
|------|------|
| **前提条件** | 確認ダイアログが表示されている |
| **テスト手順** | 1. ダイアログ表示中に緊急ボタン位置をタップする |
| **期待結果** | モーダルバリアにより緊急ボタンへのタップが遮断される |
| **検証方法** | 追加のダイアログが表示されないことを検証 |

### TC-046-021: 「はい」ボタン連続タップでコールバックが1回だけ呼ばれる [P0]

**関連要件**: AC-013, EDGE-003

| 項目 | 内容 |
|------|------|
| **前提条件** | 確認ダイアログが表示されている |
| **テスト手順** | 1. 「はい」ボタンを短時間に連続でタップする |
| **期待結果** | onEmergencyConfirmedコールバックは1回のみ呼び出される |
| **検証方法** | コールバック呼び出し回数カウントが1であることを検証 |

### TC-046-022: 「いいえ」ボタン連続タップでダイアログが正常に閉じる [P0]

**関連要件**: AC-014, EDGE-004

| 項目 | 内容 |
|------|------|
| **前提条件** | 確認ダイアログが表示されている |
| **テスト手順** | 1. 「いいえ」ボタンを短時間に連続でタップする |
| **期待結果** | ダイアログは1回のみ閉じ、エラーが発生しない |
| **検証方法** | onCancel呼び出し回数カウントが1であることを検証 |

---

## 6. アクセシビリティテスト

### TC-046-023: 「はい」ボタンのタップターゲットが44px x 44px以上 [P0]

**関連要件**: FR-203, REQ-5001, AC-015

| 項目 | 内容 |
|------|------|
| **前提条件** | 確認ダイアログが表示されている |
| **テスト手順** | 1. 「はい」ボタンのサイズを測定する |
| **期待結果** | 幅・高さともに44px以上 |
| **検証方法** | `tester.getSize()` で幅・高さ >= AppSizes.minTapTarget (44) |

### TC-046-024: 「いいえ」ボタンのタップターゲットが44px x 44px以上 [P0]

**関連要件**: FR-203, REQ-5001, AC-016

| 項目 | 内容 |
|------|------|
| **前提条件** | 確認ダイアログが表示されている |
| **テスト手順** | 1. 「いいえ」ボタンのサイズを測定する |
| **期待結果** | 幅・高さともに44px以上 |
| **検証方法** | `tester.getSize()` で幅・高さ >= AppSizes.minTapTarget (44) |

### TC-046-025: 「はい」ボタン幅が100px以上である [P1]

**関連要件**: 境界値（最小値100px）

| 項目 | 内容 |
|------|------|
| **前提条件** | 確認ダイアログが表示されている |
| **テスト手順** | 1. 「はい」ボタンの幅を測定する |
| **期待結果** | 幅が100px以上 |
| **検証方法** | `tester.getSize().width >= 100.0` |

### TC-046-026: 「いいえ」ボタン幅が100px以上である [P1]

**関連要件**: 境界値（最小値100px）

| 項目 | 内容 |
|------|------|
| **前提条件** | 確認ダイアログが表示されている |
| **テスト手順** | 1. 「いいえ」ボタンの幅を測定する |
| **期待結果** | 幅が100px以上 |
| **検証方法** | `tester.getSize().width >= 100.0` |

### TC-046-027: 確認ダイアログにSemantics「緊急呼び出し確認ダイアログ」が設定されている [P0]

**関連要件**: NFR-A001, AC-017

| 項目 | 内容 |
|------|------|
| **前提条件** | 確認ダイアログが表示されている |
| **テスト手順** | 1. ダイアログのSemantics情報を確認する |
| **期待結果** | label属性に「緊急呼び出し確認ダイアログ」が設定されている |
| **検証方法** | `tester.getSemantics().label` に「緊急呼び出し確認ダイアログ」が含まれる |

### TC-046-028: 緊急ボタンにSemantics「緊急呼び出しボタン」が設定されている [P0]

**関連要件**: NFR-A001

| 項目 | 内容 |
|------|------|
| **前提条件** | 緊急ボタンが画面に表示されている |
| **テスト手順** | 1. 緊急ボタンのSemantics情報を確認する |
| **期待結果** | label属性に「緊急呼び出しボタン」が含まれる |
| **検証方法** | `tester.getSemantics().label` に「緊急呼び出し」が含まれる |

### TC-046-029: 緊急ボタンにbutton: trueセマンティクスが設定されている [P1]

**関連要件**: NFR-A001

| 項目 | 内容 |
|------|------|
| **前提条件** | 緊急ボタンが画面に表示されている |
| **テスト手順** | 1. 緊急ボタンのSemantics情報を確認する |
| **期待結果** | button属性がtrueに設定されている |
| **検証方法** | Semanticsウィジェットのbutton属性を検証 |

### TC-046-030: 色だけでなくアイコンで緊急性を表現している [P1]

**関連要件**: NFR-A002

| 項目 | 内容 |
|------|------|
| **前提条件** | 緊急ボタンが画面に表示されている |
| **テスト手順** | 1. 緊急ボタンにアイコンが含まれることを確認する |
| **期待結果** | notifications_activeアイコンが表示されている |
| **検証方法** | `find.byIcon(Icons.notifications_active)` が `findsOneWidget` |

---

## 7. テーマ対応テスト

### TC-046-031: ライトモードで「はい」ボタンが赤色（#D32F2F）で表示される [P0]

**関連要件**: NFR-T001, AC-018

| 項目 | 内容 |
|------|------|
| **前提条件** | ライトテーマ適用、確認ダイアログが表示されている |
| **テスト手順** | 1. 「はい」ボタンの背景色を確認する |
| **期待結果** | 背景色が#D32F2F（AppColors.emergency） |
| **検証方法** | ボタンの背景色とAppColors.emergencyの一致を検証 |

### TC-046-032: ダークモードで「はい」ボタンが明るい赤色（#EF5350）で表示される [P0]

**関連要件**: NFR-T002, AC-019

| 項目 | 内容 |
|------|------|
| **前提条件** | ダークテーマ適用、確認ダイアログが表示されている |
| **テスト手順** | 1. 「はい」ボタンの背景色を確認する |
| **期待結果** | 背景色が#EF5350（AppColors.emergencyDark） |
| **検証方法** | ボタンの背景色とAppColors.emergencyDarkの一致を検証 |

### TC-046-033: 高コントラストモードで「はい」ボタンが純粋な赤色（#FF0000）で表示される [P0]

**関連要件**: NFR-T003, AC-020

| 項目 | 内容 |
|------|------|
| **前提条件** | 高コントラストテーマ適用、確認ダイアログが表示されている |
| **テスト手順** | 1. 「はい」ボタンの背景色を確認する |
| **期待結果** | 背景色が#FF0000（AppColors.emergencyHighContrast） |
| **検証方法** | ボタンの背景色とAppColors.emergencyHighContrastの一致を検証 |

### TC-046-034: ライトモードで「いいえ」ボタンがグレー色（#757575）で表示される [P1]

**関連要件**: NFR-T001

| 項目 | 内容 |
|------|------|
| **前提条件** | ライトテーマ適用、確認ダイアログが表示されている |
| **テスト手順** | 1. 「いいえ」ボタンの背景色を確認する |
| **期待結果** | 背景色が#757575（AppColors.cancelButtonLight） |
| **検証方法** | ボタンの背景色とAppColors.cancelButtonLightの一致を検証 |

### TC-046-035: ダークモードで「いいえ」ボタンが明るいグレー色（#BDBDBD）で表示される [P1]

**関連要件**: NFR-T002

| 項目 | 内容 |
|------|------|
| **前提条件** | ダークテーマ適用、確認ダイアログが表示されている |
| **テスト手順** | 1. 「いいえ」ボタンの背景色を確認する |
| **期待結果** | 背景色が#BDBDBD（AppColors.cancelButtonDark） |
| **検証方法** | ボタンの背景色とAppColors.cancelButtonDarkの一致を検証 |

### TC-046-036: 高コントラストモードで「いいえ」ボタンが黒色（#000000）白文字で表示される [P1]

**関連要件**: NFR-T003

| 項目 | 内容 |
|------|------|
| **前提条件** | 高コントラストテーマ適用、確認ダイアログが表示されている |
| **テスト手順** | 1. 「いいえ」ボタンの背景色と文字色を確認する |
| **期待結果** | 背景色が#000000、文字色が白 |
| **検証方法** | ボタンの背景色とAppColors.cancelButtonHighContrastの一致、foregroundColorが白を検証 |

### TC-046-037: 高コントラストモードでコントラスト比4.5:1以上を確保 [P0]

**関連要件**: NFR-A004, REQ-5006, AC-020

| 項目 | 内容 |
|------|------|
| **前提条件** | 高コントラストテーマ適用、確認ダイアログが表示されている |
| **テスト手順** | 1. ボタンの前景色と背景色のコントラスト比を計算する |
| **期待結果** | コントラスト比が4.5:1以上（WCAG 2.1 AAレベル） |
| **検証方法** | 白文字(#FFFFFF)と赤背景(#FF0000)のコントラスト比を検証 |

### TC-046-038: 緊急ボタンがライトモードで赤色（#D32F2F）で表示される [P0]

**関連要件**: NFR-T001, REQ-803

| 項目 | 内容 |
|------|------|
| **前提条件** | ライトテーマ適用 |
| **テスト手順** | 1. 緊急ボタンの背景色を確認する |
| **期待結果** | 背景色が#D32F2F（AppColors.emergency） |
| **検証方法** | Inkデコレーションの色を検証 |

### TC-046-039: 緊急ボタンがダークモードで明るい赤色（#EF5350）で表示される [P0]

**関連要件**: NFR-T002, REQ-803

| 項目 | 内容 |
|------|------|
| **前提条件** | ダークテーマ適用 |
| **テスト手順** | 1. 緊急ボタンの背景色を確認する |
| **期待結果** | 背景色が#EF5350（AppColors.emergencyDark） |
| **検証方法** | Inkデコレーションの色を検証 |

### TC-046-040: 緊急ボタンが高コントラストモードで純粋な赤色（#FF0000）で表示される [P0]

**関連要件**: NFR-T003, REQ-803, REQ-5006

| 項目 | 内容 |
|------|------|
| **前提条件** | 高コントラストテーマ適用 |
| **テスト手順** | 1. 緊急ボタンの背景色を確認する |
| **期待結果** | 背景色が#FF0000（AppColors.emergencyHighContrast） |
| **検証方法** | Inkデコレーションの色を検証 |

---

## 8. UI/デザインテスト

### TC-046-041: 緊急ボタンが円形で表示される [P1]

**関連要件**: デザイン仕様

| 項目 | 内容 |
|------|------|
| **前提条件** | 緊急ボタンが画面に表示されている |
| **テスト手順** | 1. ボタンの形状を確認する |
| **期待結果** | ボタンが円形（正方形のサイズ）で表示される |
| **検証方法** | ボタンの幅と高さが等しいことを検証 |

### TC-046-042: 緊急ボタンのデフォルトサイズが60x60pxである [P1]

**関連要件**: デザイン仕様

| 項目 | 内容 |
|------|------|
| **前提条件** | sizeパラメータ未指定で緊急ボタンが表示されている |
| **テスト手順** | 1. ボタンのサイズを測定する |
| **期待結果** | 幅・高さともに60px（AppSizes.recommendedTapTarget） |
| **検証方法** | `tester.getSize()` で幅・高さ == 60.0 |

### TC-046-043: 緊急ボタンにカスタムサイズが適用される [P2]

**関連要件**: カスタマイズ対応

| 項目 | 内容 |
|------|------|
| **前提条件** | size: 80.0で緊急ボタンが表示されている |
| **テスト手順** | 1. ボタンのサイズを測定する |
| **期待結果** | 幅・高さともに80px |
| **検証方法** | `tester.getSize()` で幅・高さ == 80.0 |

### TC-046-044: 緊急ボタンの最小サイズ（44px）が保証される [P0]

**関連要件**: FR-203, REQ-5001

| 項目 | 内容 |
|------|------|
| **前提条件** | size: 30.0（最小未満）で緊急ボタンが表示されている |
| **テスト手順** | 1. ボタンのサイズを測定する |
| **期待結果** | 幅・高さともに44px以上が保証される |
| **検証方法** | `tester.getSize()` で幅・高さ >= AppSizes.minTapTarget (44) |

### TC-046-045: 緊急ボタンにnotifications_activeアイコンが表示される [P0]

**関連要件**: デザイン仕様

| 項目 | 内容 |
|------|------|
| **前提条件** | 緊急ボタンが画面に表示されている |
| **テスト手順** | 1. アイコンの存在を確認する |
| **期待結果** | notifications_activeアイコンが表示される |
| **検証方法** | `find.byIcon(Icons.notifications_active)` が `findsOneWidget` |

### TC-046-046: 緊急ボタンのアイコン色が白である [P1]

**関連要件**: デザイン仕様

| 項目 | 内容 |
|------|------|
| **前提条件** | 緊急ボタンが画面に表示されている |
| **テスト手順** | 1. アイコンの色を確認する |
| **期待結果** | アイコン色が白（Colors.white） |
| **検証方法** | Iconウィジェットのcolor属性を検証 |

### TC-046-047: 緊急ボタンにエレベーション（影）が適用されている [P2]

**関連要件**: デザイン仕様

| 項目 | 内容 |
|------|------|
| **前提条件** | 緊急ボタンが画面に表示されている |
| **テスト手順** | 1. ボタンのBoxShadowを確認する |
| **期待結果** | 影（BoxShadow）が適用されている |
| **検証方法** | Inkデコレーションにboxshadowが設定されていることを検証 |

### TC-046-048: 緊急ボタンタップ時に視覚的フィードバック（リップル）が発生する [P2]

**関連要件**: デザイン仕様

| 項目 | 内容 |
|------|------|
| **前提条件** | 緊急ボタンが画面に表示されている |
| **テスト手順** | 1. InkWellウィジェットの存在を確認する |
| **期待結果** | InkWellによるリップルエフェクトが存在する |
| **検証方法** | `find.byType(InkWell)` が存在することを検証 |

---

## 9. 統合テスト

### TC-046-049: 2段階確認フロー全体（ボタンタップ→確認→実行）が正しく動作する [P0]

**関連要件**: FR-201, REQ-302, AC-021

| 項目 | 内容 |
|------|------|
| **前提条件** | 緊急ボタンが画面に表示されている |
| **テスト手順** | 1. 緊急ボタンをタップする<br>2. 確認ダイアログが表示されることを確認する<br>3. 「はい」ボタンをタップする |
| **期待結果** | ダイアログが閉じ、onEmergencyConfirmedコールバックが呼び出される |
| **検証方法** | 各ステップの状態遷移を検証 |

### TC-046-050: キャンセルフロー全体（ボタンタップ→確認→キャンセル）が正しく動作する [P0]

**関連要件**: FR-201, REQ-302, AC-022

| 項目 | 内容 |
|------|------|
| **前提条件** | 緊急ボタンが画面に表示されている |
| **テスト手順** | 1. 緊急ボタンをタップする<br>2. 確認ダイアログが表示されることを確認する<br>3. 「いいえ」ボタンをタップする |
| **期待結果** | ダイアログが閉じ、コールバックは呼ばれず、通常状態に戻る |
| **検証方法** | 各ステップの状態遷移を検証 |

### TC-046-051: タップ操作のみで全操作が完結する [P0]

**関連要件**: FR-202, REQ-5005, AC-023

| 項目 | 内容 |
|------|------|
| **前提条件** | 緊急ボタンが画面に表示されている |
| **テスト手順** | 1. タップのみで緊急ボタン→確認ダイアログ→「はい」の操作を完了する |
| **期待結果** | スワイプやロングプレスなしでタップのみで操作が完結する |
| **検証方法** | タップ操作のみで全フローを完了できることを検証 |

### TC-046-052: 確認後に緊急処理が1回だけ実行される（重複実行防止） [P0]

**関連要件**: FR-201, REQ-5002

| 項目 | 内容 |
|------|------|
| **前提条件** | 緊急ボタンが画面に表示されている |
| **テスト手順** | 1. 緊急ボタンをタップする<br>2. 「はい」ボタンを素早く連続タップする |
| **期待結果** | コールバックは1回のみ呼び出される |
| **検証方法** | コールバック呼び出し回数が1であることを検証 |

### TC-046-053: カスタムダイアログビルダーが適用される [P2]

**関連要件**: カスタマイズ対応

| 項目 | 内容 |
|------|------|
| **前提条件** | dialogBuilderパラメータが指定されている |
| **テスト手順** | 1. 緊急ボタンをタップする |
| **期待結果** | カスタムダイアログが表示される |
| **検証方法** | カスタムダイアログのタイトル等が表示されることを検証 |

---

## 10. エッジケーステスト

### TC-046-054: ダイアログ表示中のアプリバックグラウンド化 [P2]

**関連要件**: EDGE-005

| 項目 | 内容 |
|------|------|
| **前提条件** | 確認ダイアログが表示されている |
| **テスト手順** | 1. アプリをバックグラウンドに移動する<br>2. フォアグラウンドに復帰する |
| **期待結果** | ダイアログが維持される、またはキャンセル状態で閉じている |
| **備考** | 手動テストまたはIntegration Testで検証 |

### TC-046-055: ダイアログ表示中の画面回転 [P2]

**関連要件**: EDGE-006

| 項目 | 内容 |
|------|------|
| **前提条件** | 確認ダイアログが表示されている |
| **テスト手順** | 1. デバイスを回転させる |
| **期待結果** | ダイアログが維持され、レイアウトが適切に調整される |
| **備考** | 手動テストまたはIntegration Testで検証 |

---

## テストケースサマリー

### カテゴリ別テストケース数

| カテゴリ | P0 | P1 | P2 | P3 | 合計 |
|----------|----|----|----|----|------|
| 1. 確認ダイアログ表示 | 5 | 3 | 1 | 0 | 9 |
| 2. 「はい」ボタン動作 | 2 | 1 | 0 | 0 | 3 |
| 3. 「いいえ」ボタン動作 | 3 | 0 | 0 | 0 | 3 |
| 4. ダイアログ外タップ | 1 | 2 | 0 | 0 | 3 |
| 5. 連続タップ防止 | 4 | 0 | 0 | 0 | 4 |
| 6. アクセシビリティ | 4 | 4 | 0 | 0 | 8 |
| 7. テーマ対応 | 5 | 5 | 0 | 0 | 10 |
| 8. UI/デザイン | 2 | 3 | 3 | 0 | 8 |
| 9. 統合テスト | 4 | 0 | 1 | 0 | 5 |
| 10. エッジケース | 0 | 0 | 2 | 0 | 2 |
| **合計** | **30** | **18** | **7** | **0** | **55** |

### 優先度別テストケース数

| 優先度 | テストケース数 | 割合 |
|--------|----------------|------|
| P0（必須） | 30 | 54.5% |
| P1（高優先度） | 18 | 32.7% |
| P2（中優先度） | 7 | 12.7% |
| P3（低優先度） | 0 | 0% |
| **合計** | **55** | **100%** |

---

## 既存テストとの関係

### TASK-0045で実装済みテスト

以下のテストはTASK-0045で既に実装済みです:
- `test/features/emergency/presentation/widgets/emergency_button_with_confirmation_test.dart`
  - TC-045-001 〜 TC-045-027, TC-045-050 〜 TC-045-052
- `test/features/emergency/presentation/widgets/emergency_confirmation_dialog_test.dart`
  - TC-045-028 〜 TC-045-049

### TASK-0046で追加・拡張するテスト

TASK-0046では以下のテストを追加・拡張します:
1. **誤操作防止の強化テスト**: ダイアログ外複数回タップ、連続タップの詳細検証
2. **エッジケースの網羅**: アプリバックグラウンド化、画面回転
3. **テーマ対応の詳細検証**: 各テーマでの具体的な色コード検証
4. **ボタン配置順序**: 「いいえ」「はい」の左右配置検証
5. **コントラスト比検証**: 高コントラストモードでのWCAG準拠確認

---

## 備考

- **信頼性レベル凡例**:
  - 🔵 **青信号**: 要件定義書に明確に記載された要件
  - 🟡 **黄信号**: 要件定義書から妥当に推測される要件
  - 🔴 **赤信号**: 要件定義書にない推測による要件

- **テスト実行環境**:
  - Flutter 3.38.1 + flutter_test
  - WidgetTesterを使用したWidgetテスト
  - 必要に応じてIntegration Testを使用

- **カバレッジ目標**:
  - 全体カバレッジ: 80%以上
  - ビジネスロジック: 90%以上

---

**ドキュメント作成日**: 2025-11-24
**タスクID**: TASK-0046
**関連要件**: REQ-302, REQ-2004, REQ-2005, REQ-5002
