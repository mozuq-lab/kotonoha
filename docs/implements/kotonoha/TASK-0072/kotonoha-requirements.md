# TASK-0072: フォントサイズ設定UI・適用 要件定義書

## 1. 機能の概要（EARS要件定義書・設計文書ベース）

### 1.1 機能説明
🔵 青信号

**何をする機能か**:
フォントサイズ設定をアプリ全体に即座に反映する機能。設定画面でフォントサイズ（小/中/大）を変更すると、文字盤、定型文一覧、ボタンラベル、入力欄など全てのテキスト要素のサイズが即座に変更される。

**どのような問題を解決するか**:
視力が弱い高齢者・視覚障害者が自分に適したフォントサイズでアプリを利用できるようにする。

**想定されるユーザー**:
- 脳梗塞・ALS・筋疾患などで発話が困難だが、タブレット操作が可能な方
- 高齢者など視力が弱い方
- 様々な視力レベルを持つユーザー

**システム内での位置づけ**:
- 設定画面（SettingsScreen）のUI要素
- アプリ全体のフォントサイズを制御するグローバル設定
- SettingsNotifierProvider経由で状態管理

### 1.2 参照情報
- **参照したEARS要件**: REQ-801, REQ-802, REQ-804, REQ-2007
- **参照した設計文書**: `docs/design/kotonoha/interfaces.dart` (FontSize enum, AppSettings class)

## 2. 入力・出力の仕様（EARS機能要件・型定義ベース）

### 2.1 入力パラメータ
🔵 青信号

| パラメータ | 型 | 範囲/制約 | 説明 |
|-----------|-----|----------|------|
| fontSize | FontSize (enum) | small, medium, large | 3段階のフォントサイズ設定 |

**FontSize enum定義** (interfaces.dart):
```dart
enum FontSize {
  small('小'),    // 16px
  medium('中'),   // 20px (デフォルト)
  large('大');    // 24px
}
```

### 2.2 出力/反映対象
🔵 青信号

| 反映対象 | 説明 |
|---------|------|
| 文字盤ボタン | 五十音文字盤の各文字のフォントサイズ |
| 定型文一覧 | 定型文リストのテキストサイズ |
| ボタンラベル | 各種ボタン（クイック応答、削除、読み上げ等）のラベルサイズ |
| 入力欄 | 入力テキスト表示エリアのフォントサイズ |

### 2.3 データフロー
🔵 青信号

```
ユーザー操作（設定画面でフォントサイズ選択）
    ↓
SettingsNotifier.setFontSize() 呼び出し
    ↓
AppSettings状態更新（楽観的更新でUI即座反映）
    ↓
SharedPreferencesに永続化
    ↓
全画面のウィジェットが新しいフォントサイズで再描画
```

### 2.4 参照情報
- **参照したEARS要件**: REQ-801, REQ-802, REQ-2007
- **参照した設計文書**: `interfaces.dart` のFontSize enum、AppSettings class

## 3. 制約条件（EARS非機能要件・アーキテクチャ設計ベース）

### 3.1 パフォーマンス要件
🟡 黄信号

| 要件 | 値 | 根拠 |
|------|-----|------|
| 設定変更の反映時間 | 即座（100ms以内） | REQ-2007「即座に変更」、NFR-003から推測 |
| 設定画面の表示時間 | 1秒以内 | NFR-004から推測 |

### 3.2 アクセシビリティ要件
🔵 青信号

| 要件 | 説明 | 根拠 |
|------|------|------|
| デフォルトサイズ | 高齢者にも見やすいサイズ（medium: 20px） | REQ-804 |
| 大サイズ | 視力が弱い方向け（large: 24px） | REQ-801 |
| タップターゲット | 44px × 44px以上 | REQ-5001 |

### 3.3 永続化要件
🔵 青信号

| 要件 | 説明 | 根拠 |
|------|------|------|
| 設定保存 | SharedPreferencesに保存 | REQ-5003 |
| 復元 | アプリ再起動後も設定を保持 | REQ-5003 |

### 3.4 参照情報
- **参照したEARS要件**: REQ-801, REQ-804, REQ-2007, REQ-5001, REQ-5003, NFR-003, NFR-004
- **参照した設計文書**: `architecture.md`, `app_sizes.dart`

## 4. 想定される使用例（EARS Edgeケース・データフローベース）

### 4.1 基本的な使用パターン
🔵 青信号

#### パターン1: フォントサイズを大に変更
1. ユーザーが設定画面を開く
2. 「フォントサイズ」セクションで「大」をタップ
3. 即座にアプリ全体のフォントサイズが24pxに変更される
4. 文字盤、定型文、ボタンラベルすべてが拡大表示される
5. 設定がSharedPreferencesに保存される

#### パターン2: フォントサイズ変更後のホーム画面確認
1. ユーザーがフォントサイズを「大」に設定
2. ホーム画面に戻る
3. 文字盤の文字が大きく表示されている
4. クイック応答ボタンのラベルが大きく表示されている

#### パターン3: アプリ再起動後の設定復元
1. ユーザーがフォントサイズを「小」に設定
2. アプリを終了
3. アプリを再起動
4. フォントサイズが「小」のまま復元されている

### 4.2 エッジケース
🟡 黄信号

| ケース | 期待動作 | 根拠 |
|-------|---------|------|
| 設定読み込み中 | デフォルト（medium）を使用 | EDGE-201, NFR-301 |
| 設定保存失敗 | UI状態は更新済み、次回起動時にデフォルトに戻る可能性 | NFR-301 |
| 不正な保存値 | デフォルト（medium）にフォールバック | 防御的プログラミング |

### 4.3 参照情報
- **参照したEARS要件**: REQ-2007, EDGE-201, NFR-301
- **参照した設計文書**: `dataflow.md`

## 5. EARS要件・設計文書との対応関係

### 5.1 参照した機能要件
| 要件ID | 内容 | 対応 |
|--------|------|------|
| REQ-801 | フォントサイズを「小」「中」「大」の3段階から選択できる | UI実装済み（TASK-0071）、適用の検証が必要 |
| REQ-802 | 文字盤・定型文一覧・ボタンラベルのフォントサイズを設定に追従させる | 本タスクの主要目的 |
| REQ-804 | 標準フォントサイズを高齢者にも見やすいサイズに設定 | デフォルト値の確認 |
| REQ-2007 | フォントサイズ変更時に即座にすべてのテキスト要素のサイズを変更 | 即座反映の検証が必要 |

### 5.2 参照した非機能要件
| 要件ID | 内容 | 対応 |
|--------|------|------|
| NFR-003 | 100ms以内の応答 | 即座反映の確認 |
| REQ-5003 | 設定永続化 | 既存実装で対応済み |
| NFR-301 | 重大なエラーでも基本機能継続 | エラーハンドリング |

### 5.3 参照した設計文書
| 文書 | 該当セクション |
|------|---------------|
| interfaces.dart | FontSize enum, AppSettings class |
| app_sizes.dart | fontSizeSmall/Medium/Large 定数 |
| settings_provider.dart | setFontSize()メソッド |
| character_board_widget.dart | fontSize プロパティ |

## 6. 実装状況確認

### 6.1 既存実装
🔵 青信号

以下は既にTASK-0071で実装済み:
- FontSizeSettingsWidget（設定UI）
- SettingsNotifier.setFontSize()（状態管理）
- FontSize enum（3段階定義）
- SharedPreferences永続化

### 6.2 本タスクで検証/実装が必要な項目
🔵 青信号

1. **フォントサイズがアプリ全体に正しく反映されることの検証**
   - CharacterBoardWidget への反映
   - QuickResponseButtons への反映
   - 入力欄への反映
   - 定型文一覧への反映

2. **即座反映（REQ-2007）の検証**
   - 設定変更後、ホーム画面に戻らなくても反映されるか
   - 100ms以内に反映されるか

3. **アプリ再起動後の設定復元の検証**
   - 保存した設定が正しく復元されるか

## 7. 品質判定

✅ **高品質**

| 基準 | 状態 |
|------|------|
| 要件の曖昧さ | なし - EARS要件が明確 |
| 入出力定義 | 完全 - FontSize enum、適用対象が明確 |
| 制約条件 | 明確 - 即座反映、永続化要件が定義済み |
| 実装可能性 | 確実 - 既存実装をベースに検証主体 |

---

**次のお勧めステップ**: `/tdd-testcases` でテストケースの洗い出しを行います。
