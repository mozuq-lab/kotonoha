# TASK-0072: フォントサイズ設定UI・適用 テストケース定義書

## 開発言語・フレームワーク

- **プログラミング言語**: Dart
  - **言語選択の理由**: Flutter アプリケーションの開発言語
  - **テストに適した機能**: Null Safety、強い型付け、非同期テストサポート
- **テストフレームワーク**: flutter_test + flutter_riverpod
  - **フレームワーク選択の理由**: Flutter 公式テストフレームワーク、Riverpod の状態管理テスト対応
  - **テスト実行環境**: Flutter テストランナー（`flutter test`）
- 🔵 青信号: `docs/tech-stack.md` で定義された技術スタック

---

## テストケース概要

| カテゴリ | テストケース数 | 対応要件 |
|---------|---------------|---------|
| 正常系 | 8 | REQ-801, REQ-802, REQ-2007 |
| 異常系 | 2 | NFR-301, EDGE-201 |
| 境界値 | 3 | REQ-801 |
| **合計** | **13** | |

---

## 1. 正常系テストケース（基本動作）

### TC-072-001: 設定画面でフォントサイズ選択UIが表示される

- **テスト名**: フォントサイズ選択UI表示テスト
  - **何をテストするか**: 設定画面にフォントサイズ選択UIが表示されること
  - **期待される動作**: 「フォントサイズ」ラベルと3つの選択肢（小/中/大）が表示される
- **入力値**: なし（設定画面を表示）
  - **入力データの意味**: ユーザーが設定画面を開いた状態
- **期待される結果**: FontSizeSettingsWidget が表示される
  - **期待結果の理由**: TASK-0071 で実装済みのUIが正常に動作することを確認
- **テストの目的**: REQ-801 の UI 部分の確認
  - **確認ポイント**: セグメントボタンが3つ表示される
- 🔵 青信号: REQ-801「フォントサイズを3段階から選択可能」

### TC-072-002: フォントサイズ変更が CharacterBoardWidget に反映される

- **テスト名**: 文字盤フォントサイズ追従テスト
  - **何をテストするか**: フォントサイズ設定が文字盤の文字サイズに反映されること
  - **期待される動作**: フォントサイズを「大」に設定すると文字盤の文字が24pxで表示される
- **入力値**: fontSize = FontSize.large
  - **入力データの意味**: ユーザーがフォントサイズを「大」に設定した状態
- **期待される結果**: CharacterBoardWidget の fontSize が large になる
  - **期待結果の理由**: REQ-802「文字盤のフォントサイズが設定に追従」
- **テストの目的**: REQ-802 の文字盤追従確認
  - **確認ポイント**: CharacterBoardWidget.fontSize が設定値と一致する
- 🔵 青信号: REQ-802「文字盤のフォントサイズを設定に追従させる」

### TC-072-003: フォントサイズ変更が QuickResponseButtons に反映される

- **テスト名**: クイック応答ボタンフォントサイズ追従テスト
  - **何をテストするか**: フォントサイズ設定がクイック応答ボタンに反映されること
  - **期待される動作**: フォントサイズを「大」に設定するとボタンラベルが大きくなる
- **入力値**: fontSize = FontSize.large
  - **入力データの意味**: ユーザーがフォントサイズを「大」に設定した状態
- **期待される結果**: QuickResponseButtons の fontSize が large になる
  - **期待結果の理由**: REQ-802「ボタンラベルのフォントサイズが設定に追従」
- **テストの目的**: REQ-802 のボタンラベル追従確認
  - **確認ポイント**: QuickResponseButtons.fontSize が設定値と一致する
- 🔵 青信号: REQ-802「ボタンラベルのフォントサイズを設定に追従させる」

### TC-072-004: フォントサイズ変更が即座に反映される

- **テスト名**: フォントサイズ即座反映テスト
  - **何をテストするか**: 設定変更後すぐにUIに反映されること
  - **期待される動作**: setFontSize() 呼び出し直後に state が更新される
- **入力値**: setFontSize(FontSize.large)
  - **入力データの意味**: ユーザーがフォントサイズを変更した操作
- **期待される結果**: 楽観的更新で即座に state が更新される
  - **期待結果の理由**: REQ-2007「即座にすべてのテキスト要素のサイズを変更」
- **テストの目的**: REQ-2007 の即座反映確認
  - **確認ポイント**: await 完了後に state.fontSize が更新されている
- 🔵 青信号: REQ-2007「フォントサイズ変更時に即座に変更」

### TC-072-005: フォントサイズ「小」の設定と適用

- **テスト名**: フォントサイズ小設定テスト
  - **何をテストするか**: フォントサイズ「小」が正しく設定・適用されること
  - **期待される動作**: fontSize = small が状態に保存され、UIに反映される
- **入力値**: FontSize.small
  - **入力データの意味**: 視力が良好なユーザーが「小」を選択
- **期待される結果**: settings.fontSize == FontSize.small
  - **期待結果の理由**: REQ-801 の3段階選択の最小値
- **テストの目的**: 3段階選択の網羅（最小値）
  - **確認ポイント**: 状態更新と永続化が正常に動作する
- 🔵 青信号: REQ-801「小/中/大の3段階」

### TC-072-006: フォントサイズ「中」の設定と適用（デフォルト）

- **テスト名**: フォントサイズ中設定テスト
  - **何をテストするか**: フォントサイズ「中」（デフォルト）が正しく設定・適用されること
  - **期待される動作**: fontSize = medium が状態に保存され、UIに反映される
- **入力値**: FontSize.medium
  - **入力データの意味**: 標準的なユーザーがデフォルト設定を使用
- **期待される結果**: settings.fontSize == FontSize.medium
  - **期待結果の理由**: REQ-804「高齢者にも見やすいサイズ」のデフォルト
- **テストの目的**: デフォルト値の確認
  - **確認ポイント**: デフォルト値が正しく適用されている
- 🔵 青信号: REQ-804「標準フォントサイズを高齢者にも見やすいサイズに設定」

### TC-072-007: フォントサイズ「大」の設定と適用

- **テスト名**: フォントサイズ大設定テスト
  - **何をテストするか**: フォントサイズ「大」が正しく設定・適用されること
  - **期待される動作**: fontSize = large が状態に保存され、UIに反映される
- **入力値**: FontSize.large
  - **入力データの意味**: 視力が弱い高齢者・視覚障害者が「大」を選択
- **期待される結果**: settings.fontSize == FontSize.large
  - **期待結果の理由**: REQ-801 の3段階選択の最大値
- **テストの目的**: 3段階選択の網羅（最大値）
  - **確認ポイント**: 状態更新と永続化が正常に動作する
- 🔵 青信号: REQ-801「小/中/大の3段階」

### TC-072-008: アプリ再起動後のフォントサイズ設定復元

- **テスト名**: フォントサイズ設定復元テスト
  - **何をテストするか**: アプリ再起動後に保存したフォントサイズが復元されること
  - **期待される動作**: SharedPreferences に保存した値が build() で読み込まれる
- **入力値**: SharedPreferences に fontSize = large.index を保存
  - **入力データの意味**: 前回セッションで「大」を選択した状態
- **期待される結果**: settings.fontSize == FontSize.large
  - **期待結果の理由**: REQ-5003「アプリ強制終了しても設定を失わない」
- **テストの目的**: REQ-5003 の永続化確認
  - **確認ポイント**: 保存値が正しく復元される
- 🔵 青信号: REQ-5003「永続化機構を実装」

---

## 2. 異常系テストケース（エラーハンドリング）

### TC-072-009: 設定読み込み中のデフォルト値使用

- **テスト名**: 設定読み込み中フォールバックテスト
  - **エラーケースの概要**: 設定の非同期読み込み中にUIが表示される場合
  - **エラー処理の重要性**: ローディング中もアプリが動作する必要がある
- **入力値**: settingsNotifierProvider が AsyncLoading 状態
  - **不正な理由**: まだ設定が読み込まれていない
  - **実際の発生シナリオ**: アプリ起動直後、SharedPreferences 読み込み中
- **期待される結果**: デフォルト値（medium）でUIが表示される
  - **エラーメッセージの内容**: なし（正常動作）
  - **システムの安全性**: ローディング中もUIが崩れない
- **テストの目的**: ローディング状態のハンドリング確認
  - **品質保証の観点**: UX を損なわない非同期処理
- 🟡 黄信号: EDGE-201、NFR-301 から推測

### TC-072-010: 不正な保存値のフォールバック

- **テスト名**: 不正値フォールバックテスト
  - **エラーケースの概要**: SharedPreferences に不正な値が保存されている場合
  - **エラー処理の重要性**: 設定ファイルの破損時もアプリが起動する必要がある
- **入力値**: SharedPreferences に fontSize = 99（範囲外の値）を保存
  - **不正な理由**: FontSize enum の範囲外（0-2）
  - **実際の発生シナリオ**: 設定ファイル破損、古いバージョンからのアップグレード
- **期待される結果**: デフォルト値（medium）にフォールバック
  - **エラーメッセージの内容**: なし（サイレントフォールバック）
  - **システムの安全性**: 不正値でもアプリがクラッシュしない
- **テストの目的**: 防御的プログラミングの確認
  - **品質保証の観点**: 堅牢性の確保
- 🟡 黄信号: NFR-301「基本機能継続」から推測

---

## 3. 境界値テストケース

### TC-072-011: FontSize enum の最小値（small = 0）

- **テスト名**: FontSize 最小値テスト
  - **境界値の意味**: enum の最初の値（index = 0）
  - **境界値での動作保証**: 最小値でも正常に動作する
- **入力値**: FontSize.small (index = 0)
  - **境界値選択の根拠**: enum の最小インデックス
  - **実際の使用場面**: 視力が良い若いユーザー
- **期待される結果**: fontSize = small が正常に保存・復元される
  - **境界での正確性**: SharedPreferences に 0 が保存される
  - **一貫した動作**: 他の値と同様に動作する
- **テストの目的**: 境界値（最小）の動作確認
  - **堅牢性の確認**: インデックス 0 でも正常動作
- 🔵 青信号: REQ-801 の3段階（最小）

### TC-072-012: FontSize enum の最大値（large = 2）

- **テスト名**: FontSize 最大値テスト
  - **境界値の意味**: enum の最後の値（index = 2）
  - **境界値での動作保証**: 最大値でも正常に動作する
- **入力値**: FontSize.large (index = 2)
  - **境界値選択の根拠**: enum の最大インデックス
  - **実際の使用場面**: 視力が弱い高齢者・視覚障害者
- **期待される結果**: fontSize = large が正常に保存・復元される
  - **境界での正確性**: SharedPreferences に 2 が保存される
  - **一貫した動作**: 他の値と同様に動作する
- **テストの目的**: 境界値（最大）の動作確認
  - **堅牢性の確認**: インデックス 2 でも正常動作
- 🔵 青信号: REQ-801 の3段階（最大）

### TC-072-013: フォントサイズ切り替えの連続操作

- **テスト名**: フォントサイズ連続変更テスト
  - **境界値の意味**: 状態遷移の連続性
  - **境界値での動作保証**: 連続した変更が正常に処理される
- **入力値**: small → medium → large → small の順に変更
  - **境界値選択の根拠**: 全値の循環テスト
  - **実際の使用場面**: ユーザーが最適なサイズを探している
- **期待される結果**: 各変更後に正しい値が設定される
  - **境界での正確性**: 最終的に small が正しく設定される
  - **一貫した動作**: 中間状態も正しく反映される
- **テストの目的**: 状態遷移の安定性確認
  - **堅牢性の確認**: 連続操作でも状態が一貫する
- 🟡 黄信号: 一般的なUI動作から推測

---

## テストファイル構成

```
test/features/settings/
├── providers/
│   ├── settings_provider_test.dart           # 既存（TC-001〜TC-016）
│   └── settings_provider_font_size_test.dart # 新規（TC-072-001〜TC-072-013）
├── presentation/
│   ├── settings_screen_test.dart             # 既存
│   └── widgets/
│       └── font_size_settings_widget_test.dart # 既存（TASK-0071）
└── integration/
    └── font_size_application_test.dart       # 新規（アプリ全体への反映テスト）
```

---

## 品質判定

✅ **高品質**

| 基準 | 状態 |
|------|------|
| テストケース分類 | 正常系8件、異常系2件、境界値3件 で網羅 |
| 期待値定義 | 各テストケースの期待値が具体的に定義済み |
| 技術選択 | flutter_test + flutter_riverpod で確定 |
| 実装可能性 | 既存のテストパターンを踏襲可能 |

---

**次のお勧めステップ**: `/tsumiki:tdd-red` でRedフェーズ（失敗テスト作成）を開始します。
