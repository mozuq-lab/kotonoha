# TASK-0084: 大ボタン・緊急ボタンE2Eテスト 実装メモ

## 実装概要

大ボタン（クイック応答）、状態ボタン、緊急ボタン機能のE2Eテストを実装。TDD手法に基づいて、要件定義→テストケース作成→テスト実装→リファクタリング→品質確認の順で進行。

## 作成ファイル

### E2Eテストファイル

- `frontend/kotonoha_app/integration_test/large_emergency_buttons_test.dart`
  - 21テストケース実装
  - 6つのテストグループ（正常系大ボタン、正常系状態ボタン、正常系緊急ボタン、異常系、パフォーマンス、統合）

### ドキュメント

- `docs/implements/kotonoha/TASK-0084/large-emergency-buttons-requirements.md` - 要件定義書
- `docs/implements/kotonoha/TASK-0084/large-emergency-buttons-testcases.md` - テストケース一覧

## テストケース一覧

### 正常系（大ボタン）

1. TC-E2E-084-001: 「はい」「いいえ」「わからない」ボタンが表示される
2. TC-E2E-084-002: 「はい」ボタンタップで即座に読み上げ開始
3. TC-E2E-084-003: 「いいえ」ボタンタップで即座に読み上げ開始
4. TC-E2E-084-004: 「わからない」ボタンタップで即座に読み上げ開始
5. TC-E2E-084-005: 大ボタン連続タップがデバウンスされる

### 正常系（状態ボタン）

6. TC-E2E-084-006: 状態ボタンが8-12個表示される
7. TC-E2E-084-007: 「痛い」ボタンタップで即座に読み上げ開始
8. TC-E2E-084-008: 「トイレ」ボタンタップで即座に読み上げ開始
9. TC-E2E-084-009: すべての必須状態ボタンが正しくタップできる

### 正常系（緊急ボタン）

10. TC-E2E-084-010: 緊急ボタンが常時表示される
11. TC-E2E-084-011: 緊急ボタンタップで確認ダイアログが表示される
12. TC-E2E-084-012: 確認ダイアログで「いいえ」選択でキャンセル
13. TC-E2E-084-013: 確認ダイアログで「はい」選択で緊急処理実行
14. TC-E2E-084-014: 緊急画面でリセットボタンタップで通常画面に戻る

### 異常系

15. TC-E2E-084-015: 大ボタンを空の入力欄状態でタップしても安全に処理される
16. TC-E2E-084-016: 緊急ボタン誤操作防止（2段階確認）が正しく機能する
17. TC-E2E-084-017: 確認ダイアログ外タップで閉じない

### パフォーマンス

18. TC-E2E-084-018: 大ボタンタップから読み上げ開始まで1秒以内
19. TC-E2E-084-019: 状態ボタンタップから読み上げ開始まで1秒以内

### 統合

20. TC-E2E-084-020: 大ボタンタップ→読み上げ→履歴保存の一連フロー
21. TC-E2E-084-021: 緊急ボタン→確認→緊急画面→リセットの一連フロー

## 関連要件

### 大ボタン関連

- REQ-201: クイック応答ボタン（はい/いいえ/わからない）
- REQ-202: 状態ボタン（痛い、トイレ、暑い、寒い、水、眠い、助けて、待って）
- REQ-203: 状態ボタン数（8-12個）
- REQ-204: 即座読み上げ

### 緊急ボタン関連

- REQ-301: 緊急ボタン常時表示
- REQ-302: 2段階確認
- REQ-303: 緊急音再生
- REQ-304: 緊急画面表示（赤い全画面）

### 非機能要件

- NFR-001: TTS読み上げ1秒以内
- REQ-5002: 誤操作防止

## 技術的な決定事項

1. **TTS状態確認**: 「停止」ボタンの表示でTTS読み上げ開始を確認
2. **緊急ボタン検索**: `Icons.notifications_active` アイコンで検索
3. **確認ダイアログ操作**: `find.widgetWithText(TextButton, 'はい')` でダイアログ内ボタンを特定
4. **緊急画面検証**: `EmergencyAlertScreen` ウィジェットの存在確認
5. **パフォーマンス計測**: `measurePerformance()` ヘルパーで1秒以内の応答を検証
6. **デバウンステスト**: 100ms間隔での連続タップでデバウンス動作を確認

## 完了日

2025-11-29

## 信頼性レベル

🔵 青信号 - REQ-201〜REQ-204、REQ-301〜REQ-304に基づく明確なテスト実装
