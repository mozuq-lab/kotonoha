# TASK-0080: Phase 4 統合テスト - テストケース

## テスト概要

- **タスクID**: TASK-0080
- **総テストケース数**: 12件
- **テストファイル**: `test/integration/phase4/phase4_integration_test.dart`

---

## 1. 設定変更即時反映テスト

| TC-ID | テストケース名 | 前提条件 | テスト内容 | 期待結果 | 関連要件 |
|-------|---------------|----------|-----------|----------|----------|
| TC-080-001 | テーマ設定変更が即時反映される | 設定初期化完了 | setTheme(AppTheme.dark)を呼ぶ | settings.themeがAppTheme.darkになる | INT-001 |
| TC-080-002 | フォントサイズ変更が即時反映される | 設定初期化完了 | setFontSize(FontSize.large)を呼ぶ | settings.fontSizeがFontSize.largeになる | INT-002 |
| TC-080-003 | TTS速度変更が即時反映される | 設定初期化完了 | setTTSSpeed(TTSSpeed.fast)を呼ぶ | settings.ttsSpeedがTTSSpeed.fastになる | INT-003 |

---

## 2. オフライン時フォールバック動作テスト

| TC-ID | テストケース名 | 前提条件 | テスト内容 | 期待結果 | 関連要件 |
|-------|---------------|----------|-----------|----------|----------|
| TC-080-004 | オフライン時にバナーが表示される | オフライン状態 | OfflineBannerを表示 | 「オフライン - 基本機能のみ利用可能」が表示される | INT-004, EDGE-001 |
| TC-080-005 | オフライン時にAI変換が無効 | オフライン状態 | isAIConversionAvailableを確認 | falseが返る | INT-005, REQ-1001 |
| TC-080-006 | オンライン復帰時にAI変換が有効化 | オフライン→オンライン | setOnline()後にisAIConversionAvailableを確認 | trueが返る | INT-006 |

---

## 3. アプリ状態復元テスト

| TC-ID | テストケース名 | 前提条件 | テスト内容 | 期待結果 | 関連要件 |
|-------|---------------|----------|-----------|----------|----------|
| TC-080-007 | 入力中テキストが保存・復元される | テキストを保存済み | 新コンテナでinitialize()後にdraftTextを確認 | 保存したテキストが復元される | INT-007, EDGE-201 |
| TC-080-008 | 最後のルートが保存・復元される | ルートを保存済み | 新コンテナでinitialize()後にlastRouteを確認 | 保存したルートが復元される | INT-008, EDGE-201 |

---

## 4. ネットワーク状態管理テスト

| TC-ID | テストケース名 | 前提条件 | テスト内容 | 期待結果 | 関連要件 |
|-------|---------------|----------|-----------|----------|----------|
| TC-080-009 | 初期状態はchecking | 新規コンテナ | networkProviderを読む | NetworkState.checkingが返る | INT-009 |
| TC-080-010 | ネットワーク状態変更が正しく通知される | - | setOnline()→setOffline()→setOnline()を順に呼ぶ | 状態変更がリスナーに通知される | INT-010 |

---

## 5. 設定永続化テスト

| TC-ID | テストケース名 | 前提条件 | テスト内容 | 期待結果 | 関連要件 |
|-------|---------------|----------|-----------|----------|----------|
| TC-080-011 | 設定が永続化される | 設定初期化完了 | 各設定を変更 | SharedPreferencesに値が保存される | INT-011, REQ-5003 |
| TC-080-012 | アプリ再起動後も設定が維持される | SPに設定が保存済み | 新コンテナで設定を読む | 保存した設定が復元される | INT-012, REQ-5003 |

---

## テスト実行コマンド

```bash
# Phase 4 統合テスト実行
flutter test test/integration/phase4/phase4_integration_test.dart

# カバレッジ付きテスト実行
flutter test --coverage test/integration/phase4/phase4_integration_test.dart
```

## 検証対象Provider

| Provider名 | 説明 | テスト対象 |
|------------|------|-----------|
| settingsNotifierProvider | 設定状態管理（AsyncNotifier） | TC-080-001〜003, 011〜012 |
| networkProvider | ネットワーク状態管理 | TC-080-004〜006, 009〜010 |
| appSessionProvider | アプリセッション状態管理 | TC-080-007〜008 |

## 検証対象Widget

| Widget名 | 説明 | テスト対象 |
|----------|------|-----------|
| OfflineBanner | オフライン時バナー表示 | TC-080-004 |

## テスト結果

```
12 tests passed
```

## Phase 4 統合テストで検証した機能

| 機能カテゴリ | タスク範囲 | 検証内容 |
|-------------|-----------|----------|
| 設定管理 | TASK-0071〜0074 | 設定変更の即時反映、永続化 |
| ネットワーク状態 | TASK-0076〜0077 | オフラインバナー、AI変換無効化 |
| セッション復元 | TASK-0079 | テキスト・ルートの保存/復元 |
