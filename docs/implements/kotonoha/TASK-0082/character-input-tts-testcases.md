# TASK-0082 文字入力・読み上げE2Eテスト テストケース一覧

## 概要

- **タスクID**: TASK-0082
- **タスク名**: 文字入力・読み上げE2Eテスト
- **作成日時**: 2025-11-29
- **関連要件**: REQ-001, REQ-002, REQ-401, REQ-402, NFR-001, NFR-003

## 開発言語・フレームワーク

- **プログラミング言語**: Dart
  - **言語選択の理由**: FlutterアプリケーションのE2Eテスト
  - **テストに適した機能**: integration_testパッケージによるウィジェットテスト拡張
- **テストフレームワーク**: Flutter integration_test
  - **フレームワーク選択の理由**: Flutter公式のE2Eテストフレームワーク
  - **テスト実行環境**: Chrome（Web）、iOS/Androidエミュレータ/実機
- 🔵 青信号: tech-stack.mdで明確に定義

---

## 1. 正常系テストケース

### TC-E2E-082-001: 文字盤で「こんにちは」を入力できる

- **テスト名**: 文字盤で「こんにちは」を入力できる
  - **何をテストするか**: 文字盤タップで入力欄に文字が反映されること
  - **期待される動作**: 「こ」「ん」「に」「ち」「は」を順番にタップすると入力欄に「こんにちは」と表示される
- **入力値**: 文字盤の「こ」「ん」「に」「ち」「は」を順番にタップ
  - **入力データの意味**: 日本語で最も基本的な挨拶文
- **期待される結果**: 入力欄に「こんにちは」と表示される
  - **期待結果の理由**: REQ-002で文字タップ→入力欄反映が必須
- **テストの目的**: REQ-001, REQ-002の充足確認
  - **確認ポイント**: 文字盤UIの表示、タップの反映順序
- 🔵 青信号: REQ-001, REQ-002で明確に定義

### TC-E2E-082-002: 入力後に読み上げボタンをタップしてTTSが開始される

- **テスト名**: 入力後に読み上げボタンをタップしてTTSが開始される
  - **何をテストするか**: 入力欄のテキストがTTSで読み上げられること
  - **期待される動作**: 読み上げボタンタップでTTS処理が開始される
- **入力値**: 入力欄に「テスト」を入力し、読み上げボタンをタップ
  - **入力データの意味**: シンプルな読み上げテスト
- **期待される結果**: TTS再生が開始され、読み上げ中の状態になる
  - **期待結果の理由**: REQ-401, REQ-402で読み上げ機能が必須
- **テストの目的**: REQ-401, REQ-402の充足確認
  - **確認ポイント**: 読み上げボタンの存在、TTS開始状態
- 🔵 青信号: REQ-401, REQ-402で明確に定義

### TC-E2E-082-003: 連続した文字入力が正しく処理される

- **テスト名**: 連続した文字入力が正しく処理される
  - **何をテストするか**: 連続タップで複数文字が正しく入力されること
  - **期待される動作**: 素早い連続タップでも文字が抜けずに反映される
- **入力値**: 「あいうえお」を連続して素早くタップ
  - **入力データの意味**: あ行5文字の連続入力
- **期待される結果**: 入力欄に「あいうえお」と表示される
  - **期待結果の理由**: 連続入力は実際の利用シーンで頻繁に発生
- **テストの目的**: 連続入力の信頼性確認
  - **確認ポイント**: 文字の順序、欠落なし
- 🟡 黄信号: UC-002から推測

### TC-E2E-082-004: 削除ボタンで最後の1文字が削除される

- **テスト名**: 削除ボタンで最後の1文字が削除される
  - **何をテストするか**: 削除ボタンで最後の1文字のみが削除されること
  - **期待される動作**: 「あいう」入力後に削除ボタンタップで「あい」になる
- **入力値**: 「あいう」を入力後、削除ボタンをタップ
  - **入力データの意味**: 3文字入力して1文字削除
- **期待される結果**: 入力欄に「あい」と表示される
  - **期待結果の理由**: REQ-003で1文字削除が必須
- **テストの目的**: REQ-003の充足確認
  - **確認ポイント**: 最後の1文字のみ削除、他の文字は保持
- 🔵 青信号: REQ-003で明確に定義

### TC-E2E-082-005: 全消去ボタンで全文字が削除される

- **テスト名**: 全消去ボタンで全文字が削除される
  - **何をテストするか**: 全消去ボタンで入力欄が空になること
  - **期待される動作**: 「こんにちは」入力後に全消去で空になる
- **入力値**: 「こんにちは」を入力後、全消去ボタンをタップ→確認ダイアログで「はい」
  - **入力データの意味**: 5文字入力して全消去
- **期待される結果**: 入力欄が空になる
  - **期待結果の理由**: REQ-004で全消去が必須
- **テストの目的**: REQ-004, REQ-2001の充足確認
  - **確認ポイント**: 確認ダイアログ表示、全文字削除
- 🔵 青信号: REQ-004, REQ-2001で明確に定義

### TC-E2E-082-006: 読み上げ中に停止ボタンで停止できる

- **テスト名**: 読み上げ中に停止ボタンで停止できる
  - **何をテストするか**: TTS読み上げ中に停止ボタンで中断できること
  - **期待される動作**: 読み上げ中に停止ボタンタップでTTSが停止
- **入力値**: 長い文章を読み上げ中に停止ボタンをタップ
  - **入力データの意味**: 読み上げ中断のテスト
- **期待される結果**: TTS読み上げが停止され、停止状態になる
  - **期待結果の理由**: REQ-403で停止機能が必須
- **テストの目的**: REQ-403, REQ-3003の充足確認
  - **確認ポイント**: 停止ボタン表示、TTS停止
- 🔵 青信号: REQ-403で明確に定義

---

## 2. 異常系テストケース

### TC-E2E-082-007: 空の入力欄で読み上げボタンをタップ

- **テスト名**: 空の入力欄で読み上げボタンをタップ
  - **エラーケースの概要**: 読み上げ対象がない状態での読み上げ試行
  - **エラー処理の重要性**: 空入力での誤操作を防止
- **入力値**: 入力欄が空の状態で読み上げボタンをタップ
  - **不正な理由**: 読み上げる内容がない
  - **実際の発生シナリオ**: ユーザーが誤ってボタンをタップ
- **期待される結果**: 読み上げが実行されない（何も起きない or 視覚的フィードバック）
  - **エラーメッセージの内容**: 不要（無操作で安全）
  - **システムの安全性**: エラーにならず安全に処理される
- **テストの目的**: 空入力時のエラーハンドリング確認
  - **品質保証の観点**: 誤操作耐性
- 🟡 黄信号: 妥当な推測

### TC-E2E-082-008: 全消去確認ダイアログでキャンセル

- **テスト名**: 全消去確認ダイアログでキャンセル
  - **エラーケースの概要**: 全消去の確認ダイアログでキャンセルした場合
  - **エラー処理の重要性**: 誤操作による意図しない削除を防止
- **入力値**: 「こんにちは」を入力後、全消去ボタンをタップ→確認ダイアログで「いいえ」
  - **不正な理由**: ユーザーがキャンセルを選択
  - **実際の発生シナリオ**: 誤って全消去ボタンをタップした場合
- **期待される結果**: 入力欄の内容が保持される（「こんにちは」のまま）
  - **エラーメッセージの内容**: 不要
  - **システムの安全性**: キャンセルで元の状態が保持される
- **テストの目的**: REQ-2001の充足確認（誤操作防止）
  - **品質保証の観点**: REQ-5002誤操作防止
- 🔵 青信号: REQ-2001, REQ-5002で明確に定義

---

## 3. 境界値テストケース

### TC-E2E-082-009: 1文字だけ入力して読み上げ

- **テスト名**: 1文字だけ入力して読み上げ
  - **境界値の意味**: 最小入力長での動作確認
  - **境界値での動作保証**: 1文字でも正常に読み上げできること
- **入力値**: 「あ」を1文字だけ入力して読み上げ
  - **境界値選択の根拠**: 入力の最小単位
  - **実際の使用場面**: 短い返事や相槌
- **期待される結果**: 「あ」が正常に読み上げられる
  - **境界での正確性**: 1文字でもTTSが動作
  - **一貫した動作**: 通常の読み上げと同じ動作
- **テストの目的**: 最小入力での動作確認
  - **堅牢性の確認**: 極端に短い入力でも安定動作
- 🟡 黄信号: 妥当な推測

### TC-E2E-082-010: 1000文字の入力と読み上げ

- **テスト名**: 1000文字の入力と読み上げ
  - **境界値の意味**: 最大入力長での動作確認
  - **境界値での動作保証**: 1000文字でも正常に入力・読み上げできること
- **入力値**: 1000文字（「あ」×1000）を入力して読み上げ
  - **境界値選択の根拠**: EDGE-101で1000文字が上限
  - **実際の使用場面**: 長い文章の入力
- **期待される結果**: 1000文字が入力欄に表示され、読み上げが開始される
  - **境界での正確性**: 文字数制限内で正常動作
  - **一貫した動作**: 通常の読み上げと同じ動作
- **テストの目的**: EDGE-101の充足確認
  - **堅牢性の確認**: 最大文字数でも安定動作
- 🟡 黄信号: EDGE-101から推測

### TC-E2E-082-011: 1001文字目の入力が制限される

- **テスト名**: 1001文字目の入力が制限される
  - **境界値の意味**: 最大入力長を超えた場合の動作確認
  - **境界値での動作保証**: 1001文字目以降が入力できないこと
- **入力値**: 1000文字入力後、さらに「あ」を入力しようとする
  - **境界値選択の根拠**: EDGE-101で1000文字が上限
  - **実際の使用場面**: 長い文章を入力し続けた場合
- **期待される結果**: 1001文字目が入力されず、警告が表示される
  - **境界での正確性**: 制限が正しく適用される
  - **一貫した動作**: 警告表示による通知
- **テストの目的**: EDGE-101の充足確認（制限動作）
  - **堅牢性の確認**: 制限超過時の適切な処理
- 🟡 黄信号: EDGE-101から推測

### TC-E2E-082-012: 削除ボタン連打で空になるまで削除

- **テスト名**: 削除ボタン連打で空になるまで削除
  - **境界値の意味**: 削除操作の境界（0文字）での動作確認
  - **境界値での動作保証**: 空になった後も安全に処理されること
- **入力値**: 「あ」を1文字入力後、削除ボタンを2回タップ
  - **境界値選択の根拠**: 空になった後の削除操作
  - **実際の使用場面**: 誤って多く削除ボタンを押した場合
- **期待される結果**: 入力欄が空になり、2回目の削除は何も起きない
  - **境界での正確性**: 空の状態でエラーにならない
  - **一貫した動作**: 安全に無視される
- **テストの目的**: 空状態での削除操作確認
  - **堅牢性の確認**: 境界を超えた操作でも安定動作
- 🟡 黄信号: 防御的プログラミングから推測

---

## 4. パフォーマンステストケース

### TC-E2E-082-013: 文字盤タップ応答が100ms以内

- **テスト名**: 文字盤タップ応答が100ms以内
  - **パフォーマンス要件**: NFR-003で100ms以内が必須
  - **計測内容**: タップから入力欄更新までの時間
- **入力値**: 文字盤の「あ」をタップ
  - **計測ポイント**: タップイベント発火から入力欄更新完了まで
- **期待される結果**: 応答時間が100ms以内
  - **測定方法**: Stopwatchで計測
- **テストの目的**: NFR-003の充足確認
  - **品質基準**: パフォーマンス要件達成
- 🔵 青信号: NFR-003で明確に定義

### TC-E2E-082-014: TTS読み上げ開始が1秒以内

- **テスト名**: TTS読み上げ開始が1秒以内
  - **パフォーマンス要件**: NFR-001で1秒以内が必須
  - **計測内容**: 読み上げボタンタップからTTS開始までの時間
- **入力値**: 入力欄に「こんにちは」を入力し、読み上げボタンをタップ
  - **計測ポイント**: ボタンタップからTTS再生開始まで
- **期待される結果**: TTS開始までの時間が1秒以内
  - **測定方法**: Stopwatchで計測
- **テストの目的**: NFR-001の充足確認
  - **品質基準**: パフォーマンス要件達成
- 🔵 青信号: NFR-001で明確に定義

### TC-E2E-082-015: 連続10回タップの応答が安定

- **テスト名**: 連続10回タップの応答が安定
  - **パフォーマンス要件**: 連続タップでも応答時間が安定すること
  - **計測内容**: 10回連続タップの各応答時間
- **入力値**: 文字盤を10回連続タップ
  - **計測ポイント**: 各タップの応答時間
- **期待される結果**: すべてのタップで100ms以内の応答
  - **測定方法**: 各タップをStopwatchで計測
- **テストの目的**: 安定したパフォーマンスの確認
  - **品質基準**: 連続操作でも劣化しない
- 🟡 黄信号: NFR-003から推測

---

## 5. 統合テストケース

### TC-E2E-082-016: 文字入力→読み上げ→履歴保存の一連フロー

- **テスト名**: 文字入力→読み上げ→履歴保存の一連フロー
  - **統合テストの範囲**: 入力から履歴保存までのエンドツーエンドフロー
  - **機能間連携の確認**: 入力→TTS→履歴の連携
- **入力値**: 「こんにちは」を入力して読み上げ
  - **シナリオ**: 実際のユーザー操作フロー
- **期待される結果**: 読み上げが完了し、履歴に「こんにちは」が追加される
  - **検証ポイント**: 各機能が正しく連携
- **テストの目的**: REQ-601の充足確認（履歴自動保存）
  - **品質保証の観点**: 機能間の統合が正しく動作
- 🔵 青信号: REQ-601で明確に定義

### TC-E2E-082-017: 複数回の入力→読み上げサイクル

- **テスト名**: 複数回の入力→読み上げサイクル
  - **統合テストの範囲**: 繰り返し操作での安定性
  - **機能間連携の確認**: 複数サイクルでの状態管理
- **入力値**: 3回連続で異なるテキストを入力して読み上げ
  - **シナリオ**: 連続した会話のシミュレーション
- **期待される結果**: すべての読み上げが正常に完了
  - **検証ポイント**: 状態のリセット、メモリリークなし
- **テストの目的**: 繰り返し使用での安定性確認
  - **品質保証の観点**: 長時間使用での信頼性
- 🟡 黄信号: 妥当な推測

---

## テストケース実装コード例

```dart
/// TC-E2E-082-001: 文字盤で「こんにちは」を入力できる
///
/// 【テスト目的】: 文字盤タップで入力欄に文字が反映されること
/// 【テスト内容】: 「こ」「ん」「に」「ち」「は」を順番にタップ
/// 【期待される動作】: 入力欄に「こんにちは」と表示される
/// 🔵 青信号: REQ-001, REQ-002で明確に定義
testWidgets('TC-E2E-082-001: 文字盤で「こんにちは」を入力できる', (tester) async {
  // 【テストデータ準備】: アプリを初期化
  // 【初期条件設定】: ホーム画面が表示された状態
  await pumpApp(tester);

  // 【実際の処理実行】: 「こんにちは」を順番に入力
  // 【処理内容】: 文字盤の各文字をタップ
  await typeOnCharacterBoard(tester, 'こんにちは');

  // 【結果検証】: 入力欄に「こんにちは」が表示されること
  // 【期待値確認】: TextInputFieldに正しいテキストが表示される
  expect(find.text('こんにちは'), findsOneWidget);
  // 【確認内容】: 入力が正しく反映された 🔵
});

/// TC-E2E-082-013: 文字盤タップ応答が100ms以内
///
/// 【テスト目的】: NFR-003パフォーマンス要件の充足確認
/// 【テスト内容】: タップから入力欄更新までの時間を計測
/// 【期待される動作】: 100ms以内に応答
/// 🔵 青信号: NFR-003で明確に定義
testWidgets('TC-E2E-082-013: 文字盤タップ応答が100ms以内', (tester) async {
  // 【テストデータ準備】: アプリを初期化
  // 【初期条件設定】: ホーム画面が表示された状態
  await pumpApp(tester);

  // 【実際の処理実行】: パフォーマンス計測付きでタップ
  // 【処理内容】: 文字盤タップの応答時間を計測
  await measurePerformance(
    '文字盤タップ応答',
    maxMilliseconds: 100,
    action: () async {
      await tapCharacterOnBoard(tester, 'あ');
    },
  );
  // 【確認内容】: 100ms以内に応答した 🔵
});
```

---

## 品質判定

### 判定結果: ✅ 高品質

| 基準 | 状態 |
|------|------|
| テストケース分類 | ✅ 正常系6件、異常系2件、境界値4件、パフォーマンス3件、統合2件で網羅 |
| 期待値定義 | ✅ 各テストケースの期待値が明確に定義 |
| 技術選択 | ✅ Flutter integration_testで確定 |
| 実装可能性 | ✅ TASK-0081で環境構築済み、ヘルパー関数も準備済み |

### 信頼性レベル内訳

- 🔵 青信号: 10件（REQ/NFRで明確に定義）
- 🟡 黄信号: 7件（要件から妥当な推測）
- 🔴 赤信号: 0件

---

## 次のステップ

次のお勧めステップ: `/tsumiki:tdd-red` でRedフェーズ（失敗テスト作成）を開始します。
