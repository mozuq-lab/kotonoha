# TDDテストケース定義書 - TASK-0041: 定型文CRUD機能実装

## テスト概要

| 項目 | 内容 |
|------|------|
| **タスクID** | TASK-0041 |
| **タスク名** | 定型文CRUD機能実装 |
| **テスト対象** | PhraseAddDialog, PhraseEditDialog, PhraseDeleteDialog, PresetPhraseNotifier, PresetPhraseValidator, PresetPhraseRepository |
| **テストフレームワーク** | flutter_test |
| **モックライブラリ** | mocktail |
| **テストケース総数** | 62件 |

---

## 開発言語・フレームワーク

- **プログラミング言語**: Dart 3.x
  - **言語選択の理由**: Flutterアプリケーションの標準言語
  - **テストに適した機能**: 非同期テスト、ウィジェットテスト対応
- **テストフレームワーク**: flutter_test + mocktail
  - **フレームワーク選択の理由**: Flutterウィジェットテストの標準ツール
  - **テスト実行環境**: `flutter test` コマンド

---

## テスト対象ファイル

| ファイル | 説明 |
|----------|------|
| `lib/features/preset_phrase/presentation/widgets/phrase_add_dialog.dart` | 定型文追加ダイアログ |
| `lib/features/preset_phrase/presentation/widgets/phrase_edit_dialog.dart` | 定型文編集ダイアログ |
| `lib/features/preset_phrase/presentation/widgets/phrase_delete_dialog.dart` | 削除確認ダイアログ |
| `lib/features/preset_phrase/providers/preset_phrase_provider.dart` | 定型文状態管理 |
| `lib/features/preset_phrase/domain/preset_phrase_validator.dart` | バリデーションロジック |
| `lib/features/preset_phrase/data/preset_phrase_repository.dart` | データ操作（Hive連携） |

---

## 1. PresetPhraseValidator テストケース

### 1.1 正常系テスト

#### TC-041-001: 有効な定型文内容を検証する

- **テスト名**: 有効な定型文内容（1-500文字）がバリデーションを通過する
  - **何をテストするか**: 正常な文字数範囲での検証
  - **期待される動作**: バリデーション成功（nullを返す）
- **前提条件**: バリデーターが初期化されていること
- **入力値**: "おはようございます"（8文字）
  - **入力データの意味**: 一般的な定型文
- **期待される結果**: バリデーション成功
  - **期待結果の理由**: CRUD-201, CRUD-202（1〜500文字制限）
- **テストの目的**: 正常な入力が受け入れられることの確認
  - **確認ポイント**: 戻り値がnull
- **関連要件**: CRUD-201, CRUD-202
- **優先度**: P0 必須

#### TC-041-002: 1文字の定型文がバリデーションを通過する

- **テスト名**: 最小文字数（1文字）の定型文がバリデーションを通過する
  - **何をテストするか**: 最小境界値での検証
  - **期待される動作**: バリデーション成功
- **前提条件**: バリデーターが初期化されていること
- **入力値**: "あ"（1文字）
  - **入力データの意味**: 最小有効文字数
- **期待される結果**: バリデーション成功
  - **期待結果の理由**: CRUD-202（最小1文字）
- **テストの目的**: 最小境界値の確認
  - **確認ポイント**: 戻り値がnull
- **関連要件**: CRUD-202, EDGE-002
- **優先度**: P0 必須

#### TC-041-003: 500文字の定型文がバリデーションを通過する

- **テスト名**: 最大文字数（500文字）の定型文がバリデーションを通過する
  - **何をテストするか**: 最大境界値での検証
  - **期待される動作**: バリデーション成功
- **前提条件**: バリデーターが初期化されていること
- **入力値**: 500文字のテキスト
  - **入力データの意味**: 最大有効文字数
- **期待される結果**: バリデーション成功
  - **期待結果の理由**: CRUD-201（最大500文字）
- **テストの目的**: 最大境界値の確認
  - **確認ポイント**: 戻り値がnull
- **関連要件**: CRUD-201, EDGE-003
- **優先度**: P0 必須

### 1.2 異常系テスト

#### TC-041-004: 空文字列でエラーを返す

- **テスト名**: 空文字列入力時にエラーメッセージを返す
  - **何をテストするか**: 空入力のバリデーション
  - **期待される動作**: エラーメッセージを返す
- **前提条件**: バリデーターが初期化されていること
- **入力値**: ""（空文字列）
  - **入力データの意味**: 無効な入力
- **期待される結果**: "定型文を入力してください" エラーメッセージ
  - **期待結果の理由**: CRUD-105（空入力拒否）
- **テストの目的**: 空入力のエラーハンドリング確認
  - **確認ポイント**: 適切なエラーメッセージ
- **関連要件**: CRUD-105, EDGE-001
- **優先度**: P0 必須

#### TC-041-005: 空白のみの文字列でエラーを返す

- **テスト名**: 空白のみの入力時にエラーメッセージを返す
  - **何をテストするか**: 空白のみのバリデーション
  - **期待される動作**: エラーメッセージを返す
- **前提条件**: バリデーターが初期化されていること
- **入力値**: "   "（空白3文字）
  - **入力データの意味**: 実質的に空の入力
- **期待される結果**: "定型文を入力してください" エラーメッセージ
  - **期待結果の理由**: EDGE-005（空白のみ拒否）
- **テストの目的**: 空白のみのエラーハンドリング確認
  - **確認ポイント**: 適切なエラーメッセージ
- **関連要件**: CRUD-105, EDGE-005
- **優先度**: P0 必須

#### TC-041-006: 501文字でエラーを返す

- **テスト名**: 501文字入力時にエラーメッセージを返す
  - **何をテストするか**: 文字数上限超過のバリデーション
  - **期待される動作**: エラーメッセージを返す
- **前提条件**: バリデーターが初期化されていること
- **入力値**: 501文字のテキスト
  - **入力データの意味**: 上限超過
- **期待される結果**: "定型文は500文字以内で入力してください" エラーメッセージ
  - **期待結果の理由**: CRUD-104（500文字制限）
- **テストの目的**: 文字数超過のエラーハンドリング確認
  - **確認ポイント**: 適切なエラーメッセージ
- **関連要件**: CRUD-104, CRUD-201, EDGE-004
- **優先度**: P0 必須

### 1.3 特殊文字テスト

#### TC-041-007: 絵文字を含む定型文がバリデーションを通過する

- **テスト名**: 絵文字を含む定型文がバリデーションを通過する
  - **何をテストするか**: 特殊文字（絵文字）の受け入れ
  - **期待される動作**: バリデーション成功
- **前提条件**: バリデーターが初期化されていること
- **入力値**: "ありがとう" (絵文字を含む例として記述)
  - **入力データの意味**: 絵文字を含むテキスト
- **期待される結果**: バリデーション成功
  - **期待結果の理由**: EDGE-006（絵文字許可）
- **テストの目的**: 絵文字の受け入れ確認
  - **確認ポイント**: 戻り値がnull
- **関連要件**: EDGE-006
- **優先度**: P1 重要

#### TC-041-008: 改行を含む定型文がバリデーションを通過する

- **テスト名**: 改行を含む定型文がバリデーションを通過する
  - **何をテストするか**: 改行文字の受け入れ
  - **期待される動作**: バリデーション成功
- **前提条件**: バリデーターが初期化されていること
- **入力値**: "おはようございます\nよろしくお願いします"
  - **入力データの意味**: 改行を含むテキスト
- **期待される結果**: バリデーション成功
  - **期待結果の理由**: EDGE-007（改行許可）
- **テストの目的**: 改行の受け入れ確認
  - **確認ポイント**: 戻り値がnull
- **関連要件**: EDGE-007
- **優先度**: P1 重要

#### TC-041-009: 全角・半角混在テキストがバリデーションを通過する

- **テスト名**: 全角・半角混在テキストがバリデーションを通過する
  - **何をテストするか**: 混在文字の受け入れ
  - **期待される動作**: バリデーション成功
- **前提条件**: バリデーターが初期化されていること
- **入力値**: "ABC123あいうえお"
  - **入力データの意味**: 全角・半角混在
- **期待される結果**: バリデーション成功
  - **期待結果の理由**: EDGE-008（混在許可）
- **テストの目的**: 混在文字の受け入れ確認
  - **確認ポイント**: 戻り値がnull
- **関連要件**: EDGE-008
- **優先度**: P1 重要

#### TC-041-010: カテゴリバリデーション - 有効なカテゴリ

- **テスト名**: 有効なカテゴリ（daily, health, other）がバリデーションを通過する
  - **何をテストするか**: カテゴリ値の検証
  - **期待される動作**: バリデーション成功
- **前提条件**: バリデーターが初期化されていること
- **入力値**: ["daily", "health", "other"]
  - **入力データの意味**: 有効なカテゴリ値
- **期待される結果**: すべてバリデーション成功
  - **期待結果の理由**: 入力仕様2.1.1
- **テストの目的**: カテゴリ値の検証確認
  - **確認ポイント**: 戻り値がnull
- **関連要件**: 入力仕様
- **優先度**: P1 重要

---

## 2. PhraseAddDialog テストケース

### 2.1 正常系テスト

#### TC-041-011: 追加ダイアログが正しく表示される

- **テスト名**: PhraseAddDialogが正しく表示される
  - **何をテストするか**: ダイアログの基本表示
  - **期待される動作**: タイトル、入力フィールド、ボタンが表示される
- **前提条件**: ダイアログが開かれていること
- **入力値**: なし
  - **入力データの意味**: 初期状態
- **期待される結果**: "定型文を追加" タイトル、テキストフィールド、カテゴリ選択、保存・キャンセルボタンが表示される
  - **期待結果の理由**: CRUD-001, CRUD-002
- **テストの目的**: ダイアログ表示の確認
  - **確認ポイント**: 各UI要素の存在
- **関連要件**: CRUD-001, CRUD-002, AC-001
- **優先度**: P0 必須

#### TC-041-012: 定型文を入力して保存できる

- **テスト名**: 定型文を入力して保存ボタンで追加できる
  - **何をテストするか**: 追加操作の基本フロー
  - **期待される動作**: 入力→保存→ダイアログ閉じる→コールバック発火
- **前提条件**: ダイアログが開かれていること
- **入力値**: content: "ありがとうございます", category: "daily"
  - **入力データの意味**: 一般的な定型文
- **期待される結果**: コールバックが正しいデータで呼び出される
  - **期待結果の理由**: UC-001（定型文追加フロー）
- **テストの目的**: 追加操作の確認
  - **確認ポイント**: コールバック引数
- **関連要件**: AC-002
- **優先度**: P0 必須

#### TC-041-013: カテゴリを選択できる

- **テスト名**: カテゴリ（日常/体調/その他）を選択できる
  - **何をテストするか**: カテゴリ選択機能
  - **期待される動作**: ドロップダウンまたはラジオボタンでカテゴリ選択可能
- **前提条件**: ダイアログが開かれていること
- **入力値**: category選択操作
  - **入力データの意味**: カテゴリ変更
- **期待される結果**: 選択したカテゴリが反映される
  - **期待結果の理由**: CRUD-002
- **テストの目的**: カテゴリ選択の確認
  - **確認ポイント**: 選択状態の変化
- **関連要件**: CRUD-002
- **優先度**: P0 必須

#### TC-041-014: デフォルトカテゴリが日常である

- **テスト名**: カテゴリのデフォルト値が「日常」である
  - **何をテストするか**: 初期値設定
  - **期待される動作**: ダイアログ表示時に「日常」が選択済み
- **前提条件**: ダイアログが開かれていること
- **入力値**: なし
  - **入力データの意味**: 初期状態
- **期待される結果**: "daily"（日常）が初期選択されている
  - **期待結果の理由**: ユーザビリティ
- **テストの目的**: デフォルト値の確認
  - **確認ポイント**: 初期選択状態
- **関連要件**: CRUD-002
- **優先度**: P1 重要

#### TC-041-015: 文字数カウンターが表示される

- **テスト名**: 入力中に文字数カウンターが表示される
  - **何をテストするか**: 文字数表示機能
  - **期待される動作**: "XX/500" 形式で文字数が表示される
- **前提条件**: ダイアログが開かれていること
- **入力値**: "おはよう"（4文字）
  - **入力データの意味**: 入力中のテキスト
- **期待される結果**: "4/500" が表示される
  - **期待結果の理由**: UC-006（文字数表示）
- **テストの目的**: 文字数カウンターの確認
  - **確認ポイント**: カウンター表示
- **関連要件**: CRUD-104
- **優先度**: P1 重要

### 2.2 異常系テスト

#### TC-041-016: 空入力で保存するとエラー表示

- **テスト名**: 空入力で保存しようとするとエラーメッセージが表示される
  - **何をテストするか**: 空入力のエラーハンドリング
  - **期待される動作**: エラーメッセージ表示、ダイアログは閉じない
- **前提条件**: ダイアログが開かれていること
- **入力値**: ""（空）
  - **入力データの意味**: 無効な入力
- **期待される結果**: "定型文を入力してください" エラー表示、ダイアログ維持
  - **期待結果の理由**: UC-005, CRUD-105
- **テストの目的**: エラー表示の確認
  - **確認ポイント**: エラーメッセージの存在、ダイアログ状態
- **関連要件**: AC-009, CRUD-105
- **優先度**: P0 必須

#### TC-041-017: 500文字超過時に入力が制限される

- **テスト名**: 500文字を超える入力が制限される
  - **何をテストするか**: 文字数制限機能
  - **期待される動作**: 500文字で入力がストップする
- **前提条件**: ダイアログが開かれていること
- **入力値**: 600文字のテキスト
  - **入力データの意味**: 上限超過入力
- **期待される結果**: 500文字で入力が制限される
  - **期待結果の理由**: CRUD-104, UC-006
- **テストの目的**: 入力制限の確認
  - **確認ポイント**: 実際の入力文字数
- **関連要件**: AC-010, CRUD-104
- **優先度**: P0 必須

#### TC-041-018: 500文字到達時にカウンターが赤くなる

- **テスト名**: 500文字到達時に文字数カウンターが赤く表示される
  - **何をテストするか**: 警告表示
  - **期待される動作**: "500/500" が赤色で表示される
- **前提条件**: ダイアログが開かれていること
- **入力値**: 500文字のテキスト
  - **入力データの意味**: 上限到達
- **期待される結果**: カウンターが赤色で表示される
  - **期待結果の理由**: UC-006
- **テストの目的**: 警告表示の確認
  - **確認ポイント**: テキストの色
- **関連要件**: CRUD-104
- **優先度**: P1 重要

### 2.3 キャンセル操作テスト

#### TC-041-019: キャンセルボタンでダイアログが閉じる

- **テスト名**: キャンセルボタンタップでダイアログが閉じる
  - **何をテストするか**: キャンセル操作
  - **期待される動作**: ダイアログが閉じ、データは保存されない
- **前提条件**: ダイアログが開かれ、テキストが入力されていること
- **入力値**: キャンセルボタンタップ
  - **入力データの意味**: キャンセル操作
- **期待される結果**: ダイアログが閉じる、コールバック未発火
  - **期待結果の理由**: EDGE-014
- **テストの目的**: キャンセル操作の確認
  - **確認ポイント**: ダイアログ状態、コールバック
- **関連要件**: EDGE-014
- **優先度**: P0 必須

#### TC-041-020: ダイアログ外タップでダイアログが閉じる

- **テスト名**: ダイアログ外タップでダイアログが閉じる
  - **何をテストするか**: バリアタップ動作
  - **期待される動作**: ダイアログが閉じる
- **前提条件**: ダイアログが開かれていること
- **入力値**: バリア（ダイアログ外）タップ
  - **入力データの意味**: 外側タップ
- **期待される結果**: ダイアログが閉じる
  - **期待結果の理由**: EDGE-012
- **テストの目的**: バリアタップの確認
  - **確認ポイント**: ダイアログ状態
- **関連要件**: EDGE-012
- **優先度**: P1 重要

### 2.4 アクセシビリティテスト

#### TC-041-021: 保存ボタンのタップターゲットが44px以上

- **テスト名**: 保存ボタンのタップターゲットサイズが44px以上
  - **何をテストするか**: アクセシビリティ要件
  - **期待される動作**: ボタンサイズが44px以上
- **前提条件**: ダイアログが開かれていること
- **入力値**: なし
  - **入力データの意味**: サイズ測定
- **期待される結果**: 保存ボタンの高さが44px以上
  - **期待結果の理由**: CRUD-203
- **テストの目的**: タップターゲットサイズ確認
  - **確認ポイント**: ウィジェットサイズ
- **関連要件**: CRUD-203, AC-014
- **優先度**: P0 必須

---

## 3. PhraseEditDialog テストケース

### 3.1 正常系テスト

#### TC-041-022: 編集ダイアログが現在の内容で表示される

- **テスト名**: PhraseEditDialogが現在の定型文内容を初期表示する
  - **何をテストするか**: 編集ダイアログの初期表示
  - **期待される動作**: 既存の内容とカテゴリが入力済みで表示される
- **前提条件**: 編集対象の定型文が存在すること
- **入力値**: PresetPhrase(content: "こんにちは", category: "daily")
  - **入力データの意味**: 編集対象データ
- **期待される結果**: テキストフィールドに"こんにちは"、カテゴリに"日常"が表示される
  - **期待結果の理由**: CRUD-005
- **テストの目的**: 初期表示の確認
  - **確認ポイント**: フィールドの初期値
- **関連要件**: CRUD-004, CRUD-005, AC-003
- **優先度**: P0 必須

#### TC-041-023: 定型文を編集して保存できる

- **テスト名**: 定型文を編集して保存ボタンで更新できる
  - **何をテストするか**: 編集操作の基本フロー
  - **期待される動作**: 編集→保存→ダイアログ閉じる→コールバック発火
- **前提条件**: 編集ダイアログが開かれていること
- **入力値**: content変更: "こんにちは" → "こんばんは"
  - **入力データの意味**: 内容変更
- **期待される結果**: 更新されたデータでコールバックが呼び出される
  - **期待結果の理由**: UC-002（定型文編集フロー）
- **テストの目的**: 編集操作の確認
  - **確認ポイント**: コールバック引数
- **関連要件**: AC-004
- **優先度**: P0 必須

#### TC-041-024: カテゴリを変更して保存できる

- **テスト名**: カテゴリを変更して保存できる
  - **何をテストするか**: カテゴリ変更機能
  - **期待される動作**: カテゴリ変更が反映される
- **前提条件**: 編集ダイアログが開かれていること
- **入力値**: category変更: "daily" → "health"
  - **入力データの意味**: カテゴリ変更
- **期待される結果**: 新しいカテゴリでコールバックが呼び出される
  - **期待結果の理由**: CRUD-004
- **テストの目的**: カテゴリ変更の確認
  - **確認ポイント**: コールバックのcategory引数
- **関連要件**: CRUD-004
- **優先度**: P0 必須

#### TC-041-025: 編集時にupdatedAtが更新される

- **テスト名**: 編集保存時にupdatedAtタイムスタンプが更新される
  - **何をテストするか**: タイムスタンプ更新
  - **期待される動作**: updatedAtが現在時刻に更新される
- **前提条件**: 編集対象の定型文が存在すること
- **入力値**: 編集操作
  - **入力データの意味**: 更新操作
- **期待される結果**: updatedAtが更新前より新しい時刻になる
  - **期待結果の理由**: CRUD-008
- **テストの目的**: タイムスタンプ更新の確認
  - **確認ポイント**: updatedAtの値
- **関連要件**: CRUD-008
- **優先度**: P1 重要

### 3.2 異常系テスト

#### TC-041-026: 編集時に空にするとエラー表示

- **テスト名**: 既存の内容を空にして保存しようとするとエラー表示
  - **何をテストするか**: 編集時の空入力チェック
  - **期待される動作**: エラーメッセージ表示
- **前提条件**: 編集ダイアログが開かれていること
- **入力値**: 内容をすべて削除
  - **入力データの意味**: 空にする操作
- **期待される結果**: "定型文を入力してください" エラー表示
  - **期待結果の理由**: CRUD-105
- **テストの目的**: 編集時バリデーションの確認
  - **確認ポイント**: エラーメッセージ
- **関連要件**: CRUD-105
- **優先度**: P0 必須

#### TC-041-027: 編集キャンセル時に変更が破棄される

- **テスト名**: 編集中にキャンセルすると変更が破棄される
  - **何をテストするか**: キャンセル時の状態復元
  - **期待される動作**: 元の内容が維持される
- **前提条件**: 編集ダイアログで変更が行われていること
- **入力値**: キャンセルボタンタップ
  - **入力データの意味**: キャンセル操作
- **期待される結果**: 変更が保存されない
  - **期待結果の理由**: EDGE-014
- **テストの目的**: キャンセル時の動作確認
  - **確認ポイント**: コールバック未発火
- **関連要件**: EDGE-014
- **優先度**: P0 必須

---

## 4. PhraseDeleteDialog テストケース

### 4.1 正常系テスト

#### TC-041-028: 削除確認ダイアログが表示される

- **テスト名**: 削除操作時に確認ダイアログが表示される
  - **何をテストするか**: 削除確認ダイアログの表示
  - **期待される動作**: "この定型文を削除しますか？" メッセージと削除・キャンセルボタン
- **前提条件**: 削除対象の定型文が存在すること
- **入力値**: 削除ボタンタップ
  - **入力データの意味**: 削除操作開始
- **期待される結果**: 確認ダイアログが表示される
  - **期待結果の理由**: CRUD-101, REQ-5002
- **テストの目的**: 削除確認の表示確認
  - **確認ポイント**: ダイアログの存在とメッセージ
- **関連要件**: CRUD-101, CRUD-204, AC-005
- **優先度**: P0 必須

#### TC-041-029: 確認後に削除が実行される

- **テスト名**: 確認ダイアログで「削除」選択後に削除が実行される
  - **何をテストするか**: 削除の実行
  - **期待される動作**: 定型文が削除される
- **前提条件**: 削除確認ダイアログが表示されていること
- **入力値**: 「削除」ボタンタップ
  - **入力データの意味**: 削除確認
- **期待される結果**: 削除コールバックが呼び出される
  - **期待結果の理由**: CRUD-102
- **テストの目的**: 削除実行の確認
  - **確認ポイント**: コールバック呼び出し
- **関連要件**: CRUD-102, AC-006
- **優先度**: P0 必須

#### TC-041-030: キャンセルで削除が中止される

- **テスト名**: 確認ダイアログで「キャンセル」選択後に削除が中止される
  - **何をテストするか**: 削除のキャンセル
  - **期待される動作**: 定型文が削除されない
- **前提条件**: 削除確認ダイアログが表示されていること
- **入力値**: 「キャンセル」ボタンタップ
  - **入力データの意味**: キャンセル操作
- **期待される結果**: 削除コールバックが呼び出されない、ダイアログが閉じる
  - **期待結果の理由**: CRUD-103, UC-007
- **テストの目的**: キャンセル操作の確認
  - **確認ポイント**: コールバック未発火
- **関連要件**: CRUD-103
- **優先度**: P0 必須

### 4.2 誤操作防止テスト

#### TC-041-031: 削除確認ダイアログ外タップで閉じない

- **テスト名**: 削除確認ダイアログ外タップでダイアログが閉じない
  - **何をテストするか**: 誤操作防止
  - **期待される動作**: バリアタップでダイアログが閉じない
- **前提条件**: 削除確認ダイアログが表示されていること
- **入力値**: バリア（ダイアログ外）タップ
  - **入力データの意味**: 外側タップ
- **期待される結果**: ダイアログが維持される
  - **期待結果の理由**: EDGE-013（誤操作防止）
- **テストの目的**: 誤操作防止の確認
  - **確認ポイント**: ダイアログ状態
- **関連要件**: EDGE-013, REQ-5002
- **優先度**: P0 必須

---

## 5. PresetPhraseNotifier テストケース

### 5.1 追加機能テスト

#### TC-041-032: 定型文を追加できる

- **テスト名**: addPhrase()で定型文を追加できる
  - **何をテストするか**: 追加機能
  - **期待される動作**: 新しい定型文が状態に追加される
- **前提条件**: PresetPhraseNotifierが初期化されていること
- **入力値**: content: "おはようございます", category: "daily"
  - **入力データの意味**: 新規定型文
- **期待される結果**: 定型文が追加され、状態が更新される
  - **期待結果の理由**: REQ-104
- **テストの目的**: 追加機能の確認
  - **確認ポイント**: 状態の変化
- **関連要件**: REQ-104, AC-002
- **優先度**: P0 必須

#### TC-041-033: 追加時にUUIDが自動付与される

- **テスト名**: 追加された定型文にUUID形式のIDが自動付与される
  - **何をテストするか**: ID自動生成
  - **期待される動作**: UUID形式のIDが付与される
- **前提条件**: PresetPhraseNotifierが初期化されていること
- **入力値**: content: "テスト", category: "daily"
  - **入力データの意味**: 新規定型文（ID未指定）
- **期待される結果**: 追加された定型文にUUID形式のIDがある
  - **期待結果の理由**: CRUD-003
- **テストの目的**: ID自動生成の確認
  - **確認ポイント**: IDの形式
- **関連要件**: CRUD-003
- **優先度**: P0 必須

#### TC-041-034: 追加時にcreatedAt/updatedAtが設定される

- **テスト名**: 追加された定型文にcreatedAt/updatedAtが自動設定される
  - **何をテストするか**: タイムスタンプ自動設定
  - **期待される動作**: 現在時刻が設定される
- **前提条件**: PresetPhraseNotifierが初期化されていること
- **入力値**: content: "テスト", category: "daily"
  - **入力データの意味**: 新規定型文
- **期待される結果**: createdAtとupdatedAtに現在時刻が設定される
  - **期待結果の理由**: CRUD-008
- **テストの目的**: タイムスタンプ設定の確認
  - **確認ポイント**: タイムスタンプの値
- **関連要件**: CRUD-008
- **優先度**: P1 重要

### 5.2 更新機能テスト

#### TC-041-035: 定型文の内容を更新できる

- **テスト名**: updatePhrase()で定型文の内容を更新できる
  - **何をテストするか**: 内容更新機能
  - **期待される動作**: 指定した定型文の内容が更新される
- **前提条件**: 定型文が1件以上存在すること
- **入力値**: id: "existing-id", content: "更新後の内容"
  - **入力データの意味**: 内容変更
- **期待される結果**: 指定IDの定型文の内容が更新される
  - **期待結果の理由**: REQ-104
- **テストの目的**: 内容更新の確認
  - **確認ポイント**: 更新後のcontent
- **関連要件**: REQ-104, AC-004
- **優先度**: P0 必須

#### TC-041-036: 定型文のカテゴリを更新できる

- **テスト名**: updatePhrase()で定型文のカテゴリを更新できる
  - **何をテストするか**: カテゴリ更新機能
  - **期待される動作**: 指定した定型文のカテゴリが更新される
- **前提条件**: 定型文が1件以上存在すること
- **入力値**: id: "existing-id", category: "health"
  - **入力データの意味**: カテゴリ変更
- **期待される結果**: 指定IDの定型文のカテゴリが更新される
  - **期待結果の理由**: REQ-104
- **テストの目的**: カテゴリ更新の確認
  - **確認ポイント**: 更新後のcategory
- **関連要件**: REQ-104
- **優先度**: P1 重要

### 5.3 削除機能テスト

#### TC-041-037: 定型文を削除できる

- **テスト名**: deletePhrase()で定型文を削除できる
  - **何をテストするか**: 削除機能
  - **期待される動作**: 指定した定型文が状態から削除される
- **前提条件**: 定型文が1件以上存在すること
- **入力値**: id: "existing-id"
  - **入力データの意味**: 削除対象ID
- **期待される結果**: 指定IDの定型文が削除される
  - **期待結果の理由**: REQ-104
- **テストの目的**: 削除機能の確認
  - **確認ポイント**: 状態から削除されていること
- **関連要件**: REQ-104, AC-006
- **優先度**: P0 必須

### 5.4 お気に入り機能テスト

#### TC-041-038: お気に入りフラグを切り替えできる

- **テスト名**: toggleFavorite()でお気に入りフラグを切り替えできる
  - **何をテストするか**: お気に入り切替機能
  - **期待される動作**: isFavoriteが反転する
- **前提条件**: 定型文が1件以上存在すること
- **入力値**: id: "existing-id"（isFavorite: false）
  - **入力データの意味**: お気に入り切替対象
- **期待される結果**: isFavoriteがfalse→trueに変わる
  - **期待結果の理由**: CRUD-007, CRUD-106
- **テストの目的**: お気に入り切替の確認
  - **確認ポイント**: isFavoriteの値
- **関連要件**: CRUD-007, CRUD-106, AC-007
- **優先度**: P0 必須

#### TC-041-039: お気に入り解除ができる

- **テスト名**: toggleFavorite()でお気に入り解除ができる
  - **何をテストするか**: お気に入り解除機能
  - **期待される動作**: isFavoriteがtrue→falseに変わる
- **前提条件**: お気に入り登録済みの定型文が存在すること
- **入力値**: id: "favorite-id"（isFavorite: true）
  - **入力データの意味**: お気に入り解除対象
- **期待される結果**: isFavoriteがtrue→falseに変わる
  - **期待結果の理由**: CRUD-007
- **テストの目的**: お気に入り解除の確認
  - **確認ポイント**: isFavoriteの値
- **関連要件**: CRUD-007
- **優先度**: P0 必須

#### TC-041-040: お気に入り切替後に一覧表示位置が更新される

- **テスト名**: お気に入り切替後に一覧の表示順序が更新される
  - **何をテストするか**: 一覧更新機能
  - **期待される動作**: お気に入りが上部に移動する
- **前提条件**: 複数の定型文が存在すること
- **入力値**: 通常の定型文をお気に入りに変更
  - **入力データの意味**: お気に入り追加
- **期待される結果**: お気に入りに変更した定型文が上部に表示される
  - **期待結果の理由**: REQ-105
- **テストの目的**: 表示順序更新の確認
  - **確認ポイント**: 並び順
- **関連要件**: REQ-105, AC-008
- **優先度**: P0 必須

### 5.5 エラーハンドリングテスト

#### TC-041-041: 存在しないIDで更新しようとするとエラー

- **テスト名**: 存在しないIDでupdatePhrase()を呼び出すとエラーハンドリングされる
  - **何をテストするか**: 不正ID時のエラーハンドリング
  - **期待される動作**: エラーが発生し、ログ出力される
- **前提条件**: PresetPhraseNotifierが初期化されていること
- **入力値**: id: "non-existent-id"
  - **入力データの意味**: 存在しないID
- **期待される結果**: エラーハンドリングされ、状態は変化しない
  - **期待結果の理由**: EDGE-009
- **テストの目的**: エラーハンドリングの確認
  - **確認ポイント**: 例外処理または戻り値
- **関連要件**: EDGE-009
- **優先度**: P1 重要

#### TC-041-042: 存在しないIDで削除しようとするとエラー

- **テスト名**: 存在しないIDでdeletePhrase()を呼び出すとエラーハンドリングされる
  - **何をテストするか**: 不正ID時のエラーハンドリング
  - **期待される動作**: エラーが発生し、ログ出力される
- **前提条件**: PresetPhraseNotifierが初期化されていること
- **入力値**: id: "non-existent-id"
  - **入力データの意味**: 存在しないID
- **期待される結果**: エラーハンドリングされ、状態は変化しない
  - **期待結果の理由**: EDGE-010
- **テストの目的**: エラーハンドリングの確認
  - **確認ポイント**: 例外処理または戻り値
- **関連要件**: EDGE-010
- **優先度**: P1 重要

---

## 6. PresetPhraseRepository テストケース

### 6.1 CRUD操作テスト

#### TC-041-043: 定型文をHiveに保存できる

- **テスト名**: save()で定型文をHiveに保存できる
  - **何をテストするか**: 永続化機能
  - **期待される動作**: 定型文がHive Boxに保存される
- **前提条件**: Hive Boxが初期化されていること
- **入力値**: PresetPhrase(id: "test-id", content: "テスト")
  - **入力データの意味**: 保存対象データ
- **期待される結果**: Hive Boxに定型文が保存される
  - **期待結果の理由**: CRUD-205
- **テストの目的**: 永続化の確認
  - **確認ポイント**: Boxへの書き込み
- **関連要件**: CRUD-205
- **優先度**: P0 必須

#### TC-041-044: 定型文をHiveから読み込める

- **テスト名**: getAll()でHiveから定型文を読み込める
  - **何をテストするか**: 読み込み機能
  - **期待される動作**: Hive Boxから定型文リストが取得される
- **前提条件**: Hive Boxに定型文が保存されていること
- **入力値**: なし
  - **入力データの意味**: 読み込み操作
- **期待される結果**: 保存済みの定型文リストが返される
  - **期待結果の理由**: CRUD-205
- **テストの目的**: 読み込みの確認
  - **確認ポイント**: 取得データ
- **関連要件**: CRUD-205
- **優先度**: P0 必須

#### TC-041-045: 定型文をHiveから削除できる

- **テスト名**: delete()でHiveから定型文を削除できる
  - **何をテストするか**: 削除機能
  - **期待される動作**: 指定した定型文がHive Boxから削除される
- **前提条件**: Hive Boxに定型文が保存されていること
- **入力値**: id: "test-id"
  - **入力データの意味**: 削除対象ID
- **期待される結果**: 指定IDの定型文がBoxから削除される
  - **期待結果の理由**: REQ-104
- **テストの目的**: 削除の確認
  - **確認ポイント**: Boxからの削除
- **関連要件**: REQ-104
- **優先度**: P0 必須

#### TC-041-046: 定型文をHiveで更新できる

- **テスト名**: update()でHiveの定型文を更新できる
  - **何をテストするか**: 更新機能
  - **期待される動作**: 指定した定型文がHive Boxで更新される
- **前提条件**: Hive Boxに定型文が保存されていること
- **入力値**: 更新後のPresetPhrase
  - **入力データの意味**: 更新データ
- **期待される結果**: Boxの定型文が更新される
  - **期待結果の理由**: REQ-104
- **テストの目的**: 更新の確認
  - **確認ポイント**: 更新後のデータ
- **関連要件**: REQ-104
- **優先度**: P0 必須

---

## 7. 統合テスト

### 7.1 追加フローテスト

#### TC-041-047: 定型文追加の統合フロー

- **テスト名**: ダイアログから追加→Provider更新→Repository保存の統合フロー
  - **何をテストするか**: 追加操作のE2E
  - **期待される動作**: UI→Provider→Repositoryの連携
- **前提条件**: アプリが起動していること
- **入力値**: ダイアログでの入力操作
  - **入力データの意味**: ユーザー操作
- **期待される結果**: 定型文が追加され、一覧に表示される
  - **期待結果の理由**: UC-001
- **テストの目的**: 統合動作の確認
  - **確認ポイント**: データの一貫性
- **関連要件**: AC-002
- **優先度**: P0 必須

#### TC-041-048: 定型文編集の統合フロー

- **テスト名**: ダイアログから編集→Provider更新→Repository保存の統合フロー
  - **何をテストするか**: 編集操作のE2E
  - **期待される動作**: UI→Provider→Repositoryの連携
- **前提条件**: 編集対象の定型文が存在すること
- **入力値**: ダイアログでの編集操作
  - **入力データの意味**: ユーザー操作
- **期待される結果**: 定型文が更新され、一覧に反映される
  - **期待結果の理由**: UC-002
- **テストの目的**: 統合動作の確認
  - **確認ポイント**: データの一貫性
- **関連要件**: AC-004
- **優先度**: P0 必須

#### TC-041-049: 定型文削除の統合フロー

- **テスト名**: 削除確認→Provider更新→Repository削除の統合フロー
  - **何をテストするか**: 削除操作のE2E
  - **期待される動作**: UI→Provider→Repositoryの連携
- **前提条件**: 削除対象の定型文が存在すること
- **入力値**: 削除確認操作
  - **入力データの意味**: ユーザー操作
- **期待される結果**: 定型文が削除され、一覧から消える
  - **期待結果の理由**: UC-003
- **テストの目的**: 統合動作の確認
  - **確認ポイント**: データの一貫性
- **関連要件**: AC-006
- **優先度**: P0 必須

---

## 8. テーマ対応テスト

### 8.1 ライトテーマ

#### TC-041-050: 追加ダイアログがライトテーマで正しく表示される

- **テスト名**: ライトテーマでPhraseAddDialogが正しく表示される
  - **何をテストするか**: ライトテーマでの表示
  - **期待される動作**: ライトテーマの配色で表示される
- **前提条件**: ライトテーマが設定されていること
- **入力値**: ライトテーマ設定
  - **入力データの意味**: テーマ適用確認
- **期待される結果**: ライトテーマの配色が適用される
  - **期待結果の理由**: REQ-803
- **テストの目的**: テーマ適用確認
  - **確認ポイント**: ウィジェットの描画
- **関連要件**: REQ-803, AC-015
- **優先度**: P1 重要

### 8.2 ダークテーマ

#### TC-041-051: 追加ダイアログがダークテーマで正しく表示される

- **テスト名**: ダークテーマでPhraseAddDialogが正しく表示される
  - **何をテストするか**: ダークテーマでの表示
  - **期待される動作**: ダークテーマの配色で表示される
- **前提条件**: ダークテーマが設定されていること
- **入力値**: ダークテーマ設定
  - **入力データの意味**: テーマ適用確認
- **期待される結果**: ダークテーマの配色が適用される
  - **期待結果の理由**: REQ-803
- **テストの目的**: テーマ適用確認
  - **確認ポイント**: ウィジェットの描画
- **関連要件**: REQ-803, AC-015
- **優先度**: P1 重要

### 8.3 高コントラストテーマ

#### TC-041-052: 追加ダイアログが高コントラストテーマで正しく表示される

- **テスト名**: 高コントラストテーマでPhraseAddDialogが正しく表示される
  - **何をテストするか**: 高コントラストテーマでの表示
  - **期待される動作**: 高コントラストの配色で表示される
- **前提条件**: 高コントラストテーマが設定されていること
- **入力値**: 高コントラストテーマ設定
  - **入力データの意味**: テーマ適用確認
- **期待される結果**: 高コントラストの配色が適用される
  - **期待結果の理由**: REQ-803
- **テストの目的**: テーマ適用確認
  - **確認ポイント**: ウィジェットの描画
- **関連要件**: REQ-803, AC-015
- **優先度**: P1 重要

---

## 9. フォントサイズ対応テスト

#### TC-041-053: 小フォントサイズでダイアログが正しく表示される

- **テスト名**: 小フォントサイズでダイアログが正しく表示される
  - **何をテストするか**: フォントサイズ設定の反映
  - **期待される動作**: 小フォントサイズが適用される
- **前提条件**: フォントサイズが「小」に設定されていること
- **入力値**: フォントサイズ「小」設定
  - **入力データの意味**: サイズ設定
- **期待される結果**: 小フォントサイズでテキストが表示される
  - **期待結果の理由**: REQ-801
- **テストの目的**: フォントサイズ適用確認
  - **確認ポイント**: テキストサイズ
- **関連要件**: REQ-801, AC-016
- **優先度**: P1 重要

#### TC-041-054: 大フォントサイズでダイアログが正しく表示される

- **テスト名**: 大フォントサイズでダイアログが正しく表示される
  - **何をテストするか**: フォントサイズ設定の反映
  - **期待される動作**: 大フォントサイズが適用される
- **前提条件**: フォントサイズが「大」に設定されていること
- **入力値**: フォントサイズ「大」設定
  - **入力データの意味**: サイズ設定
- **期待される結果**: 大フォントサイズでテキストが表示される
  - **期待結果の理由**: REQ-801
- **テストの目的**: フォントサイズ適用確認
  - **確認ポイント**: テキストサイズ
- **関連要件**: REQ-801, AC-016
- **優先度**: P1 重要

---

## 10. パフォーマンステスト

#### TC-041-055: 追加操作が500ms以内に完了する

- **テスト名**: 定型文追加操作が500ms以内に完了する
  - **何をテストするか**: 追加パフォーマンス
  - **期待される動作**: 500ms以内に追加が完了
- **前提条件**: アプリが正常動作していること
- **入力値**: 追加操作
  - **入力データの意味**: パフォーマンス測定
- **期待される結果**: 追加完了までの時間が500ms以内
  - **期待結果の理由**: 非機能要件4.1
- **テストの目的**: パフォーマンス要件確認
  - **確認ポイント**: 処理時間
- **関連要件**: AC-013
- **優先度**: P1 重要

#### TC-041-056: 編集操作が500ms以内に完了する

- **テスト名**: 定型文編集操作が500ms以内に完了する
  - **何をテストするか**: 編集パフォーマンス
  - **期待される動作**: 500ms以内に編集が完了
- **前提条件**: アプリが正常動作していること
- **入力値**: 編集操作
  - **入力データの意味**: パフォーマンス測定
- **期待される結果**: 編集完了までの時間が500ms以内
  - **期待結果の理由**: 非機能要件4.1
- **テストの目的**: パフォーマンス要件確認
  - **確認ポイント**: 処理時間
- **関連要件**: AC-013
- **優先度**: P1 重要

#### TC-041-057: 削除操作が500ms以内に完了する

- **テスト名**: 定型文削除操作が500ms以内に完了する
  - **何をテストするか**: 削除パフォーマンス
  - **期待される動作**: 500ms以内に削除が完了
- **前提条件**: アプリが正常動作していること
- **入力値**: 削除操作
  - **入力データの意味**: パフォーマンス測定
- **期待される結果**: 削除完了までの時間が500ms以内
  - **期待結果の理由**: 非機能要件4.1
- **テストの目的**: パフォーマンス要件確認
  - **確認ポイント**: 処理時間
- **関連要件**: AC-013
- **優先度**: P1 重要

#### TC-041-058: お気に入り切替が100ms以内に完了する

- **テスト名**: お気に入り切替操作が100ms以内に完了する
  - **何をテストするか**: お気に入り切替パフォーマンス
  - **期待される動作**: 100ms以内に切替が完了
- **前提条件**: アプリが正常動作していること
- **入力値**: お気に入り切替操作
  - **入力データの意味**: パフォーマンス測定
- **期待される結果**: 切替完了までの時間が100ms以内
  - **期待結果の理由**: 非機能要件4.1（即座）
- **テストの目的**: パフォーマンス要件確認
  - **確認ポイント**: 処理時間
- **関連要件**: AC-013
- **優先度**: P1 重要

---

## 11. 境界値テスト

#### TC-041-059: 0文字入力（下限境界値-1）

- **テスト名**: 0文字入力時のバリデーション
  - **境界値の意味**: 最小文字数の下限境界値-1
  - **境界値での動作保証**: エラーとなること
- **前提条件**: バリデーターが初期化されていること
- **入力値**: ""（0文字）
  - **境界値選択の根拠**: CRUD-202の下限境界
- **期待される結果**: エラーメッセージが返される
  - **境界での正確性**: 境界外は拒否
- **テストの目的**: 下限境界値の確認
  - **堅牢性の確認**: 無効な入力が拒否される
- **関連要件**: CRUD-202, EDGE-001
- **優先度**: P0 必須

#### TC-041-060: 499文字入力（上限境界値-1）

- **テスト名**: 499文字入力時のバリデーション
  - **境界値の意味**: 最大文字数の上限境界値-1
  - **境界値での動作保証**: 正常に受け入れられること
- **前提条件**: バリデーターが初期化されていること
- **入力値**: 499文字のテキスト
  - **境界値選択の根拠**: CRUD-201の上限境界-1
- **期待される結果**: バリデーション成功
  - **境界での正確性**: 境界内は受け入れ
- **テストの目的**: 上限境界値-1の確認
  - **堅牢性の確認**: 有効な入力が受け入れられる
- **関連要件**: CRUD-201
- **優先度**: P1 重要

#### TC-041-061: 500文字入力（上限境界値）

- **テスト名**: 500文字入力時のバリデーション
  - **境界値の意味**: 最大文字数の上限境界値
  - **境界値での動作保証**: 正常に受け入れられること
- **前提条件**: バリデーターが初期化されていること
- **入力値**: 500文字のテキスト
  - **境界値選択の根拠**: CRUD-201の上限境界
- **期待される結果**: バリデーション成功
  - **境界での正確性**: 境界は受け入れ
- **テストの目的**: 上限境界値の確認
  - **堅牢性の確認**: 境界値が正しく処理される
- **関連要件**: CRUD-201, EDGE-003
- **優先度**: P0 必須

#### TC-041-062: 501文字入力（上限境界値+1）

- **テスト名**: 501文字入力時のバリデーション
  - **境界値の意味**: 最大文字数の上限境界値+1
  - **境界値での動作保証**: エラーとなること
- **前提条件**: バリデーターが初期化されていること
- **入力値**: 501文字のテキスト
  - **境界値選択の根拠**: CRUD-201の上限境界+1
- **期待される結果**: エラーメッセージが返される
  - **境界での正確性**: 境界外は拒否
- **テストの目的**: 上限境界値+1の確認
  - **堅牢性の確認**: 無効な入力が拒否される
- **関連要件**: CRUD-201, EDGE-004
- **優先度**: P0 必須

---

## テストケースサマリー

| カテゴリ | テスト数 | P0 | P1 | P2 |
|----------|----------|-----|-----|-----|
| PresetPhraseValidator | 10 | 6 | 4 | 0 |
| PhraseAddDialog | 11 | 6 | 4 | 1 |
| PhraseEditDialog | 6 | 5 | 1 | 0 |
| PhraseDeleteDialog | 4 | 4 | 0 | 0 |
| PresetPhraseNotifier | 11 | 8 | 3 | 0 |
| PresetPhraseRepository | 4 | 4 | 0 | 0 |
| 統合テスト | 3 | 3 | 0 | 0 |
| テーマ対応 | 3 | 0 | 3 | 0 |
| フォントサイズ対応 | 2 | 0 | 2 | 0 |
| パフォーマンス | 4 | 0 | 4 | 0 |
| 境界値テスト | 4 | 3 | 1 | 0 |
| **合計** | **62** | **39** | **22** | **1** |

---

## 品質判定

### 判定結果: 高品質

| 項目 | 状態 |
|------|------|
| テストケース分類 | 正常系・異常系・境界値・エッジケースが網羅されている |
| 期待値定義 | 各テストケースの期待値が明確 |
| 技術選択 | Dart + flutter_test + mocktail |
| 実装可能性 | 現在の技術スタックで実現可能 |
| 要件カバレッジ | REQ-104, EDGE-102, 関連要件をすべてカバー |

---

## 要件とテストケースの対応表

| 要件ID | テストケースID |
|--------|---------------|
| CRUD-001 | TC-041-011 |
| CRUD-002 | TC-041-011, TC-041-013, TC-041-014 |
| CRUD-003 | TC-041-033 |
| CRUD-004 | TC-041-022, TC-041-023, TC-041-024 |
| CRUD-005 | TC-041-022 |
| CRUD-006 | TC-041-028, TC-041-029, TC-041-037 |
| CRUD-007 | TC-041-038, TC-041-039 |
| CRUD-008 | TC-041-025, TC-041-034 |
| CRUD-101 | TC-041-028 |
| CRUD-102 | TC-041-029 |
| CRUD-103 | TC-041-030 |
| CRUD-104 | TC-041-006, TC-041-017, TC-041-018 |
| CRUD-105 | TC-041-004, TC-041-005, TC-041-016, TC-041-026 |
| CRUD-106 | TC-041-038, TC-041-039 |
| CRUD-201 | TC-041-003, TC-041-006, TC-041-061, TC-041-062 |
| CRUD-202 | TC-041-002, TC-041-059 |
| CRUD-203 | TC-041-021 |
| CRUD-204 | TC-041-028 |
| CRUD-205 | TC-041-043, TC-041-044, TC-041-045, TC-041-046 |
| EDGE-001 | TC-041-004, TC-041-059 |
| EDGE-002 | TC-041-002 |
| EDGE-003 | TC-041-003, TC-041-061 |
| EDGE-004 | TC-041-006, TC-041-062 |
| EDGE-005 | TC-041-005 |
| EDGE-006 | TC-041-007 |
| EDGE-007 | TC-041-008 |
| EDGE-008 | TC-041-009 |
| EDGE-009 | TC-041-041 |
| EDGE-010 | TC-041-042 |
| EDGE-012 | TC-041-020 |
| EDGE-013 | TC-041-031 |
| EDGE-014 | TC-041-019, TC-041-027 |
| REQ-104 | TC-041-032, TC-041-035, TC-041-036, TC-041-037, TC-041-045, TC-041-046 |
| REQ-105 | TC-041-040 |
| REQ-5002 | TC-041-028, TC-041-031 |
| REQ-801 | TC-041-053, TC-041-054 |
| REQ-803 | TC-041-050, TC-041-051, TC-041-052 |

---

## 次のステップ

次のお勧めステップ: `/tsumiki:tdd-red` でRedフェーズ（失敗テスト作成）を開始します。

---

## 更新履歴

- **2025-11-23**: TDDテストケース定義書初版作成（TASK-0041）
