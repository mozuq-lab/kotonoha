# Phase 3: フロントエンド基本機能実装

## 要件名

**kotonoha** - 文字盤コミュニケーション支援アプリ

## フェーズ概要

- **期間**: Week 9-12 (20営業日)
- **目標**: 文字盤UI、定型文、大ボタン、緊急ボタン、TTS、ローカルストレージ実装
- **成果物**: 動作する基本コミュニケーション機能（オフライン対応）
- **総タスク数**: 24タスク
- **総工数**: 192時間
- **信頼性レベル**: 🔵 青信号（EARS要件定義書・インターフェース定義に明確に記載）

## 🔵 信頼性レベルについて

このフェーズのタスクは、EARS要件定義書（REQ-001〜REQ-804）および `docs/design/kotonoha/interfaces.dart` のインターフェース定義に明確に記載されている内容に基づいています。各タスクは具体的な要件（文字盤入力、定型文管理、TTS読み上げ、緊急ボタン等）に対応しており、推測はほとんど含まれていません。

## 週次計画

### Week 9: 文字盤・定型文UI実装

- **目標**: 五十音文字盤、定型文一覧・管理UI実装
- **成果物**: 文字入力機能、定型文CRUD機能

### Week 10: 大ボタン・緊急ボタン実装

- **目標**: 「はい」「いいえ」大ボタン、状態ボタン、緊急ボタン実装
- **成果物**: 即座読み上げボタン、2段階確認緊急機能

### Week 11: TTS読み上げ・対面表示モード

- **目標**: OS標準TTS連携、対面表示UI実装
- **成果物**: 読み上げ機能（1秒以内開始）、180度回転表示

### Week 12: ローカルストレージ・状態管理

- **目標**: Hive データ永続化、Riverpod 状態管理実装
- **成果物**: オフライン動作、データ保持機能

---

## 日次タスク

### Week 9: 文字盤・定型文UI実装

#### Day 1: TASK-0037 - 五十音文字盤UI実装

- [ ] **タスク完了**
- **推定工数**: 8時間
- **タスクタイプ**: TDD
- **要件名**: kotonoha
- **関連要件**: REQ-001, REQ-002, REQ-5001, NFR-003, NFR-202
- **依存タスク**: TASK-0016 (テーマ実装), TASK-0011 (Flutter構造)

**実装詳細**:

1. 五十音配列の文字盤ウィジェット作成
2. 各文字ボタンのサイズを44px × 44px以上に設定
3. タップイベント処理（100ms以内の応答）
4. 視覚的フィードバック（タップアニメーション）実装
5. レスポンシブ対応（縦・横画面両対応）

**完了条件**:

- 五十音すべての文字（あ〜ん、濁音、半濁音、拗音）が表示される
- タップから文字反映まで100ms以内
- 画面回転でも適切に表示される
- フォントサイズ設定に追従する
- アクセシビリティ対応（Semanticsウィジェット使用）

**テスト要件**:

```dart
// test/character_pad_test.dart
testWidgets('文字盤が正しく表示される', (tester) async {
  await tester.pumpWidget(CharacterPadWidget());
  expect(find.text('あ'), findsOneWidget);
  expect(find.text('ん'), findsOneWidget);
});

testWidgets('文字タップで入力バッファに追加', (tester) async {
  await tester.pumpWidget(CharacterPadWidget());
  await tester.tap(find.text('あ'));
  await tester.pump(Duration(milliseconds: 100));
  // バッファに「あ」が追加されることを確認
});
```

---

#### Day 2: TASK-0038 - 文字入力バッファ管理（Riverpod StateNotifier）

- [ ] **タスク完了**
- **推定工数**: 8時間
- **タスクタイプ**: TDD
- **要件名**: kotonoha
- **関連要件**: REQ-002, EDGE-101
- **依存タスク**: TASK-0013 (Riverpod設定), TASK-0037

**実装詳細**:

1. InputBufferStateNotifier作成（Riverpod）
2. 文字追加・削除・全消去メソッド実装
3. 最大1000文字制限のバリデーション
4. 状態変更時の通知機能

**完了条件**:

- 文字が正しく入力バッファに追加される
- 1000文字制限が機能する
- 状態がリアルタイムでUIに反映される

**テスト要件**:

```dart
// test/input_buffer_test.dart
test('文字を追加できる', () {
  final container = ProviderContainer();
  final notifier = container.read(inputBufferProvider.notifier);
  notifier.addCharacter('あ');
  expect(container.read(inputBufferProvider), 'あ');
});

test('1000文字制限', () {
  final container = ProviderContainer();
  final notifier = container.read(inputBufferProvider.notifier);
  final longText = 'あ' * 1001;
  notifier.setText(longText);
  expect(container.read(inputBufferProvider).length, 1000);
});
```

---

#### Day 3: TASK-0039 - 削除ボタン・全消去ボタン実装

- [ ] **タスク完了**
- **推定工数**: 8時間
- **タスクタイプ**: TDD
- **要件名**: kotonoha
- **関連要件**: REQ-003, REQ-004, REQ-2001, REQ-5002
- **依存タスク**: TASK-0038

**実装詳細**:

1. 削除ボタン（最後の1文字削除）実装
2. 全消去ボタン実装
3. 全消去時の確認ダイアログ表示
4. 誤操作防止UI設計

**完了条件**:

- 削除ボタンで最後の1文字が削除される
- 全消去ボタンタップ時に確認ダイアログが表示される
- ダイアログ「はい」でバッファがクリアされる
- ダイアログ「いいえ」でキャンセルされる

**テスト要件**:

```dart
testWidgets('削除ボタンで最後の1文字削除', (tester) async {
  // テスト実装
});

testWidgets('全消去ボタンで確認ダイアログ表示', (tester) async {
  // テスト実装
});
```

---

#### Day 4: TASK-0040 - 定型文一覧UI実装

- [ ] **タスク完了**
- **推定工数**: 8時間
- **タスクタイプ**: TDD
- **要件名**: kotonoha
- **関連要件**: REQ-101, REQ-105, REQ-106, NFR-004
- **依存タスク**: TASK-0016 (テーマ), TASK-0037

**実装詳細**:

1. 定型文一覧画面作成
2. お気に入り優先表示ロジック
3. カテゴリ別表示（日常・体調・その他）
4. スクロール可能なリスト実装
5. 1秒以内に100件表示（NFR-004）

**完了条件**:

- 定型文が一覧表示される
- お気に入りが上部に表示される
- カテゴリごとに分類表示される
- 100件の定型文を1秒以内に表示できる

**テスト要件**:

```dart
testWidgets('定型文一覧が表示される', (tester) async {
  // テスト実装
});

testWidgets('お気に入りが上部に表示', (tester) async {
  // テスト実装
});
```

---

#### Day 5: TASK-0041 - 定型文CRUD機能実装

- [ ] **タスク完了**
- **推定工数**: 8時間
- **タスクタイプ**: TDD
- **要件名**: kotonoha
- **関連要件**: REQ-104, EDGE-102
- **依存タスク**: TASK-0040

**実装詳細**:

1. 定型文追加画面・ダイアログ実装
2. 定型文編集機能実装
3. 定型文削除機能（確認ダイアログ付き）
4. お気に入り切り替え機能
5. 最大500文字制限

**完了条件**:

- 定型文を追加できる
- 定型文を編集できる
- 定型文を削除できる（確認ダイアログ表示）
- お気に入りを切り替えられる
- 500文字制限が機能する

**テスト要件**:

```dart
testWidgets('定型文を追加できる', (tester) async {
  // テスト実装
});

testWidgets('定型文を削除できる（確認ダイアログ）', (tester) async {
  // テスト実装
});
```

---

### Week 10: 大ボタン・緊急ボタン実装

#### Day 6: TASK-0042 - 定型文初期データ（50-100個サンプル）

- [ ] **タスク完了**
- **推定工数**: 8時間
- **タスクタイプ**: DIRECT
- **要件名**: kotonoha
- **関連要件**: REQ-107
- **依存タスク**: TASK-0041

**実装詳細**:

1. 50-100個の汎用定型文作成
2. カテゴリ分類（日常・体調・その他）
3. 初期データJSON作成
4. 初回起動時のデータ投入ロジック

**完了条件**:

- 50個以上の定型文サンプルが作成される
- カテゴリごとに適切に分類される
- 初回起動時に自動投入される

---

#### Day 7: TASK-0043 - 「はい」「いいえ」「わからない」大ボタン実装

- [ ] **タスク完了**
- **推定工数**: 8時間
- **タスクタイプ**: TDD
- **要件名**: kotonoha
- **関連要件**: REQ-201, REQ-204, NFR-202
- **依存タスク**: TASK-0037

**実装詳細**:

1. 大ボタンウィジェット作成（推奨60px × 60px以上）
2. 画面上部に常時表示
3. タップ時に即座読み上げ
4. 視認性の高いデザイン

**完了条件**:

- 「はい」「いいえ」「わからない」ボタンが表示される
- ボタンサイズが60px × 60px以上
- タップ時に即座に読み上げられる
- すべての画面で表示される

**テスト要件**:

```dart
testWidgets('大ボタンが表示される', (tester) async {
  await tester.pumpWidget(LargeButtonsWidget());
  expect(find.text('はい'), findsOneWidget);
  expect(find.text('いいえ'), findsOneWidget);
  expect(find.text('わからない'), findsOneWidget);
});

testWidgets('大ボタンタップで即座読み上げ', (tester) async {
  // TTS読み上げのモックテスト
});
```

---

#### Day 8: TASK-0044 - 状態ボタン（「痛い」「トイレ」等8-12個）実装

- [ ] **タスク完了**
- **推定工数**: 8時間
- **タスクタイプ**: TDD
- **要件名**: kotonoha
- **関連要件**: REQ-202, REQ-203, REQ-204
- **依存タスク**: TASK-0043

**実装詳細**:

1. 状態ボタン8-12個作成（「痛い」「トイレ」「暑い」「寒い」等）
2. 画面上部またはサイドに配置
3. タップ時に即座読み上げ
4. カスタマイズ可能な設計（将来拡張用）

**完了条件**:

- 8-12個の状態ボタンが表示される
- ボタンサイズが44px × 44px以上
- タップ時に即座に読み上げられる
- 視認性が高いデザイン

**テスト要件**:

```dart
testWidgets('状態ボタンが表示される', (tester) async {
  await tester.pumpWidget(StateButtonsWidget());
  expect(find.text('痛い'), findsOneWidget);
  expect(find.text('トイレ'), findsOneWidget);
});
```

---

#### Day 9: TASK-0045 - 緊急ボタンUI実装

- [ ] **タスク完了**
- **推定工数**: 8時間
- **タスクタイプ**: TDD
- **要件名**: kotonoha
- **関連要件**: REQ-301, REQ-5002, NFR-202
- **依存タスク**: TASK-0037

**実装詳細**:

1. 緊急ボタンウィジェット作成（目立つデザイン・赤色等）
2. すべての画面で常時表示
3. 誤タップ防止の配置・デザイン
4. アクセシビリティ対応

**完了条件**:

- 緊急ボタンがすべての画面に表示される
- 目立つデザイン（赤色・大きめサイズ）
- 誤タップしにくい配置

**テスト要件**:

```dart
testWidgets('緊急ボタンが表示される', (tester) async {
  await tester.pumpWidget(EmergencyButtonWidget());
  expect(find.byType(EmergencyButton), findsOneWidget);
});
```

---

#### Day 10: TASK-0046 - 緊急ボタン2段階確認実装

- [ ] **タスク完了**
- **推定工数**: 8時間
- **タスクタイプ**: TDD
- **要件名**: kotonoha
- **関連要件**: REQ-302, REQ-2004, REQ-2005, REQ-5002
- **依存タスク**: TASK-0045

**実装詳細**:

1. 緊急ボタン1回目タップで確認ダイアログ表示
2. ダイアログ「はい」「いいえ」ボタン実装
3. 「はい」タップで緊急処理実行
4. 「いいえ」タップでダイアログ閉じる
5. ダイアログ外タップでも閉じない（誤操作防止）

**完了条件**:

- 1回目タップで確認ダイアログが表示される
- 「はい」で緊急処理実行
- 「いいえ」でキャンセル
- ダイアログ外タップでは閉じない

**テスト要件**:

```dart
testWidgets('緊急ボタン1回目で確認ダイアログ', (tester) async {
  await tester.tap(find.byType(EmergencyButton));
  await tester.pump();
  expect(find.text('緊急呼び出しを実行しますか?'), findsOneWidget);
});

testWidgets('「はい」タップで緊急処理実行', (tester) async {
  // テスト実装
});
```

---

### Week 11: TTS読み上げ・対面表示モード

#### Day 11: TASK-0047 - 緊急音・画面赤表示実装

- [ ] **タスク完了**
- **推定工数**: 8時間
- **タスクタイプ**: TDD
- **要件名**: kotonoha
- **関連要件**: REQ-303, REQ-304, EDGE-203
- **依存タスク**: TASK-0046

**実装詳細**:

1. 緊急音の再生（大音量・連続音）
2. 画面全体を赤く表示
3. マナーモード時の対応（警告表示）
4. リセットボタンで通常画面に戻る機能

**完了条件**:

- 緊急音が鳴る（audioplayers使用）
- 画面全体が赤く表示される
- リセットボタンで元に戻る
- マナーモード時は警告表示

**テスト要件**:

```dart
testWidgets('緊急音が再生される', (tester) async {
  // audioplayers モックテスト
});

testWidgets('画面が赤く表示される', (tester) async {
  // 画面色変更のテスト
});
```

---

#### Day 12: TASK-0048 - OS標準TTS連携（flutter_tts）

- [ ] **タスク完了**
- **推定工数**: 8時間
- **タスクタイプ**: TDD
- **要件名**: kotonoha
- **関連要件**: REQ-401, NFR-001
- **依存タスク**: TASK-0038

**実装詳細**:

1. flutter_ttsパッケージ統合
2. TTS初期化処理
3. 読み上げメソッド実装
4. 読み上げ開始までの時間を1秒以内に最適化
5. iOS/Android両対応

**完了条件**:

- OS標準TTSが動作する
- 読み上げボタンタップから1秒以内に読み上げ開始
- iOS/Android両方で正常動作
- エラーハンドリング実装

**テスト要件**:

```dart
test('TTSが初期化される', () async {
  final tts = FlutterTts();
  final initialized = await tts.setLanguage('ja-JP');
  expect(initialized, 1); // 成功
});

test('読み上げが実行される', () async {
  final tts = FlutterTts();
  await tts.speak('こんにちは');
  // モックテスト
});
```

---

#### Day 13: TASK-0049 - TTS速度設定（遅い/普通/速い）

- [ ] **タスク完了**
- **推定工数**: 8時間
- **タスクタイプ**: TDD
- **要件名**: kotonoha
- **関連要件**: REQ-404
- **依存タスク**: TASK-0048

**実装詳細**:

1. TTS速度設定Provider作成（Riverpod）
2. 速度選択UI実装（遅い: 0.5倍、普通: 1.0倍、速い: 1.5倍）
3. flutter_ttsのsetSpeechRate適用
4. 設定のローカル保存（shared_preferences）

**完了条件**:

- 3段階の速度設定が選択できる
- 設定が即座に反映される
- 設定が永続化される

**テスト要件**:

```dart
test('TTS速度が設定される', () async {
  final tts = FlutterTts();
  await tts.setSpeechRate(0.5); // 遅い
  // モックテスト
});

testWidgets('速度設定UIが表示される', (tester) async {
  // テスト実装
});
```

---

#### Day 14: TASK-0050 - TTS読み上げ中断機能

- [ ] **タスク完了**
- **推定工数**: 8時間
- **タスクタイプ**: TDD
- **要件名**: kotonoha
- **関連要件**: REQ-403, REQ-3003
- **依存タスク**: TASK-0048

**実装詳細**:

1. 読み上げ中状態の管理（Riverpod）
2. 読み上げ中は「停止」ボタンに切り替え
3. 停止ボタンタップで読み上げ中断
4. 読み上げ完了時のコールバック処理

**完了条件**:

- 読み上げ中は停止ボタンが表示される
- 停止ボタンで読み上げが中断される
- 読み上げ完了後は読み上げボタンに戻る

**テスト要件**:

```dart
test('読み上げを中断できる', () async {
  final tts = FlutterTts();
  await tts.speak('長いテキスト...');
  await tts.stop();
  // モックテスト
});

testWidgets('読み上げ中は停止ボタン表示', (tester) async {
  // テスト実装
});
```

---

#### Day 15: TASK-0051 - OS音量0の警告表示

- [ ] **タスク完了**
- **推定工数**: 8時間
- **タスクタイプ**: TDD
- **要件名**: kotonoha
- **関連要件**: EDGE-202
- **依存タスク**: TASK-0048

**実装詳細**:

1. OS音量確認処理（volume_controller パッケージ）
2. 音量0の場合に警告ダイアログ表示
3. 音量調整へのクイックアクセス提供
4. 視覚的な警告表示

**完了条件**:

- OS音量が0の場合に警告が表示される
- 警告メッセージが分かりやすい
- 音量調整への誘導がある

**テスト要件**:

```dart
testWidgets('音量0の場合に警告表示', (tester) async {
  // volume_controller モックテスト
});
```

---

### Week 12: ローカルストレージ・状態管理

#### Day 16: TASK-0052 - 対面表示モード（拡大表示）実装

- [ ] **タスク完了**
- **推定工数**: 8時間
- **タスクタイプ**: TDD
- **要件名**: kotonoha
- **関連要件**: REQ-501, REQ-503
- **依存タスク**: TASK-0048

**実装詳細**:

1. 対面表示モード画面作成
2. テキスト拡大表示UI
3. 背景シンプル化
4. 通常モードへの戻るボタン
5. モード切り替えボタン実装

**完了条件**:

- 対面表示モードでテキストが大きく表示される
- 背景がシンプルで読みやすい
- 通常モードに簡単に戻れる
- フォントサイズ設定に関わらず大きく表示

**テスト要件**:

```dart
testWidgets('対面表示モードでテキスト拡大', (tester) async {
  // テスト実装
});

testWidgets('通常モードに戻れる', (tester) async {
  // テスト実装
});
```

---

#### Day 17: TASK-0053 - 180度画面回転機能

- [ ] **タスク完了**
- **推定工数**: 8時間
- **タスクタイプ**: TDD
- **要件名**: kotonoha
- **関連要件**: REQ-502
- **依存タスク**: TASK-0052

**実装詳細**:

1. 画面回転ボタン実装
2. Transform.rotate() を使用した180度回転
3. 回転状態の管理（Riverpod）
4. 回転後の操作性確保

**完了条件**:

- 画面が180度回転する
- 回転後も文字が読みやすい
- 再度タップで元に戻る

**テスト要件**:

```dart
testWidgets('画面が180度回転する', (tester) async {
  // Transform テスト
});
```

---

#### Day 18: TASK-0054 - Hive データベース初期化

- [ ] **タスク完了**
- **推定工数**: 8時間
- **タスクタイプ**: DIRECT
- **要件名**: kotonoha
- **関連要件**: REQ-5003, NFR-101
- **依存タスク**: TASK-0014 (Hive設定)

**実装詳細**:

1. Hive データベース初期化処理
2. TypeAdapter登録（定型文、履歴、お気に入り）
3. Box作成（presetPhraseBox、historyBox、favoriteBox）
4. エラーハンドリング

**完了条件**:

- Hive データベースが正常に初期化される
- TypeAdapterが正しく登録される
- Boxが作成される
- エラー時の適切なハンドリング

---

#### Day 19: TASK-0055 - 定型文ローカル保存（Hive）

- [ ] **タスク完了**
- **推定工数**: 8時間
- **タスクタイプ**: TDD
- **要件名**: kotonoha
- **関連要件**: REQ-104, REQ-5003, NFR-101
- **依存タスク**: TASK-0054

**実装詳細**:

1. PresetPhrase Hive モデル定義
2. CRUD操作実装（追加・読み取り・更新・削除）
3. お気に入り状態の保存
4. カテゴリ情報の保存
5. Riverpod Provider統合

**完了条件**:

- 定型文がHiveに保存される
- アプリ再起動後も保持される
- CRUD操作が正常動作する

**テスト要件**:

```dart
test('定型文をHiveに保存できる', () async {
  final box = await Hive.openBox<PresetPhrase>('preset_phrases');
  final phrase = PresetPhrase(content: 'こんにちは', category: Category.daily);
  await box.add(phrase);
  expect(box.length, 1);
});
```

---

#### Day 20: TASK-0056 - アプリ設定保存（shared_preferences）

- [ ] **タスク完了**
- **推定工数**: 8時間
- **タスクタイプ**: TDD
- **要件名**: kotonoha
- **関連要件**: REQ-801-804, NFR-101
- **依存タスク**: TASK-0054

**実装詳細**:

1. AppSettings モデル定義
2. shared_preferences統合
3. フォントサイズ設定の保存
4. テーマ設定の保存
5. TTS速度設定の保存
6. AI丁寧さレベル設定の保存

**完了条件**:

- 設定がshared_preferencesに保存される
- アプリ再起動後も保持される
- 設定変更が即座に反映される

**テスト要件**:

```dart
test('設定をshared_preferencesに保存', () async {
  final prefs = await SharedPreferences.getInstance();
  await prefs.setString('fontSize', 'medium');
  expect(prefs.getString('fontSize'), 'medium');
});
```

---

#### Day 21: TASK-0057 - Riverpod Provider 構造設計

- [ ] **タスク完了**
- **推定工数**: 8時間
- **タスクタイプ**: TDD
- **要件名**: kotonoha
- **関連要件**: なし（アーキテクチャ）
- **依存タスク**: TASK-0013 (Riverpod設定)

**実装詳細**:

1. Provider階層設計
2. InputBufferProvider（入力バッファ管理）
3. PresetPhraseProvider（定型文管理）
4. HistoryProvider（履歴管理）
5. FavoriteProvider（お気に入り管理）
6. SettingsProvider（設定管理）
7. TTSProvider（TTS状態管理）
8. NetworkProvider（ネットワーク状態管理）

**完了条件**:

- すべてのProvider が正しく定義される
- Provider間の依存関係が適切に設計される
- テスト可能な構造になっている

**テスト要件**:

```dart
test('InputBufferProvider が動作する', () {
  final container = ProviderContainer();
  final buffer = container.read(inputBufferProvider);
  expect(buffer, '');
});
```

---

#### Day 22: TASK-0058 - オフライン動作確認

- [ ] **タスク完了**
- **推定工数**: 8時間
- **タスクタイプ**: TDD
- **要件名**: kotonoha
- **関連要件**: REQ-1001, REQ-1002, REQ-1003, NFR-303
- **依存タスク**: すべてのPhase 3タスク

**実装詳細**:

1. ネットワーク切断テスト
2. オフライン時の基本機能動作確認
   - 文字盤入力
   - 定型文選択・読み上げ
   - 大ボタン・緊急ボタン
   - TTS読み上げ
   - ローカルストレージ
3. AI変換ボタンの無効化確認
4. オフライン表示の確認

**完了条件**:

- オフライン時も基本機能が正常動作する
- AI変換ボタンが無効化またはグレーアウト表示される
- オフライン状態が明示される
- エラーメッセージが分かりやすい

**テスト要件**:

```dart
testWidgets('オフライン時にAI変換ボタンが無効化', (tester) async {
  // ネットワーク切断シミュレーション
  // AI変換ボタンの無効化確認
});

testWidgets('オフライン時も文字盤入力が動作', (tester) async {
  // テスト実装
});
```

---

#### Day 23: TASK-0059 - データ永続化テスト

- [ ] **タスク完了**
- **推定工数**: 8時間
- **タスクタイプ**: TDD
- **要件名**: kotonoha
- **関連要件**: REQ-5003, NFR-301, NFR-302
- **依存タスク**: TASK-0055, TASK-0056

**実装詳細**:

1. アプリ強制終了シミュレーション
2. 再起動後のデータ復元確認
3. 入力状態の復元確認
4. トランザクション整合性確認

**完了条件**:

- アプリ強制終了後も定型文・設定が保持される
- 入力中のテキストが復元される
- データの整合性が保たれる

**テスト要件**:

```dart
test('アプリ再起動後もデータが保持される', () async {
  // Hive データ保存
  // アプリ再起動シミュレーション
  // データ読み取り確認
});
```

---

#### Day 24: TASK-0060 - Phase 3 統合テスト

- [ ] **タスク完了**
- **推定工数**: 8時間
- **タスクタイプ**: TDD
- **要件名**: kotonoha
- **関連要件**: すべてのPhase 3要件
- **依存タスク**: すべてのPhase 3タスク

**実装詳細**:

1. E2Eテストシナリオ作成
2. ユーザーフロー全体のテスト
   - 文字入力 → 読み上げ → 履歴保存
   - 定型文選択 → 即座読み上げ
   - 緊急ボタン → 2段階確認 → 緊急音
3. パフォーマンステスト
   - 文字盤タップ応答100ms以内
   - TTS開始1秒以内
4. アクセシビリティテスト

**完了条件**:

- すべてのE2Eテストが合格
- パフォーマンス要件を満たす
- アクセシビリティ要件を満たす
- カバレッジ80%以上

**テスト要件**:

```dart
testWidgets('文字入力から読み上げまでのフロー', (tester) async {
  // 文字盤で「こんにちは」入力
  // 読み上げボタンタップ
  // 履歴に保存確認
});

testWidgets('定型文即座読み上げフロー', (tester) async {
  // 定型文タップ
  // 即座読み上げ確認
});
```

---

## フェーズ完了条件

- [ ] すべての24タスクが完了している
- [ ] 基本コミュニケーション機能（文字盤・定型文・TTS）が動作する
- [ ] 緊急ボタンが正常に動作する
- [ ] ローカルストレージでデータが永続化される
- [ ] オフライン環境で基本機能が動作する
- [ ] パフォーマンス要件を満たす（100ms応答、1秒TTS開始）
- [ ] テストカバレッジ80%以上
- [ ] アクセシビリティ要件を満たす

## 次のフェーズへの引き継ぎ事項

- Phase 4で実装する履歴管理・お気に入り機能のための基盤が整っている
- AI変換UI連携のための状態管理構造が整っている
- 設定画面実装のための設定保存機構が整っている

---

## 更新履歴

- **2025-11-19**: Phase 3タスクファイル作成
- **2025-11-19**: タスク検証完了（tsumiki:kairo-task-verify により更新）
  - 信頼性レベルセクション追加
